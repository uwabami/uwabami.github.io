<!doctype html>
<html ⚡ lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="preconnect dns-prefetch" href="//cdn.ampproject.org" crossorigin>
    <link rel="preconnect dns-prefetch" href="//uwabami.github.io/" crossorigin>
    <!-- amp preload -->
    <link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js">
    <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/ComicNeueSubset.woff2" crossorigin>
    <!-- end amp preload -->
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-geo" src="https://cdn.ampproject.org/v0/amp-geo-0.1.js"></script>
    <script async custom-element="amp-consent" src="https://cdn.ampproject.org/v0/amp-consent-0.1.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-form" src="https://cdn.ampproject.org/v0/amp-form-0.1.js"></script>
    <style amp-custom>:root{--font-family: sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", Symbola;--line-height: 1.5;--font-weight: 400;--font-size: 16px;--border-radius: 0.25rem;--border-width: 1px;--outline-width: 3px;--spacing: 1rem;--typography-spacing-vertical: 1.5rem;--block-spacing-vertical: calc(var(--spacing) * 2);--block-spacing-horizontal: var(--spacing);--grid-spacing-vertical: 0;--grid-spacing-horizontal: var(--spacing);--form-element-spacing-vertical: 0.75rem;--form-element-spacing-horizontal: 1rem;--nav-element-spacing-vertical: 1rem;--nav-element-spacing-horizontal: 0.5rem;--nav-link-spacing-vertical: 0.5rem;--nav-link-spacing-horizontal: 0.5rem;--form-label-font-weight: var(--font-weight);--transition: 0.2s ease-in-out;--modal-overlay-backdrop-filter: blur(0.25rem)}@media(min-width: 576px){:root{--font-size: 17px}}@media(min-width: 768px){:root{--font-size: 18px}}@media(min-width: 992px){:root{--font-size: 19px}}@media(min-width: 1200px){:root{--font-size: 20px}}@media(min-width: 576px){body>header,body>main,body>footer,section{--block-spacing-vertical: calc(var(--spacing) * 2.5)}}@media(min-width: 768px){body>header,body>main,body>footer,section{--block-spacing-vertical: calc(var(--spacing) * 3)}}@media(min-width: 992px){body>header,body>main,body>footer,section{--block-spacing-vertical: calc(var(--spacing) * 3.5)}}@media(min-width: 1200px){body>header,body>main,body>footer,section{--block-spacing-vertical: calc(var(--spacing) * 4)}}@media(min-width: 576px){article{--block-spacing-horizontal: calc(var(--spacing) * 1.25)}}@media(min-width: 768px){article{--block-spacing-horizontal: calc(var(--spacing) * 1.5)}}@media(min-width: 992px){article{--block-spacing-horizontal: calc(var(--spacing) * 1.75)}}@media(min-width: 1200px){article{--block-spacing-horizontal: calc(var(--spacing) * 2)}}dialog>article{--block-spacing-vertical: calc(var(--spacing) * 2);--block-spacing-horizontal: var(--spacing)}@media(min-width: 576px){dialog>article{--block-spacing-vertical: calc(var(--spacing) * 2.5);--block-spacing-horizontal: calc(var(--spacing) * 1.25)}}@media(min-width: 768px){dialog>article{--block-spacing-vertical: calc(var(--spacing) * 3);--block-spacing-horizontal: calc(var(--spacing) * 1.5)}}a{--text-decoration: none}a.secondary,a.contrast{--text-decoration: underline}small{--font-size: 0.875em}h1,h2,h3,h4,h5,h6{--font-weight: normal}h1{--font-size: 2rem}h2{--font-size: 1.75rem;border-bottom:1px solid #5af;font-weight:normal;padding:0;margin:1rem 0 0 0}h3{--font-size: 1.5rem;border-bottom:1px dashed #5af;font-weight:normal;margin:1rem 0 0 0}h4{--font-size: 1.25rem;border-bottom:1px dotted #5af;font-weight:normal;margin:1rem 0 0 0}h5{--font-size: 1.125rem;border-bottom:1px dashed #333;font-weight:normal;margin:1rem 0 0 0}h6{--font-size: 1.05rem;border-bottom:1px dashed #333;font-weight:normal;margin:1rem 0 0 0}strong{font-weight:normal;font-size:1.75em}[type=checkbox],[type=radio]{--border-width: 2px}[type=checkbox][role=switch]{--border-width: 3px}thead th,thead td,tfoot th,tfoot td{--border-width: 3px}:not(thead,tfoot)>*>td{--font-size: 0.875em}pre,code,kbd,samp{--font-family: "Menlo", "Cascadia", "Cascadia Code", "Cascadia Mono", "Consolas", "Monaco", monospace, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", Symbola}kbd{--font-weight: bolder}:root{--background-color: #fff;--color: hsl(205, 20%, 32%);--h1-color: hsl(205, 30%, 15%);--h2-color: #24333e;--h3-color: hsl(205, 25%, 23%);--h4-color: #374956;--h5-color: hsl(205, 20%, 32%);--h6-color: #4d606d;--muted-color: hsl(205, 10%, 50%);--muted-border-color: hsl(205, 20%, 94%);--primary: hsl(195, 85%, 41%);--primary-hover: hsl(195, 90%, 32%);--primary-focus: rgba(16, 149, 193, 0.125);--primary-inverse: #fff;--secondary: hsl(205, 15%, 41%);--secondary-hover: hsl(205, 20%, 32%);--secondary-focus: rgba(89, 107, 120, 0.125);--secondary-inverse: #fff;--contrast: hsl(205, 30%, 15%);--contrast-hover: #000;--contrast-focus: rgba(89, 107, 120, 0.125);--contrast-inverse: #fff;--mark-background-color: #fff2ca;--mark-color: #543a26;--ins-color: #388e3c;--del-color: #c62828;--blockquote-border-color: var(--muted-border-color);--blockquote-footer-color: var(--muted-color);--button-box-shadow: 0 0 0 rgba(0, 0, 0, 0);--button-hover-box-shadow: 0 0 0 rgba(0, 0, 0, 0);--form-element-background-color: transparent;--form-element-border-color: hsl(205, 14%, 68%);--form-element-color: var(--color);--form-element-placeholder-color: var(--muted-color);--form-element-active-background-color: transparent;--form-element-active-border-color: var(--primary);--form-element-focus-color: var(--primary-focus);--form-element-disabled-background-color: hsl(205, 18%, 86%);--form-element-disabled-border-color: hsl(205, 14%, 68%);--form-element-disabled-opacity: 0.5;--form-element-invalid-border-color: #c62828;--form-element-invalid-active-border-color: #d32f2f;--form-element-invalid-focus-color: rgba(211, 47, 47, 0.125);--form-element-valid-border-color: #388e3c;--form-element-valid-active-border-color: #43a047;--form-element-valid-focus-color: rgba(67, 160, 71, 0.125);--switch-background-color: hsl(205, 16%, 77%);--switch-color: var(--primary-inverse);--switch-checked-background-color: var(--primary);--range-border-color: hsl(205, 18%, 86%);--range-active-border-color: hsl(205, 16%, 77%);--range-thumb-border-color: var(--background-color);--range-thumb-color: var(--secondary);--range-thumb-hover-color: var(--secondary-hover);--range-thumb-active-color: var(--primary);--table-border-color: var(--muted-border-color);--table-row-stripped-background-color: #f6f8f9;--code-background-color: hsl(210, 28%, 97%);--code-color: var(--muted-color);--code-kbd-background-color: var(--contrast);--code-kbd-color: var(--contrast-inverse);--code-tag-color: hsl(330, 40%, 50%);--code-property-color: hsl(185, 40%, 40%);--code-value-color: hsl(40, 20%, 50%);--code-comment-color: hsl(205, 14%, 68%);--accordion-border-color: var(--muted-border-color);--accordion-close-summary-color: var(--color);--accordion-open-summary-color: var(--muted-color);--card-background-color: var(--background-color);--card-border-color: var(--muted-border-color);--card-box-shadow: 0.0145rem 0.029rem 0.174rem rgba(27, 40, 50, 0.01698), 0.0335rem 0.067rem 0.402rem rgba(27, 40, 50, 0.024), 0.0625rem 0.125rem 0.75rem rgba(27, 40, 50, 0.03), 0.1125rem 0.225rem 1.35rem rgba(27, 40, 50, 0.036), 0.2085rem 0.417rem 2.502rem rgba(27, 40, 50, 0.04302), 0.5rem 1rem 6rem rgba(27, 40, 50, 0.06), 0 0 0 0.0625rem rgba(27, 40, 50, 0.015);--card-sectionning-background-color: #fbfbfc;--dropdown-background-color: #fbfbfc;--dropdown-border-color: #e1e6eb;--dropdown-box-shadow: var(--card-box-shadow);--dropdown-color: var(--color);--dropdown-hover-background-color: hsl(205, 20%, 94%);--modal-overlay-background-color: rgba(213, 220, 226, 0.7);--progress-background-color: hsl(205, 18%, 86%);--progress-color: var(--primary);--loading-spinner-opacity: 0.5;--tooltip-background-color: var(--contrast);--tooltip-color: var(--contrast-inverse)}progress,[type=checkbox],[type=radio],[type=range]{accent-color:var(--primary)}*,*::before,*::after{box-sizing:border-box;background-repeat:no-repeat}::before,::after{text-decoration:inherit;vertical-align:inherit}:where(:root){-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-text-size-adjust:100%;text-size-adjust:100%;background-color:var(--background-color);color:var(--color);font-weight:var(--font-weight);font-size:var(--font-size);line-height:var(--line-height);font-family:var(--font-family);text-rendering:optimizeLegibility;overflow-wrap:break-word;cursor:default;tab-size:4}main{display:block}body{width:100%;margin:0}body>header,body>main,body>footer{width:100%;margin-right:auto;margin-left:auto;padding:var(--block-spacing-vertical) 0}.container,.container-fluid{width:100%;margin-right:auto;margin-left:auto;padding-right:var(--spacing);padding-left:var(--spacing)}@media(min-width: 576px){.container{max-width:510px;padding-right:0;padding-left:0}}@media(min-width: 768px){.container{max-width:700px}}@media(min-width: 992px){.container{max-width:920px}}@media(min-width: 1200px){.container{max-width:1130px}}section{margin-bottom:var(--block-spacing-vertical)}.grid{grid-column-gap:var(--grid-spacing-horizontal);grid-row-gap:var(--grid-spacing-vertical);display:grid;grid-template-columns:1fr;margin:0}@media(min-width: 992px){.grid{grid-template-columns:repeat(auto-fit, minmax(0%, 1fr))}}.grid>*{min-width:0}figure{display:block;margin:0;padding:0;overflow-x:auto}figure figcaption{padding:calc(var(--spacing)*.5) 0;color:var(--muted-color)}b,strong{font-weight:bolder}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}address,blockquote,dl,figure,form,ol,p,pre,table,ul{margin-top:0;margin-bottom:var(--typography-spacing-vertical);color:var(--color);font-style:normal;font-weight:var(--font-weight);font-size:var(--font-size)}a,[role=link]{--color: var(--primary);--background-color: transparent;outline:none;background-color:var(--background-color);color:var(--color);text-decoration:var(--text-decoration);transition:background-color var(--transition),color var(--transition),text-decoration var(--transition),box-shadow var(--transition)}a:is([aria-current],:hover,:active,:focus),[role=link]:is([aria-current],:hover,:active,:focus){--color: var(--primary-hover);--text-decoration: underline}a:focus,[role=link]:focus{--background-color: var(--primary-focus)}a.secondary,[role=link].secondary{--color: var(--secondary)}a.secondary:is([aria-current],:hover,:active,:focus),[role=link].secondary:is([aria-current],:hover,:active,:focus){--color: var(--secondary-hover)}a.secondary:focus,[role=link].secondary:focus{--background-color: var(--secondary-focus)}a.contrast,[role=link].contrast{--color: var(--contrast)}a.contrast:is([aria-current],:hover,:active,:focus),[role=link].contrast:is([aria-current],:hover,:active,:focus){--color: var(--contrast-hover)}a.contrast:focus,[role=link].contrast:focus{--background-color: var(--contrast-focus)}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:var(--typography-spacing-vertical);color:var(--color);font-weight:var(--font-weight);font-size:var(--font-size);font-family:var(--font-family)}h1{--color: var(--h1-color)}h2{--color: var(--h2-color)}h3{--color: var(--h3-color)}h4{--color: var(--h4-color)}h5{--color: var(--h5-color)}h6{--color: var(--h6-color)}:where(address,blockquote,dl,figure,form,ol,p,pre,table,ul)~:is(h1,h2,h3,h4,h5,h6){margin-top:var(--typography-spacing-vertical)}hgroup,.headings{margin-bottom:var(--typography-spacing-vertical)}hgroup>*,.headings>*{margin-bottom:0}hgroup>*:last-child,.headings>*:last-child{--color: var(--muted-color);--font-weight: unset;font-size:1rem;font-family:unset}p{margin-bottom:var(--typography-spacing-vertical)}small{font-size:var(--font-size)}:where(dl,ol,ul){padding-right:0;padding-left:var(--spacing);padding-inline-start:var(--spacing);padding-inline-end:0}:where(dl,ol,ul) li{margin-bottom:calc(var(--typography-spacing-vertical)*.25)}:where(dl,ol,ul) :is(dl,ol,ul){margin:0;margin-top:calc(var(--typography-spacing-vertical)*.25)}ul li{list-style:square}mark{padding:.125rem .25rem;background-color:var(--mark-background-color);color:var(--mark-color);vertical-align:baseline}blockquote{display:block;margin:var(--typography-spacing-vertical) 0;padding:var(--spacing);border-right:none;border-left:.25rem solid var(--blockquote-border-color);border-inline-start:.25rem solid var(--blockquote-border-color);border-inline-end:none}blockquote footer{margin-top:calc(var(--typography-spacing-vertical)*.5);color:var(--blockquote-footer-color)}abbr[title]{border-bottom:1px dotted;text-decoration:none;cursor:help}ins{color:var(--ins-color);text-decoration:none}del{color:var(--del-color)}::selection{background-color:var(--primary-focus)}ul li{list-style:disc}dl{padding-left:0px}dd{margin-left:1rem}input,optgroup,select,textarea{margin:0;font-size:1rem;line-height:var(--line-height);font-family:inherit;letter-spacing:inherit}input{overflow:visible}select{text-transform:none}legend{max-width:100%;padding:0;color:inherit;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{padding:0}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}::-moz-focus-inner{padding:0;border-style:none}:-moz-focusring{outline:none}:-moz-ui-invalid{box-shadow:none}::-ms-expand{display:none}[type=file],[type=range]{padding:0;border-width:0}input:not([type=checkbox],[type=radio],[type=range]){height:calc(1rem*var(--line-height) + var(--form-element-spacing-vertical)*2 + var(--border-width)*2)}fieldset{margin:0;margin-bottom:var(--spacing);padding:0;border:0}label,fieldset legend{display:block;margin-bottom:calc(var(--spacing)*.25);font-weight:var(--form-label-font-weight, var(--font-weight))}input:not([type=checkbox],[type=radio]),select,textarea{width:100%}input:not([type=checkbox],[type=radio],[type=range],[type=file]),select,textarea{appearance:none;padding:var(--form-element-spacing-vertical) var(--form-element-spacing-horizontal)}input,select,textarea{--background-color: var(--form-element-background-color);--border-color: var(--form-element-border-color);--color: var(--form-element-color);--box-shadow: none;border:var(--border-width) solid var(--border-color);border-radius:var(--border-radius);outline:none;background-color:var(--background-color);box-shadow:var(--box-shadow);color:var(--color);font-weight:var(--font-weight);transition:background-color var(--transition),border-color var(--transition),color var(--transition),box-shadow var(--transition)}input:not([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[readonly]):is(:active,:focus),:where(select,textarea):is(:active,:focus){--background-color: var(--form-element-active-background-color)}input:not([type=submit],[type=button],[type=reset],[role=switch],[readonly]):is(:active,:focus),:where(select,textarea):is(:active,:focus){--border-color: var(--form-element-active-border-color)}input:not([type=submit],[type=button],[type=reset],[type=range],[type=file],[readonly]):focus,select:focus,textarea:focus{--box-shadow: 0 0 0 var(--outline-width) var(--form-element-focus-color)}input:not([type=submit],[type=button],[type=reset])[disabled],select[disabled],textarea[disabled],:where(fieldset[disabled]) :is(input:not([type=submit],[type=button],[type=reset]),select,textarea){--background-color: var(--form-element-disabled-background-color);--border-color: var(--form-element-disabled-border-color);opacity:var(--form-element-disabled-opacity);pointer-events:none}:where(input,select,textarea):not([type=checkbox],[type=radio],[type=date],[type=datetime-local],[type=month],[type=time],[type=week])[aria-invalid]{padding-right:calc(var(--form-element-spacing-horizontal) + 1.5rem);padding-left:var(--form-element-spacing-horizontal);padding-inline-start:var(--form-element-spacing-horizontal);padding-inline-end:calc(var(--form-element-spacing-horizontal) + 1.5rem);background-position:center right .75rem;background-size:1rem auto;background-repeat:no-repeat}:where(input,select,textarea):not([type=checkbox],[type=radio],[type=date],[type=datetime-local],[type=month],[type=time],[type=week])[aria-invalid=false]{background-image:var(--icon-valid)}:where(input,select,textarea):not([type=checkbox],[type=radio],[type=date],[type=datetime-local],[type=month],[type=time],[type=week])[aria-invalid=true]{background-image:var(--icon-invalid)}:where(input,select,textarea)[aria-invalid=false]{--border-color: var(--form-element-valid-border-color)}:where(input,select,textarea)[aria-invalid=false]:is(:active,:focus){--border-color: var(--form-element-valid-active-border-color);--box-shadow: 0 0 0 var(--outline-width) var(--form-element-valid-focus-color)}:where(input,select,textarea)[aria-invalid=true]{--border-color: var(--form-element-invalid-border-color)}:where(input,select,textarea)[aria-invalid=true]:is(:active,:focus){--border-color: var(--form-element-invalid-active-border-color);--box-shadow: 0 0 0 var(--outline-width) var(--form-element-invalid-focus-color)}[dir=rtl] :where(input,select,textarea):not([type=checkbox],[type=radio]):is([aria-invalid],[aria-invalid=true],[aria-invalid=false]){background-position:center left .75rem}input::placeholder,input::-webkit-input-placeholder,textarea::placeholder,textarea::-webkit-input-placeholder,select:invalid{color:var(--form-element-placeholder-color);opacity:1}input:not([type=checkbox],[type=radio]),select,textarea{margin-bottom:var(--spacing)}select::-ms-expand{border:0;background-color:rgba(0,0,0,0)}select:not([multiple],[size]){padding-right:calc(var(--form-element-spacing-horizontal) + 1.5rem);padding-left:var(--form-element-spacing-horizontal);padding-inline-start:var(--form-element-spacing-horizontal);padding-inline-end:calc(var(--form-element-spacing-horizontal) + 1.5rem);background-image:var(--icon-chevron);background-position:center right .75rem;background-size:1rem auto;background-repeat:no-repeat}[dir=rtl] select:not([multiple],[size]){background-position:center left .75rem}:where(input,select,textarea,.grid)+small{display:block;width:100%;margin-top:calc(var(--spacing)*-0.75);margin-bottom:var(--spacing);color:var(--muted-color)}label>:where(input,select,textarea){margin-top:calc(var(--spacing)*.25)}[type=color]::-webkit-color-swatch-wrapper{padding:0}[type=color]::-moz-focus-inner{padding:0}[type=color]::-webkit-color-swatch{border:0;border-radius:calc(var(--border-radius)*.5)}[type=color]::-moz-color-swatch{border:0;border-radius:calc(var(--border-radius)*.5)}input:not([type=checkbox],[type=radio],[type=range],[type=file]):is([type=date],[type=datetime-local],[type=month],[type=time],[type=week]){--icon-position: 0.75rem;--icon-width: 1rem;padding-right:calc(var(--icon-width) + var(--icon-position));background-image:var(--icon-date);background-position:center right var(--icon-position);background-size:var(--icon-width) auto;background-repeat:no-repeat}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=time]{background-image:var(--icon-time)}[type=date]::-webkit-calendar-picker-indicator,[type=datetime-local]::-webkit-calendar-picker-indicator,[type=month]::-webkit-calendar-picker-indicator,[type=time]::-webkit-calendar-picker-indicator,[type=week]::-webkit-calendar-picker-indicator{width:var(--icon-width);margin-right:calc(var(--icon-width)*-1);margin-left:var(--icon-position);opacity:0}[dir=rtl] :is([type=date],[type=datetime-local],[type=month],[type=time],[type=week]){text-align:right}[type=file]{--color: var(--muted-color);padding:calc(var(--form-element-spacing-vertical)*.5) 0;border:0;border-radius:0;background:none}[type=file]::file-selector-button{--background-color: var(--secondary);--border-color: var(--secondary);--color: var(--secondary-inverse);margin-right:calc(var(--spacing)/2);margin-left:0;margin-inline-start:0;margin-inline-end:calc(var(--spacing)/2);padding:calc(var(--form-element-spacing-vertical)*.5) calc(var(--form-element-spacing-horizontal)*.5);border:var(--border-width) solid var(--border-color);border-radius:var(--border-radius);outline:none;background-color:var(--background-color);box-shadow:var(--box-shadow);color:var(--color);font-weight:var(--font-weight);font-size:1rem;line-height:var(--line-height);text-align:center;cursor:pointer;transition:background-color var(--transition),border-color var(--transition),color var(--transition),box-shadow var(--transition)}[type=file]::file-selector-button:is(:hover,:active,:focus){--background-color: var(--secondary-hover);--border-color: var(--secondary-hover)}[type=file]::-webkit-file-upload-button{--background-color: var(--secondary);--border-color: var(--secondary);--color: var(--secondary-inverse);margin-right:calc(var(--spacing)/2);margin-left:0;margin-inline-start:0;margin-inline-end:calc(var(--spacing)/2);padding:calc(var(--form-element-spacing-vertical)*.5) calc(var(--form-element-spacing-horizontal)*.5);border:var(--border-width) solid var(--border-color);border-radius:var(--border-radius);outline:none;background-color:var(--background-color);box-shadow:var(--box-shadow);color:var(--color);font-weight:var(--font-weight);font-size:1rem;line-height:var(--line-height);text-align:center;cursor:pointer;transition:background-color var(--transition),border-color var(--transition),color var(--transition),box-shadow var(--transition)}[type=file]::-webkit-file-upload-button:is(:hover,:active,:focus){--background-color: var(--secondary-hover);--border-color: var(--secondary-hover)}[type=file]::-ms-browse{--background-color: var(--secondary);--border-color: var(--secondary);--color: var(--secondary-inverse);margin-right:calc(var(--spacing)/2);margin-left:0;margin-inline-start:0;margin-inline-end:calc(var(--spacing)/2);padding:calc(var(--form-element-spacing-vertical)*.5) calc(var(--form-element-spacing-horizontal)*.5);border:var(--border-width) solid var(--border-color);border-radius:var(--border-radius);outline:none;background-color:var(--background-color);box-shadow:var(--box-shadow);color:var(--color);font-weight:var(--font-weight);font-size:1rem;line-height:var(--line-height);text-align:center;cursor:pointer;transition:background-color var(--transition),border-color var(--transition),color var(--transition),box-shadow var(--transition)}[type=file]::-ms-browse:is(:hover,:active,:focus){--background-color: var(--secondary-hover);--border-color: var(--secondary-hover)}[type=range]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;height:1.25rem;background:none}[type=range]::-webkit-slider-runnable-track{width:100%;height:.25rem;border-radius:var(--border-radius);background-color:var(--range-border-color);transition:background-color var(--transition),box-shadow var(--transition)}[type=range]::-moz-range-track{width:100%;height:.25rem;border-radius:var(--border-radius);background-color:var(--range-border-color);transition:background-color var(--transition),box-shadow var(--transition)}[type=range]::-ms-track{width:100%;height:.25rem;border-radius:var(--border-radius);background-color:var(--range-border-color);transition:background-color var(--transition),box-shadow var(--transition)}[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:1.25rem;height:1.25rem;margin-top:-0.5rem;border:2px solid var(--range-thumb-border-color);border-radius:50%;background-color:var(--range-thumb-color);cursor:pointer;transition:background-color var(--transition),transform var(--transition)}[type=range]::-moz-range-thumb{-webkit-appearance:none;width:1.25rem;height:1.25rem;margin-top:-0.5rem;border:2px solid var(--range-thumb-border-color);border-radius:50%;background-color:var(--range-thumb-color);cursor:pointer;transition:background-color var(--transition),transform var(--transition)}[type=range]::-ms-thumb{-webkit-appearance:none;width:1.25rem;height:1.25rem;margin-top:-0.5rem;border:2px solid var(--range-thumb-border-color);border-radius:50%;background-color:var(--range-thumb-color);cursor:pointer;transition:background-color var(--transition),transform var(--transition)}[type=range]:hover,[type=range]:focus{--range-border-color: var(--range-active-border-color);--range-thumb-color: var(--range-thumb-hover-color)}[type=range]:active{--range-thumb-color: var(--range-thumb-active-color)}[type=range]:active::-webkit-slider-thumb{transform:scale(1.25)}[type=range]:active::-moz-range-thumb{transform:scale(1.25)}[type=range]:active::-ms-thumb{transform:scale(1.25)}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search]{padding-inline-start:calc(var(--form-element-spacing-horizontal) + 1.75rem);border-radius:5rem;background-image:var(--icon-search);background-position:center left 1.125rem;background-size:1rem auto;background-repeat:no-repeat}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid]{padding-inline-start:calc(var(--form-element-spacing-horizontal) + 1.75rem);background-position:center left 1.125rem,center right .75rem}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid=false]{background-image:var(--icon-search),var(--icon-valid)}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid=true]{background-image:var(--icon-search),var(--icon-invalid)}[type=search]::-webkit-search-cancel-button{-webkit-appearance:none;display:none}[dir=rtl] :where(input):not([type=checkbox],[type=radio],[type=range],[type=file])[type=search]{background-position:center right 1.125rem}[dir=rtl] :where(input):not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid]{background-position:center right 1.125rem,center left .75rem}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search]{background-image:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(65, 84, 98)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='8'></circle><line x1='21' y1='21' x2='16.65' y2='16.65'></line></svg>")}:where(table){width:100%;border-collapse:collapse;border-spacing:0;text-indent:0}th,td{padding:calc(var(--spacing)/2) var(--spacing);border-bottom:var(--border-width) solid var(--table-border-color);color:var(--color);font-weight:var(--font-weight);font-size:var(--font-size);text-align:left;text-align:start}tfoot th,tfoot td{border-top:var(--border-width) solid var(--table-border-color);border-bottom:0}table[role=grid] tbody tr:nth-child(odd){background-color:var(--table-row-stripped-background-color)}pre,code,kbd,samp{font-size:.875em;font-family:var(--font-family)}pre{-ms-overflow-style:scrollbar;overflow:auto}pre,code,kbd{border-radius:var(--border-radius);background:var(--code-background-color);font-weight:var(--font-weight);line-height:initial}code,kbd{display:inline-block;padding:.375rem .5rem}pre{display:block;margin-bottom:var(--spacing);margin-top:var(--spacing);padding:calc(.5*var(--spacing));overflow-x:auto}pre>code{display:block;padding:var(--spacing);background:none;line-height:var(--line-height)}kbd{background-color:var(--code-kbd-background-color);color:var(--code-kbd-color);vertical-align:baseline}figure.highlight{margin:0;padding:0;border:0;font-family:inherit}.highlight{font-family:inherit}.highlight{background-color:#f8f8f8}.highlight table td{padding:5px}.highlight table pre{margin:0}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .c{color:#998;font-style:italic}.highlight .ch{color:#998;font-style:italic}.highlight .cd{color:#998;font-style:italic}.highlight .cpf{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .gd{color:#000;background-color:#fdd}.highlight .ge{color:#000;font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{color:#000;font-weight:bold}.highlight .kd{color:#000;font-weight:bold}.highlight .kn{color:#000;font-weight:bold}.highlight .kp{color:#000;font-weight:bold}.highlight .kr{color:#000;font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .k{color:#000;font-weight:bold}.highlight .kv{color:#000;font-weight:bold}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .il{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .m{color:#099}.highlight .mb{color:#099}.highlight .mx{color:#099}.highlight .sa{color:#000;font-weight:bold}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .s{color:#d14}.highlight .dl{color:#d14}.highlight .na{color:teal}.highlight .bp{color:#999}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:teal}.highlight .nd{color:#3c5d5d;font-weight:bold}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .fm{color:#900;font-weight:bold}.highlight .nl{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .nv{color:teal}.highlight .vm{color:teal}.highlight .ow{color:#000;font-weight:bold}.highlight .o{color:#000;font-weight:bold}.highlight .w{color:#bbb}hr{height:0;border:0;border-top:1px solid var(--muted-border-color);color:inherit}[hidden],template{display:none}canvas{display:inline-block}details{display:block;margin-bottom:var(--spacing);padding-bottom:var(--spacing);border-bottom:var(--border-width) solid var(--accordion-border-color)}details summary{line-height:1rem;list-style-type:none;cursor:pointer;transition:color var(--transition)}details summary:not([role]){color:var(--accordion-close-summary-color)}details summary::-webkit-details-marker{display:none}details summary::marker{display:none}details summary::-moz-list-bullet{list-style-type:none}details summary::after{display:block;width:1rem;height:1rem;margin-inline-start:calc(var(--spacing, 1rem)*.5);float:right;transform:rotate(-90deg);background-image:var(--icon-chevron);background-position:right center;background-size:1rem auto;background-repeat:no-repeat;content:"";transition:transform var(--transition)}details summary:focus{outline:none}details summary:focus:not([role=button]){color:var(--accordion-active-summary-color)}details summary[role=button]{width:100%;text-align:left}details summary[role=button]::after{height:calc(1rem*var(--line-height, 1.5));background-image:var(--icon-chevron-button)}details summary[role=button]:not(.outline).contrast::after{background-image:var(--icon-chevron-button-inverse)}details[open]>summary{margin-bottom:calc(var(--spacing))}details[open]>summary:not([role]):not(:focus){color:var(--accordion-open-summary-color)}details[open]>summary::after{transform:rotate(0)}[dir=rtl] details summary{text-align:right}[dir=rtl] details summary::after{float:left;background-position:left center}:where(nav li)::before{float:left;content:"​"}nav,nav ul{display:flex}nav{justify-content:space-between}nav ol,nav ul{align-items:center;margin-bottom:0;padding:0;list-style:none}nav ol:first-of-type,nav ul:first-of-type{margin-left:calc(var(--nav-element-spacing-horizontal)*-1)}nav ol:last-of-type,nav ul:last-of-type{margin-right:calc(var(--nav-element-spacing-horizontal)*-1)}nav li{display:inline-block;margin:0;padding:var(--nav-element-spacing-vertical) var(--nav-element-spacing-horizontal)}nav li>*{--spacing: 0}nav :where(a,[role=link]){display:inline-block;margin:calc(var(--nav-link-spacing-vertical)*-1) calc(var(--nav-link-spacing-horizontal)*-1);padding:var(--nav-link-spacing-vertical) var(--nav-link-spacing-horizontal);border-radius:var(--border-radius);text-decoration:none}nav :where(a,[role=link]):is([aria-current],:hover,:active,:focus){text-decoration:none}nav[aria-label=breadcrumb]{align-items:center;justify-content:start}nav[aria-label=breadcrumb] ul li:not(:first-child){margin-inline-start:var(--nav-link-spacing-horizontal)}nav[aria-label=breadcrumb] ul li:not(:last-child) ::after{position:absolute;width:calc(var(--nav-link-spacing-horizontal)*2);margin-inline-start:calc(var(--nav-link-spacing-horizontal)/2);content:"/";color:var(--muted-color);text-align:center}nav[aria-label=breadcrumb] a[aria-current]{background-color:rgba(0,0,0,0);color:inherit;text-decoration:none;pointer-events:none}nav [role=button]{margin-right:inherit;margin-left:inherit;padding:var(--nav-link-spacing-vertical) var(--nav-link-spacing-horizontal)}aside nav,aside ol,aside ul,aside li{display:block}aside li{padding:calc(var(--nav-element-spacing-vertical)*.5) var(--nav-element-spacing-horizontal)}aside li a{display:block}aside li [role=button]{margin:inherit}[dir=rtl] nav[aria-label=breadcrumb] ul li:not(:last-child) ::after{content:"\\"}nav input:not([type=checkbox],[type=radio]),nav select,nav textarea{width:100%;max-width:300px}nav[aria-label=breadcrumb] ul li:not(:last-child) ::after{text-decoration:none}details[role=list],li[role=list]{position:relative}details[role=list] summary+ul,li[role=list]>ul{display:flex;z-index:99;position:absolute;top:auto;right:0;left:0;flex-direction:column;margin:0;padding:0;border:var(--border-width) solid var(--dropdown-border-color);border-radius:var(--border-radius);border-top-right-radius:0;border-top-left-radius:0;background-color:var(--dropdown-background-color);box-shadow:var(--card-box-shadow);color:var(--dropdown-color);white-space:nowrap}details[role=list] summary+ul li,li[role=list]>ul li{width:100%;margin-bottom:0;padding:calc(var(--form-element-spacing-vertical)*.5) var(--form-element-spacing-horizontal);list-style:none}details[role=list] summary+ul li:first-of-type,li[role=list]>ul li:first-of-type{margin-top:calc(var(--form-element-spacing-vertical)*.5)}details[role=list] summary+ul li:last-of-type,li[role=list]>ul li:last-of-type{margin-bottom:calc(var(--form-element-spacing-vertical)*.5)}details[role=list] summary+ul li a,li[role=list]>ul li a{display:block;margin:calc(var(--form-element-spacing-vertical)*-0.5) calc(var(--form-element-spacing-horizontal)*-1);padding:calc(var(--form-element-spacing-vertical)*.5) var(--form-element-spacing-horizontal);overflow:hidden;color:var(--dropdown-color);text-decoration:none;text-overflow:ellipsis}details[role=list] summary+ul li a:hover,li[role=list]>ul li a:hover{background-color:var(--dropdown-hover-background-color)}details[role=list] summary::after,li[role=list]>a::after{display:block;width:1rem;height:calc(1rem*var(--line-height, 1.5));margin-inline-start:.5rem;float:right;transform:rotate(0deg);background-position:right center;background-size:1rem auto;background-repeat:no-repeat;content:""}details[role=list]{padding:0;border-bottom:none}details[role=list] summary{margin-bottom:0}details[role=list] summary:not([role]){height:calc(1rem*var(--line-height) + var(--form-element-spacing-vertical)*2 + var(--border-width)*2);padding:var(--form-element-spacing-vertical) var(--form-element-spacing-horizontal);border:var(--border-width) solid var(--form-element-border-color);border-radius:var(--border-radius);background-color:var(--form-element-background-color);color:var(--form-element-placeholder-color);line-height:inherit;cursor:pointer;transition:background-color var(--transition),border-color var(--transition),color var(--transition),box-shadow var(--transition)}details[role=list] summary:not([role]):active,details[role=list] summary:not([role]):focus{border-color:var(--form-element-active-border-color);background-color:var(--form-element-active-background-color)}details[role=list] summary:not([role]):focus{box-shadow:0 0 0 var(--outline-width) var(--form-element-focus-color)}details[role=list][open] summary{border-bottom-right-radius:0;border-bottom-left-radius:0}details[role=list][open] summary::before{display:block;z-index:1;position:fixed;top:0;right:0;bottom:0;left:0;background:none;content:"";cursor:default}nav details[role=list] summary,nav li[role=list] a{display:flex;direction:ltr}nav details[role=list] summary+ul,nav li[role=list]>ul{min-width:fit-content;border-radius:var(--border-radius)}nav details[role=list] summary+ul li a,nav li[role=list]>ul li a{border-radius:0}nav details[role=list] summary,nav details[role=list] summary:not([role]){height:auto;padding:var(--nav-link-spacing-vertical) var(--nav-link-spacing-horizontal)}nav details[role=list][open] summary{border-radius:var(--border-radius)}nav details[role=list] summary+ul{margin-top:var(--outline-width);margin-inline-start:0}nav details[role=list] summary[role=link]{margin-bottom:calc(var(--nav-link-spacing-vertical)*-1);line-height:var(--line-height)}nav details[role=list] summary[role=link]+ul{margin-top:calc(var(--nav-link-spacing-vertical) + var(--outline-width));margin-inline-start:calc(var(--nav-link-spacing-horizontal)*-1)}li[role=list]:hover>ul,li[role=list] a:active~ul,li[role=list] a:focus~ul{display:flex}li[role=list]>ul{display:none;margin-top:calc(var(--nav-link-spacing-vertical) + var(--outline-width));margin-inline-start:calc(var(--nav-element-spacing-horizontal) - var(--nav-link-spacing-horizontal))}li[role=list]>a::after{background-image:var(--icon-chevron)}summary[role=link]{transition:color var(--transition)}summary[role=link]::-webkit-details-marker{display:none}summary[role=link]::marker{display:none}summary[role=link]::-moz-list-bullet{list-style-type:none}summary[role=link]::after{display:block;width:1rem;height:1rem;margin-inline-start:calc(var(--spacing, 1rem)*.5);float:right;transform:rotate(-90deg);background-image:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(65, 84, 98)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'></polyline></svg>");background-position:right center;background-size:1rem auto;background-repeat:no-repeat;content:"";transition:transform var(--transition)}[aria-controls]{cursor:pointer}[aria-disabled=true],[disabled]{cursor:not-allowed}[aria-hidden=false][hidden]{display:initial}[aria-hidden=false][hidden]:not(:focus){clip:rect(0, 0, 0, 0);position:absolute}a,area,button,input,label,select,summary,textarea,[tabindex]{-ms-touch-action:manipulation}[dir=rtl]{direction:rtl}@font-face{font-family:"Comic Neue";font-style:normal;font-weight:400;font-display:swap;src:local("Comic Neue"),local("Comic Neue"),url("/assets/fonts/ComicNeueSubset.woff2") format("woff2")}@font-face{font-family:"AoyagiKouzanTSubset";font-style:normal;font-weight:400;font-display:swap;src:local("AoyagiKouzanTSubset"),local("AoyagiKouzanTSubset"),url("/assets/fonts/AoyagiKouzanTSubset.woff2") format("woff2")}.title-font{font-family:"Comic Neue","AoyagiKouzanTSubset",sans-serif}#top{border-radius:80%}.wrapper{min-height:100%}header{position:sticky;top:0;background-color:var(--background-color);box-shadow:0 6px 10px -10px rgba(0,0,0,.7);margin-bottom:var(--spacing);z-index:100}header nav{--nav-element-spacing-vertical: 0.25rem;--form-element-spacing-vertical: 0.25rem;--typography-spacing-vertical: 0rem}.langselector{margin-left:auto}#table-of-contents{align-items:center;justify-content:start;border-bottom:1px solid rgba(0,0,0,.1);margin-bottom:10px;padding-bottom:10px}#table-of-contents h2{--font-size: 1rem;border:none}#table-of-contents h2:after{content:":";padding:0;margin:0;margin-right:var(--nav-link-spacing-horizontal)}#table-of-contents ul li:not(:first-child){margin-inline-start:var(--nav-link-spacing-horizontal)}#table-of-contents ul li:not(:last-child) ::after{position:absolute;width:calc(var(--nav-link-spacing-horizontal)*2);margin-inline-start:calc(var(--nav-link-spacing-horizontal)/2);content:"/";color:var(--muted-color);text-align:center;text-decoration:none}#table-of-contents a[aria-current]{background-color:rgba(0,0,0,0);color:inherit;text-decoration:none;pointer-events:none}footer p{text-align:right}.profile-picture{height:20vw;max-height:260px;width:20vw;max-width:260px;position:relative;float:right;border-radius:50%;margin-top:-1rem}.menu-btn{display:none}@media(min-width: 768px){.md-hide{display:none}.back_to_top{margin-left:85%}.title-font{font-size:3rem}}@media(max-width: 768px){.menu-icon{display:flex;height:60px;width:60px;justify-content:center;align-items:center;position:relative;z-index:200;cursor:pointer}.menu-icon span,.menu-icon span:before,.menu-icon span:after{content:"";display:block;height:3px;width:25px;border-radius:3px;background:#000;transition:.5s;position:absolute}.menu-icon span:before{bottom:8px}.menu-icon span:after{top:8px}#menu-btn:checked~.menu-icon span{background:#fff}#menu-btn:checked~.menu-icon span::before{bottom:0;transform:rotate(45deg)}#menu-btn:checked~.menu-icon span::after{top:0;transform:rotate(-45deg)}.menu{width:100%;height:100%;position:fixed;top:0;left:100%;z-index:200;background:#fff;transition:.5s;flex-direction:column;margin-top:120px}#menu-btn:checked~.menu{left:0;width:100%}.title-font{font-size:2rem}#table-of-contents{display:none}.sm-hide{display:none}.profile-picture{margin-top:-4rem}}.logo{border-radius:80%}.icon-envelope svg,.icon-key svg,.icon-keybase svg,.icon-twitter svg,.icon-facebook svg,.icon-github svg,.icon-mastodon svg,.icon-amp svg{height:1.2rem;width:1.2rem}.icon-envelope{color:#242424}.icon-key{color:#ff8c00}.icon-keybase{color:#ff8c00}.icon-twitter{color:#55acee}.icon-facebook{color:#3b5998}.icon-github{color:#4c4c4c}.icon-mastodon{color:#3b5998}.icon-amp{color:#ff851b}.research li:nth-child(even){background-color:#f5f5f5}.back_to_top{position:sticky;bottom:20px;margin-top:100vh;margin-left:calc(100% - 20px - 6rem);text-decoration:none;padding:10px;color:#fff;background:#000;border-radius:100px;white-space:nowrap}.nowrap{white-space:pre}a:hover{text-decoration:underline}span.anchor{display:none}.sanchor{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAAAAAA6I3INAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAOAAAADgCxW/H3AAAAH0lEQVQI12M4jAIYDv9HAni4hw/Tmgt3E1YuiqtQAAD5Nq+Ne1ON1gAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxMi0wNy0zMVQxNTowNDowNCswOTowMONpTpcAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMDctMTAtMjhUMDc6NDY6MzArMDk6MDAE9UrdAAAAAElFTkSuQmCC);background-position:bottom right;background-repeat:no-repeat;padding:14px 14px 0px 0px;color:#fff;background-color:rgba(0,0,0,0);font-size:1px}.canchor{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAMAAAADADOpTJ+AAAAIElEQVQI12P4jwQYsHKOHDlCDAe3AVAOSDVcD24OAgAAVIGJOMkyXx4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTItMDctMzFUMTU6MDM6NTgrMDk6MDCO9TH+AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA3LTEwLTI4VDA3OjQ2OjMwKzA5OjAwBPVK3QAAAABJRU5ErkJggg==);background-position:bottom right;background-repeat:no-repeat;padding:12px 12px 0px 0px;color:#fff;background-color:rgba(0,0,0,0);font-size:1px}.mail{display:none}.sanchor:before{display:block;content:" ";margin-top:-110px;height:110px;visibility:hidden}p.source{text-align:right;font-size:80%}p.source cite{font-style:normal}.day h2{font-size:1rem}.amp-htb{--nav-link-spacing-vertical: 0;--nav-link-spacing-horizontal: 0}.comment{display:none}.tdiary-profile-picture{border-radius:50%;width:30vw;max-width:260px;max-height:260px;margin-left:auto;margin-right:auto}@media(max-width: 768px){.tdiary-profile-picture{display:none}}.footer{display:block;margin:0 auto;text-align:right;width:100%}*[id]:before{display:block;content:" ";margin-top:-120px;height:120px;visibility:hidden}    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <meta name="author" content="Youhei SASAKI">
    <!-- end: check google site verification -->
    <!-- alternate -->
    <link rel="alternate" hreflang="ja" href="https://uwabami.github.io/cc-env/Emacs.html" />
    <!-- end: alternate -->
    <!-- begin jekyll seo -->
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Emacs の設定 | Youhei SASAKI’s official site</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Emacs の設定" />
<meta name="author" content="Youhei SASAKI" />
<meta property="og:locale" content="ja" />
<link rel="canonical" href="https://uwabami.github.io/cc-env/Emacs.html" />
<meta property="og:url" content="https://uwabami.github.io/cc-env/Emacs.html" />
<meta property="og:site_name" content="Youhei SASAKI’s official site" />
<meta property="og:image" content="https://uwabami.github.io/assets/img/eyecatch_1600x900.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-01T05:23:49+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://uwabami.github.io/assets/img/eyecatch_1600x900.png" />
<meta property="twitter:title" content="Emacs の設定" />
<meta name="twitter:site" content="@uwabami" />
<meta name="twitter:creator" content="@Youhei SASAKI" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Youhei SASAKI","url":"https://uwabami.github.io/"},"dateModified":"2021-10-01T05:23:49+09:00","datePublished":"2021-10-01T05:23:49+09:00","headline":"Emacs の設定","image":"https://uwabami.github.io/assets/img/eyecatch_1600x900.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://uwabami.github.io/cc-env/Emacs.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://uwabami.github.io/assets/img/eyecatch_1600x900.png"},"name":"Youhei SASAKI"},"url":"https://uwabami.github.io/cc-env/Emacs.html"}</script>
<!-- End Jekyll SEO tag -->
    <!-- end jekyll seo -->
    <link rel="icon" type="image/x-icon" href="https://uwabami.github.io/assets/img/favicon.ico">
    <!-- apple icons -->
    <link rel="apple-touch-icon" href="https://uwabami.github.io/assets/img/favicon-256x256.png">
    <link rel="shortcut-icon" type="image/ico" href="/assets/img/favicon.ico">
  </head>
  <body>
    <!-- include: gdpr -->
<amp-geo layout="nodisplay">
  <script type="application/json">
    {
        "ISOCountryGroups": {
            "eu": [ "preset-eea"]
        }
    }
  </script>
</amp-geo>
<amp-consent layout="nodisplay" id="consent-element">
  <script type="application/json">
    {
        "consents": {
            "my_consent": {
                "promptIfUnknownForGeoGroup": "eu",
                "promptUI": "consent-ui"
            }
        }
    }
  </script>
  <div id="consent-ui">
    <p>I use cookies to analyze how visitors use my website via Google Analytics:</p>
    <button on="tap:consent-element.accept" role="button">Accept</button>
    <button on="tap:consent-element.reject" role="button">Reject</button>
    <button on="tap:consent-element.dismiss" role="button">Dismiss</button>
  </div>
</amp-consent>
    <!-- end include: gdpr -->
    <div class="wrapper container">
      <header>
        <!-- page loop -->
<nav>
  <ul>
    <li>
      <a href="/index.html">
        <amp-img layout="fixed"
                 width="1.2rem"
                 height="1.2rem"
                 src="/assets/img/top.webp"
                 alt="About"
                 id="top">
          <amp-img fallback
                   layout="fixed"
                   width="1.2rem"
                   height="1.2rem"
                   src="/assets/img/top.jpg"
                   alt="About"
                   id="top">
          </amp-img>
        </amp-img>
      </a>
    </li>
  </ul>
  <input class="menu-btn" type="checkbox" id="menu-btn"/>
  <label class="menu-icon" for="menu-btn"><span></span></label>
  <ul class="menu">
    <!-- lang ja -->
    <li>
      <a href="/research/index.html">
        Research
      </a>
    </li>
    <li>
      <details role="list">
        <summary aria-haspopup="listbox" role="link">Software</summary>
        <ul>
          <li>
            <a href="/software/index.html">
              Repository
            </a>
          </li>
          <li>
            <a href="/cc-env/index.html">
              Comp. Memo
            </a>
          </li>
        </ul>
      </details>
    </li>
    <li>
      <a href="https://uwabami.junkhub.org/log">blog</a>
    </li>
    <li>
      <form method="GET"
            action="https://www.google.com/cse"
            target="_top">
        <input name="cx" type="hidden"
               value="017455171263919107349:oumnpe4bynr" />
        <input name="ie" type="hidden" value="UTF-8" />
        <input type="search" placeholder="検索" name="q" required>
      </form>
    </li>
    
  </ul>
</nav>

        <nav aria-label="breadcrumb">
  <ul>
    <!-- create crumbs -->
    <li>
      <a href="/index.html">
        Top
      </a>
    </li>
    <li><a href="/cc-env/index.html">Cc-env</a></li>      <!-- end page loop -->
  </ul>
  <span class="langselector"><!-- end: lang selector -->
  </span>
</nav>

      </header>
      <main role="main">
        <div class="content">
          <h1 class="page-title">Emacs の設定</h1>
          <hr>
<p>
Related <a href="https://uwabami.github.io/cc-env/index.html">Index</a> <a href="https://uwabami.github.io/cc-env/Emacs.html">Emacs</a>
</p>
<div>
<h2 id="org66fa74cd">はじめに</h2>
<div class="outline-text-2" id="text-org66fa74cd">
<p>
ここでは私の Emacs の設定についてまとめています．
</p>

<span class="inline-block">
<amp-img src="https://github.com/uwabami/emacs/actions/workflows/build.yml/badge.svg" width="104px" height="20px" layout="fixed" class="github_badge"><amp-img src="https://github.com/uwabami/emacs/actions/workflows/build.yml/badge.svg" width="104px" height="20px" layout="fixed" class="github_badge" fallback></amp-img><noscript><img src="https://github.com/uwabami/emacs/actions/workflows/build.yml/badge.svg" width="104px" height="20px" class="github_badge"></noscript></amp-img>
<amp-img src="https://img.shields.io/badge/License-GPLv3-blue.svg" width="92px" height="20px" layout="fixed"><amp-img src="https://img.shields.io/badge/License-GPLv3-blue.svg" width="92px" height="20px" layout="fixed" fallback></amp-img><noscript><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" width="92px" height="20px"></noscript></amp-img>
<a href="https://github.com/uwabami/emacs"><span class="icon-github"><svg id="SVGRoot" width="20px" height="20px" version="1.1" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="m5.4144 12.761c0 0.0645-0.0742 0.11613-0.16774 0.11613-0.10645 0.01-0.18064-0.0419-0.18064-0.11613 0-0.0645 0.0742-0.11613 0.16774-0.11613 0.0968-0.01 0.18064 0.0419 0.18064 0.11613zm-1.0032-0.14516c-0.0226 0.0645 0.0419 0.13871 0.13871 0.15806 0.0839 0.0323 0.18064 0 0.2-0.0645 0.0194-0.0645-0.0419-0.13871-0.13871-0.16775-0.0839-0.0226-0.17742 0.01-0.2 0.0742zm1.4258-0.0548c-0.0935 0.0226-0.15806 0.0839-0.14838 0.15806 0.01 0.0645 0.0935 0.10645 0.19032 0.0839 0.0936-0.0226 0.15806-0.0839 0.14839-0.14838-0.01-0.0613-0.0968-0.10323-0.19033-0.0935zm2.1226-12.361c-4.4742 0-7.8968 3.3968-7.8968 7.871 0 3.5774 2.2516 6.6387 5.4677 7.7161 0.41291 0.0742 0.55807-0.18064 0.55807-0.39032 0-0.2-0.01-1.3032-0.01-1.9806 0 0-2.2581 0.48387-2.7323-0.96129 0 0-0.36774-0.93871-0.89677-1.1806 0 0-0.73871-0.50645 0.0516-0.49677 0 0 0.80323 0.0645 1.2452 0.83226 0.70645 1.2452 1.8903 0.88709 2.3516 0.67419 0.0742-0.51613 0.28387-0.87419 0.51613-1.0871-1.8032-0.2-3.6226-0.46129-3.6226-3.5645 0-0.8871 0.24516-1.3323 0.76129-1.9-0.0839-0.20968-0.35806-1.0742 0.0839-2.1903 0.6742-0.20967 2.2258 0.87097 2.2258 0.87097 0.64516-0.18064 1.3387-0.27419 2.0258-0.27419 0.68709 0 1.3806 0.0936 2.0258 0.27419 0 0 1.5516-1.0839 2.2258-0.87097 0.44193 1.1194 0.16774 1.9806 0.0839 2.1903 0.51613 0.57096 0.83226 1.0161 0.83226 1.9 0 3.1129-1.9 3.3613-3.7032 3.5645 0.29678 0.25484 0.54839 0.73871 0.54839 1.4968 0 1.0871-0.01 2.4322-0.01 2.6968 0 0.20968 0.14839 0.46452 0.55807 0.39032 3.2258-1.071 5.4129-4.1322 5.4129-7.7097 0-4.4742-3.629-7.871-8.1032-7.871zm-4.7613 11.126c-0.0419 0.0323-0.0323 0.10646 0.0226 0.16775 0.0516 0.0516 0.12581 0.0742 0.16775 0.0323 0.0419-0.0323 0.0323-0.10645-0.0226-0.16774-0.0516-0.0516-0.12581-0.0742-0.16775-0.0323zm-0.34838-0.26129c-0.0226 0.0419 0.01 0.0935 0.0742 0.12581 0.0516 0.0323 0.11613 0.0226 0.13871-0.0226 0.0226-0.0419-0.01-0.0935-0.0742-0.12581-0.0645-0.0194-0.11613-0.01-0.13871 0.0226zm1.0452 1.1484c-0.0516 0.0419-0.0323 0.13871 0.0419 0.2 0.0742 0.0742 0.16775 0.0839 0.20968 0.0323 0.0419-0.0419 0.0226-0.13871-0.0419-0.2-0.071-0.0742-0.16775-0.0839-0.20968-0.0323zm-0.36774-0.47419c-0.0516 0.0323-0.0516 0.11613 0 0.19032 0.0516 0.0742 0.13871 0.10645 0.18064 0.0742 0.0516-0.0419 0.0516-0.1258 0-0.2-0.0452-0.0742-0.12903-0.10645-0.18064-0.0645z" fill="currentColor" stroke-width=".032258"></path></svg></span></a>
</span>

<p>
基本方針は以下の通り:
</p>
</div>
<div>
<h3 id="org5eaa4818">Debian パッケージがインストールされているならばそれを優先する</h3>
<div class="outline-text-3" id="text-org5eaa4818">
<p>
:<a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">Eating your own dog food - Wikipedia</a>
</p>

<p>
Emacsに関連するDebianパッケージを幾つかメンテナンスしているので,
可能な限りDebianパッケージを使うことにしています．
</p>
</div>
</div>
<div>
<h3 id="orgd2ba4ef2">
<a href="https://github.com/conao3/leaf.el">leaf.el</a>でEmacs のパッケージの導入と設定を行なう</h3>
<div class="outline-text-3" id="text-orgd2ba4ef2">
<p>
設定には<a href="https://github.com/conao3/leaf.el">leaf.el</a>を利用します．
VCS からインストールしたいパッケージが幾つかあるので,
それらについては<a href="https://github.com/dimitri/el-get">el-get</a>を利用しています．
</p>
</div>
</div>
<div>
<h3 id="org458d9cf4">設定は <a href="http://orgmode.org/">Org mode</a> で書きたい</h3>
<div class="outline-text-3" id="text-org458d9cf4">
<p>
以前こんなブログ記事を書きました→ <a href="http://uwabami.junkhub.org/log/20111213.html#p01">Emacsの設定ファイルをorgで書く</a>
</p>

<p>
というわけで, 設定は <a href="http://orgmode.org/worg/org-contrib/babel/intro.html">Org Babel</a> で書いています.
本ファイル(<code>README.org</code>) から,
Makefile 内の以下のスクリプトで <code>~/init.el</code> を生成し, byte-compile します.
</p>
<figure class="highlight"><pre><code class="language-makefile-gmake" data-lang="makefile-gmake">EMACS   ?= emacs
init.el: README.org
    $(EMACS) -Q -q --batch --eval \
       "(progn \
          (require 'ob-tangle) \
          (org-babel-tangle-file \"$&lt;\" \"$@\" \"emacs-lisp\"))"
    $(EMACS) -q -l init.el --batch --eval '(kill-emacs)'
%.elc: %.el
    $(EMACS) -q -l init.el -batch -f batch-byte-compile $&lt;</code></pre></figure>
</div>
</div>
<div>
<h3 id="org990b5166">設定ファイルのヘッダ</h3>
<div class="outline-text-3" id="text-org990b5166">
<p>
出力される <code>init.el</code> 用のヘッダは以下の通り.
<code>lexsical-binding</code> を有効にしておきます．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -*- lexical-binding: nil -*-</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgae182d4d">起動の高速化</h3>
<div class="outline-text-3" id="text-orgae182d4d">
<p>
この辺は <a href="https://emacs-jp.github.io/tips/startup-optimization">Emacs の起動時間を""詰める""</a> を参考に.
設定は <code>early-init.el</code> に移動した方が良いのかもしれないかな.
</p>
</div>
<div>
<h4 id="org373f7f70">Emacs Profiler</h4>
<div class="outline-text-4" id="text-org373f7f70">
<p>
起動の高速化を検証するために, 必要に応じて有効に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (require 'profiler)</span>
<span class="c1">;; (profiler-start 'cpu)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="orgb6dd6727">Magic File Name を一時的に無効化</h4>
<div class="outline-text-4" id="text-orgb6dd6727">
<p>
これだけで 0.2秒縮まった. これは知見である.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:saved-file-name-handler-alist</span> <span class="nv">file-name-handler-alist</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">file-name-handler-alist</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'emacs-startup-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">file-name-handler-alist</span> <span class="nv">my:saved-file-name-handler-alist</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org77e2f299">GC の設定</h4>
<div class="outline-text-4" id="text-org77e2f299">
<p>
起動時に garbage collection を発生させない様にする.
</p>

<p>
メモリ喰いな拡張を入れている場合には,
安易に <code>gc-cons-threshold</code> を上げるのは考えものである.
「gc が走る→大きな領域を掃除するのでその間 emacs が止まる」
という事を頻繁に経験することになるだろう.
</p>

<p>
とはいえ, デフォルト値のままだと
起動時に結構 garbage-collect が走って遅くなるので,
起動時は <code>most-positive-fixnum</code> にしておいて,
起動後に <code>emacs-startup-hook</code> で default に戻すようにしてみた.
</p>

<p>
ついでに <code>idle-timer</code> で入力が無い時に GC を走らせることに.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:default-gc-cons-threshold</span> <span class="nv">gc-cons-threshold</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">gc-cons-threshold</span> <span class="nv">most-positive-fixnum</span><span class="p">)</span>
<span class="c1">;; Run GC every 60 seconds if emacs is idle.</span>
<span class="p">(</span><span class="nv">run-with-idle-timer</span> <span class="mf">60.0</span> <span class="no">t</span> <span class="nf">#'</span><span class="nv">garbage-collect</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'emacs-startup-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">gc-cons-threshold</span> <span class="nv">my:default-gc-cons-threshold</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="orgcb2bfa7b"><code>early-init.el</code></h4>
<div class="outline-text-4" id="text-orgcb2bfa7b">
<p>
Emacs &gt;= 27 からの機能だが, いまいち使い方がわからん.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">push</span> <span class="o">'</span><span class="p">(</span><span class="nv">vertical-scroll-bars</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">default-frame-alist</span><span class="p">)</span>
<span class="p">(</span><span class="nb">push</span> <span class="o">'</span><span class="p">(</span><span class="nv">menu-bar-lines</span>       <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">default-frame-alist</span><span class="p">)</span>
<span class="p">(</span><span class="nb">push</span> <span class="o">'</span><span class="p">(</span><span class="nv">tool-bar-lines</span>       <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">default-frame-alist</span><span class="p">)</span>
<span class="p">(</span><span class="nb">push</span> <span class="o">'</span><span class="p">(</span><span class="nv">scroll-bar-mode</span>      <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">default-frame-alist</span><span class="p">)</span>
<span class="p">(</span><span class="nb">push</span> <span class="o">'</span><span class="p">(</span><span class="nv">blink-cursor-mode</span>    <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">default-frame-alist</span><span class="p">)</span>
<span class="p">(</span><span class="nb">push</span> <span class="o">'</span><span class="p">(</span><span class="nv">column-number-mode</span>   <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">default-frame-alist</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">load-prefer-newer</span> <span class="nv">noninteractive</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">frame-inhibit-implied-resize</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">site-run-file</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; (Setq window-divider-default-right-width 3)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">package-enable-at-startup</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nb">provide</span> <span class="ss">'early-init</span><span class="p">)</span>
<span class="c1">;;; early-init.el ends here</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h3 id="org60bad8a3">ディレクトリ構成の修正</h3>
<div class="outline-text-3" id="text-org60bad8a3">
<p>
分割した設定ファイル群やパッケージでinstallしたパッケージ
の置き場所は <code>user-emacs-directory</code> 以下にまとめています。
</p>

<p>
ディレクトリ構成は以下のようにしました:
</p>
<pre class="example">
    ~/.emacs.d/
     |-- Makefile    ←  byte-compile 用の rule
     |-- README.org  ←  本ファイル．`org-babel-tangle' で init.el を生成
     |-- pkg
     |   |-- elpa/   ←  package.el で導入したパッケージが置かれる場所
     |   `-- el-get/ ←  el-get で導入したパッケージが置かれる場所
     `-- share/      ←  (基本的に)参照するだけの資源置き場所
    ~/.cache/emacs   ←  一次ファイルの置き場所
</pre>
<p>
上記ディレクトリ構成を設定ファイルで使用するために
ディレクトリ配置を宣言しておきます。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">when</span> <span class="nv">load-file-name</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">user-emacs-directory</span>
        <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nv">file-name-directory</span> <span class="nv">load-file-name</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:share</span>
  <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"share/"</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:tmp</span>
  <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">".cache/emacs/"</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:pkg:elpa</span>
  <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"pkg/elpa"</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:pkg:elget</span>
  <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"pkg/el-get"</span> <span class="nv">user-emacs-directory</span><span class="p">))</span></code></pre></figure>
<p>
その他, 良く使うディレクトリもここで設定しておきます．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:nextcloud</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)</span> <span class="s">"/Nextcloud"</span><span class="p">))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:org</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org"</span> <span class="nv">my:d:nextcloud</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org87c9febb">Byte-Compile 時の Common Lisp の読み込み</h3>
<div class="outline-text-3" id="text-org87c9febb">
<p>
幾つかの関数で <code>Common-Lisp</code> 的挙動が期待されているので,
<code>cl-lib</code> を読み込んでおきます．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'cl-lib</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span></code></pre></figure>
<p>
ついでに Emacs 27 以降は
cl が読み込まれていると
`Package cl is deprecated' が表示されるので, これを止めておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">byte-compile-warnings</span> <span class="o">'</span><span class="p">(</span><span class="nb">not</span> <span class="nv">cl-functions</span> <span class="nv">obsolete</span><span class="p">))</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="orgcf4176e7">Package 関連: <a href="https://emacs-jp.github.io/packages/package-management/package-el">package.el</a>, <a href="https://github.com/conao3/leaf.el">leaf.el</a>, <a href="https://github.com/dimitri/el-get">el-get</a>
</h2>
<div class="outline-text-2" id="text-orgcf4176e7">
<p>
<a href="https://github.com/conao3/leaf.el">leaf.el</a>のおかげで,
無いと途方に暮れるパッケージ以外のインストールは無視できるようになります.
</p>
</div>
<div>
<h3 id="orgc51eb87d"><a href="https://emacs-jp.github.io/packages/package-management/package-el">package.el</a></h3>
<div class="outline-text-3" id="text-orgc51eb87d">
<p>
パッケージは基本的に <code>package.el</code> で導入するので, 先ずはその設定.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; elpa/gnutls workaround</span>
<span class="p">(</span><span class="nv">eval-and-compile</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">version&lt;=</span>  <span class="nv">emacs-version</span> <span class="s">"26.2"</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">gnutls-algorithm-priority</span> <span class="s">"NORMAL:-VERS-TLS1.3"</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">custom-set-variables</span>
   <span class="o">'</span><span class="p">(</span><span class="nv">package-archives</span> <span class="o">'</span><span class="p">((</span><span class="s">"gnu"</span>   <span class="o">.</span> <span class="s">"https://elpa.gnu.org/packages/"</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">"melpa"</span> <span class="o">.</span> <span class="s">"https://melpa.org/packages/"</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">"org"</span> <span class="o">.</span> <span class="s">"https://orgmode.org/elpa/"</span><span class="p">)</span>
                        <span class="p">))</span>
   <span class="o">'</span><span class="p">(</span><span class="nv">package-gnupghome-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">".gnupg"</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)))</span>
   <span class="o">'</span><span class="p">(</span><span class="nv">package-user-dir</span> <span class="nv">my:d:pkg:elpa</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">eval-when-compile</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"bootstrap-stamp"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">with-temp-buffer</span>
      <span class="p">(</span><span class="nv">write-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"bootstrap-stamp"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
    <span class="p">))</span>
<span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgc2ededbf"><a href="https://github.com/conao3/leaf.el">leaf.el</a></h3>
<div class="outline-text-3" id="text-orgc2ededbf">
<p>
個々のパッケージの設定には<a href="https://github.com/conao3/leaf.el">leaf.el</a>を利用します.
自分で修正した版やオリジナル版を別の場所から持ってくる場合は
<a href="https://github.com/conao3/leaf.el">leaf.el</a>から<a href="https://github.com/dimitri/el-get">el-get</a>を呼び出します.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="ss">'leaf</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">package-install</span> <span class="ss">'leaf</span> <span class="no">t</span><span class="p">))</span>
<span class="c1">;; (require 'leaf nil 'noerror)</span>
<span class="c1">;; (defvar leaf--load-file-name nil)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">leaf-keywords</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">blackout</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">el-get</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:preface</span>
    <span class="p">(</span><span class="nv">defconst</span> <span class="nv">el-get-dir</span> <span class="nv">my:d:pkg:elget</span><span class="p">)</span> <span class="c1">;; override el-get default</span>
    <span class="ss">:custom</span> <span class="p">((</span><span class="nv">el-get-notify-type</span>       <span class="o">.</span> <span class="ss">'message</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">el-get-git-shallow-clone</span> <span class="o">.</span> <span class="no">t</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf-keywords-init</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org9abae8f2">
<code>exec-path-from-shell</code>: 環境変数の読み込み</h2>
<div class="outline-text-2" id="text-org9abae8f2">
<p>
shell(zsh)で設定した <code>PATH</code> などの環境変数をEmacsに引き継ぐために
<a href="https://github.com/purcell/exec-path-from-shell">purcell/exec-path-from-shell</a> を使います.
今の所
</p>
<ul class="org-ul">
<li><code>DEBEMAIL</code></li>
<li><code>DEBFULLNAME</code></li>
<li><code>GPG_AGENT_INFO</code></li>
<li><code>GPG_KEY_ID</code></li>
<li><code>PASSWORD_STORE_DIR</code></li>
<li><code>PATH</code></li>
<li><code>SHELL</code></li>
<li><code>SKKSERVER</code></li>
<li><code>TEXMFHOME</code></li>
<li><code>WSL_DISTRO_NAME</code></li>
<li><code>http_proxy</code></li>
</ul>
<p>
を読み込んでいます(多いな…).
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">exec-path-from-shell</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:defun</span> <span class="p">(</span><span class="nv">exec-path-from-shell-initialize</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">exec-path-from-shell-check-startup-files</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">exec-path-from-shell-arguments</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">exec-path-from-shell-variables</span>
    <span class="o">.</span> <span class="o">'</span><span class="p">(</span>
        <span class="s">"DEBEMAIL"</span>
        <span class="s">"DEBFULLNAME"</span>
        <span class="s">"GPG_AGENT_INFO"</span>
        <span class="s">"GPG_KEY_ID"</span>
        <span class="s">"PASSWORD_STORE_DIR"</span>
        <span class="s">"PATH"</span>
        <span class="s">"SHELL"</span>
        <span class="s">"SKKSERVER"</span>
        <span class="s">"TEXMFHOME"</span>
        <span class="s">"WSL_DISTRO_NAME"</span>
        <span class="s">"http_proxy"</span>
        <span class="p">)))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">exec-path-from-shell-initialize</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">user-full-name</span>    <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"DEBFULLNAME"</span><span class="p">))</span>
        <span class="nv">user-mail-address</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"DEBEMAIL"</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:password-store</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"PASSWORD_STORE_DIR"</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"Emacs/"</span> <span class="p">(</span><span class="nv">system-name</span><span class="p">))</span>
                          <span class="p">(</span><span class="nv">getenv</span> <span class="s">"PASSWORD_STORE_DIR"</span><span class="p">))</span> <span class="s">""</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org1a8b35da">認証関連: <code>plstore</code>, <code>password-store</code> など</h2>
<div class="outline-text-2" id="text-org1a8b35da">
<ul class="org-ul">
<li>
<code>leaf-plstore</code> で <code>plstore</code> が使えるようになったので,
その設定をしておく.</li>
<li>
<code>auth-password-store</code> で auth-source として <code>password-store</code> を使う.</li>
</ul>
<p>
といった事をしている.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*authentication</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"GPG_KEY_ID"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:password-store</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">leaf-default-plstore</span>
     <span class="p">(</span><span class="nv">plstore-open</span>
         <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"plstore.plist"</span> <span class="nv">my:d:password-store</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'vc-directory-exclusion-list</span>
               <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">my:d:password-store</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">auth-source</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">auth-source-gpg-encrypt-to</span> <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">getenv</span> <span class="s">"GPG_KEY_ID"</span><span class="p">))</span>
      <span class="c1">;; (auth-sources</span>
      <span class="c1">;; . ,(expand-file-name "authinfo.gpg" my:d:password-store))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">password-store</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">auth-source-pass</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">plstore</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">plstore-secret-keys</span> <span class="o">.</span> <span class="ss">'silent</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">plstore-encrypt-to</span>  <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">getenv</span> <span class="s">"GPG_KEY_ID"</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org34ff2306">独自関数</h2>
<div class="outline-text-2" id="text-org34ff2306">
<p>
細かい独自関数, など．
</p>
</div>
<div>
<h3 id="org452a76a8">ファイル名を minibuffer におさまる様に整形</h3>
<div class="outline-text-3" id="text-org452a76a8">
<p>
zsh prompt風味．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:shorten-file-path</span> <span class="p">(</span><span class="nv">fpath</span> <span class="nv">max-length</span><span class="p">)</span>
  <span class="s">"Show up to `max-length' characters of a directory name `fpath' like zsh"</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">path</span> <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nv">split-string</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span> <span class="nv">fpath</span><span class="p">)</span> <span class="s">"/"</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">output</span> <span class="s">""</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">top</span> <span class="p">(</span><span class="nv">mapconcat</span> <span class="ss">'identity</span> <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nb">last</span> <span class="nv">path</span> <span class="mi">3</span><span class="p">))</span> <span class="s">"/"</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">vmax</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">max-length</span> <span class="mi">4</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">top</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">path</span> <span class="p">(</span><span class="nb">butlast</span> <span class="nv">path</span> <span class="mi">3</span><span class="p">))</span>
         <span class="p">)</span>
    <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">path</span>
                <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">output</span><span class="p">)</span> <span class="nv">vmax</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"/"</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">path</span><span class="p">)</span> <span class="nv">output</span><span class="p">))</span> <span class="nv">vmax</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">output</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"/"</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">path</span><span class="p">)</span> <span class="nv">output</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">path</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">path</span><span class="p">)))</span>
    <span class="c1">;; 省略</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">path</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">output</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"/..."</span> <span class="nv">output</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="s">"%s%s"</span> <span class="nv">top</span> <span class="nv">output</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org5b521483">空になったファイルを尋ねずに自動削除</h3>
<div class="outline-text-3" id="text-org5b521483">
<p>
ゴミが残らないし, 地味に便利．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*delete-file-if-no-contents</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:delete-file-if-no-contents</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">buffer-file-name</span> <span class="p">(</span><span class="nv">current-buffer</span><span class="p">))</span>
               <span class="p">(</span><span class="nb">=</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">delete-file</span>
       <span class="p">(</span><span class="nv">buffer-file-name</span> <span class="p">(</span><span class="nv">current-buffer</span><span class="p">)))))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">after-save-hook</span> <span class="o">.</span> <span class="nv">my:delete-file-if-no-contents</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orge279b0e0">scratch を殺さない. 消したら再生成</h3>
<div class="outline-text-3" id="text-orge279b0e0">
<p>
…元ネタがどこだったのか忘れてしまった…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*keepscratchbuffer</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:make-scratch</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">arg</span><span class="p">)</span>
    <span class="s">" *scratch* を作成して buffer-list に放り込む."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">progn</span>
      <span class="p">(</span><span class="nv">set-buffer</span> <span class="p">(</span><span class="nv">get-buffer-create</span> <span class="s">"*scratch*"</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">funcall</span> <span class="nv">initial-major-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">erase-buffer</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">initial-scratch-message</span> <span class="p">(</span><span class="nb">not</span> <span class="nv">inhibit-startup-message</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">insert</span> <span class="nv">initial-scratch-message</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">or</span> <span class="nv">arg</span>
          <span class="p">(</span><span class="k">progn</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">switch-to-buffer</span> <span class="s">"*scratch*"</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">=</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">message</span> <span class="s">"*scratch* is cleared up."</span><span class="p">))</span>
            <span class="p">((</span><span class="nb">=</span> <span class="nv">arg</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">message</span> <span class="s">"another *scratch* is created"</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:buffer-name-list</span> <span class="p">()</span>
    <span class="s">"buffer 一覧の取得"</span>
    <span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">function</span> <span class="nv">buffer-name</span><span class="p">)</span> <span class="p">(</span><span class="nv">buffer-list</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">kill-buffer-query-functions</span>
    <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">string=</span> <span class="s">"*scratch*"</span> <span class="p">(</span><span class="nv">buffer-name</span><span class="p">))</span>
            <span class="p">(</span><span class="k">progn</span> <span class="p">(</span><span class="nv">my:make-scratch</span> <span class="mi">0</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
          <span class="no">t</span><span class="p">)))</span>
   <span class="p">(</span><span class="nv">after-save-hook</span>
    <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">member</span> <span class="s">"*scratch*"</span> <span class="p">(</span><span class="nv">my:buffer-name-list</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">my:make-scratch</span> <span class="mi">1</span><span class="p">)))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org1effd724">
<span class="todo SOMEDAY">SOMEDAY</span> 行末の無駄な空白/改行を削除する <code>[/]</code>
</h3>
<div class="outline-text-3" id="text-org1effd724">
<p>
@see <a href="http://d.hatena.ne.jp/tototoshi/20101202/1291289625">無駄な行末の空白を削除する(Emacs Advent Calendar jp:2010)</a>
</p>

<p>
ただし, RD や Markdown だと空白行に意味があったりするので,
必要に応じて拡張子で判断して外している．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*trailing-white-space</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:delete-trailing-whitespace-exclude-suffix</span>
    <span class="p">(</span><span class="nb">list</span> <span class="s">"\\.rd$"</span> <span class="s">"\\.md$"</span> <span class="s">"\\.rbt$"</span> <span class="s">"\\.rab$"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:delete-trailing-whitespace</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'cl-lib</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">cond</span>
     <span class="p">((</span><span class="nb">equal</span> <span class="no">nil</span>
             <span class="p">(</span><span class="nv">cl-loop</span> <span class="nv">for</span> <span class="nv">pattern</span> <span class="nv">in</span> <span class="nv">my:delete-trailing-whitespace-exclude-suffix</span>
                      <span class="nv">thereis</span> <span class="p">(</span><span class="nv">string-match</span> <span class="nv">pattern</span> <span class="nv">buffer-file-name</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">delete-trailing-whitespace</span><span class="p">))))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">before-save-hook</span> <span class="o">.</span> <span class="nv">my:delete-trailing-whitespace</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> <code>cl 依存の書き換え?</code>
</li>
</ul>
</div>
</div>
<div>
<h3 id="org194b826d">ターミナルで <code>C-M-</code> を打つために</h3>
<div class="outline-text-3" id="text-org194b826d">
<p>
詳細は
<a href="https://superuser.com/questions/83166/using-c-m-to-do-a-query-replace-regexp-in-emacs-running-in-mac-terminal">Using C-M-% to do a query-replace-regexp in Emacs running in Mac terminal</a>
を参照のこと. terminal では <code>C-%</code> (つまり <code>Control-Shift-5</code> )が入力できない, という話.
</p>

<p>
代わりに <code>C-x @</code> を <code>C-M-</code> に解釈させるように設定しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">; cargo cult adaptation of event-apply-control-modifier</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:event-apply-control-meta-modifiers</span> <span class="p">(</span><span class="nv">ignore-prompt</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">vector</span>
   <span class="p">(</span><span class="nv">event-apply-modifier</span> <span class="p">(</span><span class="nv">event-apply-modifier</span> <span class="p">(</span><span class="nv">read-event</span><span class="p">)</span>
                                               <span class="ss">'control</span> <span class="mi">26</span> <span class="s">"C-"</span><span class="p">)</span>
                         <span class="ss">'meta</span> <span class="mi">27</span> <span class="s">"M-"</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">define-key</span> <span class="nv">function-key-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-x @"</span><span class="p">)</span> <span class="ss">'my:event-apply-control-meta-modifiers</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="orgadf8c6bf">言語の設定</h2>
<div class="outline-text-2" id="text-orgadf8c6bf">
<p>
最近のEmacsはlocaleから文字コードを自動判別するらしいので,
以前良く設定していた以下は不要らしいですね(ホントかな…?)。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">set-language-environment</span> <span class="s">"Japanese"</span><span class="p">)</span>
<span class="p">(</span><span class="nv">prefer-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-file-name-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-keyboard-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-terminal-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-default</span> <span class="ss">'buffer-file-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span></code></pre></figure>
<p>
なお, m17n.org の消滅によって上記設定に関する情報の参照元が消えた。
適切な参照元はどこだろう…?
</p>
</div>
<div>
<h3 id="org58d8e6f8">cp5022x.el</h3>
<div class="outline-text-3" id="text-org58d8e6f8">
<p>
Emacs23 から内部が Unicode ベースになっています。
</p>

<p>
しかし文字コードの変換はGNU libcのiconvをベースにしているため,
機種依存文字を含む文字コードの変換をうまく行なえません。
そこで言語設定前に <code>cp5022x.el</code> をインストールすることにしています。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">cp5022x</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">set-charset-priority</span> <span class="ss">'ascii</span> <span class="ss">'japanese-jisx0208</span> <span class="ss">'latin-jisx0201</span>
                        <span class="ss">'katakana-jisx0201</span> <span class="ss">'iso-8859-1</span> <span class="ss">'unicode</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">set-coding-system-priority</span> <span class="ss">'utf-8</span> <span class="ss">'euc-jp</span> <span class="ss">'iso-2022-jp</span> <span class="ss">'cp932</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org1927da44">主にEmacs本体, および同梱されている拡張に関する設定</h2>
<div class="outline-text-2" id="text-org1927da44">
</div>
<div>
<h3 id="orgd140a191">終了時に <code>custom.el</code> を消す</h3>
<div class="outline-text-3" id="text-orgd140a191">
<p>
設定ファイルに極力移す.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">cus-edit</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">custom-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"custom.el"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">custom-file</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"custom.el"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">kill-emacs-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                         <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">custom-file</span><span class="p">)</span>
                             <span class="p">(</span><span class="nb">delete-file</span> <span class="nv">custom-file</span><span class="p">)))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgaee31636">
<code>customize</code> で設定していたアレコレ</h3>
<div class="outline-text-3" id="text-orgaee31636">
<p>
<code>custom.el</code> にある設定は極力こちらに移すようにしている.
</p>
<ul class="org-ul">
<li>大抵の場合ターミナル内で <code>-nw</code> として起動するし,
メニューは触ったことないので使わないので,
フレーム, ツールバー等を非表示にする．</li>
<li>
<code>.elc</code> と <code>.el</code> の timestamp を比較し, 新しい方を読み込む
(<code>load-prefer-newer</code> は Emacs &gt;= 24.4 から).</li>
<li>yes or no を y or n に</li>
</ul>
<p>
他にもイロイロと. 設定が増えてきたら分ける.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">cus-start</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">(</span>
    <span class="c1">;; 表示</span>
    <span class="p">(</span><span class="nv">ring-bell-function</span>     <span class="o">.</span> <span class="ss">'ignore</span><span class="p">)</span>   <span class="c1">; ベル無効化</span>
    <span class="c1">;; 編集</span>
    <span class="p">(</span><span class="nv">tab-width</span>              <span class="o">.</span> <span class="mi">4</span><span class="p">)</span>    <span class="c1">;; tab 幅 4</span>
    <span class="p">(</span><span class="nv">indent-tabs-mode</span>       <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>  <span class="c1">;; tab ではインデントしない</span>
    <span class="p">(</span><span class="nv">fill-column</span>            <span class="o">.</span> <span class="mi">72</span><span class="p">)</span>   <span class="c1">;; RFC2822 風味</span>
    <span class="p">(</span><span class="nv">truncate-lines</span>         <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>  <span class="c1">;; 折り返し無し</span>
    <span class="p">(</span><span class="nv">truncate-partial-width-windows</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">paragraph-start</span>        <span class="o">.</span> <span class="o">'</span><span class="s">"^\\([ 　・○&lt;\t\n\f]\\|(?[0-9a-zA-Z]+)\\)"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">auto-fill-mode</span>         <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">next-line-add-newlines</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>  <span class="c1">;; バッファ終端で newline を入れない</span>
    <span class="p">(</span><span class="nv">read-file-name-completion-ignore-case</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>  <span class="c1">; 大文字小文字区別無し</span>
    <span class="p">(</span><span class="nv">save-abbrevs</span>           <span class="o">.</span> <span class="ss">'silent</span><span class="p">)</span>
    <span class="c1">;; backup</span>
    <span class="p">(</span><span class="nv">auto-save-list-file-prefix</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">".saves-"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">auto-save-default</span>       <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">auto-save-timeout</span>       <span class="o">.</span> <span class="mi">15</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">auto-save-interval</span>      <span class="o">.</span> <span class="mi">60</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">make-backup-files</span>       <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">backup-by-copying</span>       <span class="o">.</span> <span class="no">t</span><span class="p">)</span>  <span class="c1">;; symlink は使わない</span>
    <span class="p">(</span><span class="nv">backup-directory-alist</span>  <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="s">"."</span> <span class="o">.</span> <span class="o">,</span><span class="nv">my:d:tmp</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">auto-save-file-name-transforms</span> <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="s">".*"</span> <span class="o">,</span><span class="nv">my:d:tmp</span> <span class="no">t</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">version-control</span>         <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">kept-new-versions</span>       <span class="o">.</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">kept-old-versions</span>       <span class="o">.</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">delete-old-versions</span>     <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">delete-auto-save-files</span>  <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="c1">;; undo/redo - 数字に根拠無し</span>
    <span class="p">(</span><span class="nv">undo-limit</span>              <span class="o">.</span> <span class="mi">200000</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">undo-strong-limit</span>       <span class="o">.</span> <span class="mi">260000</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">history-length</span>          <span class="o">.</span> <span class="no">t</span><span class="p">)</span>  <span class="c1">;; 無制限(の筈)</span>
    <span class="c1">;; (save-silently           . t)</span>
    <span class="c1">;;</span>
    <span class="p">(</span><span class="nv">safe-local-variable-values</span>
     <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nv">org-link-file-path-type</span> <span class="o">.</span> <span class="nv">absolute</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">boundp</span> <span class="ss">'load-prefer-newer</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">load-prefer-newer</span> <span class="no">t</span><span class="p">))</span>
  <span class="c1">;; yes or no を y or n に</span>
  <span class="p">(</span><span class="nv">fset</span> <span class="ss">'yes-or-no-p</span> <span class="ss">'y-or-n-p</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org9eac26e0">
<code>startup</code>: 起動は静かに</h3>
<div class="outline-text-3" id="text-org9eac26e0">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">startup</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">inhibit-startup-screen</span>            <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">inhibit-startup-message</span>           <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">inhibit-startup-echo-area-message</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">initial-scratch-message</span>           <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org58ba514c">
<code>hl-mode</code>: 現在行のハイライト</h3>
<div class="outline-text-3" id="text-org58ba514c">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">hl-line</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">global-hl-line-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgd5c20561">選択リージョンに色付け</h3>
<div class="outline-text-3" id="text-orgd5c20561">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">simple</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">transient-mark-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org281c29f0">
<code>show-paren-mode</code>: 対応する括弧を強調表示</h3>
<div class="outline-text-3" id="text-org281c29f0">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">paren</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">show-paren-style</span>  <span class="o">.</span> <span class="ss">'mixed</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">show-paren-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgdd3a7c08">
<code>linum-mode</code> : 行番号表示</h3>
<div class="outline-text-3" id="text-orgdd3a7c08">
<p>
必要に応じて有効にするので, 基本使わない.
通常はモードラインに行番号や桁番号を表示しないようする.
ついでに <code>linum-mode</code> を有効にした場合の桁表示を 5 桁に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">line-number-mode</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">linum-format</span>     <span class="o">.</span> <span class="s">"%5d "</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">line-number-mode</span> <span class="o">.</span> <span class="no">nil</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org45fe96c0">byte-compile 関連</h3>
<div class="outline-text-3" id="text-org45fe96c0">
<ul class="org-ul">
<li>debug は表示しない: 必要に応じて t に変更する</li>
<li>Compile-Log の非表示: ほとんど見ないし．</li>
<li>Warning の抑制: これもほとんど見ないし．</li>
</ul>
<p>
他にも増えそうだが
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-and-compile</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">bytecomp</span>
    <span class="ss">:custom</span>
    <span class="p">((</span><span class="nv">byte-compile-warnings</span> <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nb">not</span>
                                <span class="nv">obsolete</span>
                                <span class="nv">free-vars</span>
                                <span class="nv">unresolved</span>
                                <span class="nv">callargs</span>
                                <span class="nv">redefine</span>
                                <span class="nv">noruntime</span>
                                <span class="nv">cl-functions</span>
                                <span class="nv">interactive-only</span>
                                <span class="nv">make-local</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">debug-on-error</span>        <span class="o">.</span> <span class="no">nil</span><span class="p">))</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">win</span> <span class="p">(</span><span class="nv">get-buffer-window</span> <span class="s">"*Compile-Log*"</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">win</span> <span class="p">(</span><span class="nv">delete-window</span> <span class="nv">win</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org41afd6b6">
<code>autorevert</code>: ファイルが変更されたら再読み込み</h3>
<div class="outline-text-3" id="text-org41afd6b6">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">autorevert</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">auto-revert-interval</span> <span class="o">.</span> <span class="mf">0.1</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">global-auto-revert-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org246148ce">
<code>savehist</code>: 変更履歴を保存</h3>
<div class="outline-text-3" id="text-org246148ce">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">savehist</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">savehist-file</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"history"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">savehist-mode</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org35f3de20">ファイル, デイレクトリ整理</h3>
<div class="outline-text-3" id="text-org35f3de20">
<p>
<code>~/.emacs.d/</code> 以下にファイルが転がるのがなんか嫌なので,
気がつく度に設定している.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*change-default-file-location</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">(</span><span class="c1">;; url</span>
    <span class="p">(</span><span class="nv">url-configuration-directory</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"url"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="c1">;; nsm</span>
    <span class="p">(</span><span class="nv">nsm-settings-file</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"nsm.data"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="c1">;; bookmark</span>
    <span class="p">(</span><span class="nv">bookmark-default-file</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"bookmarks"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="c1">;; eshell</span>
    <span class="p">(</span><span class="nv">eshell-directory-name</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eshell"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<p>
他にもイロイロありそう．
<code>bookmark</code> はちゃんと使いこなしたい所ではあるが．
</p>
</div>
</div>
<div>
<h3 id="org6a5a84f9">
<code>eldoc</code>: emacs-lisp document</h3>
<div class="outline-text-3" id="text-org6a5a84f9">
<p>
minibuffer では eldoc にお黙り頂く。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">eldoc</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-lisp-mode-hook</span> <span class="o">.</span> <span class="nv">turn-on-eldoc-mode</span><span class="p">)</span>
  <span class="ss">:blackout</span> <span class="no">t</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:shutup-eldoc-message</span> <span class="p">(</span><span class="nv">f</span> <span class="k">&amp;optional</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">active-minibuffer-window</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">funcall</span> <span class="nv">f</span> <span class="nb">string</span><span class="p">)))</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:around</span> <span class="nv">eldoc-message</span>
           <span class="nv">my:shutup-eldoc-message</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org2157dacb">
<code>midnight</code>: 一定期間使用しなかった buffer を自動削除</h3>
<div class="outline-text-3" id="text-org2157dacb">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">midnight</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">clean-buffer-list-delay-general</span> <span class="o">.</span> <span class="mi">1</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">midnight-mode</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org9a0cf611">
<code>uniquify</code>: モードラインのファイル名にディレクトリも表示する</h3>
<div class="outline-text-3" id="text-org9a0cf611">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">uniquify</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">uniquify-buffer-name-style</span> <span class="o">.</span> <span class="ss">'post-forward-angle-brackets</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">uniquify-min-dir-content</span>   <span class="o">.</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org68c5e01b">
<code>whitespace</code>: 空白の強調表示</h3>
<div class="outline-text-3" id="text-org68c5e01b">
<p>
背景も変えようかなぁ…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">whitespace</span>
  <span class="ss">:blackout</span> <span class="p">((</span><span class="nv">global-whitespace-mode</span> <span class="o">.</span> <span class="s">""</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">whitespace-mode</span>        <span class="o">.</span> <span class="s">""</span><span class="p">))</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">global-whitespace-mode</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">whitespace-line-column</span>      <span class="o">.</span> <span class="mi">72</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">whitespace-style</span>
    <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">face</span>        <span class="c1">; faceを使う</span>
        <span class="nv">trailing</span>    <span class="c1">; 行末の空白を対象.</span>
        <span class="nv">tabs</span>        <span class="c1">; tab</span>
        <span class="nv">spaces</span>      <span class="c1">; space</span>
        <span class="p">))</span>
   <span class="p">(</span><span class="nv">whitespace-display-mappings</span> <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nv">space-mark</span> <span class="nv">?\u3000</span> <span class="nv">[?\□]</span><span class="p">)</span>
                                    <span class="p">(</span><span class="nv">tab-mark</span> <span class="nv">?\t</span> <span class="nv">[?\u00BB</span> <span class="nv">?\t]</span> <span class="nv">[?\\</span> <span class="nv">?\t]</span><span class="p">)))</span>
   <span class="p">(</span><span class="nv">whitespace-space-regexp</span>     <span class="o">.</span> <span class="s">"\\(\u3000+\\)"</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">whitespace-global-modes</span>     <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nb">not</span> <span class="nv">eww-mode</span>
                                        <span class="nv">term-mode</span>
                                        <span class="nv">eshell-mode</span>
                                        <span class="nv">org-agenda-mode</span>
                                        <span class="nv">calendar-mode</span><span class="p">))</span>
   <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org285d3b12">
<code>saveplace</code>: 前回の修正位置を記憶する.</h3>
<div class="outline-text-3" id="text-org285d3b12">
<p>
記憶の保存先を <code>~/.emacs.d/tmp/emacs-places</code> に変更.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">save-place</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">save-place</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">save-place-file</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"emacs-places"</span>  <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">save-place-mode</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">save-place-ingore-files-regexp</span>
        <span class="p">(</span><span class="nb">format</span> <span class="s">"\\(%s\\)\\|\\(%s\\)"</span>
                <span class="nv">save-place-ignore-files-regexp</span>
                <span class="nv">tramp-file-name-regexp</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgd064b693">
<code>time-stamp</code>: 保存時に timestamp を自動更新</h3>
<div class="outline-text-3" id="text-orgd064b693">
<p>
デフォルトではいろいろと衝突したので
更新文字列を変更し,  <code>＄Lastupdate: 2</code> (＄は半角) があったら
timestamp を更新する様にした．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">time-stamp</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">before-save-hook</span> <span class="o">.</span> <span class="nv">time-stamp</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">time-stamp-active</span>     <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">time-stamp-line-limit</span> <span class="o">.</span> <span class="mi">10</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">time-stamp-start</span>      <span class="o">.</span> <span class="s">"$Lastupdate: 2"</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">time-stamp-end</span>        <span class="o">.</span> <span class="s">"\\$"</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">time-stamp-format</span>     <span class="o">.</span> <span class="s">"%Y-%02m-%02d %02H:%02M:%02S"</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<p>
モード独自の設定(例えば Org とか)に関しては別途．
</p>
</div>
</div>
<div>
<h3 id="org04853162">
<code>tramp</code>: ssh 越しにファイルを編集</h3>
<div class="outline-text-3" id="text-org04853162">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">tramp</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">tramp-persistency-file-name</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"tramp"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">tramp-persistency-file-name</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"tramp"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">tramp-completion-reread-directory-timeout</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">kill-emacs-hook</span>
   <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">tramp-persistency-file-name</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">delete-file</span> <span class="nv">tramp-persistency-file-name</span><span class="p">))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org456d3821"><code>browse-url</code></h3>
<div class="outline-text-3" id="text-org456d3821">
<p>
ブラウザ呼び出しは <code>xdg-open/open</code> に丸投げ.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">browse-url</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">(</span><span class="s">"C-c C-j"</span> <span class="o">.</span> <span class="nv">browse-url-at-point</span><span class="p">)</span>
  <span class="ss">:defer-config</span>
  <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nv">executable-find</span> <span class="s">"xdg-open"</span><span class="p">)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">'browse-url-xdg-open</span>
               <span class="nv">browse-url-secondary-browser-function</span> <span class="ss">'browse-url-xdg-open</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'darwin</span><span class="p">)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">'browse-url-default-macosx-browser</span>
               <span class="nv">browse-url-secondary-browser-function</span> <span class="ss">'browse-url-default-macosx-browser</span><span class="p">))</span>
        <span class="p">(</span><span class="no">t</span>
         <span class="c1">;; (setq browse-url-browser-function 'w3m-browse-url)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">'eww-browse-url</span><span class="p">)</span>
         <span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org931fd3cc">
<code>server</code>: Emacs server</h3>
<div class="outline-text-3" id="text-org931fd3cc">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">server</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">server-running-p</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:new-client-frame</span> <span class="p">()</span>
    <span class="s">"Create new GUI emacsclient"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">make-frame-on-display</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"DISPLAY"</span><span class="p">)))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                          <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">server-running-p</span><span class="p">)</span>
                            <span class="p">(</span><span class="nv">server-start</span><span class="p">))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgdd48e2df">buffer の印刷</h3>
<div class="outline-text-3" id="text-orgdd48e2df">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ps-mule</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">ps-multibyte-buffer</span> <span class="o">.</span> <span class="ss">'non-latin-printer</span><span class="p">))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">defalias</span> <span class="ss">'ps-mule-header-string-charset</span> <span class="ss">'ignore</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgcc9538d1">
<code>tab-bar-mode</code>: Emacsの「tab」</h3>
<div class="outline-text-3" id="text-orgcc9538d1">
<p>
Emacs27から同梱された <code>tab-bar-mode</code> に elscreen から乗り換えた.
手癖で "C-o" を prefix で使いたいので, その設定をしていたり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">tab-bar-mode</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">make-sparse-keymap</span><span class="p">)</span>
    <span class="s">"My original keymap binded to C-o."</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defalias</span> <span class="ss">'my:ctrl-o-prefix</span> <span class="nv">my:ctrl-o-map</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-o"</span><span class="p">)</span> <span class="ss">'my:ctrl-o-prefix</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"c"</span><span class="p">)</span>   <span class="ss">'tab-new</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c"</span><span class="p">)</span> <span class="ss">'tab-new</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"k"</span><span class="p">)</span>   <span class="ss">'tab-close</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-k"</span><span class="p">)</span> <span class="ss">'tab-close</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"n"</span><span class="p">)</span>   <span class="ss">'tab-next</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-n"</span><span class="p">)</span> <span class="ss">'tab-next</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"p"</span><span class="p">)</span>   <span class="ss">'tab-previous</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-p"</span><span class="p">)</span> <span class="ss">'tab-previous</span><span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:tab-bar-tab-name-truncated</span> <span class="p">()</span>
    <span class="s">"Custom: Generate tab name from the buffer of the selected window."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">tab-name</span> <span class="p">(</span><span class="nv">buffer-name</span> <span class="p">(</span><span class="nv">window-buffer</span> <span class="p">(</span><span class="nv">minibuffer-selected-window</span><span class="p">))))</span>
          <span class="p">(</span><span class="nv">ellipsis</span> <span class="p">(</span><span class="nb">cond</span>
                     <span class="p">(</span><span class="nv">tab-bar-tab-name-ellipsis</span><span class="p">)</span>
                     <span class="p">((</span><span class="nv">char-displayable-p</span> <span class="nv">?</span><span class="err">…</span><span class="p">)</span> <span class="s">"…"</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">"..."</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">tab-name</span><span class="p">)</span> <span class="nv">tab-bar-tab-name-truncated-max</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">format</span> <span class="s">"%-12s"</span> <span class="nv">tab-name</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">propertize</span> <span class="p">(</span><span class="nv">truncate-string-to-width</span>
                     <span class="nv">tab-name</span> <span class="nv">tab-bar-tab-name-truncated-max</span> <span class="no">nil</span> <span class="no">nil</span>
                     <span class="nv">ellipsis</span><span class="p">)</span>
                    <span class="ss">'help-echo</span> <span class="nv">tab-name</span><span class="p">))))</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">tab-bar-close-button-show</span>      <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-close-last-tab-choice</span>  <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-close-tab-select</span>       <span class="o">.</span> <span class="ss">'left</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-history-mode</span>           <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-new-tab-choice</span>         <span class="o">.</span> <span class="s">"*scratch*"</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-new-button-show</span>        <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-tab-name-function</span>      <span class="o">.</span> <span class="ss">'my:tab-bar-tab-name-truncated</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-tab-name-truncated-max</span> <span class="o">.</span> <span class="mi">12</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tab-bar-separator</span>              <span class="o">.</span> <span class="s">""</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">tab-bar-mode</span> <span class="mi">+1</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li><a href="https://masutaka.net/chalow/2011-09-28-1.html">ターミナルの zsh と Emacs を風のように駆け抜ける！</a></li>
</ul>
</div>
</div>
</div>
<div>
<h2 id="orgb750c5b3">
<code>beacon</code>: buffer 切り替え時の行の強調表示</h2>
<div class="outline-text-2" id="text-orgb750c5b3">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">beacon</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">beacon-color</span>              <span class="o">.</span> <span class="s">"#aa3400"</span><span class="p">)</span>
    <span class="c1">;; (beacon-size               . 64)</span>
    <span class="p">(</span><span class="nv">beacon-blink-when-focused</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:custom-face</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">beacon-fallback-background</span> <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:background</span> <span class="s">"#556b2f"</span><span class="p">)))))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">beacon-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org43970469">
<code>recentf</code>: 最近使ったファイル履歴の保管</h2>
<div class="outline-text-2" id="text-org43970469">
<p>
結局履歴を貯める設定をしている事になっている.
ディレクトリの履歴も取れるので recentf-ext を入れておく
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">recentf</span>
  <span class="ss">:defun</span>
  <span class="p">(</span><span class="nv">recentf-save-list</span> <span class="nv">recentf-cleanup</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">shut-up</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:init</span>
    <span class="p">(</span><span class="nb">defvar</span> <span class="nv">shut-up-ignore</span> <span class="no">t</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:recentf-save-list-silence</span> <span class="p">()</span>
    <span class="s">"Shut up"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">message-log-max</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">shut-up</span> <span class="p">(</span><span class="nv">recentf-save-list</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">message</span> <span class="s">""</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:recentf-cleanup-silence</span> <span class="p">()</span>
    <span class="s">"Shut up"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">message-log-max</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">shut-up</span> <span class="p">(</span><span class="nv">recentf-cleanup</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">message</span> <span class="s">""</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">recentf-ext</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">recentf-mode</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">focus-out-hook</span>  <span class="o">.</span> <span class="nv">my:recentf-save-list-silence</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">focus-out-hook</span>  <span class="o">.</span> <span class="nv">my:recentf-cleanup-silence</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">recentf-save-file</span>       <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"recentf"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">recentf-max-saved-items</span> <span class="o">.</span> <span class="mi">2000</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">recentf-auto-cleanup</span>    <span class="o">.</span> <span class="ss">'never</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">recentf-exclude</span>         <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="s">".recentf"</span>
                                 <span class="s">"^/tmp\\.*"</span>
                                 <span class="s">"^/private\\.*"</span>
                                 <span class="s">"^/var/folders\\.*"</span>
                                 <span class="s">"/TAGS$"</span>
                                 <span class="s">"\\.*草稿\\.*"</span>
                                 <span class="s">"^#\\.*"</span>
                                 <span class="s">"^/home/uwabami/.mozilla/\\.*"</span>
                                 <span class="s">"^/home/uwabami/.emacs.d/tmp/\\.*"</span>
                                 <span class="s">"^/home/uwabami/.dotfiles/Emacs/tmp/\\.*"</span>
                                 <span class="s">"^/[^/:]+:"</span>
                                 <span class="s">"bookmarks"</span>
                                 <span class="s">"org-recent-headings.dat"</span>
                                 <span class="s">"^/mnt/c/\\.*"</span>
                                 <span class="s">"\\.*COMMIT_EDITMSG$"</span>
                                 <span class="s">".*-autoloads.el$"</span>
                                 <span class="s">"^/home/uwabami/.emacs.d/pkg/\\.*"</span>
                                 <span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgd903bf1d">
<code>all-the-icons-in-terminal</code>: ターミナルでもicon fontを使いたい。</h2>
<div class="outline-text-2" id="text-orgd903bf1d">
<p>
<a href="https://github.com/domtronn/all-the-icons.el">all-the-icons.el</a>のデータを修正して,
<a href="https://github.com/sebastiencs/icons-in-terminal">icons in terminal</a>を修正した
自作フォントのデータを読みに行くようにしてみました。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">all-the-icons</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span> <span class="p">(</span><span class="nv">leaf</span> <span class="nv">memoize</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">all-the-icons-scale-factor</span>   <span class="o">.</span> <span class="mf">0.9</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">all-the-icons-default-adjust</span> <span class="o">.</span> <span class="mf">0.0</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">all-the-icons-in-terminal</span>
  <span class="ss">:el-get</span> <span class="p">(</span><span class="nv">all-the-icons-in-terminal</span>
           <span class="ss">:type</span> <span class="nv">github</span>
           <span class="ss">:pkgname</span> <span class="s">"uwabami/isfit-plus"</span><span class="p">)</span>
  <span class="ss">:after</span> <span class="nv">all-the-icons</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'all-the-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">f90-mode</span> <span class="nv">all-the-icons-faicon</span> <span class="s">"facebook"</span><span class="p">))</span> <span class="c1">;; facebook!?</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'all-the-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">wl-folder-mode</span> <span class="nv">all-the-icons-faicon</span> <span class="s">"folder-o"</span> <span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'all-the-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">wl-summary-mode</span> <span class="nv">all-the-icons-faicon</span> <span class="s">"folder-open-o"</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'all-the-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">wl-draft-mode</span> <span class="nv">all-the-icons-material</span> <span class="s">"drafts"</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'all-the-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">mime-view-mode</span> <span class="nv">all-the-icons-faicon</span> <span class="s">"envelope-o"</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
<div>
<h3 id="orgd3ca00ac">
<span class="todo SOMEDAY">SOMEDAY</span> East Asian Ambiguos 対応 <code>[0/1]</code>
</h3>
<div class="outline-text-3" id="text-orgd3ca00ac">
<p>
East Asian Ambiguosを2文字幅にして, ついでに
CJK 以外の East Asian Ambiguosと絵文字も2文字幅にするようにしています。
拙作の修正ロケールはこちら: <a href="https://github.com/uwabami/locale-eaw-emoji">https://github.com/uwabami/locale-eaw-emoji</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">locale-eaw-emoji</span>
  <span class="ss">:el-get</span> <span class="nv">uwabami/locale-eaw-emoji</span>
  <span class="ss">:after</span> <span class="nv">all-the-icons-in-terminal</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="c1">;; (eaw-half-emoji-fullwidth)</span>
  <span class="p">(</span><span class="nv">eaw-and-emoji-fullwidth</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> 最近, EAWは一文字幅強制の方が良いかなぁ, とか悩み中.</li>
</ul>
</div>
</div>
<div>
<h3 id="orgcf967538">macOS対応</h3>
<div class="outline-text-3" id="text-orgcf967538">
<p>
最近良く触る様になったので設定している。
<del>まあ, イマイチ慣れない訳ですけれど</del>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*mac-encoding</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'darwin</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">ucs-normalize</span>
    <span class="ss">:require</span> <span class="no">t</span>
    <span class="ss">:defvar</span> <span class="p">(</span><span class="nv">mac-pass-control-to-system</span> <span class="nv">ns-command-modifier</span> <span class="nv">ns-alternate-modifier</span><span class="p">)</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="nv">set-file-name-coding-system</span> <span class="ss">'utf-8-hfs</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">locale-coding-system</span> <span class="ss">'utf-8-hfs</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">mac-pass-control-to-system</span> <span class="no">t</span>  <span class="c1">;; Ctrl を Mac から奪い取る</span>
          <span class="nv">ns-command-modifier</span> <span class="ss">'meta</span>     <span class="c1">;; Cmd と Option を逆にする</span>
          <span class="nv">ns-alternate-modifier</span> <span class="ss">'super</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">global-set-key</span> <span class="nv">[ns-drag-file]</span> <span class="ss">'ns-find-file</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org3416eeb2">Windows(WSL2)対応</h3>
<div class="outline-text-3" id="text-org3416eeb2">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*wsl2-path</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"WSL_DISTRO_NAME"</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">set-drvfs-alist</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">drvfs-alist</span>
          <span class="p">(</span><span class="nb">mapcar</span>
           <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">"\\(.*\\)|\\(.*?\\)/?$"</span> <span class="nv">x</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">1</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">2</span> <span class="nv">x</span><span class="p">))))</span>
           <span class="p">(</span><span class="nv">split-string</span> <span class="p">(</span><span class="nv">concat</span>
                          <span class="c1">;; //wsl$ パス情報の追加</span>
                          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">"Microsoft"</span> <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="s">"uname -v"</span><span class="p">)))</span>
                                    <span class="p">(</span><span class="nb">&gt;=</span> <span class="p">(</span><span class="nv">string-to-number</span> <span class="p">(</span><span class="nb">nth</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">operating-system-release</span> <span class="s">"-"</span><span class="p">)))</span> <span class="mi">18362</span><span class="p">))</span>
                            <span class="p">(</span><span class="nv">concat</span> <span class="s">"/|"</span> <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="s">"wslpath -m /"</span><span class="p">)))</span>
                          <span class="p">(</span><span class="nv">shell-command-to-string</span>
                           <span class="s">"mount | grep -E ' type (9p|drvfs) ' | grep -v '^tools on /init type 9p' | sed -r 's/(.*) on (.*) type (9p|drvfs) .*/\\2\\|\\1/' | sed 's!\\\\!/!g'"</span><span class="p">))</span>
                         <span class="s">"\n"</span> <span class="no">t</span><span class="p">))))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nv">defconst</span> <span class="nv">windows-path-style-regexp</span> <span class="s">"\\`\\(.*/\\)?\\([a-zA-Z]:\\\\.*\\|[a-zA-Z]:/.*\\|\\\\\\\\.*\\|//.*\\)"</span><span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">windows-path-convert-file-name</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">name</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="nv">windows-path-style-regexp</span> <span class="s">"\\2"</span> <span class="nv">name</span> <span class="no">t</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">name</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">"\\\\"</span> <span class="s">"/"</span> <span class="nv">name</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">case-fold-search</span> <span class="no">t</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">cl-loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">mountpoint</span> <span class="o">.</span> <span class="nv">source</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">drvfs-alist</span>
               <span class="k">if</span> <span class="p">(</span><span class="nv">string-match</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"^\\("</span> <span class="p">(</span><span class="nv">regexp-quote</span> <span class="nv">source</span><span class="p">)</span> <span class="s">"\\)\\($\\|/\\)"</span><span class="p">)</span> <span class="nv">name</span><span class="p">)</span>
               <span class="nb">return</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">"^//"</span> <span class="s">"/"</span> <span class="p">(</span><span class="nv">replace-match</span> <span class="nv">mountpoint</span> <span class="no">t</span> <span class="no">t</span> <span class="nv">name</span> <span class="mi">1</span><span class="p">))</span>
               <span class="nv">finally</span> <span class="nb">return</span> <span class="nv">name</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">windows-path-run-real-handler</span> <span class="p">(</span><span class="nv">operation</span> <span class="nv">args</span><span class="p">)</span>
    <span class="s">"Run OPERATION with ARGS."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inhibit-file-name-handlers</span>
           <span class="p">(</span><span class="nb">cons</span> <span class="ss">'windows-path-map-drive-hook-function</span>
                 <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">inhibit-file-name-operation</span> <span class="nv">operation</span><span class="p">)</span>
                      <span class="nv">inhibit-file-name-handlers</span><span class="p">)))</span>
          <span class="p">(</span><span class="nv">inhibit-file-name-operation</span> <span class="nv">operation</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">apply</span> <span class="nv">operation</span> <span class="nv">args</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">windows-path-map-drive-hook-function</span> <span class="p">(</span><span class="nv">operation</span> <span class="nv">name</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
    <span class="s">"Run OPERATION on cygwin NAME with ARGS."</span>
    <span class="p">(</span><span class="nv">windows-path-run-real-handler</span>
     <span class="nv">operation</span>
     <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">windows-path-convert-file-name</span> <span class="nv">name</span><span class="p">)</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">stringp</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">args</span><span class="p">))</span>
               <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">windows-path-convert-file-name</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">args</span><span class="p">))</span>
                     <span class="p">(</span><span class="nb">cdr</span> <span class="nv">args</span><span class="p">))</span>
             <span class="nv">args</span><span class="p">))))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">after-init-hook</span>
   <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
       <span class="p">(</span><span class="k">progn</span>
         <span class="p">(</span><span class="nv">set-drvfs-alist</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'my:saved-file-name-handler-alist</span>
                      <span class="p">(</span><span class="nb">cons</span> <span class="nv">windows-path-style-regexp</span>
                            <span class="ss">'windows-path-map-drive-hook-function</span><span class="p">)))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org7d9d4027">カレンダー設定</h2>
<div class="outline-text-2" id="text-org7d9d4027">
<p>
表示の更新と <code>japanese-holidays</code> による日本の休日の追加
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">calendar</span>
  <span class="ss">:custom</span>
  <span class="p">(</span><span class="c1">;; 祝日をカレンダーに表示</span>
   <span class="p">(</span><span class="nv">mark-holidays-in-calendar</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="c1">;; 月と曜日の表示調整</span>
   <span class="p">(</span><span class="nv">calendar-month-name-array</span> <span class="o">.</span> <span class="nv">[</span><span class="s">"01"</span> <span class="s">"02"</span> <span class="s">"03"</span> <span class="s">"04"</span> <span class="s">"05"</span> <span class="s">"06"</span>
                                 <span class="s">"07"</span> <span class="s">"08"</span> <span class="s">"09"</span> <span class="s">"10"</span> <span class="s">"11"</span> <span class="s">"12"</span> <span class="nv">]</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">calendar-day-name-array</span>   <span class="o">.</span> <span class="nv">[</span><span class="s">"日"</span> <span class="s">"月"</span> <span class="s">"火"</span> <span class="s">"水"</span> <span class="s">"木"</span> <span class="s">"金"</span> <span class="s">"土"</span><span class="nv">]</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">calendar-day-header-array</span> <span class="o">.</span> <span class="nv">[</span><span class="s">"日"</span> <span class="s">"月"</span> <span class="s">"火"</span> <span class="s">"水"</span> <span class="s">"木"</span> <span class="s">"金"</span> <span class="s">"土"</span><span class="nv">]</span><span class="p">)</span>
   <span class="c1">;; 日曜開始</span>
   <span class="p">(</span><span class="nv">calendar-week-start-day</span>   <span class="o">.</span> <span class="mi">0</span><span class="p">))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">with-eval-after-load</span> <span class="ss">'calendar</span>
    <span class="p">(</span><span class="nv">leaf</span> <span class="nv">japanese-holidays</span>
      <span class="ss">:ensure</span> <span class="no">t</span>
      <span class="ss">:custom</span>
      <span class="p">((</span><span class="nv">japanese-holiday-weekend</span>         <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
       <span class="p">(</span><span class="nv">japanese-holiday-weekend-marker</span>  <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">holiday</span>  <span class="c1">;; 日</span>
                                             <span class="no">nil</span>      <span class="c1">;; 月</span>
                                             <span class="no">nil</span>      <span class="c1">;; 火</span>
                                             <span class="no">nil</span>      <span class="c1">;; 水</span>
                                             <span class="no">nil</span>      <span class="c1">;; 木</span>
                                             <span class="no">nil</span>      <span class="c1">;; 金</span>
                                             <span class="nv">japanese-holiday-saturday</span><span class="p">)))</span>
      <span class="ss">:hook</span>
      <span class="p">((</span><span class="nv">calendar-today-visible-hook</span>   <span class="o">.</span> <span class="nv">japanese-holiday-mark-weekend</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">calendar-today-invisible-hook</span> <span class="o">.</span> <span class="nv">japanese-holiday-mark-weekend</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">calendar-today-visible-hook</span>   <span class="o">.</span> <span class="nv">calendar-mark-today</span><span class="p">))</span>
      <span class="ss">:config</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">calendar-holidays</span> <span class="p">(</span><span class="nb">append</span> <span class="nv">japanese-holidays</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org8aa6f45e">キーバインドの設定</h2>
<div class="outline-text-2" id="text-org8aa6f45e">
<p>
既に手癖になってしまっているアレコレ．
特に <code>[home]</code> と <code>[end]</code> は無いと途方に暮れます．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf-keys</span> <span class="p">((</span><span class="s">"C-h"</span>     <span class="o">.</span> <span class="nv">backward-delete-char</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-a"</span> <span class="o">.</span> <span class="nv">align-regexp</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c ;"</span>   <span class="o">.</span> <span class="nv">comment-region</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-;"</span> <span class="o">.</span> <span class="nv">uncomment-region</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-/"</span>     <span class="o">.</span> <span class="nv">undo</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-r"</span> <span class="o">.</span> <span class="nv">replace-regexp</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c r"</span>   <span class="o">.</span> <span class="nv">replace-string</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"&lt;home&gt;"</span>  <span class="o">.</span> <span class="nv">beginning-of-buffer</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"&lt;end&gt;"</span>   <span class="o">.</span> <span class="nv">end-of-buffer</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-l"</span> <span class="o">.</span> <span class="nv">toggle-truncate-lines</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org5d9ade19">
<code>migemo</code>: インクリメンタル検索</h2>
<div class="outline-text-2" id="text-org5d9ade19">
<p>
無いと途方に暮れる．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">migemo</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"cmigemo"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="c1">;; :require t</span>
  <span class="ss">:custom</span>
  <span class="o">'</span><span class="p">((</span><span class="nv">migemo-user-dictionary</span>  <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">migemo-regex-dictionary</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">migemo-options</span>          <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="s">"-q"</span> <span class="s">"--emacs"</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">migemo-command</span>          <span class="o">.</span> <span class="s">"cmigemo"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">migemo-coding-system</span>    <span class="o">.</span> <span class="ss">'utf-8-unix</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">cond</span>
   <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'darwin</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"/usr/local/share/migemo/utf-8/"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">migemo-dictionary</span> <span class="s">"/usr/local/share/migemo/utf-8/migemo-dict"</span><span class="p">))</span>
   <span class="p">(</span><span class="no">t</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">migemo-dictionary</span> <span class="s">"/usr/share/cmigemo/utf-8/migemo-dict"</span><span class="p">)))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">migemo-init</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org2d69d5ee">
<code>emacs-w3m</code>:</h2>
<div class="outline-text-2" id="text-org2d69d5ee">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">emacs-w3m</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"w3m"</span><span class="p">)</span>
  <span class="c1">;;:el-get (emacs-w3m</span>
  <span class="c1">;;         :type github</span>
  <span class="c1">;;         :pkgname "emacs-w3m/emacs-w3m"</span>
  <span class="c1">;;         :build `(("autoconf")</span>
  <span class="c1">;;                  ("./configure" ,(format "--with-emacs=%s" el-get-emacs))</span>
  <span class="c1">;;                  ("make"))</span>
  <span class="c1">;;         :info "doc")</span>
  <span class="ss">:load-path</span>
  <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"emacs-w3m/shimbun"</span> <span class="nv">my:d:pkg:elget</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org35bd4bc4">
<span class="todo SOMEDAY">SOMEDAY</span> <code>eww</code>: 内蔵ブラウザ <code>[0/3]</code>
</h2>
<div class="outline-text-2" id="text-org35bd4bc4">
<p>
リンクを簡単に辿る(Hit-a-Hint) のために <code>ace-link</code> も入れておく
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">eww</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eww"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">make-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eww"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">ace-link</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">addressbar</span>
    <span class="ss">:el-get</span> <span class="p">(</span><span class="nv">addressbar</span>
             <span class="ss">:type</span> <span class="nv">github</span>
             <span class="ss">:pkgname</span> <span class="s">"lurdan/emacs-addressbar"</span><span class="p">)</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">addressbar-persistent-history-directory</span>
       <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">addressbar-ignore-url-regexp</span>
       <span class="o">.</span> <span class="s">"\\(://duckduckgo\\.com/\\|google\\.com/search\\)"</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">addressbar-search-command-alist</span>
       <span class="o">.</span>  <span class="o">'</span><span class="p">(</span><span class="s">"g"</span> <span class="o">.</span> <span class="s">"https://google.com/search?&amp;gws_rd=cr&amp;complete=0&amp;pws=0&amp;tbs=li:1&amp;q="</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">addressbar-display-url-max-length</span> <span class="o">.</span> <span class="mi">60</span><span class="p">)</span>
      <span class="p">))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">shr</span>
    <span class="ss">:custom</span>
    <span class="p">((</span><span class="nv">shr-use-colors</span>    <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">shr-use-fonts</span>     <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">shr-image-animate</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">shr-width</span>         <span class="o">.</span> <span class="mi">72</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"&lt;f2&gt;"</span> <span class="o">.</span> <span class="nv">eww</span><span class="p">)</span>
         <span class="p">(</span><span class="ss">:eww-mode-map</span>
          <span class="p">(</span><span class="s">"r"</span>   <span class="o">.</span> <span class="nv">eww-reload</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"o"</span>   <span class="o">.</span> <span class="nv">eww</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"&amp;"</span>   <span class="o">.</span> <span class="nv">eww-browse-with-external-browser</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"b"</span>   <span class="o">.</span> <span class="nv">eww-back-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"]"</span>   <span class="o">.</span> <span class="nv">eww-next-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"["</span>   <span class="o">.</span> <span class="nv">eww-previous-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"g"</span>   <span class="o">.</span> <span class="nv">eww-top-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"+"</span>   <span class="o">.</span> <span class="nv">my:eww-increase-width</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"-"</span>   <span class="o">.</span> <span class="nv">my:eww-decrease-width</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"h"</span>   <span class="o">.</span> <span class="nv">backward-char</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"j"</span>   <span class="o">.</span> <span class="nv">next-line</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"k"</span>   <span class="o">.</span> <span class="nv">previous-line</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"l"</span>   <span class="o">.</span> <span class="nv">forward-char</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"/"</span>   <span class="o">.</span> <span class="nv">isearch-forward</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"?"</span>   <span class="o">.</span> <span class="nv">isearch-backward</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"n"</span>   <span class="o">.</span> <span class="nv">isearch-next</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"N"</span>   <span class="o">.</span> <span class="nv">isearch-previous</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"f"</span>   <span class="o">.</span> <span class="nv">ace-link-eww</span><span class="p">))</span>
         <span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">eww-bookmarks-directory</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eww"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">eww-search-prefix</span>
     <span class="o">.</span> <span class="s">"https://www.google.com/search?&amp;gws_rd=cr&amp;complete=0&amp;pws=0&amp;tbs=li:1&amp;q="</span><span class="p">))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">ace-link-setup-default</span><span class="p">)</span>
  <span class="c1">;; :init</span>
  <span class="c1">;; ;;</span>
  <span class="c1">;; (defun eww-disable-images ()</span>
  <span class="c1">;;   "ewwで画像表示させない"</span>
  <span class="c1">;;   (interactive)</span>
  <span class="c1">;;   (setq-local shr-put-image-function 'shr-put-image-alt)</span>
  <span class="c1">;;   (eww-reload))</span>
  <span class="c1">;; ;;</span>
  <span class="c1">;; (defun eww-enable-images ()</span>
  <span class="c1">;;   "ewwで画像表示させる"</span>
  <span class="c1">;;   (interactive)</span>
  <span class="c1">;;   (setq-local shr-put-image-function 'shr-put-image)</span>
  <span class="c1">;;   (eww-reload))</span>
  <span class="c1">;; (defun shr-put-image-alt (spec alt &amp;optional flags)</span>
  <span class="c1">;;   (insert alt))</span>
  <span class="c1">;; ;;</span>
  <span class="c1">;; ;;</span>
  <span class="c1">;; (defun eww-mode-hook--disable-image ()</span>
  <span class="c1">;;   (setq-local shr-put-image-function 'shr-put-image-alt))</span>
  <span class="c1">;; (add-hook 'eww-mode-hook 'eww-mode-hook--disable-image)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> 背景色の指定</li>
<li class="off">
<code>[ ]</code> 幅の強制</li>
</ul>
</div>
</div>
<div>
<h2 id="orgb83f65a0">日本語入力: <code>ddskk</code>
</h2>
<div class="outline-text-2" id="text-orgb83f65a0">
<p>
<a href="http://openlab.ring.gr.jp/skk/ddskk-ja.html">Daredevil SKK (DDSKK)</a> をメインで使用中．無いと途方に暮れる．
ちなみにGTKが有効になっていると <code>gtk-immodule</code> なんかと衝突するので
<code>~/.Xresources</code> で xim を無効にしておくと良い．
例えば以下の様に:
</p>
<figure class="highlight"><pre><code class="language-conf" data-lang="conf">! <span class="n">disable</span> <span class="n">XIM</span>
<span class="n">Emacs</span>*<span class="n">useXIM</span>: <span class="n">false</span></code></pre></figure>
</div>
<div>
<h3 id="orgeaefbd62">Emacs 本体側の設定(ddskk)</h3>
<div class="outline-text-3" id="text-orgeaefbd62">
<p>
実際の設定は別ファイルで行なわれるため
ここでは設定ファイルの位置変更を変更している．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">skk-user-directory</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">my:d:tmp</span> <span class="s">"skk"</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">skk-user-directory</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">skk-user-directory</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">locate-library</span> <span class="s">"skk"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">package-install</span> <span class="ss">'ddskk</span> <span class="no">t</span><span class="p">))</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">skk</span>
  <span class="ss">:commands</span> <span class="nv">skk-make-indicator-alist</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x j"</span>   <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x C-j"</span> <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-\\"</span>    <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-init-file</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">user-emacs-directory</span> <span class="s">"init-ddskk"</span><span class="p">)</span>
        <span class="nv">default-input-method</span> <span class="s">"japanese-skk"</span> <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org03d84f47">DDSKK 本体の設定</h3>
<div class="outline-text-3" id="text-org03d84f47">
</div>
<div>
<h4 id="orgab495f21">基本動作</h4>
<div class="outline-text-4" id="text-orgab495f21">
<p>
byte-compile の為の読み込み
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'skk</span><span class="p">))</span></code></pre></figure>
<p>
sticky shift: <a href="http://homepage1.nifty.com/blankspace/emacs/sticky.html">sticky shift</a> を参照のこと.
ddskk の 14.2 以降から同梱されるようになった(ありがたい)
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-sticky-key</span> <span class="s">";"</span><span class="p">)</span></code></pre></figure>
<p>
変換候補の表示位置
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-show-candidates-always-pop-to-buffer</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
候補表示件数を2列に
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-henkan-number-to-display-candidates</span> <span class="mi">5</span><span class="p">)</span></code></pre></figure>
<p>
日本語表示しない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-japanese-message-and-error</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
メニューを日本語にしない -&gt; toolbar 非表示だし.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-show-japanese-menu</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
注釈の表示
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-show-annotation</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
インジケータの表示のカスタマイズ
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-latin-mode-string</span> <span class="s">"[_A]"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-hiragana-mode-string</span> <span class="s">"[あ]"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-katakana-mode-string</span> <span class="s">"[ア]"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-jisx0208-latin-mode-string</span> <span class="s">"[Ａ]"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-jisx0201-mode-string</span> <span class="s">"[_ｱ]"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-abbrev-mode-string</span> <span class="s">"[aA]"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-indicator-use-cursor-color</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
インジケータを左端に表示
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-status-indicator</span> <span class="ss">'left</span><span class="p">)</span></code></pre></figure>
<p>
mode-line が動くのが許せないので, ちょっと修正
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defadvice</span> <span class="nv">skk-make-indicator-alist</span>
    <span class="p">(</span><span class="nv">after</span> <span class="nv">my:set-skk-default-indicator</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">elem</span>
           <span class="o">'</span><span class="p">((</span><span class="nv">abbrev</span> <span class="s">" [aA]"</span> <span class="o">.</span> <span class="s">"--[aA]:"</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">latin</span> <span class="s">" [_A]"</span> <span class="o">.</span> <span class="s">"--[_A]:"</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">default</span> <span class="s">" [--]"</span> <span class="o">.</span> <span class="s">"--[--]:"</span><span class="p">))</span>
           <span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">ad-return-value</span>
          <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">elem</span> <span class="no">nil</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">delq</span> <span class="p">(</span><span class="nb">assoc</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">elem</span><span class="p">)</span> <span class="nv">ad-return-value</span><span class="p">)</span> <span class="nv">ad-return-value</span><span class="p">)))))</span>
<span class="c1">;;</span>
<span class="c1">;;(setq skk-show-inline t)</span></code></pre></figure>
<p>
カーソルには色をつけない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-use-color-cursor</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
キーバインド
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">global-set-key</span> <span class="s">"\C-x\C-j"</span> <span class="ss">'skk-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="s">"\C-xj"</span> <span class="ss">'skk-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="s">"\C-j"</span> <span class="ss">'skk-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="s">"\C-\\"</span> <span class="ss">'skk-mode</span><span class="p">)</span></code></pre></figure>
<p>
半角カナを入力
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-use-jisx0201-input-method</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
Enter で改行しない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-egg-like-newline</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
"「"を入力したら"」"も自動で挿入
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-auto-insert-paren</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
句読点変換ルール
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-kuten-touten-alist</span>
      <span class="o">'</span><span class="p">(</span>
        <span class="p">(</span><span class="nv">jp</span>    <span class="o">.</span> <span class="p">(</span><span class="s">"。"</span> <span class="o">.</span> <span class="s">"、"</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">jp-en</span> <span class="o">.</span> <span class="p">(</span><span class="s">"。"</span> <span class="o">.</span> <span class="s">", "</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">en-jp</span> <span class="o">.</span> <span class="p">(</span><span class="s">"．"</span> <span class="o">.</span> <span class="s">"，"</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">en</span>    <span class="o">.</span> <span class="p">(</span><span class="s">". "</span> <span class="o">.</span> <span class="s">", "</span><span class="p">))</span>
        <span class="p">))</span>
<span class="p">(</span><span class="nv">setq-default</span> <span class="nv">skk-kutouten-type</span> <span class="ss">'en</span><span class="p">)</span></code></pre></figure>
<p>
全角記号の変換: @ での日付入力は使わない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-rom-kana-rule-list</span>
      <span class="p">(</span><span class="nb">append</span> <span class="nv">skk-rom-kana-rule-list</span>
              <span class="o">'</span><span class="p">((</span><span class="s">"!"</span> <span class="no">nil</span> <span class="s">"!"</span><span class="p">)</span>
                <span class="p">(</span><span class="s">":"</span> <span class="no">nil</span> <span class="s">":"</span><span class="p">)</span>
                <span class="p">(</span><span class="s">";"</span> <span class="no">nil</span> <span class="s">";"</span><span class="p">)</span>
                <span class="p">(</span><span class="s">"?"</span> <span class="no">nil</span> <span class="s">"?"</span><span class="p">)</span>
                <span class="p">(</span><span class="s">"z "</span> <span class="no">nil</span> <span class="s">"　"</span><span class="p">)</span>
                <span class="p">(</span><span class="s">"\\"</span> <span class="no">nil</span> <span class="s">"\\"</span><span class="p">)</span>
                <span class="p">(</span><span class="s">"@"</span> <span class="no">nil</span> <span class="s">"@"</span><span class="p">)</span>
                <span class="p">)))</span></code></pre></figure>
<p>
送り仮名が厳密に正しい候補を優先
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-henkan-strict-okuri-precedence</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
辞書の共有
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-share-private-jisyo</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
変換候補を縦に表示
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (setq skk-show-inline 'vertical)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-show-inline</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="orgb6cec722">辞書の設定</h4>
<div class="outline-text-4" id="text-orgb6cec722">
<p>
追加している辞書の一覧は
</p>
<ul class="org-ul">
<li><a href="http://www.chibutsu.org/jisho/">地球物理辞書</a></li>
<li><a href="http://www.geocities.jp/living_with_plasma/tanudic.html">天文・天体物理用語の漢字変換用辞書</a></li>
<li>はてなキーワード</li>
<li><a href="http://matsucon.net/material/dic/">2ちゃんねる顔文字辞書 MatsuCon</a></li>
<li><a href="http://matsucon.net/">MatsuCon</a></li>
</ul>
<p>
といった所.
はてなキーワードからの辞書の抽出は <a href="http://d.hatena.ne.jp/znz">znz</a> さんの
</p>
<ul class="org-ul">
<li><a href="http://rubyist.g.hatena.ne.jp/znz/20060924/p1">「はてなダイアリーキーワードふりがなリスト」を SKK の辞書に変換</a></li>
</ul>
<p>
を参考に.
<a href="http://matsucon.net/">MatsuCon</a> で公開されている顔文字に関しては
顔文字に ; や が含まれている場合に, 適宜quoteする必要があるので
以下のスクリプトで適当に変換.
</p>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="nb">require</span> <span class="s1">'nkf'</span>
<span class="n">src</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">size</span> <span class="o">&lt;</span> <span class="mi">1</span>
  <span class="nb">puts</span> <span class="s2">"usage: ime2skk.rb ime_dictionary"</span>
  <span class="nb">exit</span> <span class="mi">0</span>
<span class="k">end</span>
<span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
    <span class="n">line_euc</span> <span class="o">=</span> <span class="no">NKF</span><span class="p">.</span><span class="nf">nkf</span><span class="p">(</span><span class="s2">"-S -e"</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">line_euc</span> <span class="o">=~</span> <span class="sr">/^([^!]+?)\t(.+?)\t.+$/</span>
      <span class="n">entry</span> <span class="o">=</span> <span class="vg">$1</span>
      <span class="n">content</span> <span class="o">=</span> <span class="vg">$2</span>
      <span class="k">if</span> <span class="n">content</span> <span class="o">=~</span><span class="sr">/;/</span>
        <span class="nb">puts</span> <span class="n">entry</span> <span class="o">+</span> <span class="s2">" /(concat </span><span class="se">\"</span><span class="s2">"</span> <span class="o">+</span> <span class="n">content</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">';'</span><span class="p">,</span><span class="s1">'\\\\073'</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">)/"</span>
      <span class="k">elsif</span> <span class="n">content</span> <span class="o">=~</span><span class="sr">/\//</span>
        <span class="nb">puts</span> <span class="n">entry</span> <span class="o">+</span> <span class="s2">" /(concat </span><span class="se">\"</span><span class="s2">"</span> <span class="o">+</span> <span class="n">content</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="s1">'\\\\057'</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">)/"</span>
      <span class="k">else</span>
        <span class="nb">puts</span> <span class="n">entry</span> <span class="o">+</span> <span class="s2">" /"</span> <span class="o">+</span> <span class="n">content</span> <span class="o">+</span> <span class="s2">"/"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="p">}</span></code></pre></figure>
<p>
他にも quote する必要あるような気もするけれど, それは気がついた時に.
</p>

<p>
辞書サーバがそもそも UTF-8 を扱えれば良いのだけれども.
辞書サーバの指定は以下.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; ddskk &lt;- yaskkserv2 のみ utf-8 で通信するための設定</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:skk-open-server-decoding-utf-8</span> <span class="p">()</span>
  <span class="s">"辞書サーバと接続する。サーバープロセスを返す。 decoding coding-system が euc ではなく utf8 となる。"</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">skk-server-live-p</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">skkserv-process</span> <span class="p">(</span><span class="nv">skk-open-server-1</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">skk-server-live-p</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">code</span> <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">assoc</span> <span class="s">"euc"</span> <span class="nv">skk-coding-system-alist</span><span class="p">))))</span>
        <span class="p">(</span><span class="nv">set-process-coding-system</span> <span class="nv">skkserv-process</span>
                                   <span class="ss">'utf-8</span> <span class="nv">code</span><span class="p">))))</span> <span class="nv">skkserv-process</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-mode-hook</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">'skk-open-server</span> <span class="ss">:override</span> <span class="ss">'my:skk-open-server-decoding-utf-8</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">cond</span>
 <span class="p">((</span><span class="nv">getenv</span> <span class="s">"SKKSERVER"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-server-host</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"SKKSERVER"</span><span class="p">)</span>
        <span class="nv">skk-server-portnum</span> <span class="s">"1178"</span>
        <span class="nv">skk-large-jisyo</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'skk-search-prog-list</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">skk-server-completion-search</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'skk-search-prog-list</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">skk-comp-by-server-completion</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
 <span class="p">(</span><span class="no">t</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-get-jisyo-directory</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">my:d:tmp</span> <span class="s">"skk-jisyo"</span><span class="p">)</span>
        <span class="nv">skk-large-jisyo</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">skk-get-jisyo-directory</span> <span class="s">"/SKK-JISYO.L"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/usr/local/share/skkdic/SKK-JISYO.emoji.utf8"</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-extra-jisyo-file-list</span>
          <span class="p">(</span><span class="nb">list</span> <span class="o">'</span><span class="p">(</span><span class="s">"/usr/local/share/skkdic/SKK-JISYO.emoji.utf8"</span> <span class="o">.</span> <span class="nv">utf-8</span><span class="p">)))))</span>
 <span class="p">)</span></code></pre></figure>
<p>
辞書登録の際に送り仮名を削除
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-check-okurigana-on-touroku</span> <span class="ss">'auto</span><span class="p">)</span></code></pre></figure>
<p>
漢字登録のミスをチェックする
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-check-okurigana-on-touroku</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
個人辞書の文字コード
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">skk-jisyo-code</span> <span class="ss">'utf-8-unix</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org0cbdad2e">インクリメンタルサーチ</h4>
<div class="outline-text-4" id="text-org0cbdad2e">
<p>
minibuffer 内では強制的に skk off.
インクリメンタルサーチは migemo に任せることに．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'skk-mode-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">skk-in-minibuffer-p</span><span class="p">)</span>
                 <span class="p">(</span><span class="nv">skk-mode-exit</span><span class="p">))))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">skk-isearch-start-mode</span> <span class="ss">'latin</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
</div>
<div>
<h2 id="org15a06190">校正, 辞書等</h2>
<div class="outline-text-2" id="text-org15a06190">
</div>
<div>
<h3 id="orgc780f35e">
<code>redpen-paragraph</code>: <a href="http://redpen.cc/">redpen</a> による文章校正</h3>
<div class="outline-text-3" id="text-orgc780f35e">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">redpen-paragraph</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"redpen"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/.config/redpen"</span><span class="p">))</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span>
  <span class="p">((</span><span class="s">"C-c C-r"</span> <span class="o">.</span> <span class="nv">redpen-paragraph</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">LaTeX-mode-hook</span>
    <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">redpen-commands</span>
              <span class="o">'</span><span class="p">(</span>
                <span class="c1">;; for english command</span>
                <span class="s">"redpen -r json2 -c ~/.config/redpen/redpen-conf-en.xml -f latex %s 2&gt;/dev/null"</span>
                <span class="c1">;; for japanese command</span>
                <span class="s">"redpen -r json2 -c ~/.config/redpen/redpen-conf-ja.xml -f latex %s 2&gt;/dev/null"</span>
                <span class="p">)))</span>
    <span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">redpen-commands</span>
    <span class="o">'</span><span class="p">(</span>
      <span class="c1">;; for english command</span>
      <span class="s">"redpen -r json2 -c ~/.config/redpen/redpen-conf-en.xml %s 2&gt;/dev/null"</span>
      <span class="c1">;; for japanese command</span>
      <span class="s">"redpen -r json2 -c ~/.config/redpen/redpen-conf-ja.xml %s 2&gt;/dev/null"</span>
      <span class="p">))</span>
  <span class="c1">;;redpen-paragraph-force-reading-whole t</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org3737a28e">
<code>ispell</code>: spell checker</h3>
<div class="outline-text-3" id="text-org3737a28e">
<p>
ispell はコマンドとして <code>aspell</code> を利用する.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ispell</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-executable-p</span> <span class="s">"aspell"</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="p">(</span><span class="nv">ispell-program-name</span> <span class="o">.</span> <span class="s">"aspell"</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'ispell-skip-region-alist</span> <span class="o">'</span><span class="p">(</span><span class="s">"[^\000-\377]+"</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org820e6b6d">
<code>flyspell</code>: on-the-fly spell checker <code>[0/1]</code>
</h3>
<div class="outline-text-3" id="text-org820e6b6d">
<p>
flyspell-mode は別途有効化しておいた方が良いのかもしれない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">flyspell</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="p">(</span><span class="nv">flyspell-mode</span> <span class="o">.</span> <span class="s">"F"</span><span class="p">)</span>
  <span class="ss">:defun</span>
  <span class="nv">flyspell-emacs-popup-textual</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:flyspell-popup-choose</span> <span class="p">(</span><span class="nv">orig</span> <span class="nv">event</span> <span class="nv">poss</span> <span class="nv">word</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">window-system</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">funcall</span> <span class="nv">orig</span> <span class="nv">event</span> <span class="nv">poss</span> <span class="nv">word</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">flyspell-emacs-popup-textual</span> <span class="nv">event</span> <span class="nv">poss</span> <span class="nv">word</span><span class="p">)))</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:around</span> <span class="nv">flyspell-emacs-popup</span>
                   <span class="nv">my:flyspell-popup-choose</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="c1">;; flyspell-prog-mode との switch が欲しい</span>
  <span class="p">((</span><span class="nv">LaTeX-mode-hook</span> <span class="o">.</span> <span class="nv">flyspell-mode</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> flyspell-prog-mode との switch が欲しい</li>
</ul>
</div>
</div>
<div>
<h3 id="org3002f57f">
<code>lookup</code>: 電子辞書の検索</h3>
<div class="outline-text-3" id="text-org3002f57f">
<p>
EPWING化した辞書群を検索するために <code>lookup-el</code> ver. 1.4 系列を利用
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">lookup</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/etc/emacs/site-start.d/50lookup-el.el"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/usr/local/share/dict/lookup-enabled"</span><span class="p">))</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">lookup</span> <span class="nv">lookup-region</span> <span class="nv">lookup-pattern</span><span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-c w"</span> <span class="o">.</span> <span class="nv">lookup-pattern</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c W"</span> <span class="o">.</span> <span class="nv">lookup-word</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="p">(</span><span class="nv">lookup-search-agents</span>
   <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/eijiro"</span> <span class="ss">:alias</span> <span class="s">"英辞郎"</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/waeijiro"</span> <span class="ss">:alias</span> <span class="s">"和英辞郎"</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/rikagaku5"</span> <span class="ss">:alias</span> <span class="s">"理化学辞典 第5版"</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/koujien4"</span> <span class="ss">:alias</span> <span class="s">"広辞苑 第4版"</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/wadai5"</span> <span class="ss">:alias</span> <span class="s">"研究社 和英大辞典 第5版"</span><span class="p">)</span>
       <span class="c1">;; (ndeb "/usr/local/share/dict/eidai6" :alias "研究社 英和大辞典 第6版")</span>
       <span class="c1">;; (ndeb "/usr/local/share/dict/colloc" :alias "研究社 英和活用大辞典 ")</span>
       <span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org501da28b">
<code>text-adjust</code>: 全角文字の撲滅</h3>
<div class="outline-text-3" id="text-org501da28b">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">text-adjust</span>
  <span class="ss">:el-get</span> <span class="nv">uwabami/text-adjust.el</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org5fd7347f">補完: <code>vertico</code>, <code>marginalia</code>, <code>consult</code>
</h2>
<div class="outline-text-2" id="text-org5fd7347f">
<p>
最近話題になりだしたので, ちょっと使い始めてみた.
基本機能の拡張なので, 挙動が手に馴染む感じがとても良い.
</p>
</div>
<div>
<h3 id="orgff7e02fd">helm, ivy の無効化</h3>
<div class="outline-text-3" id="text-orgff7e02fd">
<p>
依存する拡張がまだまだ多いので, 一度インストールして邪魔しないようにしておくことに.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">helm</span> <span class="ss">:ensure</span> <span class="no">t</span> <span class="ss">:defer-config</span> <span class="p">(</span><span class="nv">helm-mode</span> <span class="mi">-1</span><span class="p">))</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">ivy</span> <span class="ss">:ensure</span> <span class="no">t</span> <span class="ss">:defer-config</span> <span class="p">(</span><span class="nv">ivy-mode</span> <span class="mi">-1</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgbf52614c">無視する拡張子の追加設定</h3>
<div class="outline-text-3" id="text-orgbf52614c">
<p>
とりあえず, 無視するファイルの拡張子を指定しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*completion</span>
  <span class="ss">:init</span>
  <span class="c1">;; 補完で無視する拡張子の追加．そのうち増える．</span>
  <span class="p">(</span><span class="nv">cl-loop</span> <span class="nv">for</span> <span class="nv">ext</span> <span class="nv">in</span>
           <span class="o">'</span><span class="p">(</span><span class="c1">;; TeX</span>
             <span class="s">".dvi"</span>
             <span class="s">".fdb_latexmk"</span>
             <span class="s">".fls"</span>
             <span class="s">".ilg"</span>
             <span class="s">".jqz"</span>
             <span class="s">".nav"</span>
             <span class="s">".out"</span>
             <span class="s">".snm"</span>
             <span class="s">".synctex\\.gz"</span>
             <span class="s">".vrb"</span>
             <span class="c1">;; fortran &gt;= 90</span>
             <span class="s">".mod"</span>
             <span class="c1">;; zsh</span>
             <span class="s">".zwc"</span>
             <span class="c1">;; libtool</span>
             <span class="s">".in"</span>
             <span class="s">".libs/"</span>
             <span class="c1">;; fxxkin Apple</span>
             <span class="s">".DS_Store"</span>
             <span class="s">"._DS_Store"</span>
             <span class="c1">;; "org-id-locations"</span>
             <span class="p">)</span>
           <span class="nb">do</span> <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'completion-ignored-extensions</span> <span class="nv">ext</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org8362fd9f">
<code>vertico</code>: 本体</h3>
<div class="outline-text-3" id="text-org8362fd9f">
<p>
<a href="https://scrapbox.io/emacs/find-file%E3%81%A7Helm%E3%81%BF%E3%81%9F%E3%81%84%E3%81%ABC-l%E3%81%A7%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E9%81%A1%E3%82%8B">find-fileでHelmみたいにC-lでディレクトリを遡る - emacs</a>
より, <code>C-l</code> で一つ上の階層へ上がれる様にしたり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">vertico</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:disable-selection</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">minibuffer-completion-table</span> <span class="nf">#'</span><span class="nv">org-tags-completion-function</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">vertico-map</span> <span class="nv">minibuffer-local-completion-map</span>
                  <span class="nv">completion-cycle-threshold</span> <span class="no">nil</span>
                  <span class="nv">completion-styles</span> <span class="o">'</span><span class="p">(</span><span class="nv">basic</span><span class="p">))))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:filename-upto-parent</span> <span class="p">()</span>
    <span class="s">"Move to parent directory like \"cd ..\" in find-file."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">sep</span> <span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nv">regexp-opt</span> <span class="o">'</span><span class="p">(</span><span class="s">"/"</span> <span class="s">"\\"</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nv">save-excursion</span>
        <span class="p">(</span><span class="nv">left-char</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="nv">sep</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">delete-char</span> <span class="mi">1</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">save-match-data</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">search-backward-regexp</span> <span class="nv">sep</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">right-char</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">filter-buffer-substring</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">save-excursion</span> <span class="p">(</span><span class="nv">end-of-line</span><span class="p">)</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
                                   <span class="nf">#'</span><span class="nb">delete</span><span class="p">)))))</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:before</span> <span class="nv">vertico--setup</span>
           <span class="nv">my:disable-selection</span><span class="p">)</span>
  <span class="ss">:bind</span>
  <span class="p">(</span><span class="ss">:vertico-map</span> <span class="p">((</span><span class="s">"C-l"</span> <span class="o">.</span> <span class="nv">my:filename-upto-parent</span><span class="p">)))</span>
  <span class="ss">:custom-face</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">vertico-current</span>
     <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:inherit</span> <span class="nv">hl-line</span> <span class="ss">:background</span> <span class="nv">unspecified</span><span class="p">)))))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">vertico-count</span> <span class="o">.</span> <span class="mi">9</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">vertico-cycle</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">vertico-multiline</span> <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="s">"↓"</span> <span class="mi">0</span> <span class="mi">1</span>
                            <span class="p">(</span><span class="nv">face</span> <span class="nv">vertico-multiline</span><span class="p">))</span>
                           <span class="p">(</span><span class="s">"…"</span> <span class="mi">0</span> <span class="mi">1</span>
                            <span class="p">(</span><span class="nv">face</span> <span class="nv">vertico-multiline</span><span class="p">))))</span>
    <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">vertico-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orge9265e4d">
<code>marginalia</code>: リッチな注釈(Enable richer annotations)</h3>
<div class="outline-text-3" id="text-orge9265e4d">
<p>
行揃えが微妙. あと, ファイル名を省略表示できないのかな?
⇒ <a href="https://github.com/minad/marginalia/issues/70">Better truncation method for file names #70</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">marginalia</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"M-A"</span> <span class="o">.</span> <span class="nv">marginalia-cycle</span><span class="p">)</span>
         <span class="p">(</span><span class="ss">:minibuffer-local-map</span>
          <span class="p">(</span><span class="s">"M-A"</span> <span class="o">.</span> <span class="nv">marginalia-cycle</span><span class="p">)</span>
          <span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">marginalia-annotators</span>
     <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">marginalia-annotators-light</span> <span class="nv">marginalia-annotators-heavy</span> <span class="no">nil</span><span class="p">)))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">marginalia-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orged5e5627">
<code>consult</code>: 便利コマンド集</h3>
<div class="outline-text-3" id="text-orged5e5627">
<p>
とりあえず recetnf が使えないと途方に暮れるので
<code>consult-recent-file</code> のカスタマイズのみ.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">consult</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x C-r"</span> <span class="o">.</span> <span class="nv">my:consult-recent-file</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">(</span><span class="c1">;; 増やさないと preview 時に theme がロードされない模様.</span>
    <span class="c1">;; とりあえず default の 10 倍にしている. 1 MB かな?</span>
    <span class="p">(</span><span class="nv">consult-preview-raw-size</span> <span class="o">.</span> <span class="mi">1024000</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">consult-preview-key</span>  <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-M-p"</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">consult-narrow-key</span>   <span class="o">.</span> <span class="s">"&lt;"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:consult-recent-file</span> <span class="p">()</span>
    <span class="s">"Find recent using `completing-read' with shorten filename"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">files</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">f</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">my:shorten-file-path</span> <span class="nv">f</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">window-width</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">f</span><span class="p">))</span>
                         <span class="nv">recentf-list</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">selected</span>
             <span class="p">(</span><span class="nv">consult--read</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#'</span><span class="nb">car</span> <span class="nv">files</span><span class="p">)</span>
                            <span class="ss">:prompt</span> <span class="s">"Find recent file: "</span>
                            <span class="ss">:sort</span> <span class="no">nil</span>
                            <span class="ss">:require-match</span> <span class="no">t</span>
                            <span class="ss">:category</span> <span class="ss">'file</span>
                            <span class="ss">:state</span> <span class="p">(</span><span class="nv">consult--file-preview</span><span class="p">)</span>
                            <span class="ss">:history</span> <span class="ss">'file-name-history</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nv">assoc-default</span> <span class="nv">selected</span> <span class="nv">files</span><span class="p">)))))</span>
  <span class="c1">;; :advice</span>
  <span class="c1">;;   (:override register-preview</span>
  <span class="c1">;;              consult-register-window)</span>
  <span class="c1">;; :config</span>
  <span class="c1">;;   (setq consult-preview-key (kbd "M-."))</span>
  <span class="p">)</span></code></pre></figure>
</div>
<div>
<h4 id="org90f5d475">
<code>consult-ghq</code>: ghq を consult で.</h4>
<div class="outline-text-4" id="text-org90f5d475">
<p>
projectile かなんかを使う方が良さげだが, とりあえず.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">consult-ghq</span>
  <span class="ss">:el-get</span> <span class="nv">uwabami/consult-ghq</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x f"</span> <span class="o">.</span> <span class="nv">consult-ghq-open</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">consult-ghq-short-list</span> <span class="o">.</span> <span class="no">t</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h3 id="orgc12df551">
<code>orderless</code>: 補完候補の選択</h3>
<div class="outline-text-3" id="text-orgc12df551">
<p>
イロイロと凝れそうだけど, とりあえずはデフォルトのままで.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">orderless</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="c1">;; :init (leaf flx :ensure t)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">completion-styles</span> <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">orderless</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">orderless-matching-styles</span>
     <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">orderless-prefixes</span>
         <span class="nv">orderless-flex</span>
         <span class="nv">orderless-regexp</span>
         <span class="nv">orderless-initialism</span>
         <span class="nv">orderless-literal</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org779f9ba7">翻訳</h2>
<div class="outline-text-2" id="text-org779f9ba7">
</div>
<div>
<h3 id="orga528b584">DeepL 翻訳</h3>
<div class="outline-text-3" id="text-orga528b584">
<p>
ブラウザ呼び出し
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*deepl-translate</span>
  <span class="ss">:commands</span> <span class="nv">my:deepl-translate</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x T"</span> <span class="o">.</span> <span class="nv">my:deepl-translate</span><span class="p">))</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'url-util</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:deepl-translate</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nb">string</span>
          <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">stringp</span> <span class="nb">string</span><span class="p">)</span> <span class="nb">string</span><span class="p">)</span>
                <span class="p">((</span><span class="nv">use-region-p</span><span class="p">)</span>
                 <span class="p">(</span><span class="nv">buffer-substring</span> <span class="p">(</span><span class="nv">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nv">region-end</span><span class="p">)))</span>
                <span class="p">(</span><span class="no">t</span>
                 <span class="p">(</span><span class="nv">save-excursion</span>
                   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">forward-char</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">backward-sentence</span><span class="p">)</span>
                     <span class="p">(</span><span class="k">setq</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
                     <span class="p">(</span><span class="nv">forward-sentence</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">buffer-substring</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">point</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="nv">run-at-time</span> <span class="mf">0.1</span> <span class="no">nil</span> <span class="ss">'deactivate-mark</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">browse-url</span>
     <span class="p">(</span><span class="nv">concat</span>
      <span class="s">"https://www.deepl.com/translator#en/ja/"</span>
      <span class="p">(</span><span class="nv">url-hexify-string</span> <span class="nb">string</span><span class="p">)</span>
      <span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org48ef2f56">Google 翻訳</h3>
<div class="outline-text-3" id="text-org48ef2f56">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">google-translate</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">google-translate-translation-directions-alist</span> <span class="o">'</span><span class="p">((</span><span class="s">"en"</span> <span class="o">.</span> <span class="s">"ja"</span><span class="p">)</span> <span class="p">(</span><span class="s">"ja"</span> <span class="o">.</span> <span class="s">"en"</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">popup</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:google-translate--search-tkk</span> <span class="p">()</span>
    <span class="s">"Search TKK. @see https://github.com/atykhonov/google-translate/issues/52"</span>
    <span class="p">(</span><span class="nb">list</span> <span class="mi">430675</span> <span class="mi">2721866130</span><span class="p">))</span>
  <span class="ss">:bind</span>
  <span class="p">(</span><span class="s">"C-x t"</span> <span class="o">.</span> <span class="nv">google-translate-smooth-translate</span><span class="p">)</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:override</span> <span class="nv">google-translate--search-tkk</span>
                     <span class="nv">my:google-translate--search-tkk</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">google-translate-translation-directions-alist</span> <span class="o">'</span><span class="p">((</span><span class="s">"en"</span> <span class="o">.</span> <span class="s">"ja"</span><span class="p">)</span> <span class="p">(</span><span class="s">"ja"</span> <span class="o">.</span> <span class="s">"en"</span><span class="p">))</span>
        <span class="nv">google-translate-backend-method</span> <span class="ss">'curl</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org12fd2b4e">Copy &amp; Paste:</h2>
<div class="outline-text-2" id="text-org12fd2b4e">
</div>
<div>
<h3 id="org1689d1f5">Linux では <code>xclip</code> を利用</h3>
<div class="outline-text-3" id="text-org1689d1f5">
<p>
clipboard と PRIMARY の同期には <code>gpaste</code> を使っている．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">xclip</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"xclip"</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'gnu/linux</span><span class="p">))</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">xclip-mode</span> <span class="mi">1</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgb2de5472">macOS では <code>pbcopy/pbpaste</code> を利用.</h3>
<div class="outline-text-3" id="text-orgb2de5472">
<p>
<code>pbcopy/pbpase</code> の呼び出し方が変わった? 動かない時がある様な。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*macOSclipborad</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'darwin</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:copy-from-osx</span> <span class="p">()</span>
    <span class="s">"Get string via pbpaste"</span>
    <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="s">"pbpaste"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:paste-to-osx</span> <span class="p">(</span><span class="nv">text</span> <span class="k">&amp;optional</span> <span class="nb">push</span><span class="p">)</span>
    <span class="s">"put `TEXT' via pbcopy with `PUSH' mode"</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">process-connection-type</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">proc</span> <span class="p">(</span><span class="nv">start-process</span> <span class="s">"pbcopy"</span> <span class="s">"*Messages*"</span> <span class="s">"pbcopy"</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">process-send-string</span> <span class="nv">proc</span> <span class="nv">text</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">process-send-eof</span> <span class="nv">proc</span><span class="p">))))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">interprogram-cut-function</span>   <span class="ss">'my:paste-to-osx</span>
        <span class="nv">interprogram-paste-function</span> <span class="ss">'my:copy-from-osx</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org5f756509">
<code>ibuffer</code>: buffer の操作</h2>
<div class="outline-text-2" id="text-org5f756509">
<p>
buffer を眺めるのは ibuffer が好み
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ibuffer</span>
  <span class="ss">:after</span> <span class="nv">all-the-icons-in-terminal</span>
  <span class="ss">:defun</span> <span class="p">(</span><span class="nv">ibuffer-current-buffer</span><span class="p">)</span>
  <span class="ss">:defvar</span> <span class="p">(</span><span class="nv">ibuffer-formats</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:ibuffer-find-file</span> <span class="p">()</span>
    <span class="s">"Like `find-file', but default to the directory of the buffer at point."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">default-directory</span>
            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">buf</span> <span class="p">(</span><span class="nv">ibuffer-current-buffer</span><span class="p">)))</span>
              <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">buffer-live-p</span> <span class="nv">buf</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">with-current-buffer</span> <span class="nv">buf</span>
                    <span class="nv">default-directory</span><span class="p">)</span>
                <span class="nv">default-directory</span><span class="p">))))</span>
      <span class="p">(</span><span class="nv">find-file</span> <span class="nv">default-directory</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x C-b"</span> <span class="o">.</span> <span class="nv">ibuffer-other-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x b"</span>   <span class="o">.</span> <span class="nv">ibuffer-other-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x M-b"</span> <span class="o">.</span> <span class="nv">ibuffer</span><span class="p">)</span>
         <span class="p">(</span><span class="ss">:ibuffer-mode-map</span>
          <span class="p">(</span><span class="s">"C-x C-f"</span> <span class="o">.</span> <span class="nv">my:ibuffer-find-file</span><span class="p">))</span>
         <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">define-ibuffer-column</span> <span class="nv">icon</span> <span class="p">(</span><span class="ss">:name</span> <span class="s">"  "</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">icon</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">buffer-file-name</span><span class="p">)</span>
                    <span class="p">(</span><span class="nv">all-the-icons-auto-mode-match?</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">all-the-icons-icon-for-file</span>
                <span class="p">(</span><span class="nv">file-name-nondirectory</span> <span class="p">(</span><span class="nv">buffer-file-name</span><span class="p">)))</span>
             <span class="p">(</span><span class="nv">all-the-icons-icon-for-mode</span> <span class="nv">major-mode</span> <span class="p">))))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbolp</span> <span class="nv">icon</span><span class="p">)</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">icon</span>
                <span class="p">(</span><span class="nv">all-the-icons-faicon</span>
                 <span class="s">"file-o"</span>
                 <span class="ss">:face</span> <span class="ss">'all-the-icons-dsilver</span><span class="p">))</span>
        <span class="nv">icon</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">ibuffer-formats</span>
        <span class="o">`</span><span class="p">((</span><span class="nv">mark</span> <span class="nv">modified</span> <span class="nv">read-only</span>
                <span class="s">" "</span> <span class="p">(</span><span class="nv">icon</span> <span class="mi">2</span> <span class="mi">2</span> <span class="ss">:left</span> <span class="ss">:elide</span><span class="p">)</span>
                <span class="o">,</span><span class="p">(</span><span class="nv">propertize</span> <span class="s">" "</span> <span class="ss">'display</span> <span class="o">`</span><span class="p">(</span><span class="nv">space</span> <span class="ss">:align-to</span> <span class="mi">8</span><span class="p">))</span>
                <span class="p">(</span><span class="nv">name</span> <span class="mi">18</span> <span class="mi">18</span> <span class="ss">:left</span> <span class="ss">:elide</span><span class="p">)</span>
                <span class="s">" "</span> <span class="p">(</span><span class="nv">size</span> <span class="mi">9</span> <span class="mi">-1</span> <span class="ss">:right</span><span class="p">)</span>
                <span class="s">" "</span> <span class="p">(</span><span class="nv">mode</span> <span class="mi">16</span> <span class="mi">16</span> <span class="ss">:left</span> <span class="ss">:elide</span><span class="p">)</span> <span class="s">" "</span> <span class="nv">filename-and-process</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">mark</span> <span class="s">" "</span> <span class="p">(</span><span class="nv">name</span> <span class="mi">16</span> <span class="mi">-1</span><span class="p">)</span> <span class="s">" "</span> <span class="nv">filename</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org2c2abb9b">
<code>wanderulst</code>: MUA の設定</h2>
<div class="outline-text-2" id="text-org2c2abb9b">
<p>
MUA として Wanderlust を使っている
</p>
<ul class="org-ul">
<li><a href="https://wanderlust.github.io/wl-docs/wl-ja.html">Wanderlust – Yet Another Message Interface On Emacsen –</a></li>
</ul>
</div>
<div>
<h3 id="org47a9ca66">Emacs 本体側の設定(wanderlust)</h3>
<div class="outline-text-3" id="text-org47a9ca66">
<p>
Emacs 本体での設定は以下の通り. Wanderlust 自体の設定は別ファイルで行なわれる．
ここでは <code>wl-init-file</code> を指定することで, 設定ファイルを明示している．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">wl</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/etc/emacs/site-start.d/65wl-beta.el"</span><span class="p">)</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">wl</span> <span class="nv">wl-other-frame</span> <span class="nv">wl-draft</span> <span class="nv">wl-user-agent</span> <span class="nv">wl-user-agent-compose</span> <span class="nv">wl-draft-send</span> <span class="nv">wl-draft-kill</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:wl-mode-line-buffer-identification</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">id</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">force-mode-line-update</span> <span class="no">t</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:wl-cache-directory</span>
    <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"wanderlust"</span> <span class="s">"~/.cache"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span>
           <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"local/Trash"</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">make-directory</span>
     <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"local/Trash"</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:override</span> <span class="nv">wl-mode-line-buffer-identification</span>
                     <span class="nv">my:wl-mode-line-buffer-identification</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">elmo-msgdb-directory</span>     <span class="o">.</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">elmo-maildir-folder-path</span> <span class="o">.</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">elmo-cache-directory</span>     <span class="o">.</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">wl-score-files-directory</span> <span class="o">.</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">read-mail-command</span>        <span class="o">.</span> <span class="nf">#'</span><span class="nv">wl</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">wl-init-file</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"init-wl"</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">wl-demo</span>                  <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">define-mail-user-agent</span>
    <span class="ss">'wl-user-agent</span>
    <span class="ss">'wl-user-agent-compose</span>
    <span class="ss">'wl-draft-send</span>
    <span class="ss">'wl-draft-kill</span>
    <span class="ss">'mail-send-hook</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<p>
割と <code>/etc/emacs/site-start.d/65wl-beta.el</code> と重複している気がするが.
</p>
</div>
</div>
<div>
<h3 id="org160184bf">Wanderlust 本体の設定</h3>
<div class="outline-text-3" id="text-org160184bf">
<p>
実際の設定は以下の通り
</p>
</div>
<div>
<h4 id="orge2af69a1">byte-compile の準備</h4>
<div class="outline-text-4" id="text-orge2af69a1">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-and-compile</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">el-x</span>
    <span class="ss">:el-get</span> <span class="p">(</span><span class="nv">el-x</span>
             <span class="ss">:type</span> <span class="nv">github</span>
             <span class="ss">:pkgname</span> <span class="s">"sigma/el-x"</span>
             <span class="ss">:build</span> <span class="o">`</span><span class="p">((</span><span class="s">"make"</span> <span class="o">,</span><span class="p">(</span><span class="nb">format</span> <span class="s">"EMACSBIN=%s"</span> <span class="nv">el-get-emacs</span><span class="p">)))</span>
             <span class="ss">:load-path</span> <span class="s">"lisp"</span>
             <span class="p">)</span>
    <span class="ss">:require</span> <span class="no">t</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">eval-when-compile</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'cp5022x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'wl</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'mime-def</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org9638e017">依存/追加ライブラリのインストールと読み込み</h4>
<div class="outline-text-4" id="text-org9638e017">
</div>
<div>
<h5 id="org587385af">rail</h5>
<div class="outline-text-5" id="text-org587385af">
<p>
SEMI や FLIM などの UA の表示に <a href="http://uwabami.github.com/rail/">rail</a> を使っている.
ちなみに rail を有効にすると, 以下の様に User-Agent が表示される
</p>
<div class="col-7 px2 mx-auto">
<amp-img layout="responsive" width="640" height="400" src="https://uwabami.github.io/software/rail/wanderlust_with_or_without_rail.webp" alt="rail preview"><amp-img layout="responsive" width="640" height="400" src="https://uwabami.github.io/software/rail/wanderlust_with_or_without_rail.png" alt="rail preview" fallback></amp-img><noscript><img width="640" height="400" src="https://uwabami.github.io/software/rail/wanderlust_with_or_without_rail.png" alt="rail preview"></noscript></amp-img>
</div>

<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">rail</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">locate-library</span> <span class="s">"rail"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">el-get-bundle</span> <span class="nv">uwabami/rail</span><span class="p">))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">rail-emulate-genjis</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orga4113e25">cp5022x を使う</h5>
<div class="outline-text-5" id="text-orga4113e25">
<p>
ISO-2022-JP を CP50220 として扱う.
<a href="http://d.hatena.ne.jp/kiwanami/20091103/1257243524">Wanderlustと文字コード</a> も参照のこと.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mime-charset-coding-system-alist</span>
             <span class="o">'</span><span class="p">(</span><span class="nv">iso-2022-jp</span> <span class="o">.</span> <span class="nv">cp50220</span><span class="p">))</span>
<span class="c1">;; fxxkin outlook</span>
<span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mime-charset-coding-system-alist</span>
             <span class="o">'</span><span class="p">(</span><span class="nv">gb2312</span> <span class="o">.</span> <span class="nv">gbk</span><span class="p">))</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-mime-charset</span> <span class="ss">'iso-2022-jp</span><span class="p">)</span>
<span class="c1">;; (setq wl-mime-charset 'utf-8-uni)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgc4ec7a62">SEMI の追加設定</h5>
<div class="outline-text-5" id="text-orgc4ec7a62">
<p>
HTML メールを表示するために eww を使う.
mime-setup がロードされる前に記述する必要あり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">mime-setup</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">w3m-load</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">mime-w3m</span> <span class="ss">:require</span> <span class="no">t</span><span class="p">)</span>
  <span class="c1">;; (setq mime-view-text/html-previewer 'shr</span>
  <span class="c1">;;       mime-setup-enable-inline-html 'shr)</span>
  <span class="c1">;; (defvar my:shr-width 72)</span>
  <span class="c1">;; (defun my:shr-insert-document (&amp;rest them)</span>
  <span class="c1">;;   (let ((shr-width my:shr-width)) (apply them)))</span>
  <span class="c1">;; (defun my:mime-shr-preview-text/html (&amp;rest args)</span>
  <span class="c1">;;   (advice-add 'shr-insert-document :around 'my:shr-insert-document)</span>
  <span class="c1">;;   (unwind-protect</span>
  <span class="c1">;;       (apply args)</span>
  <span class="c1">;;     (advice-remove 'shr-insert-document 'my:shr-insert-document)))</span>
  <span class="c1">;; :advice</span>
  <span class="c1">;; (:around mime-shr-preview-text/html</span>
  <span class="c1">;;          my:mime-shr-preview-text/html)</span>
  <span class="p">)</span></code></pre></figure>
<p>
どのアプリケーションで開くか → <code>xdg-open</code> に丸投げ．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">my-mime-preview-play-current-entity-appname</span> <span class="s">"xdg-open"</span>
  <span class="s">"meadow なら fiber, mac なら open, linux なら xdg-open"</span><span class="p">)</span>

<span class="p">(</span><span class="nb">cond</span>
 <span class="p">((</span><span class="nv">string-match</span> <span class="s">"apple-darwin"</span> <span class="nv">system-configuration</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">my-mime-preview-play-current-entity-appname</span> <span class="s">"open"</span><span class="p">)</span>
  <span class="p">)</span>
 <span class="p">((</span><span class="nv">string-match</span> <span class="s">"linux"</span> <span class="nv">system-configuration</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">my-mime-preview-play-current-entity-appname</span> <span class="s">"xdg-open"</span><span class="p">)</span>
  <span class="p">))</span>

<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">functionp</span> <span class="nf">#'</span><span class="nv">mime-preview-play-current-entity-orig</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">fset</span> <span class="nf">#'</span><span class="nv">mime-preview-play-current-entity-orig</span>
        <span class="p">(</span><span class="nb">symbol-function</span> <span class="nf">#'</span><span class="nv">mime-preview-play-current-entity</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">mime-preview-play-current-entity</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">ignore-examples</span> <span class="nv">mode</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">interactive</span> <span class="s">"P"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">mode</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">equal</span> <span class="nv">mode</span> <span class="s">"play"</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">mime-preview-play-current-entity-orig</span> <span class="nv">ignore-examples</span> <span class="nv">mode</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">entity</span> <span class="p">(</span><span class="nv">get-text-property</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="ss">'mime-view-entity</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">name</span> <span class="p">(</span><span class="nv">mime-entity-safe-filename</span> <span class="nv">entity</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">filename</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">name</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">string=</span> <span class="nv">name</span> <span class="s">""</span><span class="p">)))</span>
                                           <span class="nv">name</span>
                                         <span class="p">(</span><span class="nv">make-temp-name</span> <span class="s">"EMI"</span><span class="p">))</span>
                                       <span class="p">(</span><span class="nv">make-temp-file</span> <span class="s">"EMI"</span> <span class="ss">'directory</span><span class="p">))))</span>
      <span class="p">(</span><span class="nv">mime-write-entity-content</span> <span class="nv">entity</span> <span class="nv">filename</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">message</span> <span class="s">"External method is starting..."</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">process-name</span>
              <span class="p">(</span><span class="nv">concat</span> <span class="nv">my-mime-preview-play-current-entity-appname</span> <span class="s">" "</span> <span class="nv">filename</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">process</span>
              <span class="p">(</span><span class="nv">start-process</span> <span class="nv">process-name</span>
                             <span class="nv">mime-echo-buffer-name</span>
                             <span class="nv">my-mime-preview-play-current-entity-appname</span>
                             <span class="nv">filename</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">set-alist</span> <span class="ss">'mime-mailcap-method-filename-alist</span> <span class="nv">process</span> <span class="nv">filename</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">set-process-sentinel</span> <span class="nv">process</span> <span class="ss">'mime-mailcap-method-sentinel</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">mime-play-delete-file-immediately</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">mime-view-mailcap-files</span> <span class="o">'</span><span class="p">(</span><span class="s">"~/.mailcap"</span><span class="p">))</span></code></pre></figure>
<p>
<code>~/.mailcap</code> 自体は以下
</p>
<figure class="highlight"><pre><code class="language-conf" data-lang="conf"><span class="n">applications</span>/*; <span class="n">xdg</span>-<span class="n">open</span> %<span class="n">s</span>;
<span class="n">image</span>/*; <span class="n">xdg</span>-<span class="n">open</span> %<span class="n">s</span>;
<span class="n">video</span>/*; <span class="n">xdg</span>-<span class="n">open</span> %<span class="n">s</span>;</code></pre></figure>
<p>
MIME の例の保存先の変更
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-situation-examples-file</span>
      <span class="p">(</span><span class="nv">concat</span> <span class="nv">my:d:tmp</span> <span class="s">"mime-example"</span><span class="p">))</span></code></pre></figure>
<p>
text/plain より html を優先 <code>(- -;)</code>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-view-type-subtype-score-alist</span>
      <span class="o">'</span><span class="p">(((</span><span class="nv">text</span> <span class="o">.</span> <span class="nv">plain</span><span class="p">)</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">((</span><span class="nv">text</span> <span class="o">.</span> <span class="nv">html</span><span class="p">)</span>  <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">))</span></code></pre></figure>
<p>
音を鳴らすアレやコレの無効化
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-play-find-every-situations</span> <span class="no">nil</span>
      <span class="nv">process-connection-type</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org6dae78eb">個人情報の設定</h4>
<div class="outline-text-4" id="text-org6dae78eb">
<p>
具体的な設定内容は以下のファイルに置いている
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">load</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">my:d:password-store</span> <span class="s">"/wl-info.gpg"</span><span class="p">))</span></code></pre></figure>
<p>
設定している内容は以下の通り
</p>
</div>
<div>
<h5 id="org7f87384b">自身のメールアドレスと購読メーリングリストの設定</h5>
<div class="outline-text-5" id="text-org7f87384b">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; From: の設定</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-from</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">user-full-name</span> <span class="s">" &lt;"</span> <span class="nv">user-mail-address</span> <span class="s">"&gt;"</span><span class="p">))</span>
<span class="c1">;; (system-name) が FQDN を返さない場合、</span>
<span class="c1">;; `wl-local-domain' にホスト名を除いたドメイン名を設定</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-local-domain</span> <span class="s">"example.com"</span><span class="p">)</span>
<span class="c1">;; 自分のメールアドレスのリスト</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-user-mail-address-list</span>
      <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">wl-address-header-extract-address</span> <span class="nv">wl-from</span><span class="p">)</span>
            <span class="c1">;; "e-mail2@example.com"</span>
            <span class="c1">;; "e-mail3@example.net" ...</span>
            <span class="p">))</span>
<span class="c1">;; 自分の参加しているメーリングリストのリスト</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-subscribed-mailing-list</span>
      <span class="o">'</span><span class="p">(</span><span class="s">"wl@lists.airs.net"</span>
        <span class="s">"apel-ja@m17n.org"</span>
        <span class="s">"emacs-mime-ja@m17n.org"</span>
        <span class="c1">;; "ml@example.com" ...</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgba8bc2e7">送受信用サーバの設定</h5>
<div class="outline-text-5" id="text-orgba8bc2e7">
<p>
受信(IMAP)
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-default-server</span> <span class="s">"your imap server"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-default-port</span> <span class="ss">'993</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-default-stream-type</span> <span class="ss">'ssl</span><span class="p">)</span></code></pre></figure>
<p>
送信(SMTP)
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-posting-server</span> <span class="s">"your smtp server"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-posting-user</span> <span class="s">"your account"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-posting-port</span> <span class="mi">587</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-connection-type</span> <span class="ss">'starttls</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-authenticate-type</span> <span class="s">"login"</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org9af3a565">From に応じて送信サーバをきりかえる.</h5>
<div class="outline-text-5" id="text-org9af3a565">
<p>
本来はメール作成時/返信時の template の切り替えなのだれど,
送信時の SMTP の設定を from に合わせてきりかえるようにする.
default に二重に指定しているのは,
一度別のアカウントに切り替えた後に再びトグルして戻って来た際に元に戻す(上書き)するため.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-template-alist</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"default"</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="nv">wl-from</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"your smtp server"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">"login"</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">"example1"</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="s">"Your Name &lt;account@example1.com&gt;"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"smtp.example1.com"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">"login"</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">"example2"</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="s">"Your Name &lt;account@example2.com&gt;"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"smtp.example2.com"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">"plain"</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">"ssh:smtp"</span>
         <span class="c1">;; need ssh tunnel</span>
         <span class="c1">;; ssh -f -N -L 20025:localhost:25 smtp.server.com</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="s">"Your Name &lt;account@example3.com&gt;"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"localhost"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your ssh account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">20025</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'nil</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="ss">'nil</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">))</span></code></pre></figure>
<p>
ssh tunnel を自動的にやる事はできないモンだろうか
(送信時に open して, 送信後に close する, みたいなの).
</p>

<p>
ついでに template の切り替えに関して幾つか設定.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; template 切り替え時に 内容を表示</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-template-visible-select</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
<code>draft-mode</code> で <code>C-c C-n</code> をするとテンプレートを切り替え
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">"\C-c\C-n"</span> <span class="ss">'wl-template-select</span><span class="p">)</span></code></pre></figure>
<p>
from に応じて wl-from, wl-envelope-from,
送信 smtp サーバを変更する送信時に変更
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'wl-draft-send-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nb">set</span> <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'wl-from</span><span class="p">)</span>
                 <span class="p">(</span><span class="nv">std11-fetch-field</span> <span class="s">"From"</span><span class="p">))))</span></code></pre></figure>
<p>
送信時に自動的に wl-draft-config-alist を適用…しない?
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">'wl-draft-send-hook</span> <span class="ss">'wl-draft-config-exec</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org19ec5248">基本設定</h4>
<div class="outline-text-4" id="text-org19ec5248">
</div>
<div>
<h5 id="org69cc3854">imap 関連</h5>
<div class="outline-text-5" id="text-org69cc3854">
<p>
デフォルトの認証設定
フォルダ名は UTF-7 でエンコードされているので,
表示する際にこれをデコードする
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-use-modified-utf7</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org2d8166ce">非同期チェック</h5>
<div class="outline-text-5" id="text-org2d8166ce">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-folder-check-async</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org6572a382">フォルダの位置の default からの変更</h5>
<div class="outline-text-5" id="text-org6572a382">
<p>
<code>~/.cache/wanderlust/</code> に集約している
local の Mail folder の位置
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-maildir-folder-path</span> <span class="s">"~/.cache/wanderlust"</span>
      <span class="nv">elmo-localdir-folder-path</span> <span class="s">"~/.cache/wanderlust/local"</span><span class="p">)</span></code></pre></figure>
<p>
local フォルダの設定:
<code>.lost+found</code> は <code>elmo-maildir-folder-path</code> からの相対パスになっていることに注意
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-lost+found-folder</span> <span class="s">".lost+found"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-queue-folder</span> <span class="s">"+queue"</span><span class="p">)</span></code></pre></figure>
<p>
folders の位置の変更
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-folders-file</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">my:d:password-store</span> <span class="s">"/wl-folders.gpg"</span><span class="p">))</span></code></pre></figure>
<p>
Drafts, Trash の置き場所
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-folder</span> <span class="s">"+Drafts"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-trash-folder</span> <span class="s">"+Trash"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-lost+found-folder</span> <span class="s">"+lost+found"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-temporary-file-directory</span> <span class="s">"~/Downloads/"</span><span class="p">)</span></code></pre></figure>
<p>
アドレス帳
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-use-petname</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-address-file</span>  <span class="s">"~/.mua/Address"</span><span class="p">)</span></code></pre></figure>
<p>
LDAP サーバからアドレスを引くことも可能.
以前は GCALDaemon を使って local に ldap サーバを上げていたのだけれども,
Google Contacts の API が変わったらしく
GCALDaemon で LDAP サーバは使えなくなったのでコメントアウト.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-use-ldap</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-ldap-server</span> <span class="s">"localhost"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-ldap-port</span> <span class="s">"389"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-ldap-base</span> <span class="s">"dc=math,dc=kyoto-u,dc=ac,dc=jp"</span><span class="p">)</span></code></pre></figure>
<p>
パスワードの保存先
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-passwd-alist-file-name</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">my:d:password-store</span> <span class="s">"/wl-passwd.gpg"</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org72bfee4a">フォルダ編集時に backup を作成しない.</h5>
<div class="outline-text-5" id="text-org72bfee4a">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-fldmgr-make-backup</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org223d5fa2">FCC, BCC の設定</h5>
<div class="outline-text-5" id="text-org223d5fa2">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-fcc</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; (setq wl-fcc "%Sent")</span></code></pre></figure>
<p>
fcc を既読にする場合は以下．=wl-fcc= が nil の場合には意味は無い
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-fcc-force-as-read</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
bcc は常に自身に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-bcc</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">user-mail-address</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org4378f104">起動時に <code>%INBOX</code> のみをチェック</h5>
<div class="outline-text-5" id="text-org4378f104">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-auto-check-folder-name</span> <span class="s">"%INBOX"</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org6efc7670">フォルダ選択時の初期設定</h5>
<div class="outline-text-5" id="text-org6efc7670">
<p>
imap の namespace を毎度入力するのが面倒なので, これを追加しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-default-spec</span> <span class="s">"%"</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgb2cf2b53">confirm 関連の設定</h5>
<div class="outline-text-5" id="text-orgb2cf2b53">
<p>
スキャン時の問い合わせの無効化.
ちなみに confirm を nil にしても 問い合わせが無いだけで
threshold は効くので, 明示的に nil に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-folder-update-confirm</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-folder-update-threshold</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-message-fetch-confirm</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-message-fetch-threshold</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-prefetch-confirm</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-prefetch-threshold</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
終了時に確認しない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-interactive-exit</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
送信時は確認する
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-interactive-send</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org14b77860">misc.</h5>
<div class="outline-text-5" id="text-org14b77860">
<p>
大きいメッセージを送信時に分割しない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-edit-split-message</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
スレッドは常に閉じる
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-thread-insert-opened</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
3 pain 表示 -&gt; 使わない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-stay-folder-window</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
未読を優先的に読む
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-move-order</span> <span class="ss">'unread</span><span class="p">)</span></code></pre></figure>
<p>
改ページ無視
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-break-pages</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
icon を使わない → GUI でもメニュー表示してないし, 体感的には遅くなる
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-highlight-folder-with-icon</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org83490625">dispose, delete の設定</h5>
<div class="outline-text-5" id="text-org83490625">
<p>
Gmail用に%INBOXでは削除を <code>wl-trash-folder</code> への移動ではなく, 「delete」に．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'wl-dispose-folder-alist</span>
             <span class="o">'</span><span class="p">(</span><span class="s">"^%INBOX"</span> <span class="o">.</span> <span class="nb">remove</span><span class="p">))</span></code></pre></figure>
<p>
迷惑メール関連も
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'wl-dispose-folder-alist</span>
             <span class="o">'</span><span class="p">(</span><span class="s">".*Junk$"</span> <span class="o">.</span> <span class="nb">remove</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgd88be525">折り返しの設定</h5>
<div class="outline-text-5" id="text-orgd88be525">
<p>
message は折り返す.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-truncate-lines</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
draft も折り返す
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-truncate-lines</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgb31f5f2c">mode-line の設定</h5>
<div class="outline-text-5" id="text-orgb31f5f2c">
<p>
長いと嫌なのでイロイロ削る
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-mode-line-format</span> <span class="s">""</span><span class="p">)</span> <span class="c1">; "%f {%t}(%n/%u/%a)"</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-mode-line-format</span> <span class="s">""</span><span class="p">)</span> <span class="c1">; "&lt;&lt; %f:%F&gt;&gt; [%m]"</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org51dfe1e0">キーバインド関連</h4>
<div class="outline-text-4" id="text-org51dfe1e0">
<p>
<code>C-c C-j</code> を browse-url に明け渡す
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">"\C-c\C-j"</span> <span class="ss">'browse-url-at-point</span><span class="p">)</span></code></pre></figure>
<p>
<code>M-u</code> で unread にする
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"\M-u"</span> <span class="ss">'wl-summary-mark-as-unread</span><span class="p">)</span></code></pre></figure>
<p>
<code>i</code> で sync &lt;- Mew 風
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"i"</span> <span class="ss">'wl-summary-sync-update</span><span class="p">)</span></code></pre></figure>
<p>
<code>C-o</code> は elscreen で使う
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"\C-o"</span> <span class="no">nil</span> <span class="p">)</span></code></pre></figure>
<p>
<code>M-o</code> で <code>auto-refile</code>  (Mew 風)
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"\M-o"</span> <span class="ss">'wl-summary-auto-refile</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org460a927d">flag とフォルダを行き来する関数の追加</h4>
<div class="outline-text-4" id="text-org460a927d">
<p>
"=" でフラグ付きフォルダと
実際にメッセージのあるフォルダを行き来する.
Gmail の「スター付き」フォルダでも有効
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">'elmo</span> <span class="no">nil</span> <span class="ss">'noerror</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:wl-summary-jump-to-referer-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">wl-summary-message-number</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq</span> <span class="p">(</span><span class="nv">elmo-folder-type-internal</span> <span class="nv">wl-summary-buffer-elmo-folder</span><span class="p">)</span> <span class="ss">'flag</span><span class="p">)</span>
        <span class="p">(</span><span class="k">progn</span>
          <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">referer</span> <span class="p">(</span><span class="nv">elmo-flag-folder-referrer</span>
                           <span class="nv">wl-summary-buffer-elmo-folder</span>
                           <span class="p">(</span><span class="nv">wl-summary-message-number</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nv">folder</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">referer</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
                             <span class="p">(</span><span class="nv">completing-read</span>
                              <span class="p">(</span><span class="nb">format</span> <span class="s">"Jump to (%s): "</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">referer</span><span class="p">)))</span>
                              <span class="nv">referer</span>
                              <span class="no">nil</span> <span class="no">t</span> <span class="no">nil</span> <span class="no">nil</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">referer</span><span class="p">)))</span>
                           <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">referer</span><span class="p">)))))</span>
            <span class="p">(</span><span class="nv">wl-summary-goto-folder-subr</span> <span class="nv">folder</span> <span class="ss">'no-sync</span> <span class="no">nil</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">wl-summary-jump-to-msg</span> <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">assoc</span> <span class="nv">folder</span> <span class="nv">referer</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">eq</span> <span class="p">(</span><span class="nv">elmo-folder-type</span> <span class="nv">wl-summary-last-visited-folder</span><span class="p">)</span> <span class="ss">'internal</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">wl-summary-goto-last-visited-folder</span><span class="p">)))))</span>
<span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"="</span> <span class="ss">'my:wl-summary-jump-to-referer-message</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org433d7a5c">summary-mode の表示のカスタマイズ</h4>
<div class="outline-text-4" id="text-org433d7a5c">
</div>
<div>
<h5 id="org63a385a5">自分が差出人である mail は To:某 と表示</h5>
<div class="outline-text-5" id="text-org63a385a5">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-showto-folder-regexp</span> <span class="s">".*"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-from-function</span> <span class="ss">'wl-summary-default-from</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org94145d9c">サマリ行の表示関連</h5>
<div class="outline-text-5" id="text-org94145d9c">
<p>
サマリ行のフォーマット指定
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-line-format</span>
      <span class="s">"%T%P%1@%1&gt;%Y/%M/%D %21(%t%[%19(%c %f%)%]%) %#%~%s"</span>
      <span class="nv">wl-summary-width</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">window-width</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span></code></pre></figure>
<p>
サマリ表示は切り詰めない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-subject-length-limit</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
スレッドの幅の指定
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-thread-indent-level</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-thread-have-younger-brother-str</span> <span class="s">"+"</span> <span class="c1">;; "├" ;; "+"</span>
      <span class="nv">wl-thread-youngest-child-str</span> <span class="s">"+"</span> <span class="c1">;; "└" ;; "+"</span>
      <span class="nv">wl-thread-vertical-str</span> <span class="s">"|"</span><span class="c1">;; "│" ;; "|"</span>
      <span class="nv">wl-thread-horizontal-str</span> <span class="s">"-"</span><span class="c1">;; "─" ;; "-"</span>
      <span class="nv">wl-thread-space-str</span> <span class="s">" "</span><span class="p">)</span></code></pre></figure>
<p>
以下の二つの設定を有効にするには
<code>elmo-msgdb-extra-fields</code> を設定する必要がある.
この変数は振り分け判定にも使用するのでそこで設定している
</p>
</div>
</div>
<div>
<h5 id="orga083aeb5">Gmail 風に, 自分宛のメールに "&gt;" をつけて表示する</h5>
<div class="outline-text-5" id="text-orga083aeb5">
<p>
元ネタ <a href="http://d.hatena.ne.jp/khiker/20080206/wanderlust">http://d.hatena.ne.jp/khiker/20080206/wanderlust</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-user-mail-address-regexp</span> <span class="s">"^uwabami.*\\|^sasakyh.*"</span><span class="p">)</span>
<span class="c1">;; 一覧表示での置き換え規則に追加</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:wl-summary-line-for-me</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">catch</span> <span class="ss">'found</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">to</span> <span class="p">(</span><span class="nv">elmo-message-entity-field</span> <span class="nv">wl-message-entity</span> <span class="ss">'to</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">cc</span> <span class="p">(</span><span class="nv">elmo-message-entity-field</span> <span class="nv">wl-message-entity</span> <span class="ss">'cc</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">to</span><span class="p">)</span> <span class="nv">cc</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">to</span>
                  <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">to</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">to</span><span class="p">)</span> <span class="nv">to</span><span class="p">)</span>
                          <span class="p">(</span><span class="nb">when</span> <span class="nv">cc</span>
                            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">cc</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">cc</span><span class="p">)</span> <span class="nv">cc</span><span class="p">)))))</span>
          <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">i</span> <span class="nv">to</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">wl-address-user-mail-address-p</span> <span class="p">(</span><span class="nv">eword-decode-string</span> <span class="nv">i</span><span class="p">))</span>
              <span class="p">(</span><span class="k">throw</span> <span class="ss">'found</span> <span class="no">t</span><span class="p">)))))</span>
      <span class="s">"&gt;"</span>
    <span class="s">""</span><span class="p">))</span>
<span class="c1">;; &gt; を summary-line-format に追加</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-line-format-spec-alist</span>
      <span class="p">(</span><span class="nb">append</span> <span class="nv">wl-summary-line-format-spec-alist</span>
              <span class="o">'</span><span class="p">((</span><span class="nv">?&gt;</span> <span class="p">(</span><span class="nv">my:wl-summary-line-for-me</span><span class="p">)))))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org04b0fd69">添付ファイルがあったら, サマリ行に @ を付ける</h5>
<div class="outline-text-5" id="text-org04b0fd69">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-line-format-spec-alist</span>
      <span class="p">(</span><span class="nb">append</span> <span class="nv">wl-summary-line-format-spec-alist</span>
              <span class="o">'</span><span class="p">((</span><span class="nv">?@</span> <span class="p">(</span><span class="nv">wl-summary-line-attached</span><span class="p">)))))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org9b1eb3e9">クォートされた文字列もデコードする</h5>
<div class="outline-text-5" id="text-org9b1eb3e9">
<p>
昔はあれこれ設定してたけど, 今は良いのかな?
とりあえず, デコードする長さを default の 1000 から二桁増やしておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-field-decoding-max-size</span> <span class="mi">100000</span><span class="p">)</span>
<span class="c1">;; (setq mime-header-lexical-analyzer</span>
<span class="c1">;;       '(</span>
<span class="c1">;;         eword-analyze-quoted-string</span>
<span class="c1">;;         eword-analyze-domain-literal</span>
<span class="c1">;;         eword-analyze-comment</span>
<span class="c1">;;         eword-analyze-spaces</span>
<span class="c1">;;         eword-analyze-special</span>
<span class="c1">;;         eword-analyze-encoded-word</span>
<span class="c1">;;         eword-analyze-atom))</span>
<span class="p">(</span><span class="nv">with-eval-after-load</span> <span class="ss">'eword-decode</span>
  <span class="p">(</span><span class="nv">mime-set-field-decoder</span>
   <span class="ss">'From</span> <span class="no">nil</span> <span class="ss">'eword-decode-and-unfold-unstructured-field-body</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">mime-set-field-decoder</span>
   <span class="ss">'CC</span> <span class="no">nil</span> <span class="ss">'eword-decode-and-unfold-unstructured-field-body</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">mime-set-field-decoder</span>
   <span class="ss">'To</span> <span class="no">nil</span> <span class="ss">'eword-decode-and-unfold-unstructured-field-body</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org8e1a38e8">Subject が変わってもスレッドを切らない</h5>
<div class="outline-text-5" id="text-org8e1a38e8">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-divide-thread-when-subject-changed</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org4a68d8d4">Subject での Tab や複数スペースを無視</h5>
<div class="outline-text-5" id="text-org4a68d8d4">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (defadvice std11-unfold-string (after simply activate)</span>
<span class="c1">;;   (setq ad-return-value</span>
<span class="c1">;;         (replace-regexp-in-string ad-return-value "[ \t]+" " ")))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org84fec166">重複メッセージを非表示に</h5>
<div class="outline-text-5" id="text-org84fec166">
<p>
フォルダ内の Message-ID が同じメールを非表示にする
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-folder-process-duplicates-alist</span>
      <span class="o">'</span><span class="p">(</span>
        <span class="p">(</span><span class="s">".*"</span> <span class="o">.</span> <span class="nv">hide</span><span class="p">)</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgc0e5bbcf">sort 順: 返信が来た順</h5>
<div class="outline-text-5" id="text-orgc0e5bbcf">
<p>
元ネタは <a href="http://ikazuhiro.s206.xrea.com/article.php/20140920115345919">Re: wanderlust で GMail 風、新着レス順にソート</a>.
あんまり頑張る気がなかったので <code>el-x</code> にある <code>dflet</code> を使っている。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">wl-summary-overview-entity-compare-by-reply-date</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="s">"Compare message A and B by latest date of replies including thread."</span>
  <span class="p">(</span><span class="nv">dflet</span> <span class="p">((</span><span class="nv">string-max2</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">string&lt;</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">y</span><span class="p">)</span>
                                  <span class="p">(</span><span class="ss">'t</span> <span class="nv">x</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">elmo-entity-to-number</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                                <span class="p">(</span><span class="nb">elt</span> <span class="p">(</span><span class="nb">cddr</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">thread-number-get-date</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">timezone-make-date-sortable</span>
                                  <span class="p">(</span><span class="nv">elmo-msgdb-overview-entity-get-date</span>
                                   <span class="p">(</span><span class="nv">elmo-message-entity</span>
                                    <span class="nv">wl-summary-buffer-elmo-folder</span>
                                    <span class="nv">x</span><span class="p">))))</span>
         <span class="p">(</span><span class="nv">thread-get-family</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                            <span class="p">(</span><span class="nb">cons</span> <span class="nv">x</span> <span class="p">(</span><span class="nv">wl-thread-entity-get-descendant</span>
                                     <span class="p">(</span><span class="nv">wl-thread-get-entity</span> <span class="nv">x</span><span class="p">))))</span>
         <span class="p">(</span><span class="nv">max-reply-date</span>  <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                          <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">eq</span> <span class="ss">'nil</span> <span class="nv">x</span><span class="p">)</span>
                                 <span class="ss">'nil</span><span class="p">)</span>
                                <span class="p">((</span><span class="nb">eq</span> <span class="ss">'nil</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">thread-number-get-date</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">)))</span>
                                <span class="p">(</span><span class="ss">'t</span>
                                 <span class="p">(</span><span class="nv">string-max2</span> <span class="p">(</span><span class="nv">thread-number-get-date</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">))</span>
                                              <span class="p">(</span><span class="nv">max-reply-date</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">))))))</span>
         <span class="p">)</span>
    <span class="p">(</span><span class="nb">string&lt;</span>
     <span class="p">(</span><span class="nv">max-reply-date</span> <span class="p">(</span><span class="nv">thread-get-family</span> <span class="p">(</span><span class="nv">elmo-entity-to-number</span> <span class="nv">a</span><span class="p">)))</span>
     <span class="p">(</span><span class="nv">max-reply-date</span> <span class="p">(</span><span class="nv">thread-get-family</span> <span class="p">(</span><span class="nv">elmo-entity-to-number</span> <span class="nv">b</span><span class="p">))))))</span>
<span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'wl-summary-sort-specs</span> <span class="ss">'reply-date</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-default-sort-spec</span> <span class="ss">'reply-date</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="orgbeaff272">振り分け設定</h4>
<div class="outline-text-4" id="text-orgbeaff272">
<p>
<code>$</code> 以外を振り分け対象に
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-auto-refile-skip-marks</span> <span class="o">'</span><span class="p">(</span><span class="s">"$"</span><span class="p">))</span></code></pre></figure>
</div>
<div>
<h5 id="org1581be27">振り分け判定に使用するヘッダ</h5>
<div class="outline-text-5" id="text-org1581be27">
<p>
添付の有無の表示にも使うので <code>Content-Type</code> も登録.
あと <code>Delivered-To</code> はメールの検索の時に結構重宝している.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-msgdb-extra-fields</span>
      <span class="o">'</span><span class="p">(</span>
        <span class="s">"List-Post"</span>
        <span class="s">"List-Id"</span>
        <span class="s">"List-ID"</span>                  <span class="c1">;; たまに List-ID で来るメールあるよね?</span>
        <span class="s">"Resent-CC"</span>
        <span class="s">"Mailing-List"</span>
        <span class="s">"X-Mailing-List"</span>
        <span class="s">"X-ML-Address"</span>
        <span class="s">"X-ML-Name"</span>
        <span class="s">"X-ML-To"</span>
        <span class="s">"X-Loop"</span>
        <span class="s">"Delivered-To"</span>
        <span class="s">"Content-Type"</span>              <span class="c1">;; 添付の有無の表示の為に追加</span>
        <span class="s">"X-Google-Appengine-App-Id"</span> <span class="c1">;; GAEの送信するメールの振り分け用</span>
        <span class="s">"To"</span>
        <span class="s">"Cc"</span>
        <span class="s">"From"</span>
        <span class="s">"Subject"</span>
        <span class="s">"Reply-To"</span>
        <span class="s">"Auto-Submitted"</span>            <span class="c1">;; Git commit/Cron notify</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org1c00dc9a">メッセージ表示</h4>
<div class="outline-text-4" id="text-org1c00dc9a">
</div>
<div>
<h5 id="orgbdcad743">いったん全て非表示に</h5>
<div class="outline-text-5" id="text-orgbdcad743">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-ignored-field-list</span> <span class="o">'</span><span class="p">(</span><span class="s">"^.*:"</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org279f859d">見たいヘッダだけ表示</h5>
<div class="outline-text-5" id="text-org279f859d">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-visible-field-list</span>
      <span class="o">'</span><span class="p">(</span><span class="s">"^Subject:"</span>
        <span class="s">"^From:"</span>
        <span class="s">"^To:"</span>
        <span class="s">"^Cc:"</span>
        <span class="s">"^Date:"</span>
        <span class="s">"^Message-ID:"</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org594e5622">表示順の変更</h5>
<div class="outline-text-5" id="text-org594e5622">
<p>
Mew 風…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-sort-field-list</span>
      <span class="o">'</span><span class="p">(</span><span class="s">"^Subject:"</span>
        <span class="s">"^From:"</span>
        <span class="s">"^To:"</span>
        <span class="s">"^Cc:"</span>
        <span class="s">"^Date:"</span>
        <span class="s">"^Message-ID:"</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org452d7cdb">From, To を省略表示しない</h5>
<div class="outline-text-5" id="text-org452d7cdb">
<p>
To や From にアドレスが沢山指定されていると省略されるので, これを無効化
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-use-header-narrowing</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org1bf4b420">Wanderlust: Face の設定</h4>
<div class="outline-text-4" id="text-org1bf4b420">
<p>
デフォルトより細かく指定するために幾つかの face 定義を追加.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-highlight-message-header-alist</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"Subject[ \t]*:"</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-subject-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"From[ \t]*:"</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-from-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"Date[ \t]*:"</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-date-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"\\(.*To\\|Cc\\|Newsgroups\\)[ \t]*:"</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-important-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"\\(User-Agent\\|X-Mailer\\|X-Newsreader\\)[ \t]*:"</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-unimportant-header-contents</span><span class="p">)</span>
        <span class="p">))</span>
<span class="c1">;; face の色付け</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:wl-set-face</span> <span class="p">(</span><span class="nv">face</span> <span class="nv">spec</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">make-face</span> <span class="nv">face</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">fboundp</span> <span class="ss">'face-spec-set</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">face-spec-set</span> <span class="nv">face</span> <span class="nv">spec</span><span class="p">))</span>
        <span class="p">(</span><span class="no">t</span>
         <span class="p">(</span><span class="nv">wl-declare-face</span> <span class="nv">face</span> <span class="nv">spec</span><span class="p">))))</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nv">my:wl-set-face</span>
 <span class="ss">'wl-highlight-message-subject-header-contents</span>
 <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#FF5252"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="ss">:italic</span> <span class="no">nil</span> <span class="ss">:weight</span> <span class="nv">bold</span> <span class="p">))))</span>
<span class="p">(</span><span class="nv">my:wl-set-face</span>
 <span class="ss">'wl-highlight-message-from-header-contents</span>
 <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#FFD740"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="ss">:italic</span> <span class="no">nil</span> <span class="ss">:weight</span> <span class="nv">bold</span> <span class="p">))))</span>
<span class="p">(</span><span class="nv">my:wl-set-face</span>
 <span class="ss">'wl-highlight-message-date-header-contents</span>
 <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#5CF19E"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="ss">:italic</span> <span class="no">nil</span> <span class="ss">:weight</span> <span class="nv">bold</span> <span class="p">))))</span></code></pre></figure>
<p>
以下, 元々定義されているfaceの設定
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (my:wl-set-face 'wl-highlight-folder-closed-face</span>
<span class="c1">;;                 '((t (:foreground "#4cff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-few-face</span>
<span class="c1">;;                 '((t (:foreground "#FF4C4C" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-zero-face</span>
<span class="c1">;;                 '((t (:foreground "#f6f3e8" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-1</span>
<span class="c1">;;                 '((t (:foreground "#7fff7f" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-2</span>
<span class="c1">;;                 '((t (:foreground "#ffff7f" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-3</span>
<span class="c1">;;                 '((t (:foreground "#7f7fff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-4</span>
<span class="c1">;;                 '((t (:foreground "#7fffff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-5</span>
<span class="c1">;;                 '((t (:foreground "#ff7fff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-6</span>
<span class="c1">;;                 '((t (:foreground "#ff7f7f" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-7</span>
<span class="c1">;;                 '((t (:foreground "#4cff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-8</span>
<span class="c1">;;                 '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-9</span>
<span class="c1">;;                 '((t (:foreground "#4c4cff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-10</span>
<span class="c1">;;                 '((t (:foreground "#4cffff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-11</span>
<span class="c1">;;                 '((t (:foreground "#ff4cff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-12</span>
<span class="c1">;;                 '((t (:foreground "#ff4c4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-date-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-headers</span>
<span class="c1">;;                 '((t (:foreground "#4CFFFF" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-important-header-contents2</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-signature</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-important-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#FF4CFF" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-subject-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#FF4C4C" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-unimportant-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-answered-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-refiled-face</span>
<span class="c1">;;                 '((t (:foreground "#7F7FFF" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-thread-top-face</span>
<span class="c1">;;                 '((t (:foreground "#F6F3E8" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-important-flag-face</span>
<span class="c1">;;                 '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-killed-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:black :5Dbold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-many-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:magenta :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-opened-face</span>
<span class="c1">;;                 '((t (:foreground "#4cffff" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-path-face</span>
<span class="c1">;;                 '((t (:underline t :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-unknown-face</span>
<span class="c1">;;                 '((t (:foreground "#4cffff" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-unread-face</span>
<span class="c1">;;                 '((t (:foreground ,my:n:blue :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-header-separator-face</span>
<span class="c1">;;                 '((t (:inherit highlight :bold t ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-citation-header</span>
<span class="c1">;;                 '((t (:foreground ,my:h:green :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-copied-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFFFF" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-deleted-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:black :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-displaying-face</span>
<span class="c1">;;                 '((t (:underline t :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-disposed-face</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-flagged-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:yellow :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-forwarded-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:blue :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-high-read-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:green :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-high-unread-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:orange :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-important-face</span>
<span class="c1">;;                 '((t (:foreground "#ffff4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-killed-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:black :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-l:read-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-l:unread-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:lightb :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-new-face</span>
<span class="c1">;;                 '((t (:foreground "#ff4c4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-normal-face</span>
<span class="c1">;;                 '((t (:foreground "#f6f3e8" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-prefetch-face</span>
<span class="c1">;;                 '((t (:foreground ,my:n:blue :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-resend-face</span>
<span class="c1">;;                 '((t (:foreground ,my:h:orange :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-target-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFFFF" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-temp-face</span>
<span class="c1">;;                 '((t (:foreground ,my:n:violet :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-unread-face</span>
<span class="c1">;;                 '((t (:foreground "#ff4c4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-thread-indent-face</span>
<span class="c1">;;                 '((t (:underline t :bold nil :italic nil ))))</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org32b816f3">作成/返信設定</h4>
<div class="outline-text-4" id="text-org32b816f3">
<p>
自分宛のメールに返信する場合は <code>To:</code>, <code>Cc:</code> から自分のアドレスを削除
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-always-delete-myself</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
"a" (without-argument)では <code>Reply-To:</code> や <code>From:</code> などで
指定された唯一人または唯一つの投稿先に返信.
また, <code>X-ML-Name:</code> と <code>Reply-To:</code> がついているなら <code>Reply-To:</code> 宛に返信
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-reply-without-argument-list</span>
      <span class="o">'</span><span class="p">(((</span><span class="s">"X-ML-Name"</span> <span class="s">"Reply-To"</span><span class="p">)</span> <span class="o">.</span> <span class="p">((</span><span class="s">"Reply-To"</span><span class="p">)</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">"X-ML-Name"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"To"</span> <span class="s">"Cc"</span><span class="p">)</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">"Followup-To"</span> <span class="o">.</span> <span class="p">(</span><span class="no">nil</span> <span class="no">nil</span> <span class="p">(</span><span class="s">"Followup-To"</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">"Newsgroups"</span> <span class="o">.</span> <span class="p">(</span><span class="no">nil</span> <span class="no">nil</span> <span class="p">(</span><span class="s">"Newsgroups"</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">"Reply-To"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"Reply-To"</span><span class="p">)</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">"Mail-Reply-To"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"Mail-Reply-To"</span><span class="p">)</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"From"</span><span class="p">)</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))))</span></code></pre></figure>
<p>
<code>C-u a</code> (with-argument)であれば関係する全ての人・投稿先に返信
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-reply-with-argument-list</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"Followup-To"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"From"</span><span class="p">)</span> <span class="no">nil</span> <span class="p">(</span><span class="s">"Followup-To"</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">"Newsgroups"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"From"</span><span class="p">)</span> <span class="no">nil</span> <span class="p">(</span><span class="s">"Newsgroups"</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">"Mail-Followup-To"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"Mail-Followup-To"</span><span class="p">)</span> <span class="no">nil</span> <span class="p">(</span><span class="s">"Newsgroups"</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="p">((</span><span class="s">"From"</span><span class="p">)</span> <span class="p">(</span><span class="s">"To"</span> <span class="s">"Cc"</span><span class="p">)</span> <span class="p">(</span><span class="s">"Newsgroups"</span><span class="p">)))))</span></code></pre></figure>
<p>
サマリ表示には petname を使うが, 引用には使わない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-default-draft-cite-decorate-author</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
<div>
<h5 id="orgc8e9533f">ドラフトの自動保存の無効化</h5>
<div class="outline-text-5" id="text-orgc8e9533f">
<p>
偶に暴発している様な…? elscreen のせいかしら.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-auto-save-drafts-interval</span> <span class="mi">300</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgccd69748">メール本文の文字コード</h5>
<div class="outline-text-5" id="text-orgccd69748">
<p>
丸囲み数字なんかが入ってしまうと
勝手にエンコーディングが変わってしまって鬱陶しい. どうしたモンだろうかね.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'wl-draft-mode-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mime-charset-type-list</span> <span class="o">'</span><span class="p">(</span><span class="nv">utf-8</span> <span class="mi">8</span> <span class="no">nil</span><span class="p">))))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org62a575b3">draft mode で orgtbl を有効に</h5>
<div class="outline-text-5" id="text-org62a575b3">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'wl-draft-mode-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="k">progn</span>
              <span class="p">(</span><span class="nb">require</span> <span class="ss">'org-table</span><span class="p">)</span>
              <span class="nf">#'</span><span class="nv">turn-on-orgtbl</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgc1db3638">c-sig</h5>
<div class="outline-text-5" id="text-orgc1db3638">
<p>
署名の選択に c-sig を使用している.
設定は以下の通り. Mew 風に <code>C-c &lt;tab&gt;</code> で signature を挿入するようにしている
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">c-sig</span>
  <span class="ss">:commands</span> <span class="nv">insert-signature-eref</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'wl</span><span class="p">))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">sig-insert-end</span> <span class="no">t</span>
        <span class="nv">sig-save-to-sig-name-alist</span> <span class="no">nil</span>
        <span class="nv">message-signature-file</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">"\C-c\t"</span> <span class="ss">'insert-signature-eref</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'wl-draft-mode-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nv">define-key</span> <span class="p">(</span><span class="nv">current-local-map</span><span class="p">)</span> <span class="s">"\C-c\C-w"</span>
              <span class="ss">'insert-signature-eref</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="orgda22b5d8">GPG 署名</h4>
<div class="outline-text-4" id="text-orgda22b5d8">
<p>
以前は mailcrypt を使っていたけれど,
epa があるので主にキーバインドの設定のみ.
<code>draft-mode</code> の文字コードをあらかじめ指定しておかないと,
送信時に文字コードが変換されるので不正な署名となってしまう.
</p>

<p>
もっとうまい方法/正攻法がありそうな気がするけれど,
使えてるから, まあ良いかな, とか.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-pgp-verify-when-preview</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:epa-wl-decrypt-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">save-window-excursion</span>
    <span class="p">(</span><span class="nv">wl-summary-jump-to-current-message</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">wl-message-decrypt-pgp-nonmime</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:epa-wl-verify-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">save-selected-window</span>
    <span class="p">(</span><span class="nv">wl-summary-jump-to-current-message</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">wl-message-verify-pgp-nonmime</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">leaf-keys</span> <span class="p">((</span><span class="ss">:wl-summary-mode-map</span>
             <span class="p">(</span><span class="s">"C-c : d"</span> <span class="o">.</span> <span class="nv">my:epa-wl-decrypt-message</span><span class="p">)</span>
             <span class="p">(</span><span class="s">"C-c : v"</span> <span class="o">.</span> <span class="nv">my:epa-wl-verify-message</span><span class="p">))</span>
            <span class="p">(</span><span class="ss">:wl-draft-mode-map</span>
             <span class="p">(</span><span class="s">"C-c : s"</span> <span class="o">.</span> <span class="nv">epa-mail-sign</span><span class="p">)</span>
             <span class="p">(</span><span class="s">"C-c : e"</span> <span class="o">.</span> <span class="nv">epa-mail-encrypt</span><span class="p">)))</span>
           <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org5d7309d7">検索</h4>
<div class="outline-text-4" id="text-org5d7309d7">
<p>
notmuchを使う.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">elmo-search</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">elmo-search-register-engine</span> <span class="ss">'notmuch-custom</span> <span class="ss">'local-file</span>
                               <span class="ss">:prog</span> <span class="s">"notmuch-query-custom"</span>
                               <span class="ss">:args</span> <span class="o">'</span><span class="p">(</span><span class="nv">elmo-search-split-pattern-list</span><span class="p">)</span>
                               <span class="ss">:charset</span> <span class="ss">'utf-8</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-search-default-engine</span> <span class="ss">'notmuch-custom</span><span class="p">))</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">wl-qs</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">wl-quicksearch-folder</span> <span class="s">"[]"</span>
        <span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf-keys</span> <span class="p">((</span><span class="ss">:wl-summary-mode-map</span>
             <span class="p">(</span><span class="s">"v"</span> <span class="o">.</span> <span class="nv">wl-quicksearch-goto-search-folder-wrapper</span><span class="p">))</span>
            <span class="p">(</span><span class="ss">:wl-folder-mode-map</span>
             <span class="p">(</span><span class="s">"v"</span> <span class="o">.</span> <span class="nv">wl-quicksearch-goto-search-folder-wrapper</span><span class="p">)))</span>
           <span class="p">)</span></code></pre></figure>
<p>
実際の呼び出しはスレッドを全部取得したいので以下を呼び出している
</p>
<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> x<span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span> <span class="o">=</span> x<span class="s2">""</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nv">res</span><span class="o">=</span><span class="si">$(</span>notmuch search <span class="nt">--output</span><span class="o">=</span>threads <span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span><span class="si">)</span>
<span class="k">fi
if</span> <span class="o">[</span> <span class="o">!</span> x<span class="s2">"</span><span class="nv">$res</span><span class="s2">"</span> <span class="o">=</span> x<span class="s2">""</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="nv">$res</span> | xargs notmuch search <span class="nt">--sort</span><span class="o">=</span>oldest-first <span class="nt">--output</span><span class="o">=</span>files
<span class="k">fi</span></code></pre></figure>
<p>
検索時にメールが多すぎると怒られるので. 数字は適当.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-multi-divide-number</span> <span class="mi">2000000</span>
      <span class="nv">elmo-multi-number</span> <span class="mi">2000000</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h3 id="orgcfa9b17b">Linux Desktop で <code>mailto:</code> リンクを扱うために</h3>
<div class="outline-text-3" id="text-orgcfa9b17b">
<p>
ついでに <code>mailto</code> のリンクを emacsclient で扱うために,
以下の関数を定義しておく
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my:mailto-compose-mail</span> <span class="p">(</span><span class="nv">mailto-url</span><span class="p">)</span>
  <span class="s">"Custom: handling mailto: link"</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">mailto-url</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">string-match</span> <span class="s">"\\`mailto:"</span> <span class="nv">mailto-url</span><span class="p">))</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nv">eval-and-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'rfc2368</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">headers</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">h</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">intern</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">h</span><span class="p">))</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">h</span><span class="p">)))</span>
                                <span class="p">(</span><span class="nv">rfc2368-parse-mailto-url</span> <span class="nv">mailto-url</span><span class="p">)))</span>
               <span class="p">(</span><span class="nv">good-headers</span> <span class="p">(</span><span class="nv">cl-remove-if</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">h</span><span class="p">)</span> <span class="p">(</span><span class="nb">member</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">h</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nv">Body</span><span class="p">)))</span> <span class="nv">headers</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">body</span> <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">assoc</span> <span class="ss">'Body</span> <span class="nv">headers</span><span class="p">))))</span>
          <span class="p">(</span><span class="nv">wl-draft</span> <span class="nv">good-headers</span> <span class="no">nil</span> <span class="no">nil</span> <span class="nv">body</span><span class="p">)))))</span></code></pre></figure>
<p>
Desktop の設定では
</p>
<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>
<span class="c"># emacs-mailto-handler</span>

<span class="nv">mailto</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">mailto</span><span class="o">=</span><span class="s2">"mailto:</span><span class="k">${</span><span class="nv">mailto</span><span class="p">#mailto</span>:<span class="k">}</span><span class="s2">"</span>
<span class="nv">mailto</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$mailto</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'s/[\"]/\\&amp;/g'</span><span class="si">)</span>
<span class="nv">elisp_expr</span><span class="o">=</span><span class="s2">"(my:mailto-compose-mail </span><span class="se">\"</span><span class="nv">$mailto</span><span class="se">\"</span><span class="s2">)"</span>

emacsclient <span class="nt">-a</span> <span class="s2">""</span> <span class="nt">-n</span> <span class="nt">--eval</span> <span class="s2">"</span><span class="nv">$elisp_expr</span><span class="s2">"</span> <span class="se">\</span>
            <span class="s1">'(set-window-dedicated-p (selected-window) t)'</span></code></pre></figure>
<p>
をメーラとして指定すれば良い．
GNOME は <code>.desktop</code> ファイルが無いと「お気に入り」登録ができないので
以下のファイルを適当な名前で <code>~/.local/share/applications/</code> 以下に放り込んでおくと良いだろう
</p>
<figure class="highlight"><pre><code class="language-conf" data-lang="conf">[<span class="n">Desktop</span> <span class="n">Entry</span>]
<span class="n">Name</span>=<span class="n">Emacs</span> <span class="n">Mail</span> <span class="n">Handler</span>
<span class="n">GenericName</span>=<span class="n">Mail</span> <span class="n">User</span> <span class="n">Agent</span>
<span class="n">X</span>-<span class="n">GNOME</span>-<span class="n">FullName</span>=<span class="n">Emacs</span> <span class="n">Mail</span> <span class="n">Handler</span>
<span class="n">Comment</span>=<span class="n">Use</span> <span class="n">emacsclient</span> <span class="n">as</span> <span class="n">MUA</span>, <span class="n">handling</span> <span class="n">mailto</span> <span class="n">link</span>
<span class="n">Keywords</span>=<span class="n">email</span>
<span class="n">Exec</span>=/<span class="n">home</span>/<span class="n">uwabami</span>/<span class="n">bin</span>/<span class="n">emacs</span>-<span class="n">mailto</span>-<span class="n">handler</span> %<span class="n">U</span>
<span class="n">Icon</span>=<span class="n">emacs25</span>
<span class="n">Terminal</span>=<span class="n">false</span>
<span class="n">Type</span>=<span class="n">Application</span>
<span class="n">Categories</span>=<span class="n">GNOME</span>;<span class="n">GTK</span>;<span class="n">Office</span>;<span class="n">Email</span>;
<span class="n">StartupNotify</span>=<span class="n">false</span>
<span class="n">MimeType</span>=<span class="n">application</span>/<span class="n">mbox</span>;<span class="n">message</span>/<span class="n">rfc822</span>;<span class="n">x</span>-<span class="n">scheme</span>-<span class="n">handler</span>/<span class="n">mailto</span>;</code></pre></figure>
</div>
</div>
<div>
<h3 id="org215a97b9">メールからの予定の取り込み: <code>mhc</code>
</h3>
<div class="outline-text-3" id="text-org215a97b9">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">mhc</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)</span> <span class="s">"/.config/mhc"</span><span class="p">))</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">mhc-import</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">mhc-calendar-day-strings</span> <span class="nv">[</span><span class="s">"日"</span> <span class="s">"月"</span> <span class="s">"火"</span> <span class="s">"水"</span> <span class="s">"木"</span> <span class="s">"金"</span> <span class="s">"土"</span><span class="nv">]</span>
        <span class="nv">mhc-calendar-header-function</span> <span class="ss">'mhc-calendar-make-header-ja</span>
        <span class="nv">mhc-calendar-language</span> <span class="ss">'japanese</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="orgc0b8a536">閉じタグの入力補助: <code>smartparens</code>
</h2>
<div class="outline-text-2" id="text-orgc0b8a536">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">smartparens</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="no">t</span>
  <span class="ss">:defun</span> <span class="p">(</span><span class="nv">sp-pair</span><span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">smartparens-global-mode</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'smartparens-config</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">sp-pair</span> <span class="s">"="</span> <span class="s">"="</span> <span class="ss">:actions</span> <span class="o">'</span><span class="p">(</span><span class="nv">wrap</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">sp-pair</span> <span class="s">"+"</span> <span class="s">"+"</span> <span class="ss">:actions</span> <span class="o">'</span><span class="p">(</span><span class="nv">wrap</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">sp-pair</span> <span class="s">"&lt;"</span> <span class="s">"&gt;"</span> <span class="ss">:actions</span> <span class="o">'</span><span class="p">(</span><span class="nv">wrap</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">sp-pair</span> <span class="s">"$"</span> <span class="s">"$"</span> <span class="ss">:actions</span> <span class="o">'</span><span class="p">(</span><span class="nv">wrap</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org1f0e431b">カラーコードに色付け: <code>rainbow-mode</code>
</h2>
<div class="outline-text-2" id="text-org1f0e431b">
<p>
<code>#RRGGBB</code> のカラーコードに勝手に色が付く．CSS の編集中なんかで地味に便利．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">rainbow-mode</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="o">`</span><span class="p">((</span><span class="nv">rainbow-mode</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nb">format</span> <span class="s">" %s"</span> <span class="s">"\x1F308"</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgdddd3388">対応する括弧を見易く: <code>rainbow-delimiters</code>
</h2>
<div class="outline-text-2" id="text-orgdddd3388">
<p>
対応する括弧を強調表示してくれる
<a href="https://www.emacswiki.org/emacs/RainbowDelimiters">RainbowDelimiters</a>:
global に有効にするのは他の
Major modeとの衝突があるので止めた方が良い, らしい．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">rainbow-delimiters</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="no">t</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">prog-mode-hook</span> <span class="o">.</span> <span class="nv">rainbow-delimiters-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org7b7eccc9">Org-mode</h2>
<div class="outline-text-2" id="text-org7b7eccc9">
<p>
<code>org-mode</code> が無いと生きていけない体になりました
</p>
</div>
<div>
<h3 id="orgb143e870">基本設定: <code>org</code>
</h3>
<div class="outline-text-3" id="text-orgb143e870">
<p>
目新しい設定はしていない, と思う．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; org-plus-contrib</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">org</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="o">`</span><span class="p">((</span><span class="nv">org-mode</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">all-the-icons-icon-for-mode</span> <span class="ss">'org-mode</span><span class="p">)))</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x n s"</span> <span class="o">.</span> <span class="nv">org-narrow-to-subtree</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x n w"</span> <span class="o">.</span> <span class="nv">widen</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c a"</span>   <span class="o">.</span> <span class="nv">org-agenda</span><span class="p">)</span>
         <span class="c1">;; ("C-x m"   . org-capture)</span>
         <span class="c1">;; ("C-x M"   . org-journal-new-entry)</span>
         <span class="p">)</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:before</span> <span class="nv">org-calendar-holiday</span>
           <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'japanese-holidays</span><span class="p">)))</span>
  <span class="ss">:mode</span>
  <span class="c1">;; 昔のメモ(howm)も org-mode で開く</span>
  <span class="p">((</span><span class="s">"\\.org\\'"</span> <span class="s">"\\.howm\\'"</span><span class="o">.</span> <span class="nv">org-mode</span><span class="p">))</span>
  <span class="ss">:preface</span>
  <span class="c1">;;; timestamp 更新文字列の変更:</span>
  <span class="c1">;;  org-mode では ＃+DATE: をひっかける用に(＃は小文字)．</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-timestamp-hook</span> <span class="p">()</span>
    <span class="s">"Change `time-stamp-start' in org-mode"</span>
    <span class="p">(</span><span class="nb">set</span> <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'time-stamp-start</span><span class="p">)</span> <span class="s">"#\\+date: "</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">set</span> <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'time-stamp-end</span><span class="p">)</span>   <span class="s">"\$"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="c1">;; GTD: TODO→...→DONE としたエントリを =Arhive.org= に移動</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-archive-done-tasks</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-map-entries</span> <span class="ss">'org-archive-subtree</span> <span class="s">"/DONE"</span> <span class="ss">'file</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-mode-hook</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
          <span class="p">(</span><span class="nv">my:org-timestamp-hook</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-tempo</span> <span class="ss">:require</span> <span class="no">t</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">org-todo-statistics-hook</span>       <span class="o">.</span> <span class="nv">my:org-archive-done-tasks</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-todo-after-statistics-hook</span> <span class="o">.</span> <span class="nv">my:org-archive-done-tasks</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">(</span><span class="c1">;; Nextcloud に保存する</span>
    <span class="p">(</span><span class="nv">org-directory</span>              <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">my:d:org</span><span class="p">))</span>
    <span class="c1">;; return でリンクを辿る</span>
    <span class="p">(</span><span class="nv">org-return-follows-link</span>    <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="c1">;; 見出しを畳んで表示</span>
    <span class="p">(</span><span class="nv">org-startup-folded</span>         <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="c1">;; 折り返し無し</span>
    <span class="p">(</span><span class="nv">org-startup-truncated</span>      <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="c1">;; link handler → xdg-open 任せ</span>
    <span class="p">(</span><span class="nv">org-file-apps-defaults</span>     <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nv">remote</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>
                                    <span class="p">(</span><span class="nv">system</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)</span>
                                    <span class="p">(</span><span class="no">t</span>      <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">org-file-apps-defaults-gnu</span> <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nv">remote</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>
                                    <span class="p">(</span><span class="nv">system</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)</span>
                                    <span class="p">(</span><span class="no">t</span>      <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">org-file-apps</span>              <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nv">auto-mode</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"\\.mm\\'"</span> <span class="o">.</span> <span class="nv">default</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"\\.x?html?\\'"</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"\\.pdf\\'"</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)))</span>
    <span class="c1">;; GTD: 状態の追加</span>
    <span class="p">(</span><span class="nv">org-todo-keywords</span>          <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nc">sequence</span> <span class="s">"TODO(t)"</span> <span class="s">"WAIT(w)"</span> <span class="s">"SOMEDAY(s)"</span> <span class="s">"|"</span> <span class="s">"DONE(d)"</span> <span class="s">"CANCEL(c)"</span><span class="p">)</span>
                                    <span class="p">(</span><span class="k">type</span> <span class="s">"ARTICLE(a)"</span> <span class="s">"|"</span> <span class="s">"DONE(d)"</span><span class="p">)</span>
                                    <span class="p">(</span><span class="k">type</span> <span class="s">"MEMO(m)"</span> <span class="s">"|"</span> <span class="s">"DONE(d)"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">org-todo-keyword-faces</span>     <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="s">"TODO"</span>    <span class="o">.</span> <span class="nv">org-todo</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"WAIT"</span>    <span class="o">.</span> <span class="nv">org-todo</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"ARTICLE"</span> <span class="o">.</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7fbfff"</span> <span class="ss">:weight</span> <span class="nv">bold</span><span class="p">))</span>
                                    <span class="p">(</span><span class="s">"MEMO"</span>    <span class="o">.</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7fbfff"</span> <span class="ss">:weight</span> <span class="nv">bold</span><span class="p">))</span>
                                    <span class="p">(</span><span class="s">"SOMEDAY"</span> <span class="o">.</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7fff7f"</span> <span class="ss">:weight</span> <span class="nv">bold</span><span class="p">))))</span>
    <span class="c1">;; GTD: タグの追加</span>
    <span class="p">(</span><span class="nv">org-tag-alist</span>              <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="s">"OFFICE"</span>     <span class="o">.</span> <span class="nv">?o</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"HOME"</span>       <span class="o">.</span> <span class="nv">?h</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"MAIL"</span>       <span class="o">.</span> <span class="nv">?m</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"WORK"</span>       <span class="o">.</span> <span class="nv">?w</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"Debian"</span>     <span class="o">.</span> <span class="nv">?d</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"Computer"</span>   <span class="o">.</span> <span class="nv">?c</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"Book"</span>       <span class="o">.</span> <span class="nv">?b</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"Emacs"</span>      <span class="o">.</span> <span class="nv">?e</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"TeX"</span>        <span class="o">.</span> <span class="nv">?t</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"Ruby"</span>       <span class="o">.</span> <span class="nv">?r</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"IGNORE"</span>     <span class="o">.</span> <span class="nv">?i</span><span class="p">)</span>
                                    <span class="p">(</span><span class="s">"PLANNED"</span>    <span class="o">.</span> <span class="nv">?p</span><span class="p">)</span>
                                    <span class="p">))</span>
    <span class="c1">;; DONE → Archive.org に移動</span>
    <span class="p">(</span><span class="nv">org-archive-location</span>       <span class="o">.</span> <span class="s">"Archive.org::"</span><span class="p">)</span>
    <span class="c1">;; modules → とりあえずクリアしておく</span>
    <span class="p">(</span><span class="nv">org-modules</span>  <span class="o">.</span> <span class="o">'</span><span class="p">())</span>
    <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="c1">;; +打ち消し+ の font-lock の変更 →これはテーマに任せるべき?</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-emphasis-alist</span>
        <span class="p">(</span><span class="nb">cons</span> <span class="o">'</span><span class="p">(</span><span class="s">"+"</span> <span class="o">'</span><span class="p">(</span><span class="ss">:strike-through</span> <span class="no">t</span> <span class="ss">:foreground</span> <span class="s">"#999999"</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">cl-delete</span> <span class="s">"+"</span> <span class="nv">org-emphasis-alist</span> <span class="ss">:key</span> <span class="ss">'car</span> <span class="ss">:test</span> <span class="ss">'equal</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org67465ee0">Org-Id</h3>
<div class="outline-text-3" id="text-org67465ee0">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-id</span>
  <span class="ss">:commands</span>
  <span class="p">(</span><span class="nv">my:add-custom-id</span>
   <span class="nv">my:get-custom-id</span>
   <span class="nv">my:org-custom-id-get</span>
   <span class="nv">my:delete-all-id-in-file</span>
   <span class="nv">my:org-id-add-to-headlines-in-file</span>
   <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-macs</span> <span class="ss">:require</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-id-locations-file</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-id-locations"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-id-link-to-org-use-id</span> <span class="o">.</span> <span class="ss">'create-if-interactive-and-no-custom-id</span><span class="p">)</span>
    <span class="c1">;; (org-id-link-to-org-use-id . create-if-interactive-and-no-custom-id)</span>
    <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:add-custom-id</span> <span class="p">()</span>
    <span class="s">"Add \"CUSTOM_ID\" to the current tree if not assigned yet."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">my:org-custom-id-get</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:get-custom-id</span> <span class="p">()</span>
    <span class="s">"Return a part of UUID with an \"org\" prefix.
e.g. \"org3ca6ef0c\"."</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">id</span> <span class="p">(</span><span class="nv">org-id-new</span> <span class="s">""</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-uuidgen-p</span> <span class="nv">id</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">downcase</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"org"</span>  <span class="p">(</span><span class="nv">substring</span> <span class="p">(</span><span class="nv">org-id-new</span> <span class="s">""</span><span class="p">)</span> <span class="mi">0</span> <span class="mi">8</span><span class="p">))))))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-custom-id-get</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">pom</span> <span class="nv">create</span><span class="p">)</span>
    <span class="s">"Get the CUSTOM_ID property of the entry at point-or-marker POM.
See https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="nv">pom</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">id</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="no">nil</span> <span class="s">"CUSTOM_ID"</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">cond</span>
         <span class="p">((</span><span class="nb">and</span> <span class="nv">id</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">id</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">"\\S-"</span> <span class="nv">id</span><span class="p">))</span>
          <span class="nv">id</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">create</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">id</span> <span class="p">(</span><span class="nv">my:get-custom-id</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">unless</span> <span class="nv">id</span>
            <span class="p">(</span><span class="nb">error</span> <span class="s">"Invalid ID"</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">org-entry-put</span> <span class="nv">pom</span> <span class="s">"CUSTOM_ID"</span> <span class="nv">id</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">message</span> <span class="s">"--- CUSTOM_ID assigned: %s"</span> <span class="nv">id</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">org-id-add-location</span> <span class="nv">id</span> <span class="p">(</span><span class="nv">buffer-file-name</span> <span class="p">(</span><span class="nv">buffer-base-buffer</span><span class="p">)))</span>
          <span class="nv">id</span><span class="p">)))))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:delete-all-id-in-file</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">goto-char</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">org-next-visible-heading</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">id</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="s">"ID"</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="nv">id</span>
          <span class="p">(</span><span class="nv">message</span> <span class="s">"ID: %s"</span> <span class="nv">id</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">org-delete-property</span> <span class="s">"ID"</span><span class="p">))))</span>
    <span class="p">(</span><span class="nv">message</span> <span class="s">"--- done."</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-id-add-to-headlines-in-file</span> <span class="p">()</span>
    <span class="s">"Add CUSTOM_ID properties to all headlines in the current file.
See https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">save-excursion</span>
      <span class="p">(</span><span class="nv">widen</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"^#\\+options:.*auto-id:t"</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org-map-entries</span>
         <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">my:org-custom-id-get</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="ss">'create</span><span class="p">))))))</span>
  <span class="c1">;;</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">before-save-hook</span>
         <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
             <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">major-mode</span> <span class="ss">'org-mode</span><span class="p">)</span>
                        <span class="p">(</span><span class="nb">eq</span> <span class="nv">buffer-read-only</span> <span class="no">nil</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">my:org-id-add-to-headlines-in-file</span><span class="p">))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org99399f3b">Babel</h3>
<div class="outline-text-3" id="text-org99399f3b">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-babel</span>
  <span class="ss">:after</span> <span class="nv">all-the-icons-in-terminal</span>
  <span class="ss">:blackout</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-src-mode</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nb">format</span> <span class="s">" %s"</span> <span class="p">(</span><span class="nv">all-the-icons-octicon</span> <span class="s">"code"</span><span class="p">))))</span>
  <span class="ss">:custom</span>
  <span class="p">(</span><span class="c1">;; font-lock</span>
   <span class="p">(</span><span class="nv">org-src-fontify-natively</span>         <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="c1">;; TAB の挙動</span>
   <span class="p">(</span><span class="nv">org-src-tab-acts-natively</span>        <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="c1">;; インデント</span>
   <span class="p">(</span><span class="nv">org-edit-src-content-indentation</span> <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
   <span class="c1">;; インデントを残す</span>
   <span class="p">(</span><span class="nv">org-src-preserve-indentation</span>     <span class="o">.</span> <span class="no">t</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgbe835a6b">Org-capture: メモ取り</h3>
<div class="outline-text-3" id="text-orgbe835a6b">
<p>
キーバインドは以前 changelog memo をやっていた時の癖で <code>C-x m</code> をメモにしている.
→ capture は org-roam に丸投げすることにした.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-capture</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="ss">:commands</span> <span class="nv">org-capture</span>
  <span class="c1">;; :pl-setq</span>
  <span class="c1">;; (my:org:calendar1 my:org:calendar2)   ;; 名前がイケてないっ!</span>
  <span class="ss">:init</span> <span class="p">(</span><span class="nv">leaf</span> <span class="nv">doct</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; capture template を上手く書く拡張</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-default-notes-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"INBOX.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-capture-templates</span>
        <span class="p">(</span><span class="nv">doct</span> <span class="o">'</span><span class="p">(</span><span class="c1">;;</span>
                <span class="p">(</span><span class="s">"Org-roam Memo"</span>
                 <span class="ss">:keys</span> <span class="s">"m"</span>
                 <span class="ss">:type</span> <span class="nv">plain</span>
                 <span class="ss">:template</span> <span class="s">"* MEMO &lt;%&lt;%Y-%m-%d %H:%M&gt;&gt; %^{title}\n  %?"</span>
                 <span class="ss">:target</span>
                 <span class="ss">:prepend</span> <span class="no">nil</span>
                 <span class="ss">:unnarrowed</span> <span class="no">nil</span>
                 <span class="ss">:kill-buffer</span> <span class="no">t</span>
                 <span class="c1">;; :function org-roam-dailies-capture-today</span>
                 <span class="p">)</span>
                <span class="p">(</span><span class="s">"Schedule: 個人スケジュール"</span>
                 <span class="ss">:keys</span> <span class="s">"s"</span>
                 <span class="ss">:type</span> <span class="nv">plain</span>
                 <span class="ss">:file</span> <span class="p">(</span><span class="k">lambda</span><span class="p">()</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Schedule.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
                 <span class="ss">:template</span> <span class="s">"* %^{prompt}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar1)\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
                 <span class="ss">:prepend</span> <span class="no">nil</span>
                 <span class="ss">:unnarrowed</span> <span class="no">nil</span>
                 <span class="ss">:kill-buffer</span> <span class="no">t</span>
                 <span class="p">)</span>
                <span class="p">(</span><span class="s">"Univ. Schedule: 大学関連"</span>
                 <span class="ss">:keys</span> <span class="s">"u"</span>
                 <span class="ss">:type</span> <span class="nv">plain</span>
                 <span class="ss">:file</span> <span class="p">(</span><span class="k">lambda</span><span class="p">()</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Univ.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
                 <span class="ss">:template</span> <span class="s">"* %^{prompt}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar2)\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
                 <span class="ss">:prepend</span> <span class="no">nil</span>
                 <span class="ss">:unnarrowed</span> <span class="no">nil</span>
                 <span class="ss">:kill-buffer</span> <span class="no">t</span>
                 <span class="p">)</span>
                <span class="p">))</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgbbaf7c91">Org-roam: リンク付きメモ</h3>
<div class="outline-text-3" id="text-orgbbaf7c91">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-roam</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"rg"</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"sqlite3"</span><span class="p">)))</span>
  <span class="ss">:pl-setq</span>
  <span class="p">(</span><span class="nv">my:org:calendar1</span> <span class="nv">my:org:calendar2</span><span class="p">)</span>   <span class="c1">;; 名前がイケてないっ!</span>
  <span class="ss">:bind</span>
  <span class="p">((</span><span class="s">"C-c n a"</span> <span class="o">.</span> <span class="nv">org-roam-alias-add</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-c n f"</span> <span class="o">.</span> <span class="nv">org-roam-node-find</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-c n i"</span> <span class="o">.</span> <span class="nv">org-roam-node-insert</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-c n o"</span> <span class="o">.</span> <span class="nv">org-id-get-create</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-c n t"</span> <span class="o">.</span> <span class="nv">org-roam-tag-add</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-c n l"</span> <span class="o">.</span> <span class="nv">org-roam-buffer-toggle</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-x m"</span>   <span class="o">.</span> <span class="nv">org-roam-dailies-capture-today</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">org-roam-v2-ack</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">(</span><span class="c1">;; (org-roam-v2-ack      . t)</span>
    <span class="p">(</span><span class="nv">org-roam-db-location</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-roam.db"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-roam-directory</span>   <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"roam"</span> <span class="nv">my:d:org</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-roam-mode-section-functions</span>
     <span class="o">.</span> <span class="p">(</span><span class="nb">list</span> <span class="nf">#'</span><span class="nv">org-roam-backlinks-section</span>
             <span class="nf">#'</span><span class="nv">org-roam-reflinks-section</span>
            <span class="c1">;; #'org-roam-unlinked-references-section</span>
            <span class="p">))</span>
    <span class="c1">;; (org-roam-db-update-on-save . t)</span>
    <span class="p">(</span><span class="nv">org-roam-dailies-directory</span> <span class="o">.</span> <span class="s">""</span><span class="p">)</span> <span class="c1">;; relative path→flatten!</span>
    <span class="p">(</span><span class="nv">org-roam-dailies-capture-templates</span>
     <span class="o">.</span> <span class="o">'</span><span class="p">(</span>
         <span class="p">(</span><span class="s">"m"</span> <span class="s">"memo"</span> <span class="nv">entry</span> <span class="s">"* MEMO &lt;%&lt;%Y-%m-%d %H:%M&gt;&gt; %^{title}\n  %?"</span>
          <span class="ss">:target</span> <span class="p">(</span><span class="nv">file+head</span> <span class="s">"%&lt;%Y-%m-%d&gt;.org"</span>
                             <span class="s">"#+title: %&lt;%Y年%m月%d日(%a)&gt;"</span><span class="p">)</span>
          <span class="ss">:prepend</span> <span class="no">nil</span>
          <span class="ss">:kill-buffer</span> <span class="no">t</span>
          <span class="p">)</span>
         <span class="p">(</span><span class="s">"t"</span> <span class="s">"ToDo"</span> <span class="nv">entry</span> <span class="s">"* ToDo &lt;%&lt;%Y-%m-%d %H:%M&gt;&gt; %^{title}\n  %?"</span>
          <span class="ss">:target</span> <span class="p">(</span><span class="nv">file+head</span> <span class="s">"%&lt;%Y-%m-%d&gt;.org"</span>
                             <span class="s">"#+title: %&lt;%Y年%m月%d日(%a)&gt;"</span><span class="p">)</span>
          <span class="ss">:prepend</span> <span class="no">nil</span>
          <span class="ss">:kill-buffer</span> <span class="no">t</span>
          <span class="p">)</span>
         <span class="p">(</span><span class="s">"s"</span> <span class="s">"Schedule: 個人スケジュール"</span> <span class="nv">entry</span>
          <span class="s">"* %^{title}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar1)\n  :org-gcal-managed: org\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
          <span class="ss">:target</span> <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Schedule.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
          <span class="ss">:prepend</span> <span class="no">t</span>   <span class="c1">;; prepend nil としたいが, 末尾まで行ってくれないので諦める.</span>
          <span class="ss">:kill-buffer</span> <span class="no">t</span>
          <span class="p">)</span>
         <span class="p">(</span><span class="s">"u"</span> <span class="s">"Univ: 大学関連 スケジュール"</span> <span class="nv">entry</span>
          <span class="s">"* %^{title}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar2)\n  :org-gcal-managed: org\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
          <span class="ss">:target</span> <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Univ.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
          <span class="ss">:prepend</span> <span class="no">t</span>   <span class="c1">;; prepend nil としたいが, 末尾まで行ってくれないので諦める.</span>
          <span class="ss">:kill-buffer</span> <span class="no">t</span>
          <span class="p">)</span>
         <span class="p">))</span>
     <span class="p">)</span>
  <span class="ss">:defer-config</span>
  <span class="p">(</span><span class="nv">org-roam-db-autosync-enable</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org016dbf67">Org-agenda: スケジュール, TODO 表示</h3>
<div class="outline-text-3" id="text-org016dbf67">
<p>
GTD 用の設定．後述の <code>org-gcal</code> と <code>orgmine</code> で取得したデータも表示している．
ついでに
</p>
<ul class="org-ul">
<li>土曜日をの face を追加.</li>
<li>祝日, 休日を日曜と同じfaceにする.</li>
</ul>
<p>
なんて事もやっている．元ネタは <a href="https://julien.danjou.info/blog/2010/org-mode-and-holidays">Org-mode and holidays</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-agenda</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="ss">:defer-config</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-date-saturday</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7FBFFF"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="p">)))</span>
    <span class="s">"Agenda 表示中の土曜日用のface"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-date-today-saturday</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:inherit</span> <span class="nv">my:org-agenda-date-saturday</span> <span class="ss">:underline</span> <span class="no">t</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中の今日かつ土曜日用のface"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-date-today-weekend</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:inherit</span> <span class="nv">org-agenda-date-weekend</span> <span class="ss">:underline</span> <span class="no">t</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中の今日かつ日・祝日用のface"</span><span class="p">)</span>
  <span class="c1">;; こっからは org-gcal で同期したカレンダーの色</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-Univ</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7FFF7F"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, Univ.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-Schedule</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7FFFFF"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, Schedule.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-GFD</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#FFFF7F"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, GFD.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-DebianJP</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#BF7FFF"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, DebianJP.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-twitter</span>
    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#CCCCCC"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, Twitter log の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="c1">;; 更新用の関数 - とりあえず動いているので良しとするが,</span>
  <span class="c1">;; リファクタリングしたい</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-agenda-day-face-function</span> <span class="p">(</span><span class="nv">date</span><span class="p">)</span>
    <span class="s">"Compute DATE face for saturday, holidays."</span>
    <span class="p">(</span><span class="nv">cl-dolist</span> <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nv">org-agenda-files</span> <span class="no">nil</span> <span class="ss">'ifmode</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">cond</span>
       <span class="p">((</span><span class="nb">member</span> <span class="p">(</span><span class="nv">calendar-day-of-week</span> <span class="nv">date</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">org-agenda-todayp</span> <span class="nv">date</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">cl-return</span> <span class="ss">'my:org-agenda-date-today-weekend</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">cl-return</span> <span class="ss">'org-agenda-date-weekend</span><span class="p">))</span>
       <span class="p">((</span><span class="nb">member</span> <span class="p">(</span><span class="nv">calendar-day-of-week</span> <span class="nv">date</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">org-agenda-todayp</span> <span class="nv">date</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">cl-return</span> <span class="ss">'my:org-agenda-date-today-saturday</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">cl-return</span> <span class="ss">'my:org-agenda-date-saturday</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">face</span>
             <span class="p">(</span><span class="nv">cl-dolist</span> <span class="p">(</span><span class="nv">entry</span> <span class="p">(</span><span class="nv">org-agenda-get-day-entries</span> <span class="nv">file</span> <span class="nv">date</span><span class="p">))</span>
               <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">category</span> <span class="p">(</span><span class="nv">with-temp-buffer</span>
                                 <span class="p">(</span><span class="nv">insert</span> <span class="nv">entry</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">org-get-category</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">)))))</span>
                 <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">string=</span> <span class="s">"祝日"</span> <span class="nv">category</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">string=</span> <span class="s">"休日"</span> <span class="nv">category</span><span class="p">))</span>
                   <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">org-agenda-todayp</span> <span class="nv">date</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">cl-return</span> <span class="ss">'my:org-agenda-date-today-weekend</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">cl-return</span> <span class="ss">'org-agenda-date-weekend</span><span class="p">)))))))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="nv">face</span> <span class="p">(</span><span class="nv">cl-return</span> <span class="nv">face</span><span class="p">)))))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-agenda-day-face-function</span>
        <span class="ss">'my:org-agenda-day-face-function</span><span class="p">)</span>
  <span class="c1">;; font-lock の適用. loop減らせないかなぁ….</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-agenda-finalize-font-lock</span> <span class="p">()</span>
    <span class="s">"Custom: apply custom font-lock"</span>
    <span class="p">(</span><span class="nv">save-excursion</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"Univ:"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-text-properties</span> <span class="p">(</span><span class="nv">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-at-eol</span><span class="p">)</span>
                             <span class="o">'</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-Univ</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"Schedule:"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-text-properties</span> <span class="p">(</span><span class="nv">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-at-eol</span><span class="p">)</span>
                             <span class="o">'</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-Schedule</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"DebianJP:"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-text-properties</span> <span class="p">(</span><span class="nv">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-at-eol</span><span class="p">)</span>
                             <span class="o">'</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-DebianJP</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"GFD:"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-text-properties</span> <span class="p">(</span><span class="nv">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-at-eol</span><span class="p">)</span>
                             <span class="o">'</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-GFD</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"twitter:"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-text-properties</span> <span class="p">(</span><span class="nv">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-at-eol</span><span class="p">)</span>
                             <span class="o">'</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-twitter</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"祝日:\\|休日:\\|誕生日:"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-text-properties</span> <span class="p">(</span><span class="nv">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-at-eol</span><span class="p">)</span>
                             <span class="o">'</span><span class="p">(</span><span class="nv">face</span> <span class="nv">org-agenda-date-weekend</span><span class="p">)))</span>
      <span class="p">))</span>
  <span class="c1">;;</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'org-agenda-finalize-hook</span>
            <span class="nf">#'</span><span class="nv">my:org-agenda-finalize-font-lock</span><span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-agenda-span</span> <span class="ss">'day</span>
        <span class="nv">org-agenda-format-date</span> <span class="s">"%Y/%m/%d (%a)"</span>
        <span class="nv">org-agenda-start-on-weekday</span> <span class="mi">0</span>
        <span class="nv">org-agenda-weekend-days</span> <span class="o">'</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nv">org-agenda-repeating-timestampo-show-all</span> <span class="no">t</span>
        <span class="nv">org-agenda-day-face-function</span> <span class="ss">'my:org-agenda-day-face-function</span>
        <span class="nv">org-agenda-custom-commands</span>
        <span class="o">'</span><span class="p">(</span>
          <span class="p">(</span><span class="s">"n"</span> <span class="s">"agenda and all TODO list"</span>
           <span class="p">(</span>
            <span class="p">(</span><span class="nv">agenda</span> <span class="s">""</span>
                    <span class="p">((</span><span class="nv">org-agenda-ndays</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">org-agenda-entry-types</span> <span class="o">'</span><span class="p">(</span><span class="ss">:timestamp</span> <span class="ss">:sexp</span><span class="p">))))</span>
            <span class="p">(</span><span class="nv">todo</span> <span class="s">"TODO"</span>
                  <span class="p">((</span><span class="nv">org-agenda-prefix-format</span> <span class="s">" %i %-22:c"</span><span class="p">)))</span>
            <span class="p">(</span><span class="nv">todo</span> <span class="s">"新規|着手|進行中|確認"</span>
                  <span class="p">((</span><span class="nv">org-agenda-prefix-format</span> <span class="s">" %i %-22:c"</span><span class="p">)))</span>
            <span class="p">(</span><span class="nv">todo</span> <span class="s">"WAIT"</span>
                  <span class="p">((</span><span class="nv">org-agenda-prefix-format</span> <span class="s">" %i %-22:c"</span><span class="p">)))</span>

            <span class="p">(</span><span class="nv">todo</span> <span class="s">"SOMEDAY"</span>
                  <span class="p">((</span><span class="nv">org-agenda-prefix-format</span> <span class="s">" %i %-22:c"</span><span class="p">)))</span>
            <span class="p">))</span>
          <span class="p">(</span><span class="s">"N"</span> <span class="s">"All memo entry"</span>
           <span class="p">(</span><span class="c1">;;</span>
            <span class="p">(</span><span class="nv">todo</span> <span class="s">"MEMO"</span><span class="p">)</span>
            <span class="p">))</span>
          <span class="p">)</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">file</span>
           <span class="o">'</span><span class="p">(</span><span class="c1">;; "Archive.org"   &lt;-- 🤔</span>
             <span class="c1">;; Calendar</span>
             <span class="s">"Holidays.org"</span>
             <span class="s">"Schedule.org"</span>
             <span class="s">"GFD.org"</span>
             <span class="s">"Univ.org"</span>
             <span class="s">"DebianJP.org"</span>
             <span class="c1">;; INBOX</span>
             <span class="s">"INBOX.org"</span>
             <span class="c1">;; misc</span>
             <span class="s">"twitter.org"</span>
             <span class="c1">;; Project</span>
             <span class="s">"redmine_GFD.org"</span>
             <span class="c1">;; "redmine_FluidSoc.org"</span>
             <span class="p">))</span>
    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-agenda-files</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">file</span> <span class="nv">my:d:org</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-agenda-files</span>
               <span class="p">(</span><span class="nv">locate-user-emacs-file</span> <span class="s">"README.org"</span><span class="p">))</span>
  <span class="c1">;; (add-to-list 'org-agenda-files</span>
  <span class="c1">;;             (expand-file-name "Public/web.org" (getenv "HOME")))</span>
  <span class="c1">;; (add-to-list 'org-agenda-files</span>
  <span class="c1">;;              (expand-file-name "Public/404.org" (getenv "HOME")))</span>
  <span class="c1">;; org-wiki</span>
  <span class="c1">;; (dolist (file</span>
  <span class="c1">;;          (directory-files-recursively</span>
  <span class="c1">;;           (expand-file-name "Public/cc-env" (getenv "HOME")) "org$"))</span>
  <span class="c1">;;   (add-to-list 'org-agenda-files file))</span>
  <span class="c1">;; github repos.</span>
  <span class="c1">;; (dolist (file</span>
  <span class="c1">;;          (directory-files-recursively</span>
  <span class="c1">;;           (expand-file-name "Public/software" (getenv "HOME")) "org$"))</span>
  <span class="c1">;;   (add-to-list 'org-agenda-files file))</span>
  <span class="c1">;;</span>
<span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgb9dc2ae0">Org-roam と Org-agenda</h3>
<div class="outline-text-3" id="text-orgb9dc2ae0">
<p>
org-roam で db に query 投げて,
<code>org-agenda-files</code> を更新するように.
元ネタ: <a href="https://d12frosted.io/posts/2021-01-16-task-management-with-roam-vol5.html">Task management with org-roam Vol. 5: Dynamic and fast agenda</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">vulpea</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"rg"</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"sqlite3"</span><span class="p">)))</span>
  <span class="ss">:after</span> <span class="nv">org-agenda</span>
  <span class="ss">:el-get</span>  <span class="nv">d12frosted/vulpea</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:before</span> <span class="nv">org-agenda</span>
           <span class="nv">my:vulpea-agenda-files-update</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">org-roam-db-autosync-mode</span> <span class="o">.</span> <span class="nv">vulpea-db-autosync-enable</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">find-file-hook</span>            <span class="o">.</span> <span class="nv">vulpea-project-update-tag</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">before-save-hook</span>          <span class="o">.</span> <span class="nv">vulpea-project-update-tag</span><span class="p">))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-project-p</span> <span class="p">()</span>
    <span class="s">"Return non-nil if current buffer has any todo entry.

TODO entries marked as done are ignored, meaning the this
function returns nil if current buffer contains only completed
tasks."</span>
    <span class="p">(</span><span class="nv">seq-find</span>                                 <span class="c1">; (3)</span>
     <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="k">type</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">eq</span> <span class="k">type</span> <span class="ss">'todo</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">org-element-map</span>                         <span class="c1">; (2)</span>
         <span class="p">(</span><span class="nv">org-element-parse-buffer</span> <span class="ss">'headline</span><span class="p">)</span> <span class="c1">; (1)</span>
         <span class="ss">'headline</span>
       <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">h</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">org-element-property</span> <span class="ss">:todo-type</span> <span class="nv">h</span><span class="p">)))))</span>

  <span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-project-update-tag</span> <span class="p">()</span>
    <span class="s">"Update PROJECT tag in the current buffer."</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">active-minibuffer-window</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">vulpea-buffer-p</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">save-excursion</span>
        <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">tags</span> <span class="p">(</span><span class="nv">vulpea-buffer-tags-get</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">original-tags</span> <span class="nv">tags</span><span class="p">))</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">vulpea-project-p</span><span class="p">)</span>
              <span class="p">(</span><span class="k">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nb">cons</span> <span class="s">"project"</span> <span class="nv">tags</span><span class="p">))</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nb">remove</span> <span class="s">"project"</span> <span class="nv">tags</span><span class="p">)))</span>

          <span class="c1">;; cleanup duplicates</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nv">seq-uniq</span> <span class="nv">tags</span><span class="p">))</span>

          <span class="c1">;; update tags if changed</span>
          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">seq-difference</span> <span class="nv">tags</span> <span class="nv">original-tags</span><span class="p">)</span>
                    <span class="p">(</span><span class="nv">seq-difference</span> <span class="nv">original-tags</span> <span class="nv">tags</span><span class="p">))</span>
            <span class="p">(</span><span class="nb">apply</span> <span class="nf">#'</span><span class="nv">vulpea-buffer-tags-set</span> <span class="nv">tags</span><span class="p">))))))</span>

  <span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-p</span> <span class="p">()</span>
    <span class="s">"Return non-nil if the currently visited buffer is a note."</span>
    <span class="p">(</span><span class="nb">and</span> <span class="nv">buffer-file-name</span>
         <span class="p">(</span><span class="nv">string-prefix-p</span>
          <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nv">file-name-as-directory</span> <span class="nv">org-roam-directory</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">file-name-directory</span> <span class="nv">buffer-file-name</span><span class="p">))))</span>

  <span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-project-files</span> <span class="p">()</span>
    <span class="s">"Return a list of note files containing 'project' tag."</span> <span class="c1">;</span>
    <span class="p">(</span><span class="nv">seq-uniq</span>
     <span class="p">(</span><span class="nv">seq-map</span>
      <span class="nf">#'</span><span class="nb">car</span>
      <span class="p">(</span><span class="nv">org-roam-db-query</span>
       <span class="nv">[:select</span> <span class="nv">[nodes:file]</span>
                <span class="ss">:from</span> <span class="nv">tags</span>
                <span class="ss">:left-join</span> <span class="nv">nodes</span>
                <span class="ss">:on</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">tags:node-id</span> <span class="nv">nodes:id</span><span class="p">)</span>
                <span class="ss">:where</span> <span class="p">(</span><span class="nv">like</span> <span class="nv">tag</span> <span class="p">(</span><span class="k">quote</span> <span class="s">"%\"project\"%"</span><span class="p">))</span><span class="nv">]</span><span class="p">))))</span>

  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:vulpea-agenda-files-update</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
    <span class="s">"Update/Add the value of `org-agenda-files'."</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">vulpea-project-files</span><span class="p">)</span>
        <span class="p">(</span><span class="k">progn</span>
          <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nv">vulpea-project-files</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-agenda-files</span> <span class="nv">file</span><span class="p">))</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">org-agenada-files</span> <span class="p">(</span><span class="nv">delete-dups</span> <span class="nv">org-agenda-files</span><span class="p">)))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org6a1d2f0c">OrgとGoogle カレンダーの連携: <code>org-gcal</code>
</h3>
<div class="outline-text-3" id="text-org6a1d2f0c">
<p>
request token 等の置き場所の変更
実際の情報等は <code>password-store</code> を使って設定しておく.
ついでに agenda 表示の際の色付けを設定．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-gcal</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"curl"</span><span class="p">)))</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">org-gcal-fetch</span> <span class="nv">org-gcal-sync</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-gcal-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-gcal"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">org-gcal-dir</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">org-gcal-dir</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-generic-id</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">org-generic-id-locations-file</span>
       <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-generic-id-locations"</span>  <span class="nv">my:d:tmp</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">request</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:preface</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">request-storage-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"request"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">request-storage-directory</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">request-storage-directory</span><span class="p">))</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">request-storage-directory</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"request"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">persist</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">persist--directory-location</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"persist"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-gcal-dir</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-gcal"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-gcal-token-file</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-gcal/.org-gcal-token"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-gcal-down-days</span>    <span class="o">.</span> <span class="mi">180</span><span class="p">)</span>  <span class="c1">;; 未来 180 日</span>
    <span class="p">(</span><span class="nv">org-gcal-up-days</span>      <span class="o">.</span>  <span class="mi">30</span><span class="p">)</span>  <span class="c1">;; 過去 30 日</span>
    <span class="p">(</span><span class="nv">org-gcal-auto-archive</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-gcal-notify-p</span>     <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-gcal-remove-api-cancelled-evetnts</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-gcal-remove-events-with-cancelled-todo</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="c1">;;</span>
    <span class="p">(</span><span class="nv">alert-log-messages</span>    <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">alert-default-style</span>   <span class="o">.</span><span class="ss">'libnotify</span><span class="p">))</span>
  <span class="ss">:pl-setq</span>
  <span class="p">(</span><span class="nv">org-gcal-client-id</span>
   <span class="nv">org-gcal-client-secret</span>
   <span class="nv">org-gcal-file-alist</span><span class="p">)</span>
  <span class="c1">;; :hook (org-capture-after-finalize-hook  . org-gcal-fetch)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org5908f7b5">OrgとRedmine の連携: <code>orgmine</code>
</h3>
<div class="outline-text-3" id="text-org5908f7b5">
<p>
素晴しい!!
<a href="https://github.com/kametoku/orgmine">kametoku/orgmine: Emacs minor mode for org-mode with redmine integration</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*orgmine</span>
  <span class="ss">:if</span>  <span class="p">(</span><span class="nb">and</span> <span class="nv">my:d:password-store</span>
            <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">(</span><span class="nv">org-mode-hook</span>
    <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">assoc</span> <span class="s">"om_server"</span> <span class="nv">org-keyword-properties</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">orgmine-mode</span><span class="p">))))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">enable-local-variables</span> <span class="ss">:safe</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">elmine</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="c1">;; (add-hook 'org-mode-hook</span>
  <span class="c1">;;           (lambda ()</span>
  <span class="c1">;;             (if (assoc "om_server" org-file-properties) (orgmine-mode))))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">orgmine</span>
    <span class="ss">:commands</span> <span class="p">(</span><span class="nv">orgmine-mode</span><span class="p">)</span>
    <span class="ss">:el-get</span> <span class="nv">kametoku/orgmine</span>
    <span class="ss">:init</span>
    <span class="c1">;; (defun my:orgmine-default-todo-keyword ()</span>
    <span class="c1">;;   "Custom: use `org-file-properties' for backward compatibility."</span>
    <span class="c1">;;   (or (cdr (assoc-string "om_default_todo" org-file-properties))</span>
    <span class="c1">;;       orgmine-default-todo-keyword</span>
    <span class="c1">;;       (nth 0 org-todo-keywords-1)</span>
    <span class="c1">;;       1))</span>

    <span class="c1">;; (defun my:orgmine-setup ()</span>
    <span class="c1">;;   "Custom: use `org-file-properties' for backward compatibility."</span>
    <span class="c1">;;   (let* ((server (cdr (assoc-string "om_server" org-file-properties t)))</span>
	<span class="c1">;;          (config (cdr (assoc-string server orgmine-servers t))))</span>
    <span class="c1">;;     (if config</span>
	<span class="c1">;;         (set (make-local-variable 'orgmine-server) server))</span>
    <span class="c1">;;     (mapc (lambda (elem)</span>
	<span class="c1">;;             (let* ((key (car elem))</span>
	<span class="c1">;; 	               (symbol (intern (format "orgmine-%s" key)))</span>
	<span class="c1">;; 	               (value (cdr elem)))</span>
	<span class="c1">;;               (if (memq key orgmine-valid-variables)</span>
	<span class="c1">;; 	              (progn</span>
	<span class="c1">;; 	                (set (make-local-variable symbol) value)</span>
	<span class="c1">;; 	                (if (eq key 'custom-fields)</span>
	<span class="c1">;; 		                (orgmine-setup-custom-fields value)))</span>
	<span class="c1">;; 	            (message "orgmine-setup: %s: skipped - invalid name" key))))</span>
	<span class="c1">;;           config))</span>
    <span class="c1">;;   (orgmine-setup-tags)</span>
    <span class="c1">;;   (run-hooks 'orgmine-setup-hook))</span>
    <span class="c1">;; :advice</span>
    <span class="c1">;; '((:override orgmine-default-todo-keyword my:orgmine-default-todo-keyword)</span>
    <span class="c1">;;   (:override orgmine-setup my:orgmine-setup))</span>
    <span class="ss">:pl-setq</span> <span class="nv">orgmine-servers</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">orgmine-note-block-begin</span> <span class="s">"#+begin_src gfm"</span>   <span class="c1">;; 要調整</span>
          <span class="nv">orgmine-note-block-end</span>   <span class="s">"#+end_src\n"</span>
          <span class="nv">orgmine-default-todo-keyword</span> <span class="s">"新規"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org5f8d1640">Org-Wiki</h3>
<div class="outline-text-3" id="text-org5f8d1640">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-wiki</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/Public/cc-env"</span><span class="p">)</span>
  <span class="ss">:el-get</span> <span class="nv">uwabami/org-wiki</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-wiki-location-alist</span>     <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="s">"~/Public/cc-env"</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-wiki-location</span>           <span class="o">.</span> <span class="s">"~/Public/cc-env"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-wiki-publish-relative</span>   <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-wiki-publish-root</span>       <span class="o">.</span> <span class="s">"{{site.url}}/cc-env"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-wiki-completing-backend</span> <span class="o">.</span> <span class="ss">'completing-read</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-wiki-template</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">concat</span> <span class="s">"#+TITLE: %n\n"</span>
                <span class="s">"#+date: 20\n"</span>
                <span class="s">"#+LAYOUT: default\n"</span>
                <span class="s">"#+PREMALINK: /cc-env/%n.html\n"</span>
                <span class="s">"#+options: auto-id:nil\n"</span>
                <span class="s">"#+REF: cc-env/%n\n"</span>
                <span class="s">"Related [[wiki:index][Index]] [[~/Public/cc-env/index.org::#orge0707863][Debian]]\n"</span>
                <span class="s">"* %n\n"</span>
                <span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org54ab7934">Org-Export</h3>
<div class="outline-text-3" id="text-org54ab7934">
</div>
<div>
<h4 id="org06031219">全般設定</h4>
<div class="outline-text-4" id="text-org06031219">
<p>
latex, beamer,jekyll(後述) のみを有効に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox</span>
  <span class="ss">:preface</span>
  <span class="c1">;; 空行の削除</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:remove-org-newlines-at-cjk-text</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">_mode</span><span class="p">)</span>
    <span class="s">"先頭が '*', '#', '|' でなく、改行の前後が日本の文字の場合は改行を除去"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"^\\([^|#*\n].+\\)\\(.\\)\n *\\(.\\)"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">string-to-char</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">2</span><span class="p">))</span> <span class="m">#x2000</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">string-to-char</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">3</span><span class="p">))</span> <span class="m">#x2000</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">replace-match</span> <span class="s">"\\1\\2\\3"</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-at-bol</span><span class="p">))))</span>
  <span class="ss">:hook</span>
  <span class="c1">;; ((org-export-before-processing-hook . my:remove-org-newlines-at-cjk-text))</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">org-export-backends</span>             <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="c1">;; remove somve built-in</span>
                                        <span class="c1">;; html</span>
                                        <span class="nv">jekyll</span>
                                        <span class="nv">latex</span>
                                        <span class="nv">beamer</span><span class="p">))</span>
   <span class="p">(</span><span class="nv">org-export-with-toc</span>             <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">org-export-with-section-numbers</span> <span class="o">.</span> <span class="no">nil</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="orgd48f8f82">Jekyll, HTML</h4>
<div class="outline-text-4" id="text-orgd48f8f82">
<p>
Web サイトは Jekyll で作成しています.
以前は org file を直接 jekyll で処理していましたが,
最近は org を html に export して, それを処理する様にしています.
</p>

<p>
exporter は <a href="https://uwabami.github.com/ox-jekyll">uwabami/ox-jekyll</a> にあります.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-html</span>
  <span class="ss">:after</span> <span class="nv">ox</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-jekyll</span>
    <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/Public/cc-env"</span><span class="p">)</span>
    <span class="ss">:el-get</span> <span class="nv">uwabami/ox-jekyll</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">s</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">org-html-table-align-individual-fields</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">org-html-table-default-attributes</span>      <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">org-html-html5-fancy</span>                   <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">org-html-doctype</span>                       <span class="o">.</span> <span class="s">"html5"</span><span class="p">)</span>
   <span class="c1">;; (org-html-container-element             . "div")</span>
   <span class="p">(</span><span class="nv">org-html-inline-image-rules</span>
    <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="s">"file"</span>  <span class="o">.</span> <span class="s">"\\.\\(jpeg\\|jpg\\|png\\|gif\\|webp\\|svg\\)\\'"</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"http"</span>  <span class="o">.</span> <span class="s">"\\.\\(jpeg\\|jpg\\|png\\|gif\\|webp\\|svg\\)\\'"</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"https"</span> <span class="o">.</span> <span class="s">"\\.\\(jpeg\\|jpg\\|png\\|gif\\|webp\\|svg\\)\\'"</span><span class="p">)))</span>
   <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized1</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">require</span> <span class="ss">'s</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">s-replace</span>
       <span class="p">(</span><span class="nb">format</span> <span class="s">"&lt;a href=\"file://%sREADME.html"</span>
               <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
       <span class="s">"&lt;a href=\"{{baseurl}}/cc-env/Emacs.html"</span>
       <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized2</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">require</span> <span class="ss">'s</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">s-replace</span>
       <span class="p">(</span><span class="nb">format</span> <span class="s">"&lt;a href=\"file://%s"</span>
               <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Public/"</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)))</span>
       <span class="s">"&lt;a href=\"{{site.url}}/"</span>
       <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized3</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">" id=\"outline-container-org.+\" class=\"outline-.+\""</span>
       <span class="s">""</span> <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized4</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">"&lt;a id=\"org.+?\"&gt;&lt;/a&gt;"</span>
       <span class="s">""</span> <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized5</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">"&lt;pre class=\"example\" id=\".+?\"&gt;"</span>
       <span class="s">"&lt;pre class=\"example\"&gt;"</span> <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized6</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">"&lt;figure id=\".+?\"&gt;"</span>
       <span class="s">"&lt;figure&gt;"</span> <span class="nv">contents</span><span class="p">)))</span>

  <span class="c1">;;</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span>
               <span class="ss">'my:org-wiki-jekyll-finalized1</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span>
               <span class="ss">'my:org-wiki-jekyll-finalized2</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span>
               <span class="ss">'my:org-wiki-jekyll-finalized3</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span>
               <span class="ss">'my:org-wiki-jekyll-finalized4</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span>
               <span class="ss">'my:org-wiki-jekyll-finalized5</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span>
               <span class="ss">'my:org-wiki-jekyll-finalized6</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org4d9c6533">LaTeX, Beamer</h4>
<div class="outline-text-4" id="text-org4d9c6533">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-latex</span>
  <span class="ss">:after</span> <span class="nv">ox</span>
  <span class="ss">:preface</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-beamer</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">org-beamer-frame-level</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">org-beamer-frame-default-options</span> <span class="o">.</span> <span class="s">"fragile,squeeze,c"</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">org-latex-compiler</span> <span class="o">.</span> <span class="s">"latexmk -pvc"</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="ss">:config</span>
    <span class="c1">;; for Beamer</span>
    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
                 <span class="o">'</span><span class="p">(</span><span class="ss">:shortdate</span>    <span class="s">"SHORTDATE"</span>   <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
                 <span class="o">'</span><span class="p">(</span><span class="ss">:shorttitle</span>   <span class="s">"SHORTTITLE"</span>  <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
                 <span class="o">'</span><span class="p">(</span><span class="ss">:shortauthor</span>  <span class="s">"SHORTAUTHOR"</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
                 <span class="o">'</span><span class="p">(</span><span class="ss">:institute</span>    <span class="s">"INSTITUTE"</span>   <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-latex-default-class</span> <span class="o">.</span> <span class="s">"my:uplatex"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-latex-pdf-process</span>   <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="s">"latexmk -pvc %f"</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-latex-hyperref-template</span>
     <span class="o">.</span>
     <span class="s">"\\hypersetup{
pdfauthor={%a},
pdftitle={%t},
pdfkeywords={%k},
pdfsubject={%d},
pdfcreator={%c},
pdflang={%L},
colorlinks,
}"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-latex-classes</span>
     <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="s">"my:uplatex"</span>
          <span class="s">"\\documentclass[a4j,uplatex]{jsarticle}
            [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
          <span class="p">(</span><span class="s">"\\section\{%s\}"</span> <span class="o">.</span> <span class="s">"\\section*\{%s\}"</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"\\subsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsection*\{%s\}"</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"\\subsubsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsubsection*\{%s\}"</span><span class="p">))</span>
         <span class="p">(</span><span class="s">"my:jlreq"</span>
          <span class="s">"\\documentclass{jlreq}
            [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
          <span class="p">(</span><span class="s">"\\section\{%s\}"</span> <span class="o">.</span> <span class="s">"\\section*\{%s\}"</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"\\subsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsection*\{%s\}"</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"\\subsubsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsubsection*\{%s\}"</span><span class="p">))</span>
         <span class="p">(</span><span class="s">"my:beamer"</span>
          <span class="s">"\\documentclass[dvipdfmx,presentation]{beamer}
             [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
          <span class="p">(</span><span class="s">"\\section\{%s\}"</span> <span class="o">.</span> <span class="s">"\\section*\{%s\}"</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"\\subsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsection*\{%s\}"</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"\\subsubsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsubsection*\{%s\}"</span><span class="p">))))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org589a50cc">Jekyll</h4>
<div class="outline-text-4" id="text-org589a50cc">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"></code></pre></figure>
</div>
</div>
<div>
<h4 id="orge77c5c82">Publish</h4>
<div class="outline-text-4" id="text-orge77c5c82">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-publish</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/Public/cc-env"</span><span class="p">)</span>
  <span class="ss">:after</span> <span class="p">(</span><span class="nv">ox-jekyll</span> <span class="nv">org-wiki</span><span class="p">)</span>
  <span class="ss">:commands</span> <span class="nv">my:org-wiki-publish</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-publish-timestamp-directory</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-timestamps/"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-publish</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-publish</span> <span class="p">(</span><span class="nv">org-wiki-make-org-publish-plist</span>
                  <span class="ss">'org-jekyll-publish-to-html</span><span class="p">)</span>
                 <span class="no">t</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h3 id="org801f7dd3">Org-ref: 文献参照, 引用など</h3>
<div class="outline-text-3" id="text-org801f7dd3">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-ref</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:nextcloud</span><span class="p">)</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-ref-bibliography-notes</span>   <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"INBOX.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-ref-default-bibliography</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"references.bib"</span> <span class="nv">my:d:nextcloud</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-ref-pdf-directory</span>        <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Papers"</span> <span class="nv">my:d:nextcloud</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org912b87a3">Outline Magic</h2>
<div class="outline-text-2" id="text-org912b87a3">
<p>
どんどん増えそう．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">outline</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">outline-magic</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:bind</span> <span class="p">((</span><span class="ss">:outline-minor-mode-map</span>
            <span class="p">(</span><span class="s">"C-c TAB"</span> <span class="o">.</span> <span class="nv">outline-cycle</span><span class="p">)))</span>
    <span class="ss">:hook</span> <span class="p">((</span><span class="nv">LaTeX-mode-hook</span> <span class="o">.</span> <span class="nv">my:add-outline-headings</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">LaTeX-mode-hook</span> <span class="o">.</span> <span class="nv">outline-minor-mode</span><span class="p">))</span>
    <span class="ss">:init</span>
    <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:add-outline-headings</span> <span class="p">()</span>
      <span class="s">"Custom: Add promotion headings"</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">outline-promotion-headings</span> <span class="o">'</span><span class="p">(</span><span class="s">"\\chapter"</span>
                                         <span class="s">"\\section"</span>
                                         <span class="s">"\\subsection"</span>
                                         <span class="s">"\\subsubsection"</span>
                                         <span class="s">"\\paragraph"</span>
                                         <span class="s">"\\subparagraph"</span>
                                         <span class="s">"\\begin{frame}"</span>
                                         <span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgc6b67eb9">VCS</h2>
<div class="outline-text-2" id="text-orgc6b67eb9">
<p>
まあ, ほとんど Git 関連な訳ですが．
</p>
</div>
<div>
<h3 id="org429f5b00">git{attributes,config,ignore}-mode, git-commit</h3>
<div class="outline-text-3" id="text-org429f5b00">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*git</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">git-commit</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">gitattributes-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">gitconfig-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">gitignore-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org59371622">magit:</h3>
<div class="outline-text-3" id="text-org59371622">
<p>
magit は Emacs の Git Frontend.
結局の所 CUI でコマンド叩く事も多いけれど, これはこれで重宝している．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">magit</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x g"</span> <span class="o">.</span> <span class="nv">magit-status</span><span class="p">))</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">transient</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">transient-history-file</span>
       <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"transient-history.el"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">transient-levels-file</span>
       <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"transient-levels.el"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">transient-values-file</span>
       <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"transient-values.el"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">transient-force-fixed-pitch</span> <span class="o">.</span> <span class="no">t</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">magit-completing-read-function</span> <span class="ss">'ido-completing-read</span>
        <span class="nv">magit-refs-show-commit-count</span>   <span class="ss">'all</span>
        <span class="nv">magit-log-buffer-file-locked</span>   <span class="no">t</span>
        <span class="nv">magit-revision-show-gravatars</span>  <span class="no">nil</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org6727f452">Forge</h3>
<div class="outline-text-3" id="text-org6727f452">
<p>
Gitub/Gitlab と Magit の連携
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">forge</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:after</span> <span class="nv">magit</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org994abf0f">Git Gutter+</h3>
<div class="outline-text-3" id="text-org994abf0f">
<p>
飽きたら止めるかもしれないけれど.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">git-gutter+</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="o">`</span><span class="p">((</span><span class="nv">git-gutter+-mode</span>
               <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nb">format</span> <span class="s">"%s"</span> <span class="p">(</span><span class="nv">all-the-icons-octicon</span> <span class="s">"git-merge"</span><span class="p">))))</span>
  <span class="ss">:bind</span> <span class="p">(</span><span class="s">"C-x G"</span> <span class="o">.</span> <span class="nv">global-git-gutter+-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org710c040c">関数定義を辿る: <code>dump-jump</code>, <code>smart-jump</code>
</h2>
<div class="outline-text-2" id="text-org710c040c">
<p>
あまり上手く使えていない.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">dumb-jump</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"rg"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"M-g o"</span> <span class="o">.</span> <span class="nv">dumb-jump-go-other-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"M-g j"</span> <span class="o">.</span> <span class="nv">dumb-jump-go</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"M-g i"</span> <span class="o">.</span> <span class="nv">dumb-jump-go-prompt</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"M-g x"</span> <span class="o">.</span> <span class="nv">dumb-jump-go-prefer-external</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"M-g z"</span> <span class="o">.</span> <span class="nv">dumb-jump-go-prefer-external-other-window</span><span class="p">))</span>
  <span class="ss">:custom</span> <span class="o">'</span><span class="p">((</span><span class="nv">dumb-jump-selector</span>       <span class="o">.</span> <span class="ss">'ido</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">dumb-jump-force-searcher</span> <span class="o">.</span> <span class="ss">'rg</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">smart-jump</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">smart-jump-setup-default-registers</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org935a4dbf">言語毎の補完: <code>company-mode</code>
</h2>
<div class="outline-text-2" id="text-org935a4dbf">
<p>
まだうまく使いこなせていない．
</p>
<ul class="org-ul">
<li><a href="https://qiita.com/wktkshn/items/3ac46671d1c242a59f7e">company-dabbrevで日本語を補完しない</a></li>
</ul>
<p>
を有効にしてみたが, これで良いのかしら…?
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">company</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">company-require-match</span>             <span class="o">.</span> <span class="ss">'never</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">company-idle-delay</span>                <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">company-selection-wrap-around</span>     <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">company-tooltip-align-annotations</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">company-minimum-prefix-length</span>     <span class="o">.</span> <span class="mi">4</span><span class="p">)</span>
   <span class="c1">;; disable some noisy default backends</span>
   <span class="p">(</span><span class="nv">company-backends</span> <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">company-files</span>
                         <span class="nv">company-capf</span>
                         <span class="p">(</span><span class="nv">company-dabbrev-code</span>
                          <span class="nv">company-gtags</span>
                          <span class="nv">company-etags</span>
                          <span class="nv">company-keywords</span><span class="p">))))</span>
  <span class="ss">:bind</span>
  <span class="p">(</span><span class="c1">;; ("&lt;tab&gt;"    . company-indent-or-complete-common)</span>
   <span class="p">(</span><span class="ss">:company-active-map</span>
    <span class="p">(</span><span class="s">"C-n"</span>     <span class="o">.</span> <span class="nv">company-select-next</span><span class="p">)</span>
    <span class="p">(</span><span class="s">"C-p"</span>     <span class="o">.</span> <span class="nv">company-select-previous</span><span class="p">)</span>
    <span class="p">(</span><span class="s">"C-s"</span>     <span class="o">.</span> <span class="nv">company-filter-candidates</span><span class="p">)</span>
    <span class="p">(</span><span class="s">"C-&lt;tab&gt;"</span> <span class="o">.</span> <span class="nv">company-complete-common-or-cycle</span><span class="p">)</span>
    <span class="p">(</span><span class="s">"&lt;tab&gt;"</span>   <span class="o">.</span> <span class="nv">company-indent-or-complete-common</span><span class="p">)</span>
    <span class="p">)</span>
   <span class="p">(</span><span class="ss">:company-search-map</span>
    <span class="p">(</span><span class="s">"C-p"</span> <span class="o">.</span> <span class="nv">company-select-previous</span><span class="p">)</span>
    <span class="p">(</span><span class="s">"C-n"</span> <span class="o">.</span> <span class="nv">company-select-next</span><span class="p">)))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">after-init-hook</span>      <span class="o">.</span> <span class="nv">global-company-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">minibuffer-setup-hook</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                                <span class="p">(</span><span class="nv">company-mode</span> <span class="mi">-1</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="c1">;; (leaf company-statistics</span>
<span class="c1">;;   :disabled t</span>
<span class="c1">;;   :ensure t</span>
<span class="c1">;;   :custom</span>
<span class="c1">;;   `((company-statistics-size . 2000)</span>
<span class="c1">;;     (company-statistics-file</span>
<span class="c1">;;      . ,(expand-file-name "company-statistics-cache.el" my:d:tmp))</span>
<span class="c1">;;     (company-transformers</span>
<span class="c1">;;      . (company-sort-by-statistics company-sort-by-backed-importance)))</span>
<span class="c1">;;   :config</span>
<span class="c1">;;   (company-statistics-mode)</span>
<span class="c1">;;   )</span>
  <span class="c1">;; :init</span>
  <span class="c1">;; (defun edit-category-table-for-company-dabbrev (&amp;optional table)</span>
  <span class="c1">;;   (define-category ?s "word constituents for company-dabbrev" table)</span>
  <span class="c1">;;   (let ((i 0))</span>
  <span class="c1">;;     (while (&lt; i 128)</span>
  <span class="c1">;;       (if (equal ?w (char-syntax i))</span>
  <span class="c1">;;           (modify-category-entry i ?s table)</span>
  <span class="c1">;;         (modify-category-entry i ?s table t))</span>
  <span class="c1">;;       (setq i (1+ i)))))</span>
  <span class="c1">;; (edit-category-table-for-company-dabbrev)</span>
  <span class="c1">;; ;; (add-hook 'TeX-mode-hook 'edit-category-table-for-company-dabbrev) ; 下の追記参照</span>
  <span class="c1">;; (setq company-dabbrev-char-regexp "\\cs")</span></code></pre></figure>
<ul class="org-ul">
<li class="on">
<code>[X]</code> <a href="https://github.com/TheBB/company-reftex">TheBB/company-reftex</a>
</li>
<li class="on">
<code>[X]</code> <a href="https://github.com/vspinu/company-math">vspinu/company-math</a>
</li>
<li class="on">
<code>[X]</code> <a href="https://github.com/alexeyr/company-auctex">alexeyr/company-auctex</a>
</li>
</ul>
</div>
</div>
<div>
<h2 id="orgffdbe5ff">
<span class="todo SOMEDAY">SOMEDAY</span> テンプレート補完: <code>yasnippet</code> <code>[0/1]</code>
</h2>
<div class="outline-text-2" id="text-orgffdbe5ff">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">yasnippet</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="no">t</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">yas-indent-line</span>  <span class="o">.</span> <span class="ss">'fixed</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">yas-snippet-dirs</span> <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"snippets"</span> <span class="nv">my:d:share</span><span class="p">))))</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">after-init-hook</span> <span class="o">.</span> <span class="nv">yas-global-mode</span><span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="ss">:yas-keymap</span>
          <span class="p">(</span><span class="s">"C-&lt;tab&gt;"</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"&lt;tab&gt;"</span>   <span class="o">.</span> <span class="no">nil</span><span class="p">))</span>  <span class="c1">; for company</span>
         <span class="p">(</span><span class="ss">:yas-minor-mode-map</span>
          <span class="p">(</span><span class="s">"&lt;tab&gt;"</span>   <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-&lt;tab&gt;"</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-c y e"</span> <span class="o">.</span> <span class="nv">yas-expand</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-c y i"</span> <span class="o">.</span> <span class="nv">yas-insert-snippet</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-c y n"</span> <span class="o">.</span> <span class="nv">yas-new-snippet</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-c y v"</span> <span class="o">.</span> <span class="nv">yas-visit-snippet-file</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-c y l"</span> <span class="o">.</span> <span class="nv">yas-describe-tables</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-c y g"</span> <span class="o">.</span> <span class="nv">yas-reload-all</span><span class="p">)))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">yasnippet-snippets</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">yatemplate</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> 意図しない所で発火してテンプレートが挿入されてしまうので保留中</li>
</ul>
</div>
</div>
<div>
<h2 id="orgd4b6f681">
<span class="todo SOMEDAY">SOMEDAY</span> <code>flymake</code>: on-the-fly check <code>[0/1]</code>
</h2>
<div class="outline-text-2" id="text-orgd4b6f681">
<p>
on-the-fly syntax checker.
同様の拡張には <code>flycheck</code> があるけれど,
<code>flycheck</code> はいろいろやりすぎてて私には合わない.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">flymake</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> 設定調整が必要</li>
</ul>
</div>
</div>
<div>
<h2 id="org44ddff4c">LSP: <code>lsp-mode</code>
</h2>
<div class="outline-text-2" id="text-org44ddff4c">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">lsp-mode</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"fortls"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">lsp-print-io</span>             <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsp-trace</span>                <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsp-print-performance</span>    <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsp-auto-guess-root</span>      <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsp-document-sync-method</span> <span class="o">.</span> <span class="ss">'incremental</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsp-response-timeout</span>     <span class="o">.</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsp-prefer-flymake</span>       <span class="o">.</span><span class="ss">'flymake</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsp-session-file</span>         <span class="o">.,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"lsp-session-v1"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
   <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">lsp-ui</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:custom</span>
    <span class="p">((</span><span class="nv">lsp-ui-doc-enable</span>            <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-doc-header</span>            <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-doc-include-signature</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-doc-position</span>          <span class="o">.</span> <span class="ss">'at-point</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-doc-max-width</span>         <span class="o">.</span> <span class="mi">150</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-doc-max-height</span>        <span class="o">.</span> <span class="mi">30</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-doc-use-childframe</span>    <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-doc-use-webkit</span>        <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-flycheck-enable</span>       <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-peek-enable</span>           <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-peek-peek-height</span>      <span class="o">.</span> <span class="mi">20</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-peek-list-width</span>       <span class="o">.</span> <span class="mi">50</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">lsp-ui-peek-fontify</span>          <span class="o">.</span> <span class="ss">'on-demand</span><span class="p">)</span> <span class="c1">;; never, on-demand, or always</span>
     <span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">lsp-mode-hook</span> <span class="o">.</span> <span class="nv">lsp-ui-mode</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">f90-mode-hook</span> <span class="o">.</span> <span class="nv">lsp</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org88a3cb1b">TeX: <code>AUCTeX</code>
</h2>
<div class="outline-text-2" id="text-org88a3cb1b">
<p>
やっている事は
</p>
<ul class="org-ul">
<li>japanese-latex-mode において, 幾つかのコマンドが追加/上書きされているが,  あまり使うことの無いコマンドが表示されるのが嫌なのでそれらを削除．</li>
<li>コンパイルには<a href="http://personal.psu.edu/jcc8/software/latexmk/">Latexmk</a>を使う</li>
</ul>
<p>
と言った所.
…ただ, Beamerのクラスなんかだと勝手にdefault コマンドが LaTeX に変更されたりするので挙動がイマイチ良くわからん.
async で <code>latexmk -pvc</code> を走らせておいた方が気持が良い, 気がしている….
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">auctex</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"uplatex"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"latexmk"</span><span class="p">))</span>
  <span class="ss">:load-path</span> <span class="s">"/usr/share/emacs/site-lisp/auctex"</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/auto"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="k">progn</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/auto"</span> <span class="nv">my:d:tmp</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/style"</span> <span class="nv">my:d:tmp</span><span class="p">)</span> <span class="no">t</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">reftex</span>
    <span class="ss">:custom</span> <span class="p">((</span><span class="nv">reftex-plug-into-AUCTeX</span>               <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">reftex-cite-prompt-optional-args</span>      <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">reftex-toc-split-windows-horizontally</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
             <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">auctex-latexmk</span>
    <span class="ss">:el-get</span> <span class="nv">tom-tan/auctex-latexmk</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">auctex-latexmk-inherit-TeX-PDF-mode</span> <span class="o">.</span> <span class="no">t</span><span class="p">))</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">TeX-command-output-list</span> <span class="o">'</span><span class="p">((</span><span class="s">"LaTeXMk"</span> <span class="p">(</span><span class="s">"pdf"</span><span class="p">)))</span>
          <span class="nv">TeX-command-default</span> <span class="s">"LaTexMk"</span>
          <span class="nv">japanese-LaTeX-command-default</span> <span class="s">"LaTeX"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nb">load</span> <span class="s">"auctex"</span> <span class="no">t</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">load</span> <span class="s">"preview-latex"</span> <span class="no">t</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">LaTeX-mode-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                       <span class="p">(</span><span class="nv">turn-on-reftex</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">auctex-latexmk-setup</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">setq-default</span> <span class="nv">TeX-command-default</span> <span class="s">"LaTexMk"</span>
                                     <span class="nv">japanese-LaTeX-command-default</span> <span class="s">"LaTeX"</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">TeX-PDF-mode</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">TeX-source-correlate-mode</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">LaTeX-math-mode</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">outline-minor-mode</span><span class="p">)</span>
                       <span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">TeX-auto-local</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/auto"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">TeX-style-local</span>
     <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/style"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">TeX-default-mode</span>                  <span class="o">.</span> <span class="ss">'japanese-latex-mode</span><span class="p">)</span> <span class="c1">;; 🤔</span>
    <span class="p">(</span><span class="nv">japanese-TeX-engine-default</span>       <span class="o">.</span> <span class="ss">'uptex</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">japanese-LaTeX-default-style</span>      <span class="o">.</span> <span class="s">"jlreq"</span><span class="p">)</span> <span class="c1">;; jsarticle? bxjsarticle?</span>
    <span class="p">(</span><span class="nv">TeX-engine</span>                        <span class="o">.</span> <span class="ss">'uptex</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-PDF-from-DVI</span>                  <span class="o">.</span> <span class="s">"Dvipdfmx"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-view-program-selection</span>        <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="nv">output-dvi</span> <span class="s">"xdvi"</span><span class="p">)</span>
                                           <span class="p">(</span><span class="nv">output-pdf</span> <span class="s">"Evince"</span><span class="p">)</span>
                                           <span class="p">(</span><span class="nv">output-html</span> <span class="s">"xdg-open"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">LaTeX-figure-label</span>                <span class="o">.</span> <span class="s">"fig:"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">LaTeX-table-label</span>                 <span class="o">.</span> <span class="s">"tab:"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">LaTeX-section-label</span>               <span class="o">.</span> <span class="s">"sec:"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-command-default</span>               <span class="o">.</span> <span class="s">"LaTexMk"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-parse-self</span>                    <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-auto-save</span>                     <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-auto-untabify</span>                 <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-source-correlate-mode</span>         <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-source-correlate-start-server</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">TeX-source-correlate-method</span>       <span class="o">.</span> <span class="ss">'synctex</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">font-latex-fontify-script</span>         <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">font-latex-script-display</span>         <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">font-latex-fontify-sectioning</span>     <span class="o">.</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org898b9a45">Autoconf</h2>
<div class="outline-text-2" id="text-org898b9a45">
<p>
いれてみたけれど, はてさて．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">sh-autoconf</span>
  <span class="ss">:el-get</span> <span class="p">(</span><span class="nv">sh-autoconf</span>
           <span class="ss">:type</span> <span class="nv">http</span>
           <span class="ss">:url</span> <span class="s">"https://download.tuxfamily.org/user42/sh-autoconf.el"</span><span class="p">)</span>
  <span class="ss">:mode</span> <span class="p">((</span><span class="s">"/configure\\.\\(ac\\|in\\)\\'"</span>    <span class="o">.</span> <span class="nv">sh-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"/ac\\(include\\|local\\)\\.m4\\'"</span> <span class="o">.</span> <span class="nv">sh-mode</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org11ccc687">Fortran</h2>
<div class="outline-text-2" id="text-org11ccc687">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">f90</span>
  <span class="ss">:mode</span> <span class="p">(</span><span class="s">"\\.\\(f|F\\)\\(90|95|03|08\\)$"</span> <span class="o">.</span> <span class="nv">f90-mode</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">f90-indent</span>
    <span class="ss">:custom</span>
    <span class="p">((</span><span class="nv">f90-do-indent</span>               <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">;; 2? 4?</span>
     <span class="p">(</span><span class="nv">f90-if-indent</span>               <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">;; 2? 4?</span>
     <span class="p">(</span><span class="nv">f90-type-indent</span>             <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">;; 2? 4?</span>
     <span class="p">(</span><span class="nv">f90-program-indent</span>          <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">;; 2? 4?</span>
     <span class="p">(</span><span class="nv">f90-continuation-indent</span>     <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">;; 2? 4?</span>
     <span class="p">(</span><span class="nv">f90-directive-comment-re</span>    <span class="o">.</span> <span class="s">"!omp\\$"</span> <span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-indented-comment-re</span>     <span class="o">.</span> <span class="s">"!"</span> <span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-break-delimiters</span>        <span class="o">.</span> <span class="s">"[-+\\*/&gt;&lt;=,% \t]"</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-break-before-delimiters</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-beginning-ampersand</span>     <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-smart-end</span>               <span class="o">.</span> <span class="ss">'blink</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-auto-keyword-case</span>       <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-leave-line-no</span>           <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-comment-region</span>          <span class="o">.</span> <span class="s">"!! "</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">f90-indent-comment</span>          <span class="o">.</span> <span class="s">"! "</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org6035cc60">Markdown</h2>
<div class="outline-text-2" id="text-org6035cc60">
<p>
markdown自体はあまり好きじゃないんだけれど,
必要に迫られて書く事が増えてきたので設定しておく．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">markdown-mode</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"pandoc"</span><span class="p">)</span>
  <span class="ss">:mode</span> <span class="p">(</span><span class="s">"\\.\\(md\\|markdown\\|mkd\\)\\'"</span> <span class="o">.</span> <span class="nv">gfm-mode</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:disable-electric-indent-local-mode</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">electric-indent-local-mode</span> <span class="mi">-1</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">markdown-mode-hook</span> <span class="o">.</span> <span class="nv">my:disable-electric-indent-local-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">gfm-mode-hook</span>      <span class="o">.</span> <span class="nv">my:disable-electric-indent-local-mode</span><span class="p">))</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">markdown-command</span>
     <span class="o">.</span> <span class="s">"pandoc --from markdown_github -t html5 --mathjax --highlight-style pygments"</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org4b0a1cef">SCSS</h2>
<div class="outline-text-2" id="text-org4b0a1cef">
<p>
ちょいちょい弄る機会が増えてきたので導入．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">scss-mode</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"sass"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:mode</span> <span class="s">"\\.scss\\'"</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">scss-sass-command</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">executable-find</span> <span class="s">"sass"</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orge4a7e301">PlantUML</h2>
<div class="outline-text-2" id="text-orge4a7e301">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">plantuml-mode</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"plantuml"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">plantuml-executable-path</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nv">executable-find</span> <span class="s">"plantuml"</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">plantuml-default-exec-mode</span> <span class="o">.</span> <span class="ss">'executable</span><span class="p">))</span>
  <span class="ss">:init</span>
<span class="c1">;;   (add-to-list</span>
<span class="c1">;;    'org-src-lang-modes '("plantuml" . plantuml))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org332b8d85">Re:VIEW</h2>
<div class="outline-text-2" id="text-org332b8d85">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">review-mode</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">review-mode-use-skk-mode</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">reivew-use-em</span>            <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orga28ad005">その他のモード設定</h2>
<div class="outline-text-2" id="text-orga28ad005">
<p>
読み込むだけの mode の設定. 設定が増えたら別途まとめる。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*misc-mode</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">flycheck</span>
    <span class="ss">:disabled</span> <span class="no">t</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="nv">flycheck-define-checker</span>
     <span class="nv">textlint</span>
     <span class="s">"A linter for prose."</span>
     <span class="ss">:command</span> <span class="p">(</span><span class="s">"textlint"</span> <span class="s">"--format"</span> <span class="s">"unix"</span>
               <span class="c1">;; "--rule" "no-mix-dearu-desumasu" "--rule" "max-ten" "--rule" "spellcheck-tech-word"</span>
               <span class="nv">source-inplace</span><span class="p">)</span>
     <span class="ss">:error-patterns</span>
     <span class="p">((</span><span class="kt">warning</span> <span class="nv">line-start</span> <span class="p">(</span><span class="nv">file-name</span><span class="p">)</span> <span class="s">":"</span> <span class="nv">line</span> <span class="s">":"</span> <span class="nv">column</span> <span class="s">": "</span>
               <span class="p">(</span><span class="nv">id</span> <span class="p">(</span><span class="nv">one-or-more</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">any</span> <span class="s">" "</span><span class="p">))))</span>
               <span class="p">(</span><span class="nv">message</span> <span class="p">(</span><span class="nv">one-or-more</span> <span class="nv">not-newline</span><span class="p">)</span>
                        <span class="p">(</span><span class="nv">zero-or-more</span> <span class="s">"\n"</span> <span class="p">(</span><span class="nv">any</span> <span class="s">" "</span><span class="p">)</span> <span class="p">(</span><span class="nv">one-or-more</span> <span class="nv">not-newline</span><span class="p">)))</span>
               <span class="nv">line-end</span><span class="p">))</span>
     <span class="ss">:modes</span> <span class="p">(</span><span class="nv">text-mode</span> <span class="nv">markdown-mode</span> <span class="nv">gfm-mode</span> <span class="nv">wl-draft-mode</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'flycheck-checkers</span> <span class="ss">'textlint</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">debian-el</span>
    <span class="ss">:custom</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">debian-bug-download-directory</span> <span class="o">.</span> <span class="s">"~/Downloads"</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">rd-mode</span>
    <span class="ss">:mode</span> <span class="s">"\\.rd$"</span>
    <span class="ss">:hook</span>
    <span class="p">(</span><span class="nv">rd-mode-hook</span> <span class="o">.</span> <span class="nv">rd-show-other-block-all</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">yaml-mode</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:mode</span> <span class="s">"\\(\.yml\\|\.yaml\\)"</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">generic-x</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">textile-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">lua-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">debian-el</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">dpkg-dev-el</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">sh-mode</span>
    <span class="ss">:custom</span> <span class="p">((</span><span class="nv">system-uses-terminfo</span> <span class="o">.</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">apt-sources-list</span> <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:custom</span>
    <span class="p">((</span><span class="nv">apt-sources-list-suites</span>
      <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="s">"stable"</span> <span class="s">"stable-backports"</span>
          <span class="s">"testing"</span> <span class="s">"testing-backports"</span>
          <span class="s">"unstable"</span> <span class="s">"experimental"</span>
          <span class="s">"jessie"</span> <span class="s">"jessie-backports"</span>
          <span class="s">"stretch"</span> <span class="s">"stretch-backports"</span>
          <span class="s">"buster"</span> <span class="s">"buster-backports"</span>
          <span class="s">"bullseye"</span>
          <span class="s">"sid"</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">woman</span>
    <span class="c1">;; :custom-face</span>
    <span class="c1">;; ((woman-bold   . '((t (:inherit font-lock-type-face :bold t))))</span>
    <span class="c1">;; (woman-italic . '((t (:inherit font-lock-keyword-face :underline t)))))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">info-colors</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:hook</span>
    <span class="p">(</span><span class="nv">Info-selection</span> <span class="nf">#'</span><span class="nv">info-colors-fontify-node</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
<div>
<h3 id="org993cf404">SSH config mode</h3>
<div class="outline-text-3" id="text-org993cf404">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ssh-config-mode</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:mode</span> <span class="p">(((</span><span class="s">"/\\.ssh/config\\'"</span> <span class="s">"/sshd?_config\\'"</span><span class="p">)</span> <span class="o">.</span> <span class="nv">ssh-config-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"/known_hosts\\'"</span>                        <span class="o">.</span> <span class="nv">ssh-known-hosts-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"/authorized_keys?\\'"</span>                   <span class="o">.</span> <span class="nv">ssh-authorized-keys-mode</span><span class="p">))</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">ssh-config-mode</span> <span class="o">.</span> <span class="nv">turn-on-font-lock</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org9992a617">
<span class="todo SOMEDAY">SOMEDAY</span> 日記: <code>tDiary</code> <code>[0/1]</code>
</h2>
<div class="outline-text-2" id="text-org9992a617">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">tdiary-mode</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)</span> <span class="s">"/Nextcloud/tdiary"</span><span class="p">)))</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">tdiary-mode</span> <span class="nv">tdiary-replace</span> <span class="nv">tdiary-append</span><span class="p">)</span>
  <span class="ss">:el-get</span> <span class="nv">uwabami/tdiary-mode</span>
  <span class="ss">:defvar</span> <span class="nv">tdiary-passwd-file</span>
  <span class="ss">:pl-setq</span>
  <span class="p">(</span><span class="nv">tdiary-csrf-key</span> <span class="nv">tdiary-passwd-file</span><span class="p">)</span>
  <span class="c1">;; :init</span>
  <span class="c1">;; (setq tdiary-text-save-p t)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">tdiary-text-directory</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)</span> <span class="s">"/Nextcloud/tdiary/"</span><span class="p">)</span>
        <span class="nv">tdiary-diary-list</span> <span class="o">'</span><span class="p">((</span><span class="s">"log"</span> <span class="s">"https://uwabami.junkhub.org/log/"</span><span class="p">))</span>
        <span class="nv">tdiary-style-mode</span> <span class="ss">'org-mode</span>
        <span class="nv">tdiary-text-suffix</span> <span class="s">".org"</span>
        <span class="nv">tdiary-http-timeout</span> <span class="mi">100</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="nv">tdiary-passwd-file-load</span><span class="p">)</span>
  <span class="c1">;; (with-eval-after-load 'tdiary-mode</span>
  <span class="c1">;;   (setq tdiary-text-save-p t))</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> org2blog で tDiary を更新できないか妄想している</li>
</ul>
</div>
</div>
<div>
<h2 id="orgbf458527">テーマ, フォント, モードライン, などなど</h2>
<div class="outline-text-2" id="text-orgbf458527">
</div>
<div>
<h3 id="org356b9857">
<span class="todo SOMEDAY">SOMEDAY</span> フォント <code>[0/1]</code>
</h3>
<div class="outline-text-3" id="text-org356b9857">
<p>
試行錯誤中. とはいえ, GUIで使う事は滅多に無いのでなかなか弄る機会が無い.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:load-window-config</span> <span class="p">()</span>
  <span class="s">"load window-system specific settings"</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">progn</span>
    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'default</span> <span class="no">nil</span>
                        <span class="ss">:family</span> <span class="s">"FSMRMP"</span>
                        <span class="ss">:height</span> <span class="mi">220</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'fixed-pitch</span> <span class="no">nil</span>
                        <span class="ss">:family</span> <span class="s">"FSMRMP"</span>
                        <span class="ss">:height</span> <span class="mi">220</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'variable-pitch</span> <span class="no">nil</span>
                        <span class="ss">:family</span> <span class="s">"FSMRMP"</span>
                        <span class="ss">:height</span> <span class="mi">220</span><span class="p">)</span>
    <span class="c1">;; Japanese</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="ss">'japanese-jisx0213.2004-1</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">220</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="ss">'japanese-jisx0213-2</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">220</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="ss">'katakana-jisx0201</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">220</span><span class="p">))</span>
    <span class="c1">;; Latin with pronounciation annotations</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#x0080</span> <span class="o">.</span> <span class="m">#x024F</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">220</span><span class="p">))</span>
    <span class="c1">;; Math symbols</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#x2200</span> <span class="o">.</span> <span class="m">#x22FF</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">220</span><span class="p">))</span>
    <span class="c1">;; Greek</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#x0370</span> <span class="o">.</span> <span class="m">#x03FF</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">220</span><span class="p">))</span>
    <span class="c1">;; Some Icons</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#xE0A0</span> <span class="o">.</span> <span class="m">#xEEE0</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">220</span><span class="p">))</span>
    <span class="p">))</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:load-side-window-config</span> <span class="p">()</span>
  <span class="s">"load window-system specific settings"</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">progn</span>
    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'default</span> <span class="no">nil</span>
                        <span class="ss">:family</span> <span class="s">"AGVRMP"</span>
                        <span class="ss">:height</span> <span class="mi">180</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'fixed-pitch</span> <span class="no">nil</span>
                        <span class="ss">:family</span> <span class="s">"AGVRMP"</span>
                        <span class="ss">:height</span> <span class="mi">180</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'variable-pitch</span> <span class="no">nil</span>
                        <span class="ss">:family</span> <span class="s">"AGVRMP"</span>
                        <span class="ss">:height</span> <span class="mi">180</span><span class="p">)</span>
    <span class="c1">;; Japanese</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="ss">'japanese-jisx0213.2004-1</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">180</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="ss">'japanese-jisx0213-2</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">180</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="ss">'katakana-jisx0201</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">180</span><span class="p">))</span>
    <span class="c1">;; Latin with pronounciation annotations</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#x0080</span> <span class="o">.</span> <span class="m">#x024F</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">180</span><span class="p">))</span>
    <span class="c1">;; Math symbols</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#x2200</span> <span class="o">.</span> <span class="m">#x22FF</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">180</span><span class="p">))</span>
    <span class="c1">;; Greek</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#x0370</span> <span class="o">.</span> <span class="m">#x03FF</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">180</span><span class="p">))</span>
    <span class="c1">;; Some Icons</span>
    <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">nil</span>
                      <span class="o">'</span><span class="p">(</span><span class="m">#xE0A0</span> <span class="o">.</span> <span class="m">#xEEE0</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">font-spec</span> <span class="ss">:family</span> <span class="s">"AGVRMP"</span> <span class="ss">:height</span> <span class="mi">180</span><span class="p">))</span>
    <span class="p">))</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">*gui</span>
  <span class="ss">:if</span> <span class="nv">window-system</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">set-frame-parameter</span> <span class="no">nil</span> <span class="ss">'alpha</span> <span class="mi">90</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">use-default-font-for-symbols</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">scroll-bar-mode</span> <span class="mi">-1</span><span class="p">)</span>
<span class="c1">;;  (my:load-window-config)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> FSMRMP のギリシャ文字が全角にならない. 要調整</li>
</ul>
<pre class="example">
幅の確認:
Greek, Math, 絵文字は全角, 他は半角で 2:1 になっているかの確認用

|abcdefghijkl|
|ABCDEFGHIJKL|
|'";:-+=/\~`?|
|∞≤≥∏∑∫|
|×±≒≡⊆⊇|  ← GUI だと一部半角になる
|αβγδεζ|  ← GUI だと半角になる
|ηθικλμ|  ← GUI だと半角になる
|ΑΒΓΔΕΖ|  ← GUI だと半角になる
|ΗΘΙΚΛΜ|  ← GUI だと半角になる
|日本語の美観|
|あいうえおか|
|アイウエオカ|
|ｱｲｳｴｵｶｷｸｹｺｻｼ|

| hoge                 | hogeghoe | age              |
|----------------------+----------+------------------|
| 今日もいい天気ですね | お、     | 等幅になった👍 🍺|
|----------------------+----------+------------------|
</pre>
</div>
</div>
<div>
<h3 id="orgf37b53c3">modeline: <code>powerline</code>
</h3>
<div class="outline-text-3" id="text-orgf37b53c3">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">powerline</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:powerline-ddskk</span> <span class="p">()</span>
    <span class="s">"skkが読み込まれていなくても状態を表示"</span>
    <span class="p">(</span><span class="nb">cond</span>
     <span class="p">((</span><span class="nb">not</span> <span class="p">(</span><span class="nb">boundp</span> <span class="ss">'skk-modeline-input-mode</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-modeline-input-mode</span> <span class="s">"--[--]:"</span><span class="p">))</span>
     <span class="p">(</span><span class="no">t</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:skk-setup-modeline</span> <span class="p">()</span>
      <span class="s">"skk-setup-modeline による modeline の更新を無効化"</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-indicator-alist</span> <span class="p">(</span><span class="nv">skk-make-indicator-alist</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">force-mode-line-update</span> <span class="no">t</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:major-mode-icon</span> <span class="p">(</span><span class="nv">mode</span><span class="p">)</span>
    <span class="s">"Update file icon in mode-line, just display major-mode icon. not filename."</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">icon</span> <span class="p">(</span><span class="nv">all-the-icons-icon-for-mode</span> <span class="nv">mode</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbolp</span> <span class="nv">icon</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">all-the-icons-faicon</span> <span class="s">"file-code-o"</span>
                              <span class="ss">:face</span> <span class="ss">'all-the-icons-dsilver</span>
                              <span class="ss">:height</span> <span class="mf">1.0</span><span class="p">)</span>
      <span class="nv">icon</span><span class="p">)))</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:override</span> <span class="nv">skk-setup-modeline</span> <span class="nv">my:skk-setup-modeline</span><span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">powerline-buffer-size-suffix</span>  <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">powerline-display-hud</span>         <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">powerline-display-buffer-size</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">powerline-text-scale-factor</span>   <span class="o">.</span>  <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:powerline-theme</span> <span class="p">()</span>
    <span class="s">"Setup the default mode-line."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">my:powerline-ddskk</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">setq-default</span>
     <span class="nv">mode-line-format</span>
     <span class="o">'</span><span class="p">(</span><span class="s">"%e"</span>
       <span class="p">(</span><span class="ss">:eval</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">active</span> <span class="p">(</span><span class="nv">powerline-selected-window-active</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">mode-line-buffer-id</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'mode-line-buffer-id</span> <span class="ss">'mode-line-buffer-id-inactive</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">mode-line</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'mode-line</span> <span class="ss">'mode-line-inactive</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">face0</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'powerline-active0</span> <span class="ss">'powerline-inactive0</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">face1</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'powerline-active1</span> <span class="ss">'powerline-inactive1</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">face2</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'powerline-active2</span> <span class="ss">'powerline-inactive2</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">lhs</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">powerline-raw</span> <span class="p">(</span><span class="nv">substring</span> <span class="nv">skk-modeline-input-mode</span> <span class="mi">2</span> <span class="mi">-1</span><span class="p">)</span> <span class="nv">mode-line</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">"%*"</span> <span class="nv">mode-line</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="nv">mode-line-mule-info</span> <span class="nv">mode-line</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="p">(</span><span class="nv">my:major-mode-icon</span> <span class="nv">major-mode</span><span class="p">)</span> <span class="nv">mode-line</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-buffer-id</span> <span class="nv">mode-line-buffer-id</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">" "</span><span class="p">)</span>
                          <span class="p">))</span>
               <span class="p">(</span><span class="nv">rhs</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">powerline-raw</span> <span class="nv">global-mode-string</span> <span class="nv">face1</span> <span class="ss">'r</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-vc</span> <span class="nv">face1</span> <span class="ss">'r</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">" "</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">"%6p"</span> <span class="nv">mode-line</span> <span class="ss">'r</span><span class="p">)</span>
                          <span class="p">)))</span>
          <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">powerline-render</span> <span class="nv">lhs</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">powerline-fill</span> <span class="nv">face2</span> <span class="p">(</span><span class="nv">powerline-width</span> <span class="nv">rhs</span><span class="p">))</span>
                  <span class="p">(</span><span class="nv">powerline-render</span> <span class="nv">rhs</span><span class="p">))))))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">my:powerline-theme</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgce78777d">theme: <code>modus-theme</code>
</h3>
<div class="outline-text-3" id="text-orgce78777d">
<p>
最近乗り換えた.
じたばたしているのは背景透過と Wanderlust の face の追加, かな?
あとはデフォルトの font-lock を(好みに合わせて)入れ替えたり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">modus-themes</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">(</span><span class="s">"&lt;f5&gt;"</span> <span class="o">.</span> <span class="nv">modus-themes-toggle</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">modus-themes-load-themes</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">modus-themes-load-vivendi</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:set-background</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">frame</span><span class="p">)</span>
    <span class="s">"Unsets the background color for transparency"</span>
    <span class="p">(</span><span class="nb">or</span> <span class="nv">frame</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">frame</span> <span class="p">(</span><span class="nv">selected-frame</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">display-graphic-p</span> <span class="nv">frame</span><span class="p">)</span>
        <span class="p">(</span><span class="k">progn</span>
          <span class="p">(</span><span class="nv">set-frame-parameter</span> <span class="no">nil</span> <span class="ss">'alpha</span> <span class="o">'</span><span class="p">(</span><span class="mi">80</span>  <span class="mi">50</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'default-frame-alist</span> <span class="o">'</span><span class="p">(</span><span class="nv">alpha</span> <span class="mi">80</span> <span class="mi">50</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">set-face-background</span> <span class="ss">'default</span> <span class="s">"unspecified-bg"</span> <span class="nv">frame</span><span class="p">)))</span>
  <span class="c1">;; (my:modus-themes-custom-faces)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:modus-themes-custom-faces</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">modus-themes-with-colors</span>
      <span class="p">(</span><span class="nv">custom-set-faces</span>
       <span class="c1">;;</span>
       <span class="c1">;; `(modus-themes-hl-line ((,class ,@(modus-themes--hl-line</span>
       <span class="c1">;;                                    bg-hl-line bg-hl-line-intense</span>
       <span class="c1">;;                                    bg-hl-line-intense-accent blue-nuanced-bg</span>
       <span class="c1">;;                                    bg-region blue-intense-bg</span>
       <span class="c1">;;                                    fg-alt cyan-intense)</span>
       <span class="c1">;;                                 :extend t)))</span>
       <span class="c1">;; `(hl-line ((,class :background "#556b2f")))</span>
       <span class="c1">;;</span>
       <span class="c1">;; preprocessor → builtin</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-builtin-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-extra</span>
                                              <span class="nv">blue-alt-other</span> <span class="nv">blue-alt-other-faint</span>
                                              <span class="nv">blue-alt</span> <span class="nv">blue-alt-faint</span><span class="p">))))</span>
       <span class="c1">;; preprocessor:: red</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-preprocessor-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="nv">modus-themes-bold</span>
                                         <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-extra</span>
                                            <span class="nv">red-alt</span> <span class="nv">red-alt-faint</span>
                                            <span class="nv">red-intense</span> <span class="nv">red-faint</span><span class="p">))))</span>
       <span class="c1">;; constant → function</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-function-name-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-extra</span>
                                             <span class="nv">blue-alt-other</span> <span class="nv">blue-alt-other-faint</span>
                                             <span class="nv">magenta-alt-other</span> <span class="nv">magenta-alt-other-faint</span><span class="p">))))</span>
       <span class="c1">;; constant :: custom</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-constant-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-extra</span>
                                             <span class="nv">orange-intense</span> <span class="nv">orange-intense</span>
                                             <span class="nv">orange-intense</span> <span class="nv">orange-intense</span><span class="p">))))</span>
       <span class="c1">;; keyword → string</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-string-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="nv">modus-themes-bold</span>
                                        <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-extra</span>
                                           <span class="nv">magenta-alt-other</span> <span class="nv">magenta-alt-other-faint</span>
                                           <span class="nv">cyan</span> <span class="nv">cyan-faint</span><span class="p">))))</span>
       <span class="c1">;; keyword :: custom</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-keyword-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="nv">modus-themes-bold</span>
                                         <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-extra</span>
                                            <span class="nv">red-alt-other</span> <span class="nv">red-alt-other-faint</span>
                                            <span class="nv">red-alt-other</span> <span class="nv">red-alt-other-faint</span><span class="p">))))</span>
       <span class="c1">;; type → negation-char</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-negation-char-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="nv">modus-themes-bold</span>
                                      <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-foreground</span>
                                         <span class="nv">cyan-alt-other</span> <span class="nv">cyan-alt-faint</span><span class="p">))))</span>
       <span class="c1">;; type :: custom</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-type-face</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="nv">modus-themes-bold</span>
                                      <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-foreground</span>
                                         <span class="nv">yellow-intense</span> <span class="nv">yellow-faint</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-regexp-grouping-backslash</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="nv">bold</span>
                                                      <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span>
                                                         <span class="nv">fg-escape-char-backslash</span> <span class="nv">fg-escape-char-backslash</span>
                                                         <span class="nv">fg-escape-char-backslash</span> <span class="nv">fg-escape-char-backslash</span>
                                                         <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">font-lock-regexp-grouping-construct</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="nv">bold</span>
                                                      <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span>
                                                         <span class="nv">fg-escape-char-construct</span> <span class="nv">fg-escape-char-construct</span>
                                                         <span class="nv">fg-escape-char-construct</span> <span class="nv">fg-escape-char-construct</span>
                                                         <span class="p">))))</span>
       <span class="c1">;; カスタマイズ済みなので上書き</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-agenda-date-weekend</span>
         <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="ss">'default</span> <span class="ss">:foreground</span> <span class="s">"#ff7f7f"</span> <span class="ss">:bold</span> <span class="no">t</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-agenda-date</span>
         <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="ss">'default</span> <span class="ss">:foreground</span> <span class="s">"#ffffff"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-agenda-date-today</span>
         <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:inherit</span> <span class="ss">'default</span> <span class="ss">:foreground</span> <span class="s">"#ffffff"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="ss">:underline</span><span class="p">)))</span>
       <span class="c1">;; 不要</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-block-begin-line</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:background</span> <span class="no">nil</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-block-end-line</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:background</span> <span class="no">nil</span><span class="p">)))</span>
       <span class="c1">;; shell の lscolors に揃える.</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">dired-directory</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:foreground</span> <span class="s">"#7f7fff"</span> <span class="ss">:bold</span> <span class="no">t</span><span class="p">)))</span>
       <span class="c1">;;</span>
       <span class="c1">;; wanderlust</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-closed-face</span>                  <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">green-alt-other</span> <span class="nv">green-alt-other</span> <span class="nv">green-alt-other</span> <span class="nv">green-alt-other</span> <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-few-face</span>                     <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">red-alt-other</span> <span class="nv">red-alt-other</span> <span class="nv">red-alt-other</span> <span class="nv">red-alt-other</span> <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-killed-face</span>                  <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-alt</span> <span class="nv">fg-alt</span> <span class="nv">fg-alt</span> <span class="nv">fg-alt</span> <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-many-face</span>                    <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">magenta</span> <span class="nv">magenta</span> <span class="nv">magenta</span> <span class="nv">magenta</span> <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-opened-face</span>                  <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">cyan-alt-other</span> <span class="nv">cyan-alt-other</span> <span class="nv">cyan-alt-other</span> <span class="nv">cyan-alt-other</span> <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-path-face</span>                    <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:underline</span> <span class="no">t</span> <span class="ss">:bold</span> <span class="no">t</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-unknown-face</span>                 <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">cyan-alt</span> <span class="nv">cyan-alt</span> <span class="nv">cyan-alt</span> <span class="nv">cyan-alt</span> <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-unread-face</span>                  <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">blue-alt</span> <span class="nv">blue-alt</span> <span class="nv">blue-alt</span> <span class="nv">blue-alt</span> <span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-zero-face</span>                    <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-citation-header</span>             <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">green-active</span> <span class="nv">green-active</span> <span class="nv">green-active</span> <span class="nv">green-active</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-1</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-2</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-3</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-4</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-5</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">purple-intense</span> <span class="nv">purple-intense</span> <span class="nv">purple-intense</span> <span class="nv">purple-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-6</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-7</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-8</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-9</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-10</span>               <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-header-contents</span>             <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">purple-intense</span> <span class="nv">purple-intense</span> <span class="nv">purple-intense</span> <span class="nv">purple-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-headers</span>                     <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span> <span class="nv">cyan-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-important-header-contents</span>   <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-important-header-contents2</span>  <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-signature</span>                   <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-unimportant-header-contents</span> <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-answered-face</span>               <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span> <span class="nv">green-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-deleted-face</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span> <span class="nv">blue-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-disposed-face</span>               <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span> <span class="nv">fg-dim</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-flagged-face</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span> <span class="nv">yellow-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-high-unread-face</span>            <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-low-unread-face</span>             <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-normal-face</span>                 <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-refiled-face</span>                <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">blue-alt</span> <span class="nv">blue-alt</span> <span class="nv">blue-alt</span> <span class="nv">blue-alt</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-spam-face</span>                   <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span> <span class="nv">magenta-intense</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-thread-top-face</span>             <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span><span class="p">))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-unread-face</span>                 <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span> <span class="nv">fg-main</span><span class="p">))))</span>
       <span class="c1">;; `(wl-highlight-header-separator-face               ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-logo-face                           ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-summary-copied-face                 ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-displaying-face</span>             <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="ss">:underline</span> <span class="no">t</span> <span class="ss">:bold</span> <span class="no">t</span><span class="p">)))</span>
       <span class="c1">;; `(wl-highlight-summary-resend-face                 ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-summary-prefetch-face               ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-summary-target-face                 ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-summary-temp-face                   ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-new-face</span>                    <span class="p">((</span><span class="o">,</span><span class="nc">class</span> <span class="o">,@</span><span class="p">(</span><span class="nv">modus-themes--syntax-string</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span> <span class="nv">red-intense</span><span class="p">))))</span>
       <span class="c1">;; `(wl-highlight-summary-killed-face                 ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-summary-low-read-face               ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-thread-indent-face                  ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-summary-forwarded-face              ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-highlight-summary-high-read-face              ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-message-header-narrowing-face                 ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;; `(wl-summary-persistent-mark-face                  ((,class ,@(modus-themes--syntax-string fg-main fg-main fg-main fg-main))))</span>
       <span class="c1">;;</span>
       <span class="p">)))</span>
  <span class="ss">:advice</span>
  <span class="p">((</span><span class="ss">:after</span>
    <span class="nv">modus-themes-load-vivendi</span>
    <span class="nv">my:set-background</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">:after</span>
    <span class="nv">modus-themes-load-operandi</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">set-face-background</span> <span class="ss">'default</span> <span class="s">"#FFFFFF"</span> <span class="p">)))</span>
   <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">modus-themes-after-load-theme-hook</span>
     <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
         <span class="p">(</span><span class="nv">my:modus-themes-custom-faces</span><span class="p">)</span>
         <span class="p">))</span>
    <span class="p">(</span><span class="nv">window-setup-hook</span> <span class="o">.</span> <span class="nv">my:set-background</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">tty-setup-hook</span> <span class="o">.</span> <span class="nv">my:set-background</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:custom</span>
  <span class="o">`</span><span class="p">(</span>
    <span class="p">(</span><span class="nv">modus-themes-inhibit-reload</span>          <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">modus-themes-success-deuteranopia</span>    <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-bold-constructs</span>         <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-italic-constructs</span>       <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-syntax</span>                  <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">alt-syntax</span> <span class="nv">green-strings</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-no-mixed-fonts</span>          <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">modus-themes-links</span>                   <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">neutral-underline</span> <span class="nv">bold</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-prompts</span>                 <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">intense</span> <span class="nv">bold</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-mode-line</span>               <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">borderless</span> <span class="nv">accented</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-tabs-accented</span>           <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">modus-themes-completions</span>             <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-mail-citations</span>          <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-fringes</span>                 <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-lang-checkers</span>           <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">straight-underline</span> <span class="nv">intense</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-hl-line</span>                 <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">accented</span> <span class="nv">intense</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-subtle-line-numbers</span>     <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-paren-match</span>             <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">bold</span> <span class="nv">intense</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-region</span>                  <span class="o">.</span> <span class="o">'</span><span class="p">(</span><span class="nv">accented</span> <span class="nv">no-extend</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">modus-themes-diffs</span>                   <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-org-blocks</span>              <span class="o">.</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; default</span>
    <span class="p">(</span><span class="nv">modus-themes-org-agenda</span>              <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">modus-themes-headings</span>                <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="nv">rainbow</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">modus-themes-scale-headings</span>          <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">modus-themes-variable-pitch-ui</span>       <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">modus-themes-variable-pitch-headings</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
    <span class="c1">;; (modus-themes-vivendi-color-overrides</span>
    <span class="c1">;;  . '(</span>
    <span class="c1">;;      (bg-hl-line-intense-accent . "#556b2f")</span>
    <span class="c1">;;      ))</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="orgd89ceb4b">Debug&amp;Test</h2>
<div class="outline-text-2" id="text-orgd89ceb4b">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">rg</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"rg"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="p">)</span>
<span class="c1">;;(leaf emacs</span>
<span class="c1">;;  :preface</span>
<span class="c1">;;  (defun my-advice/window-width (fn &amp;rest args)</span>
<span class="c1">;;    (- (apply fn args) 1))</span>
<span class="c1">;;  :advice (:around window-width my-advice/window-width))</span>
<span class="c1">;;</span>
<span class="c1">;; (leaf elfeed</span>
<span class="c1">;;   :if (file-directory-p my:d:password-store)</span>
<span class="c1">;;   :ensure t</span>
<span class="c1">;;   :custom</span>
<span class="c1">;;   `((elfeed-set-timeout  . 36000)</span>
<span class="c1">;;     (elfeed-db-directory . "~/.cache/elfeed"))</span>
<span class="c1">;;   :config</span>
<span class="c1">;;   (leaf elfeed-goodies</span>
<span class="c1">;;     :ensure t</span>
<span class="c1">;;     :config</span>
<span class="c1">;;     (elfeed-goodies/setup))</span>
<span class="c1">;;   ;;</span>
<span class="c1">;;   (leaf elfeed-protocol</span>
<span class="c1">;;     :ensure t</span>
<span class="c1">;;     :config</span>
<span class="c1">;;     (setq elfeed-feeds</span>
<span class="c1">;;           '(("owncloud+https://uwabami@uwabami.junkhub.org/nextcloud"</span>
<span class="c1">;;              :password (password-store-get "Web/uwabami.junkhub.org/nextcloud")</span>
<span class="c1">;;              )</span>
<span class="c1">;;             ))</span>
<span class="c1">;;     (elfeed-protocol-enable)</span>
<span class="c1">;;     )</span>
<span class="c1">;;   )</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">vterm</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">vterm-mode-hook</span>
   <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">global-hl-line-mode</span> <span class="no">nil</span><span class="p">)))</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">keg</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">keg-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">esup</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:custom</span>
  <span class="p">((</span><span class="nv">esup-insignificant-time</span> <span class="o">.</span> <span class="mf">0.01</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">esup-depth</span>              <span class="o">.</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">;; 🤔</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgca1f29da">起動時間の出力</h2>
<div class="outline-text-2" id="text-orgca1f29da">
<p>
<a href="http://memo.sugyan.com/entry/20120120/1327037494">起動時間を計測する 改訂版 - すぎゃーんメモ</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*show-startup-time</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span>
   <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
       <span class="p">(</span><span class="nv">message</span> <span class="s">"init time: %.3f sec"</span>
                <span class="p">(</span><span class="nv">float-time</span> <span class="p">(</span><span class="nv">time-subtract</span> <span class="nv">after-init-time</span> <span class="nv">before-init-time</span><span class="p">)))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgf87c4e84">最後に</h2>
<div class="outline-text-2" id="text-orgf87c4e84">
</div>
<div>
<h3 id="org8d339cf7">profiler report</h3>
<div class="outline-text-3" id="text-org8d339cf7">
<p>
これも必要に応じて
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (profiler-report)</span>
<span class="c1">;; (profiler-stop)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org4c97a1e0">provide の設定</h3>
<div class="outline-text-3" id="text-org4c97a1e0">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">provide</span> <span class="ss">'init</span><span class="p">)</span>
<span class="c1">;; Local Variables:</span>
<span class="c1">;; byte-compile-warnings: (not obsolete cl-functions)</span>
<span class="c1">;; End:</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orge8960401">LICENSE</h3>
<div class="outline-text-3" id="text-orge8960401">
<p>
幾つかの関数の元ネタとして Emacs 本体のコードを参照したので,
GPL-3 or later です．
</p>
<pre class="example">
Copyright (C) 2011--2017 Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;
.
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
.
This package is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.
You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.
</pre>
</div>
</div>
</div>

        </div>
      </main>
      <a href="#" class="back_to_top">Back to Top &#9650;</a>
      <hr/>
      <footer>
        <p>&copy; 2006-2021
  <a href="mailto:uwabami@gfd-dennou.org">Youhei SASAKI</a>,
  Lastupdate: 2021-09-30 20:23:49 +0000
  <br/>
  Powered by
  <a href="https://orgmode.org/" rel="noopener" title="Org mode">
    Org mode
  </a>
  +
  <a href="https://jekyllrb.com/" rel="noopener" title="Jekyll">
    Jekyll
  </a>
  +
  <a href="https://picocss.com/" rel="noopener" title="pico.css">
    Pico.css
  </a>
  &amp;
  <a href="https://amp.dev/">
    <span class="icon-amp">⚡</span>AMP
  </a>
</p>

      </footer>
    </div>
    <amp-analytics data-block-on-consent
               type="googleanalytics"
               config="https://uwabami.github.io/assets/ga4.json"
               data-credentials="include"
		       data-block-on-consent>
  <script type="application/json">
    {
        "vars": {
            "GA4_MEASUREMENT_ID": "G-CLB2VW9XEW",
            "GA4_ENDPOINT_HOSTNAME": "www.google-analytics.com",
            "DEFAULT_PAGEVIEW_ENABLED": true,
            "GOOGLE_CONSENT_ENABLED": true,
            "WEBVITALS_TRACKING": false,
            "PERFORMANCE_TIMING_TRACKING": false
        }
    }
  </script>
</amp-analytics>

  </body>
</html>
