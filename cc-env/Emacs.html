<!doctype html>
<html ⚡ lang="ja" data-theme="light">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="preconnect dns-prefetch" href="//cdn.ampproject.org" crossorigin>
    <link rel="preconnect dns-prefetch" href="//uwabami.github.io/" crossorigin>
    <!-- amp preload -->
    <link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js">
    <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/ComicNeueSubset.woff2" crossorigin>
    <!-- end amp preload -->
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-geo" src="https://cdn.ampproject.org/v0/amp-geo-0.1.js"></script>
    <script async custom-element="amp-consent" src="https://cdn.ampproject.org/v0/amp-consent-0.1.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-form" src="https://cdn.ampproject.org/v0/amp-form-0.1.js"></script>



    <style amp-custom>/*! * Pico CSS ✨ v2.1.1 (https://picocss.com) * Copyright 2019-2025 - Licensed under MIT */:root,:host{--pico-font-family-emoji:"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--pico-font-family-sans-serif:system-ui,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,Helvetica,Arial,"Helvetica Neue",sans-serif,var(--pico-font-family-emoji);--pico-font-family-monospace:ui-monospace,SFMono-Regular,"SF Mono",Menlo,Consolas,"Liberation Mono",monospace,var(--pico-font-family-emoji);--pico-font-family:var(--pico-font-family-sans-serif);--pico-line-height:1.5;--pico-font-weight:400;--pico-font-size:100%;--pico-text-underline-offset:.1rem;--pico-border-radius:.25rem;--pico-border-width:.0625rem;--pico-outline-width:.125rem;--pico-transition:.2s ease-in-out;--pico-spacing:1rem;--pico-typography-spacing-vertical:1rem;--pico-block-spacing-vertical:var(--pico-spacing);--pico-block-spacing-horizontal:var(--pico-spacing);--pico-grid-column-gap:var(--pico-spacing);--pico-grid-row-gap:var(--pico-spacing);--pico-form-element-spacing-vertical:.75rem;--pico-form-element-spacing-horizontal:1rem;--pico-nav-element-spacing-vertical:1rem;--pico-nav-element-spacing-horizontal:.5rem;--pico-nav-link-spacing-vertical:.5rem;--pico-nav-link-spacing-horizontal:.5rem;--pico-nav-breadcrumb-divider:">";--pico-icon-chevron:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(136, 145, 164)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");--pico-icon-search:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(136, 145, 164)' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E")}@media(min-width: 576px){:root,:host{--pico-font-size:106.25%}}@media(min-width: 768px){:root,:host{--pico-font-size:112.5%}}@media(min-width: 1024px){:root,:host{--pico-font-size:118.75%}}@media(min-width: 1280px){:root,:host{--pico-font-size:125%}}@media(min-width: 1536px){:root,:host{--pico-font-size:131.25%}}a{--pico-text-decoration:underline}a.secondary,a.contrast{--pico-text-decoration:underline}small{--pico-font-size:.875em}h1,h2,h3,h4,h5,h6{--pico-font-weight:700}h1{--pico-font-size:2rem;--pico-line-height:1.125;--pico-typography-spacing-top:3rem}h2{--pico-font-size:1.75rem;--pico-line-height:1.15;--pico-typography-spacing-top:2.625rem}h3{--pico-font-size:1.5rem;--pico-line-height:1.175;--pico-typography-spacing-top:2.25rem}h4{--pico-font-size:1.25rem;--pico-line-height:1.2;--pico-typography-spacing-top:1.874rem}h5{--pico-font-size:1.125rem;--pico-line-height:1.225;--pico-typography-spacing-top:1.6875rem}h6{--pico-font-size:1rem;--pico-line-height:1.25;--pico-typography-spacing-top:1.5rem}thead th,thead td,tfoot th,tfoot td{--pico-font-weight:600;--pico-border-width:.1875rem}pre,code,kbd,samp{--pico-font-family:var(--pico-font-family-monospace)}kbd{--pico-font-weight:bolder}input:not([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[type=file]),:where(select,textarea){--pico-outline-width:.0625rem}[type=search]{--pico-border-radius:5rem}details.dropdown summary:not([role=button]){--pico-outline-width:.0625rem}nav details.dropdown summary:focus-visible{--pico-outline-width:.125rem}details summary[role=button]:not(.outline)::after{filter:brightness(0) invert(1)}[data-theme=light],:root:not([data-theme=dark]),:host(:not([data-theme=dark])){color-scheme:light;--pico-background-color:#fff;--pico-color:#373c44;--pico-text-selection-color:rgba(2,154,232,.25);--pico-muted-color:#646b79;--pico-muted-border-color:rgb(231, 234, 239.5);--pico-primary:#0172ad;--pico-primary-background:#0172ad;--pico-primary-border:var(--pico-primary-background);--pico-primary-underline:rgba(1,114,173,.5);--pico-primary-hover:#015887;--pico-primary-hover-background:#02659a;--pico-primary-hover-border:var(--pico-primary-hover-background);--pico-primary-hover-underline:var(--pico-primary-hover);--pico-primary-focus:rgba(2,154,232,.5);--pico-primary-inverse:#fff;--pico-secondary:#5d6b89;--pico-secondary-background:#525f7a;--pico-secondary-border:var(--pico-secondary-background);--pico-secondary-underline:rgba(93, 107, 137, 0.5);--pico-secondary-hover:#48536b;--pico-secondary-hover-background:#48536b;--pico-secondary-hover-border:var(--pico-secondary-hover-background);--pico-secondary-hover-underline:var(--pico-secondary-hover);--pico-secondary-focus:rgba(93, 107, 137, 0.25);--pico-secondary-inverse:#fff;--pico-contrast:#181c25;--pico-contrast-background:#181c25;--pico-contrast-border:var(--pico-contrast-background);--pico-contrast-underline:rgba(24, 28, 37, 0.5);--pico-contrast-hover:#000;--pico-contrast-hover-background:#000;--pico-contrast-hover-border:var(--pico-contrast-hover-background);--pico-contrast-hover-underline:var(--pico-secondary-hover);--pico-contrast-focus:rgba(93, 107, 137, 0.25);--pico-contrast-inverse:#fff;--pico-box-shadow:0.0145rem 0.029rem 0.174rem rgba(129, 145, 181, 0.01698),0.0335rem 0.067rem 0.402rem rgba(129, 145, 181, 0.024),0.0625rem 0.125rem 0.75rem rgba(129, 145, 181, 0.03),0.1125rem 0.225rem 1.35rem rgba(129, 145, 181, 0.036),0.2085rem 0.417rem 2.502rem rgba(129, 145, 181, 0.04302),0.5rem 1rem 6rem rgba(129, 145, 181, 0.06),0 0 0 .0625rem rgba(129, 145, 181, 0.015);--pico-h1-color:#2d3138;--pico-h2-color:#373c44;--pico-h3-color:#424751;--pico-h4-color:#4d535e;--pico-h5-color:#5c6370;--pico-h6-color:#646b79;--pico-mark-background-color:rgb(252.5, 230.5, 191.5);--pico-mark-color:#0f1114;--pico-ins-color:rgb(28.5, 105.5, 84);--pico-del-color:rgb(136, 56.5, 53);--pico-blockquote-border-color:var(--pico-muted-border-color);--pico-blockquote-footer-color:var(--pico-muted-color);--pico-button-box-shadow:0 0 0 rgba(0,0,0,0);--pico-button-hover-box-shadow:0 0 0 rgba(0,0,0,0);--pico-table-border-color:var(--pico-muted-border-color);--pico-table-row-stripped-background-color:rgba(111, 120, 135, 0.0375);--pico-code-background-color:rgb(243, 244.5, 246.75);--pico-code-color:#646b79;--pico-code-kbd-background-color:var(--pico-color);--pico-code-kbd-color:var(--pico-background-color);--pico-form-element-background-color:rgb(251, 251.5, 252.25);--pico-form-element-selected-background-color:#dfe3eb;--pico-form-element-border-color:#cfd5e2;--pico-form-element-color:#23262c;--pico-form-element-placeholder-color:var(--pico-muted-color);--pico-form-element-active-background-color:#fff;--pico-form-element-active-border-color:var(--pico-primary-border);--pico-form-element-focus-color:var(--pico-primary-border);--pico-form-element-disabled-opacity:.5;--pico-form-element-invalid-border-color:rgb(183.5, 105.5, 106.5);--pico-form-element-invalid-active-border-color:rgb(200.25, 79.25, 72.25);--pico-form-element-invalid-focus-color:var(--pico-form-element-invalid-active-border-color);--pico-form-element-valid-border-color:rgb(76, 154.5, 137.5);--pico-form-element-valid-active-border-color:rgb(39, 152.75, 118.75);--pico-form-element-valid-focus-color:var(--pico-form-element-valid-active-border-color);--pico-dropdown-background-color:#fff;--pico-dropdown-border-color:#eff1f4;--pico-dropdown-box-shadow:var(--pico-box-shadow);--pico-dropdown-color:var(--pico-color);--pico-dropdown-hover-background-color:#eff1f4;--pico-icon-valid:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(76, 154.5, 137.5)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");--pico-icon-invalid:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(200.25, 79.25, 72.25)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E")}[data-theme=light] input:is([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[type=file]),:root:not([data-theme=dark]) input:is([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[type=file]),:host(:not([data-theme=dark])) input:is([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[type=file]){--pico-form-element-focus-color:var(--pico-primary-focus)}@media only screen and (prefers-color-scheme: dark){:root:not([data-theme]),:host(:not([data-theme])){color-scheme:dark;--pico-background-color:rgb(19, 22.5, 30.5);--pico-color:#c2c7d0;--pico-text-selection-color:rgba(1,170,255,.1875);--pico-muted-color:#7b8495;--pico-muted-border-color:#202632;--pico-primary:#01aaff;--pico-primary-background:#0172ad;--pico-primary-border:var(--pico-primary-background);--pico-primary-underline:rgba(1,170,255,.5);--pico-primary-hover:#79c0ff;--pico-primary-hover-background:#017fc0;--pico-primary-hover-border:var(--pico-primary-hover-background);--pico-primary-hover-underline:var(--pico-primary-hover);--pico-primary-focus:rgba(1,170,255,.375);--pico-primary-inverse:#fff;--pico-secondary:#969eaf;--pico-secondary-background:#525f7a;--pico-secondary-border:var(--pico-secondary-background);--pico-secondary-underline:rgba(150, 158, 175, 0.5);--pico-secondary-hover:#b3b9c5;--pico-secondary-hover-background:#5d6b89;--pico-secondary-hover-border:var(--pico-secondary-hover-background);--pico-secondary-hover-underline:var(--pico-secondary-hover);--pico-secondary-focus:rgba(144, 158, 190, 0.25);--pico-secondary-inverse:#fff;--pico-contrast:#dfe3eb;--pico-contrast-background:#eff1f4;--pico-contrast-border:var(--pico-contrast-background);--pico-contrast-underline:rgba(223, 227, 235, 0.5);--pico-contrast-hover:#fff;--pico-contrast-hover-background:#fff;--pico-contrast-hover-border:var(--pico-contrast-hover-background);--pico-contrast-hover-underline:var(--pico-contrast-hover);--pico-contrast-focus:rgba(207, 213, 226, 0.25);--pico-contrast-inverse:#000;--pico-box-shadow:0.0145rem 0.029rem 0.174rem rgba(7, 8.5, 12, 0.01698),0.0335rem 0.067rem 0.402rem rgba(7, 8.5, 12, 0.024),0.0625rem 0.125rem 0.75rem rgba(7, 8.5, 12, 0.03),0.1125rem 0.225rem 1.35rem rgba(7, 8.5, 12, 0.036),0.2085rem 0.417rem 2.502rem rgba(7, 8.5, 12, 0.04302),0.5rem 1rem 6rem rgba(7, 8.5, 12, 0.06),0 0 0 .0625rem rgba(7, 8.5, 12, 0.015);--pico-h1-color:#f0f1f3;--pico-h2-color:#e0e3e7;--pico-h3-color:#c2c7d0;--pico-h4-color:#b3b9c5;--pico-h5-color:#a4acba;--pico-h6-color:#8891a4;--pico-mark-background-color:#014063;--pico-mark-color:#fff;--pico-ins-color:#62af9a;--pico-del-color:rgb(205.5, 126, 123);--pico-blockquote-border-color:var(--pico-muted-border-color);--pico-blockquote-footer-color:var(--pico-muted-color);--pico-button-box-shadow:0 0 0 rgba(0,0,0,0);--pico-button-hover-box-shadow:0 0 0 rgba(0,0,0,0);--pico-table-border-color:var(--pico-muted-border-color);--pico-table-row-stripped-background-color:rgba(111, 120, 135, 0.0375);--pico-code-background-color:rgb(26, 30.5, 40.25);--pico-code-color:#8891a4;--pico-code-kbd-background-color:var(--pico-color);--pico-code-kbd-color:var(--pico-background-color);--pico-form-element-background-color:rgb(28, 33, 43.5);--pico-form-element-selected-background-color:#2a3140;--pico-form-element-border-color:#2a3140;--pico-form-element-color:#e0e3e7;--pico-form-element-placeholder-color:#8891a4;--pico-form-element-active-background-color:rgb(26, 30.5, 40.25);--pico-form-element-active-border-color:var(--pico-primary-border);--pico-form-element-focus-color:var(--pico-primary-border);--pico-form-element-disabled-opacity:.5;--pico-form-element-invalid-border-color:rgb(149.5, 74, 80);--pico-form-element-invalid-active-border-color:rgb(183.25, 63.5, 59);--pico-form-element-invalid-focus-color:var(--pico-form-element-invalid-active-border-color);--pico-form-element-valid-border-color:#2a7b6f;--pico-form-element-valid-active-border-color:rgb(22, 137, 105.5);--pico-form-element-valid-focus-color:var(--pico-form-element-valid-active-border-color);--pico-dropdown-background-color:#181c25;--pico-dropdown-border-color:#202632;--pico-dropdown-box-shadow:var(--pico-box-shadow);--pico-dropdown-color:var(--pico-color);--pico-dropdown-hover-background-color:#202632;--pico-icon-valid:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(42, 123, 111)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");--pico-icon-invalid:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(149.5, 74, 80)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E")}:root:not([data-theme]) input:is([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[type=file]),:host(:not([data-theme])) input:is([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[type=file]){--pico-form-element-focus-color:var(--pico-primary-focus)}:root:not([data-theme]) details summary[role=button].contrast:not(.outline)::after,:host(:not([data-theme])) details summary[role=button].contrast:not(.outline)::after{filter:brightness(0)}}[data-theme=dark]{color-scheme:dark;--pico-background-color:rgb(19, 22.5, 30.5);--pico-color:#c2c7d0;--pico-text-selection-color:rgba(1,170,255,.1875);--pico-muted-color:#7b8495;--pico-muted-border-color:#202632;--pico-primary:#01aaff;--pico-primary-background:#0172ad;--pico-primary-border:var(--pico-primary-background);--pico-primary-underline:rgba(1,170,255,.5);--pico-primary-hover:#79c0ff;--pico-primary-hover-background:#017fc0;--pico-primary-hover-border:var(--pico-primary-hover-background);--pico-primary-hover-underline:var(--pico-primary-hover);--pico-primary-focus:rgba(1,170,255,.375);--pico-primary-inverse:#fff;--pico-secondary:#969eaf;--pico-secondary-background:#525f7a;--pico-secondary-border:var(--pico-secondary-background);--pico-secondary-underline:rgba(150, 158, 175, 0.5);--pico-secondary-hover:#b3b9c5;--pico-secondary-hover-background:#5d6b89;--pico-secondary-hover-border:var(--pico-secondary-hover-background);--pico-secondary-hover-underline:var(--pico-secondary-hover);--pico-secondary-focus:rgba(144, 158, 190, 0.25);--pico-secondary-inverse:#fff;--pico-contrast:#dfe3eb;--pico-contrast-background:#eff1f4;--pico-contrast-border:var(--pico-contrast-background);--pico-contrast-underline:rgba(223, 227, 235, 0.5);--pico-contrast-hover:#fff;--pico-contrast-hover-background:#fff;--pico-contrast-hover-border:var(--pico-contrast-hover-background);--pico-contrast-hover-underline:var(--pico-contrast-hover);--pico-contrast-focus:rgba(207, 213, 226, 0.25);--pico-contrast-inverse:#000;--pico-box-shadow:0.0145rem 0.029rem 0.174rem rgba(7, 8.5, 12, 0.01698),0.0335rem 0.067rem 0.402rem rgba(7, 8.5, 12, 0.024),0.0625rem 0.125rem 0.75rem rgba(7, 8.5, 12, 0.03),0.1125rem 0.225rem 1.35rem rgba(7, 8.5, 12, 0.036),0.2085rem 0.417rem 2.502rem rgba(7, 8.5, 12, 0.04302),0.5rem 1rem 6rem rgba(7, 8.5, 12, 0.06),0 0 0 .0625rem rgba(7, 8.5, 12, 0.015);--pico-h1-color:#f0f1f3;--pico-h2-color:#e0e3e7;--pico-h3-color:#c2c7d0;--pico-h4-color:#b3b9c5;--pico-h5-color:#a4acba;--pico-h6-color:#8891a4;--pico-mark-background-color:#014063;--pico-mark-color:#fff;--pico-ins-color:#62af9a;--pico-del-color:rgb(205.5, 126, 123);--pico-blockquote-border-color:var(--pico-muted-border-color);--pico-blockquote-footer-color:var(--pico-muted-color);--pico-button-box-shadow:0 0 0 rgba(0,0,0,0);--pico-button-hover-box-shadow:0 0 0 rgba(0,0,0,0);--pico-table-border-color:var(--pico-muted-border-color);--pico-table-row-stripped-background-color:rgba(111, 120, 135, 0.0375);--pico-code-background-color:rgb(26, 30.5, 40.25);--pico-code-color:#8891a4;--pico-code-kbd-background-color:var(--pico-color);--pico-code-kbd-color:var(--pico-background-color);--pico-form-element-background-color:rgb(28, 33, 43.5);--pico-form-element-selected-background-color:#2a3140;--pico-form-element-border-color:#2a3140;--pico-form-element-color:#e0e3e7;--pico-form-element-placeholder-color:#8891a4;--pico-form-element-active-background-color:rgb(26, 30.5, 40.25);--pico-form-element-active-border-color:var(--pico-primary-border);--pico-form-element-focus-color:var(--pico-primary-border);--pico-form-element-disabled-opacity:.5;--pico-form-element-invalid-border-color:rgb(149.5, 74, 80);--pico-form-element-invalid-active-border-color:rgb(183.25, 63.5, 59);--pico-form-element-invalid-focus-color:var(--pico-form-element-invalid-active-border-color);--pico-form-element-valid-border-color:#2a7b6f;--pico-form-element-valid-active-border-color:rgb(22, 137, 105.5);--pico-form-element-valid-focus-color:var(--pico-form-element-valid-active-border-color);--pico-dropdown-background-color:#181c25;--pico-dropdown-border-color:#202632;--pico-dropdown-box-shadow:var(--pico-box-shadow);--pico-dropdown-color:var(--pico-color);--pico-dropdown-hover-background-color:#202632;--pico-icon-valid:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(42, 123, 111)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");--pico-icon-invalid:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(149.5, 74, 80)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E")}[data-theme=dark] input:is([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[type=file]){--pico-form-element-focus-color:var(--pico-primary-focus)}[data-theme=dark] details summary[role=button].contrast:not(.outline)::after{filter:brightness(0)}progress,[type=checkbox],[type=radio],[type=range]{accent-color:var(--pico-primary)}*,*::before,*::after{box-sizing:border-box;background-repeat:no-repeat}::before,::after{text-decoration:inherit;vertical-align:inherit}:where(:root),:where(:host){-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-text-size-adjust:100%;text-size-adjust:100%;background-color:var(--pico-background-color);color:var(--pico-color);font-weight:var(--pico-font-weight);font-size:var(--pico-font-size);line-height:var(--pico-line-height);font-family:var(--pico-font-family);text-underline-offset:var(--pico-text-underline-offset);text-rendering:optimizeLegibility;overflow-wrap:break-word;tab-size:4}body{width:100%;margin:0}main{display:block}body>header,body>main,body>footer{width:100%;margin-right:auto;margin-left:auto;padding:var(--pico-block-spacing-vertical) var(--pico-block-spacing-horizontal)}@media(min-width: 576px){body>header,body>main,body>footer{max-width:510px;padding-right:0;padding-left:0}}@media(min-width: 768px){body>header,body>main,body>footer{max-width:700px}}@media(min-width: 1024px){body>header,body>main,body>footer{max-width:950px}}@media(min-width: 1280px){body>header,body>main,body>footer{max-width:1200px}}@media(min-width: 1536px){body>header,body>main,body>footer{max-width:1450px}}section{margin-bottom:var(--pico-block-spacing-vertical)}.container,.container-fluid{width:100%;margin-right:auto;margin-left:auto;padding-right:var(--pico-spacing);padding-left:var(--pico-spacing)}@media(min-width: 576px){.container{max-width:510px;padding-right:0;padding-left:0}}@media(min-width: 768px){.container{max-width:700px}}@media(min-width: 1024px){.container{max-width:950px}}@media(min-width: 1280px){.container{max-width:1200px}}@media(min-width: 1536px){.container{max-width:1450px}}.grid{grid-column-gap:var(--pico-grid-column-gap);grid-row-gap:var(--pico-grid-row-gap);display:grid;grid-template-columns:1fr}@media(min-width: 768px){.grid{grid-template-columns:repeat(auto-fit, minmax(0%, 1fr))}}.grid>*{min-width:0}b,strong{font-weight:bolder}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}address,blockquote,dl,ol,p,pre,table,ul{margin-top:0;margin-bottom:var(--pico-typography-spacing-vertical);color:var(--pico-color);font-style:normal;font-weight:var(--pico-font-weight)}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:var(--pico-typography-spacing-vertical);color:var(--pico-color);font-weight:var(--pico-font-weight);font-size:var(--pico-font-size);line-height:var(--pico-line-height);font-family:var(--pico-font-family)}h1{--pico-color:var(--pico-h1-color)}h2{--pico-color:var(--pico-h2-color)}h3{--pico-color:var(--pico-h3-color)}h4{--pico-color:var(--pico-h4-color)}h5{--pico-color:var(--pico-h5-color)}h6{--pico-color:var(--pico-h6-color)}:where(article,address,blockquote,dl,figure,form,ol,p,pre,table,ul)~:is(h1,h2,h3,h4,h5,h6){margin-top:var(--pico-typography-spacing-top)}p{margin-bottom:var(--pico-typography-spacing-vertical)}hgroup{margin-bottom:var(--pico-typography-spacing-vertical)}hgroup>*{margin-top:0;margin-bottom:0}hgroup>*:not(:first-child):last-child{--pico-color:var(--pico-muted-color);--pico-font-weight:unset;font-size:1rem}:where(ol,ul) li{margin-bottom:calc(var(--pico-typography-spacing-vertical)*.25)}:where(dl,ol,ul) :where(dl,ol,ul){margin:0;margin-top:calc(var(--pico-typography-spacing-vertical)*.25)}ul li{list-style:square}mark{padding:.125rem .25rem;background-color:var(--pico-mark-background-color);color:var(--pico-mark-color);vertical-align:baseline}blockquote{display:block;margin:var(--pico-typography-spacing-vertical) 0;padding:var(--pico-spacing);border-right:none;border-left:.25rem solid var(--pico-blockquote-border-color);border-inline-start:.25rem solid var(--pico-blockquote-border-color);border-inline-end:none}blockquote footer{margin-top:calc(var(--pico-typography-spacing-vertical)*.5);color:var(--pico-blockquote-footer-color)}abbr[title]{border-bottom:1px dotted;text-decoration:none;cursor:help}ins{color:var(--pico-ins-color);text-decoration:none}del{color:var(--pico-del-color)}::selection{background-color:var(--pico-text-selection-color)}:where(a:not([role=button])),[role=link]{--pico-color:var(--pico-primary);--pico-background-color:rgba(0,0,0,0);--pico-underline:var(--pico-primary-underline);outline:none;background-color:var(--pico-background-color);color:var(--pico-color);text-decoration:var(--pico-text-decoration);text-decoration-color:var(--pico-underline);text-underline-offset:.125em;transition:background-color var(--pico-transition),color var(--pico-transition),text-decoration var(--pico-transition),box-shadow var(--pico-transition)}:where(a:not([role=button])):is([aria-current]:not([aria-current=false]),:hover,:active,:focus),[role=link]:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-color:var(--pico-primary-hover);--pico-underline:var(--pico-primary-hover-underline);--pico-text-decoration:underline}:where(a:not([role=button])):focus-visible,[role=link]:focus-visible{box-shadow:0 0 0 var(--pico-outline-width) var(--pico-primary-focus)}:where(a:not([role=button])).secondary,[role=link].secondary{--pico-color:var(--pico-secondary);--pico-underline:var(--pico-secondary-underline)}:where(a:not([role=button])).secondary:is([aria-current]:not([aria-current=false]),:hover,:active,:focus),[role=link].secondary:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-color:var(--pico-secondary-hover);--pico-underline:var(--pico-secondary-hover-underline)}:where(a:not([role=button])).contrast,[role=link].contrast{--pico-color:var(--pico-contrast);--pico-underline:var(--pico-contrast-underline)}:where(a:not([role=button])).contrast:is([aria-current]:not([aria-current=false]),:hover,:active,:focus),[role=link].contrast:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-color:var(--pico-contrast-hover);--pico-underline:var(--pico-contrast-hover-underline)}a[role=button]{display:inline-block}button{margin:0;overflow:visible;font-family:inherit;text-transform:none}button,[type=submit],[type=reset],[type=button]{-webkit-appearance:button}button,[type=submit],[type=reset],[type=button],[type=file]::file-selector-button,[role=button]{--pico-background-color:var(--pico-primary-background);--pico-border-color:var(--pico-primary-border);--pico-color:var(--pico-primary-inverse);--pico-box-shadow:var(--pico-button-box-shadow, 0 0 0 rgba(0, 0, 0, 0));padding:var(--pico-form-element-spacing-vertical) var(--pico-form-element-spacing-horizontal);border:var(--pico-border-width) solid var(--pico-border-color);border-radius:var(--pico-border-radius);outline:none;background-color:var(--pico-background-color);box-shadow:var(--pico-box-shadow);color:var(--pico-color);font-weight:var(--pico-font-weight);font-size:1rem;line-height:var(--pico-line-height);text-align:center;text-decoration:none;cursor:pointer;user-select:none;transition:background-color var(--pico-transition),border-color var(--pico-transition),color var(--pico-transition),box-shadow var(--pico-transition)}button:is([aria-current]:not([aria-current=false])),button:is(:hover,:active,:focus),[type=submit]:is([aria-current]:not([aria-current=false])),[type=submit]:is(:hover,:active,:focus),[type=reset]:is([aria-current]:not([aria-current=false])),[type=reset]:is(:hover,:active,:focus),[type=button]:is([aria-current]:not([aria-current=false])),[type=button]:is(:hover,:active,:focus),[type=file]::file-selector-button:is([aria-current]:not([aria-current=false])),[type=file]::file-selector-button:is(:hover,:active,:focus),[role=button]:is([aria-current]:not([aria-current=false])),[role=button]:is(:hover,:active,:focus){--pico-background-color:var(--pico-primary-hover-background);--pico-border-color:var(--pico-primary-hover-border);--pico-box-shadow:var(--pico-button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0));--pico-color:var(--pico-primary-inverse)}button:focus,button:is([aria-current]:not([aria-current=false])):focus,[type=submit]:focus,[type=submit]:is([aria-current]:not([aria-current=false])):focus,[type=reset]:focus,[type=reset]:is([aria-current]:not([aria-current=false])):focus,[type=button]:focus,[type=button]:is([aria-current]:not([aria-current=false])):focus,[type=file]::file-selector-button:focus,[type=file]::file-selector-button:is([aria-current]:not([aria-current=false])):focus,[role=button]:focus,[role=button]:is([aria-current]:not([aria-current=false])):focus{--pico-box-shadow:var(--pico-button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0)),0 0 0 var(--pico-outline-width) var(--pico-primary-focus)}[type=submit],[type=reset],[type=button]{margin-bottom:var(--pico-spacing)}:is(button,[type=submit],[type=button],[role=button]).secondary,[type=reset],[type=file]::file-selector-button{--pico-background-color:var(--pico-secondary-background);--pico-border-color:var(--pico-secondary-border);--pico-color:var(--pico-secondary-inverse);cursor:pointer}:is(button,[type=submit],[type=button],[role=button]).secondary:is([aria-current]:not([aria-current=false]),:hover,:active,:focus),[type=reset]:is([aria-current]:not([aria-current=false]),:hover,:active,:focus),[type=file]::file-selector-button:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-background-color:var(--pico-secondary-hover-background);--pico-border-color:var(--pico-secondary-hover-border);--pico-color:var(--pico-secondary-inverse)}:is(button,[type=submit],[type=button],[role=button]).secondary:focus,:is(button,[type=submit],[type=button],[role=button]).secondary:is([aria-current]:not([aria-current=false])):focus,[type=reset]:focus,[type=reset]:is([aria-current]:not([aria-current=false])):focus,[type=file]::file-selector-button:focus,[type=file]::file-selector-button:is([aria-current]:not([aria-current=false])):focus{--pico-box-shadow:var(--pico-button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0)),0 0 0 var(--pico-outline-width) var(--pico-secondary-focus)}:is(button,[type=submit],[type=button],[role=button]).contrast{--pico-background-color:var(--pico-contrast-background);--pico-border-color:var(--pico-contrast-border);--pico-color:var(--pico-contrast-inverse)}:is(button,[type=submit],[type=button],[role=button]).contrast:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-background-color:var(--pico-contrast-hover-background);--pico-border-color:var(--pico-contrast-hover-border);--pico-color:var(--pico-contrast-inverse)}:is(button,[type=submit],[type=button],[role=button]).contrast:focus,:is(button,[type=submit],[type=button],[role=button]).contrast:is([aria-current]:not([aria-current=false])):focus{--pico-box-shadow:var(--pico-button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0)),0 0 0 var(--pico-outline-width) var(--pico-contrast-focus)}:is(button,[type=submit],[type=button],[role=button]).outline,[type=reset].outline{--pico-background-color:rgba(0,0,0,0);--pico-color:var(--pico-primary);--pico-border-color:var(--pico-primary)}:is(button,[type=submit],[type=button],[role=button]).outline:is([aria-current]:not([aria-current=false]),:hover,:active,:focus),[type=reset].outline:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-background-color:rgba(0,0,0,0);--pico-color:var(--pico-primary-hover);--pico-border-color:var(--pico-primary-hover)}:is(button,[type=submit],[type=button],[role=button]).outline.secondary,[type=reset].outline{--pico-color:var(--pico-secondary);--pico-border-color:var(--pico-secondary)}:is(button,[type=submit],[type=button],[role=button]).outline.secondary:is([aria-current]:not([aria-current=false]),:hover,:active,:focus),[type=reset].outline:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-color:var(--pico-secondary-hover);--pico-border-color:var(--pico-secondary-hover)}:is(button,[type=submit],[type=button],[role=button]).outline.contrast{--pico-color:var(--pico-contrast);--pico-border-color:var(--pico-contrast)}:is(button,[type=submit],[type=button],[role=button]).outline.contrast:is([aria-current]:not([aria-current=false]),:hover,:active,:focus){--pico-color:var(--pico-contrast-hover);--pico-border-color:var(--pico-contrast-hover)}:where(button,[type=submit],[type=reset],[type=button],[role=button])[disabled],:where(fieldset[disabled]) :is(button,[type=submit],[type=button],[type=reset],[role=button]){opacity:.5;pointer-events:none}:where(table){width:100%;border-collapse:collapse;border-spacing:0;text-indent:0}th,td{padding:calc(var(--pico-spacing)/2) var(--pico-spacing);border-bottom:var(--pico-border-width) solid var(--pico-table-border-color);background-color:var(--pico-background-color);color:var(--pico-color);font-weight:var(--pico-font-weight);text-align:left;text-align:start}tfoot th,tfoot td{border-top:var(--pico-border-width) solid var(--pico-table-border-color);border-bottom:0}table.striped tbody tr:nth-child(odd) th,table.striped tbody tr:nth-child(odd) td{background-color:var(--pico-table-row-stripped-background-color)}:where(audio,canvas,iframe,img,svg,video){vertical-align:middle}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}:where(iframe){border-style:none}img{max-width:100%;height:auto;border-style:none}:where(svg:not([fill])){fill:currentColor}svg:not(:root),svg:not(:host){overflow:hidden}pre,code,kbd,samp{font-size:.875em;font-family:var(--pico-font-family)}pre code,pre samp{font-size:inherit;font-family:inherit}pre{-ms-overflow-style:scrollbar;overflow:auto}pre,code,kbd,samp{border-radius:var(--pico-border-radius);background:var(--pico-code-background-color);color:var(--pico-code-color);font-weight:var(--pico-font-weight);line-height:initial}code,kbd,samp{display:inline-block;padding:.375rem}pre{display:block;margin-bottom:var(--pico-spacing);overflow-x:auto}pre>code,pre>samp{display:block;padding:var(--pico-spacing);background:none;line-height:var(--pico-line-height)}kbd{background-color:var(--pico-code-kbd-background-color);color:var(--pico-code-kbd-color);vertical-align:baseline}hr{height:0;margin:var(--pico-typography-spacing-vertical) 0;border:0;border-top:1px solid var(--pico-muted-border-color);color:inherit}[hidden],template{display:none}canvas{display:inline-block}input,optgroup,select,textarea{margin:0;font-size:1rem;line-height:var(--pico-line-height);font-family:inherit;letter-spacing:inherit}input{overflow:visible}select{text-transform:none}legend{max-width:100%;padding:0;color:inherit;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{padding:0}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}::-moz-focus-inner{padding:0;border-style:none}:-moz-focusring{outline:none}:-moz-ui-invalid{box-shadow:none}::-ms-expand{display:none}[type=file],[type=range]{padding:0;border-width:0}input:not([type=checkbox],[type=radio],[type=range]){height:calc(1rem*var(--pico-line-height) + var(--pico-form-element-spacing-vertical)*2 + var(--pico-border-width)*2)}fieldset{width:100%;margin:0;margin-bottom:var(--pico-spacing);padding:0;border:0}label,fieldset legend{display:block;margin-bottom:calc(var(--pico-spacing)*.375);color:var(--pico-color);font-weight:var(--pico-form-label-font-weight, var(--pico-font-weight))}fieldset legend{margin-bottom:calc(var(--pico-spacing)*.5)}input:not([type=checkbox],[type=radio]),button[type=submit],select,textarea{width:100%}input:not([type=checkbox],[type=radio],[type=range],[type=file]),select,textarea{appearance:none;padding:var(--pico-form-element-spacing-vertical) var(--pico-form-element-spacing-horizontal)}input,select,textarea{--pico-background-color:var(--pico-form-element-background-color);--pico-border-color:var(--pico-form-element-border-color);--pico-color:var(--pico-form-element-color);--pico-box-shadow:none;border:var(--pico-border-width) solid var(--pico-border-color);border-radius:var(--pico-border-radius);outline:none;background-color:var(--pico-background-color);box-shadow:var(--pico-box-shadow);color:var(--pico-color);font-weight:var(--pico-font-weight);transition:background-color var(--pico-transition),border-color var(--pico-transition),color var(--pico-transition),box-shadow var(--pico-transition)}input:not([type=submit],[type=button],[type=reset],[type=checkbox],[type=radio],[readonly]):is(:active,:focus),:where(select,textarea):not([readonly]):is(:active,:focus){--pico-background-color:var(--pico-form-element-active-background-color)}input:not([type=submit],[type=button],[type=reset],[role=switch],[readonly]):is(:active,:focus),:where(select,textarea):not([readonly]):is(:active,:focus){--pico-border-color:var(--pico-form-element-active-border-color)}input:not([type=submit],[type=button],[type=reset],[type=range],[type=file],[readonly]):focus,:where(select,textarea):not([readonly]):focus{--pico-box-shadow:0 0 0 var(--pico-outline-width) var(--pico-form-element-focus-color)}input:not([type=submit],[type=button],[type=reset])[disabled],select[disabled],textarea[disabled],label[aria-disabled=true],:where(fieldset[disabled]) :is(input:not([type=submit],[type=button],[type=reset]),select,textarea){opacity:var(--pico-form-element-disabled-opacity);pointer-events:none}label[aria-disabled=true] input[disabled]{opacity:1}:where(input,select,textarea):not([type=checkbox],[type=radio],[type=date],[type=datetime-local],[type=month],[type=time],[type=week],[type=range])[aria-invalid]{padding-right:calc(var(--pico-form-element-spacing-horizontal) + 1.5rem);padding-left:var(--pico-form-element-spacing-horizontal);padding-inline-start:var(--pico-form-element-spacing-horizontal);padding-inline-end:calc(var(--pico-form-element-spacing-horizontal) + 1.5rem);background-position:center right .75rem;background-size:1rem auto;background-repeat:no-repeat}:where(input,select,textarea):not([type=checkbox],[type=radio],[type=date],[type=datetime-local],[type=month],[type=time],[type=week],[type=range])[aria-invalid=false]:not(select){background-image:var(--pico-icon-valid)}:where(input,select,textarea):not([type=checkbox],[type=radio],[type=date],[type=datetime-local],[type=month],[type=time],[type=week],[type=range])[aria-invalid=true]:not(select){background-image:var(--pico-icon-invalid)}:where(input,select,textarea)[aria-invalid=false]{--pico-border-color:var(--pico-form-element-valid-border-color)}:where(input,select,textarea)[aria-invalid=false]:is(:active,:focus){--pico-border-color:var(--pico-form-element-valid-active-border-color)}:where(input,select,textarea)[aria-invalid=false]:is(:active,:focus):not([type=checkbox],[type=radio]){--pico-box-shadow:0 0 0 var(--pico-outline-width) var(--pico-form-element-valid-focus-color)}:where(input,select,textarea)[aria-invalid=true]{--pico-border-color:var(--pico-form-element-invalid-border-color)}:where(input,select,textarea)[aria-invalid=true]:is(:active,:focus){--pico-border-color:var(--pico-form-element-invalid-active-border-color)}:where(input,select,textarea)[aria-invalid=true]:is(:active,:focus):not([type=checkbox],[type=radio]){--pico-box-shadow:0 0 0 var(--pico-outline-width) var(--pico-form-element-invalid-focus-color)}[dir=rtl] :where(input,select,textarea):not([type=checkbox],[type=radio]):is([aria-invalid],[aria-invalid=true],[aria-invalid=false]){background-position:center left .75rem}input::placeholder,input::-webkit-input-placeholder,textarea::placeholder,textarea::-webkit-input-placeholder,select:invalid{color:var(--pico-form-element-placeholder-color);opacity:1}input:not([type=checkbox],[type=radio]),select,textarea{margin-bottom:var(--pico-spacing)}select::-ms-expand{border:0;background-color:rgba(0,0,0,0)}select:not([multiple],[size]){padding-right:calc(var(--pico-form-element-spacing-horizontal) + 1.5rem);padding-left:var(--pico-form-element-spacing-horizontal);padding-inline-start:var(--pico-form-element-spacing-horizontal);padding-inline-end:calc(var(--pico-form-element-spacing-horizontal) + 1.5rem);background-image:var(--pico-icon-chevron);background-position:center right .75rem;background-size:1rem auto;background-repeat:no-repeat}select[multiple] option:checked{background:var(--pico-form-element-selected-background-color);color:var(--pico-form-element-color)}[dir=rtl] select:not([multiple],[size]){background-position:center left .75rem}textarea{display:block;resize:vertical}:where(input,select,textarea,fieldset,.grid)+small{display:block;width:100%;margin-top:calc(var(--pico-spacing)*-0.75);margin-bottom:var(--pico-spacing);color:var(--pico-muted-color)}:where(input,select,textarea,fieldset,.grid)[aria-invalid=false]+small{color:var(--pico-ins-color)}:where(input,select,textarea,fieldset,.grid)[aria-invalid=true]+small{color:var(--pico-del-color)}label>:where(input,select,textarea){margin-top:calc(var(--pico-spacing)*.25)}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search]{padding-inline-start:calc(var(--pico-form-element-spacing-horizontal) + 1.75rem);background-image:var(--pico-icon-search);background-position:center left calc(var(--pico-form-element-spacing-horizontal) + .125rem);background-size:1rem auto;background-repeat:no-repeat}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid]{padding-inline-start:calc(var(--pico-form-element-spacing-horizontal) + 1.75rem);background-position:center left 1.125rem,center right .75rem}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid=false]{background-image:var(--pico-icon-search),var(--pico-icon-valid)}input:not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid=true]{background-image:var(--pico-icon-search),var(--pico-icon-invalid)}[dir=rtl] :where(input):not([type=checkbox],[type=radio],[type=range],[type=file])[type=search]{background-position:center right 1.125rem}[dir=rtl] :where(input):not([type=checkbox],[type=radio],[type=range],[type=file])[type=search][aria-invalid]{background-position:center right 1.125rem,center left .75rem}details.dropdown{position:relative;border-bottom:none}details.dropdown>summary::after,details.dropdown>button::after,details.dropdown>a::after{display:block;width:1rem;height:calc(1rem*var(--pico-line-height, 1.5));margin-inline-start:.25rem;float:right;transform:rotate(0deg) translateX(0.2rem);background-image:var(--pico-icon-chevron);background-position:right center;background-size:1rem auto;background-repeat:no-repeat;content:""}nav details.dropdown{margin-bottom:0}details.dropdown>summary:not([role]){height:calc(1rem*var(--pico-line-height) + var(--pico-form-element-spacing-vertical)*2 + var(--pico-border-width)*2);padding:var(--pico-form-element-spacing-vertical) var(--pico-form-element-spacing-horizontal);border:var(--pico-border-width) solid var(--pico-form-element-border-color);border-radius:var(--pico-border-radius);background-color:var(--pico-form-element-background-color);color:var(--pico-form-element-placeholder-color);line-height:inherit;cursor:pointer;user-select:none;transition:background-color var(--pico-transition),border-color var(--pico-transition),color var(--pico-transition),box-shadow var(--pico-transition)}details.dropdown>summary:not([role]):active,details.dropdown>summary:not([role]):focus{border-color:var(--pico-form-element-active-border-color);background-color:var(--pico-form-element-active-background-color)}details.dropdown>summary:not([role]):focus{box-shadow:0 0 0 var(--pico-outline-width) var(--pico-form-element-focus-color)}details.dropdown>summary:not([role]):focus-visible{outline:none}details.dropdown>summary:not([role])[aria-invalid=false]{--pico-form-element-border-color:var(--pico-form-element-valid-border-color);--pico-form-element-active-border-color:var(--pico-form-element-valid-focus-color);--pico-form-element-focus-color:var(--pico-form-element-valid-focus-color)}details.dropdown>summary:not([role])[aria-invalid=true]{--pico-form-element-border-color:var(--pico-form-element-invalid-border-color);--pico-form-element-active-border-color:var(--pico-form-element-invalid-focus-color);--pico-form-element-focus-color:var(--pico-form-element-invalid-focus-color)}nav details.dropdown{display:inline;margin:calc(var(--pico-nav-element-spacing-vertical)*-1) 0}nav details.dropdown>summary::after{transform:rotate(0deg) translateX(0rem)}nav details.dropdown>summary:not([role]){height:calc(1rem*var(--pico-line-height) + var(--pico-nav-link-spacing-vertical)*2);padding:calc(var(--pico-nav-link-spacing-vertical) - var(--pico-border-width)*2) var(--pico-nav-link-spacing-horizontal)}nav details.dropdown>summary:not([role]):focus-visible{box-shadow:0 0 0 var(--pico-outline-width) var(--pico-primary-focus)}details.dropdown>summary+ul{display:flex;z-index:99;position:absolute;left:0;flex-direction:column;width:100%;min-width:fit-content;margin:0;margin-top:var(--pico-outline-width);padding:0;border:var(--pico-border-width) solid var(--pico-dropdown-border-color);border-radius:var(--pico-border-radius);background-color:var(--pico-dropdown-background-color);box-shadow:var(--pico-dropdown-box-shadow);color:var(--pico-dropdown-color);white-space:nowrap;opacity:0;transition:opacity var(--pico-transition),transform 0s ease-in-out 1s}details.dropdown>summary+ul[dir=rtl]{right:0;left:auto}details.dropdown>summary+ul li{width:100%;margin-bottom:0;padding:calc(var(--pico-form-element-spacing-vertical)*.5) var(--pico-form-element-spacing-horizontal);list-style:none}details.dropdown>summary+ul li:first-of-type{margin-top:calc(var(--pico-form-element-spacing-vertical)*.5)}details.dropdown>summary+ul li:last-of-type{margin-bottom:calc(var(--pico-form-element-spacing-vertical)*.5)}details.dropdown>summary+ul li a{display:block;margin:calc(var(--pico-form-element-spacing-vertical)*-0.5) calc(var(--pico-form-element-spacing-horizontal)*-1);padding:calc(var(--pico-form-element-spacing-vertical)*.5) var(--pico-form-element-spacing-horizontal);overflow:hidden;border-radius:0;color:var(--pico-dropdown-color);text-decoration:none;text-overflow:ellipsis}details.dropdown>summary+ul li a:hover,details.dropdown>summary+ul li a:focus,details.dropdown>summary+ul li a:active,details.dropdown>summary+ul li a:focus-visible,details.dropdown>summary+ul li a[aria-current]:not([aria-current=false]){background-color:var(--pico-dropdown-hover-background-color)}details.dropdown>summary+ul li label{width:100%}details.dropdown>summary+ul li:has(label):hover{background-color:var(--pico-dropdown-hover-background-color)}details.dropdown[open]>summary{margin-bottom:0}details.dropdown[open]>summary+ul{transform:scaleY(1);opacity:1;transition:opacity var(--pico-transition),transform 0s ease-in-out 0s}details.dropdown[open]>summary::before{display:block;z-index:1;position:fixed;width:100vw;height:100vh;inset:0;background:none;content:"";cursor:default}label>details.dropdown{margin-top:calc(var(--pico-spacing)*.25)}:where(nav li)::before{float:left;content:"​"}nav,nav ul{display:flex}nav{justify-content:space-between;overflow:visible}nav ol,nav ul{align-items:center;margin-bottom:0;padding:0;list-style:none}nav ol:first-of-type,nav ul:first-of-type{margin-left:calc(var(--pico-nav-element-spacing-horizontal)*-1)}nav ol:last-of-type,nav ul:last-of-type{margin-right:calc(var(--pico-nav-element-spacing-horizontal)*-1)}nav li{display:inline-block;margin:0;padding:var(--pico-nav-element-spacing-vertical) var(--pico-nav-element-spacing-horizontal)}nav li :where(a,[role=link]){display:inline-block;margin:calc(var(--pico-nav-link-spacing-vertical)*-1) calc(var(--pico-nav-link-spacing-horizontal)*-1);padding:var(--pico-nav-link-spacing-vertical) var(--pico-nav-link-spacing-horizontal);border-radius:var(--pico-border-radius)}nav li :where(a,[role=link]):not(:hover){text-decoration:none}nav li button,nav li [role=button],nav li [type=button],nav li input:not([type=checkbox],[type=radio],[type=range],[type=file]),nav li select{height:auto;margin-right:inherit;margin-bottom:0;margin-left:inherit;padding:calc(var(--pico-nav-link-spacing-vertical) - var(--pico-border-width)*2) var(--pico-nav-link-spacing-horizontal)}nav[aria-label=breadcrumb]{align-items:center;justify-content:start}nav[aria-label=breadcrumb] ul li:not(:first-child){margin-inline-start:var(--pico-nav-link-spacing-horizontal)}nav[aria-label=breadcrumb] ul li a{margin:calc(var(--pico-nav-link-spacing-vertical)*-1) 0;margin-inline-start:calc(var(--pico-nav-link-spacing-horizontal)*-1)}nav[aria-label=breadcrumb] ul li:not(:last-child)::after{display:inline-block;position:absolute;width:calc(var(--pico-nav-link-spacing-horizontal)*4);margin:0 calc(var(--pico-nav-link-spacing-horizontal)*-1);content:var(--pico-nav-breadcrumb-divider);color:var(--pico-muted-color);text-align:center;text-decoration:none;white-space:nowrap}nav[aria-label=breadcrumb] a[aria-current]:not([aria-current=false]){background-color:rgba(0,0,0,0);color:inherit;text-decoration:none;pointer-events:none}aside nav,aside ol,aside ul,aside li{display:block}aside li{padding:calc(var(--pico-nav-element-spacing-vertical)*.5) var(--pico-nav-element-spacing-horizontal)}aside li a{display:block}aside li [role=button]{margin:inherit}[dir=rtl] nav[aria-label=breadcrumb] ul li:not(:last-child) ::after{content:"\\"}@font-face{font-family:"Comic Neue";font-style:normal;font-weight:400;font-display:swap;src:local("Comic Neue"),local("Comic Neue"),url("/assets/fonts/ComicNeueSubset.woff2") format("woff2")}@font-face{font-family:"AoyagiKouzanTSubset";font-style:normal;font-weight:400;font-display:swap;src:local("AoyagiKouzanTSubset"),local("AoyagiKouzanTSubset"),url("/assets/fonts/AoyagiKouzanTSubset.woff2") format("woff2")}:root{--pico-font-family-emoji: "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji", Symbola;--pico-font-family-sans-serif: "Helvetica Neue", Arial, BIZ UDPGothic, sans-serif, var(--pico-font-family-emoji);--pico-font-family-monospace: monospace, var(--pico-font-family-emoji);--pico-form-element-spacing-vertical: .25rem;--pico-form-element-spacing-horizontal: .75rem;--pico-nav-element-spacing-vertical: .25rem;--pico-nav-element-spacing-horizontal: .5rem;--pico-nav-link-spacing-vertical: .25rem;--pico-nav-link-spacing-horizontal: .5rem}h1{margin-top:var(--pico-typography-spacing-vertical)}h2{border-bottom:1px solid #5af;padding:0}h3{border-bottom:1px dashed #5af}h4{border-bottom:1px dotted #5af}h5{border-bottom:1px dashed #333}h6{border-bottom:1px dashed #aaa;margin-top:calc(.75*--pico-typography-spacing-vertical);margin-bottom:calc(.5*--pico--typography-spacing-vertical)}strong{font-size:1.75em}kbd{color:var(--pico-del-color)}pre{margin-top:var(--pico-spacing);padding:calc(.5*var(--pico-spacing))}figure.highlight{margin:0;padding:0;border:0;font-family:inherit}figure.highlight pre{padding-top:calc(.25*var(--pico-spacing));padding-bottom:calc(.25*var(--pico-spacing))}figure.highlight code{padding-top:calc(.25*var(--pico-spacing));padding-bottom:calc(.25*var(--pico-spacing))}.highlight{font-family:inherit}.highlight .hll{background-color:#ffc}.highlight{background:#fff}.highlight .c{color:#888}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{color:#080;font-weight:bold}.highlight .ch{color:#888}.highlight .cm{color:#888}.highlight .cp{color:#c00;font-weight:bold}.highlight .cpf{color:#888}.highlight .c1{color:#888}.highlight .cs{color:#c00;font-weight:bold;background-color:#fff0f0}.highlight .gd{color:#000;background-color:#fdd}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#333}.highlight .gi{color:#000;background-color:#dfd}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#666}.highlight .gt{color:#a00}.highlight .kc{color:#080;font-weight:bold}.highlight .kd{color:#080;font-weight:bold}.highlight .kn{color:#080;font-weight:bold}.highlight .kp{color:#080}.highlight .kr{color:#080;font-weight:bold}.highlight .kt{color:#888;font-weight:bold}.highlight .m{color:#00d;font-weight:bold}.highlight .s{color:#d20;background-color:#fff0f0}.highlight .na{color:#369}.highlight .nb{color:#038}.highlight .nc{color:#b06;font-weight:bold}.highlight .no{color:#036;font-weight:bold}.highlight .nd{color:#555}.highlight .ne{color:#b06;font-weight:bold}.highlight .nf{color:#06b;font-weight:bold}.highlight .nl{color:#369;font-style:italic}.highlight .nn{color:#b06;font-weight:bold}.highlight .py{color:#369;font-weight:bold}.highlight .nt{color:#b06;font-weight:bold}.highlight .nv{color:#369}.highlight .ow{color:#080}.highlight .w{color:#bbb}.highlight .mb{color:#00d;font-weight:bold}.highlight .mf{color:#00d;font-weight:bold}.highlight .mh{color:#00d;font-weight:bold}.highlight .mi{color:#00d;font-weight:bold}.highlight .mo{color:#00d;font-weight:bold}.highlight .sb{color:#d20;background-color:#fff0f0}.highlight .sc{color:#d20;background-color:#fff0f0}.highlight .sd{color:#d20;background-color:#fff0f0}.highlight .s2{color:#d20;background-color:#fff0f0}.highlight .se{color:#04d;background-color:#fff0f0}.highlight .sh{color:#d20;background-color:#fff0f0}.highlight .si{color:#33b;background-color:#fff0f0}.highlight .sx{color:#2b2;background-color:#f0fff0}.highlight .sr{color:#080;background-color:#fff0ff}.highlight .s1{color:#d20;background-color:#fff0f0}.highlight .ss{color:#a60;background-color:#fff0f0}.highlight .bp{color:#038}.highlight .vc{color:#369}.highlight .vg{color:#d70}.highlight .vi{color:#33b}.highlight .il{color:#00d;font-weight:bold}.title-font{font-family:"Comic Neue","AoyagiKouzanTSubset",sans-serif}#top{border-radius:80%}.wrapper{min-height:100%}header{position:sticky;top:0;background-color:var(--pico-background-color);box-shadow:0 6px 11px -12px rgba(0,0,0,.7);z-index:100}a{text-decoration:none}a:hover{text-decoration:underline}nav details.dropdown{display:inline-block;margin:calc(var(--pico-nav-element-spacing-vertical)*-2) 0}nav details.dropdown summary{border:none}nav details.dropdown summary:not([role]){border:none;background-color:#fff;color:var(--pico-primary);height:calc(1rem*var(--pico-line-height) + var(--pico-nav-link-spacing-vertical)*1)}nav details.dropdown summary:not([role])::after{display:none}.langselector{margin-left:auto}#table-of-contents{align-items:center;justify-content:start;border-bottom:1px solid rgba(0,0,0,.1);margin-bottom:10px;padding-bottom:10px}#table-of-contents h2{--pico-font-size: 1rem;--pico-typography-spacing-vertical: 0em;border:none}#table-of-contents h2:after{content:": ";padding:0;margin:0;margin-right:var(--pico-nav-link-spacing-horizontal)}#table-of-contents ul li:not(:first-child){margin-inline-start:var(--pico-nav-link-spacing-horizontal)}#table-of-contents ul li:not(:last-child) ::after{position:absolute;width:calc(var(--pico-nav-link-spacing-horizontal)*2);margin-inline-start:calc(var(--pico-nav-link-spacing-horizontal)/2);content:"/";color:var(--pico-muted-color);text-align:center;text-decoration:none}#table-of-contents a[aria-current]{background-color:rgba(0,0,0,0);color:inherit;text-decoration:none;pointer-events:none}.footer,footer p{text-align:right}.profile-picture{height:20vw;max-height:260px;width:20vw;max-width:260px;position:relative;float:right;border-radius:50%;margin-top:-1rem}.menu-btn{display:none}@media(min-width: 768px){.md-hide{display:none}.back_to_top{margin-left:85%}.title-font{font-size:3rem}}@media(max-width: 768px){.menu-icon{display:flex;height:60px;width:60px;justify-content:center;align-items:center;position:relative;z-index:200;cursor:pointer}.menu-icon span,.menu-icon span:before,.menu-icon span:after{content:"";display:block;height:3px;width:25px;border-radius:3px;background:#000;transition:.5s;position:absolute}.menu-icon span:before{bottom:8px}.menu-icon span:after{top:8px}#menu-btn:checked~.menu-icon span{background:#fff}#menu-btn:checked~.menu-icon span::before{bottom:0;transform:rotate(45deg)}#menu-btn:checked~.menu-icon span::after{top:0;transform:rotate(-45deg)}.menu{width:100%;height:100%;position:fixed;top:0;left:100%;z-index:200;background:#fff;transition:.5s;flex-direction:column;margin-top:120px}#menu-btn:checked~.menu{left:0;width:100%;font-size:calc(1.5*var(--pico-font-size))}.title-font{font-size:2rem}#table-of-contents{display:none}.sm-hide{display:none}.profile-picture{margin-top:-4rem}}.logo{border-radius:80%}[class^=icon-] svg{vertical-align:baseline}@media(min-width: 768px){[class^=icon-] svg{height:1.05rem;width:1.05rem}}@media(max-width: 768px){[class^=icon-] svg{height:1.25rem;width:1.25rem}}.icon-envelope{color:#242424}.icon-keybase{color:#ff8c00}.icon-x{color:#4a4a4a}.icon-twitter{color:#55acee}.icon-facebook{color:#3b5998}.icon-github{color:#4c4c4c}.icon-mastodon{color:#3b5998}.icon-amp{color:#ff851b}.research li:nth-child(even){background-color:var(--pico-table-row-stripped-background-color)}.back_to_top{position:sticky;bottom:20px;margin-top:120vh;margin-left:calc(100% - 20px - 6rem);text-decoration:none;padding:10px;color:#fff;background:#000;border-radius:100px;white-space:nowrap}main ul li{list-style-type:disc}.nowrap{white-space:pre}span.anchor{display:none}.sanchor{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAAAAAA6I3INAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAOAAAADgCxW/H3AAAAH0lEQVQI12M4jAIYDv9HAni4hw/Tmgt3E1YuiqtQAAD5Nq+Ne1ON1gAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxMi0wNy0zMVQxNTowNDowNCswOTowMONpTpcAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMDctMTAtMjhUMDc6NDY6MzArMDk6MDAE9UrdAAAAAElFTkSuQmCC);background-position:bottom right;background-repeat:no-repeat;background-size:100% auto;padding:1rem 1rem 0px 0px;color:#fff;background-color:rgba(0,0,0,0);font-size:1px}.canchor{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAAAAABzHgM7AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAMAAAADADOpTJ+AAAAIElEQVQI12P4jwQYsHKOHDlCDAe3AVAOSDVcD24OAgAAVIGJOMkyXx4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTItMDctMzFUMTU6MDM6NTgrMDk6MDCO9TH+AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA3LTEwLTI4VDA3OjQ2OjMwKzA5OjAwBPVK3QAAAABJRU5ErkJggg==);background-position:bottom right;background-repeat:no-repeat;background-size:100% auto;padding:1rem 1rem 0px 0px;color:#white;background-color:rgba(0,0,0,0);font-size:1px}.mail{display:none}.sanchor:before{display:block;content:" ";margin-top:-110px;height:110px;visibility:hidden}p.source{text-align:right;font-size:80%}p.source cite{font-style:normal}.day h2{font-size:1rem}.amp-social{--pico-nav-link-spacing-vertical: 0;--pico-nav-link-spacing-horizontal: 0}amp-social-share[type=hatena_bookmark]{display:inline-block;position:relative;width:24px;height:24px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 500'%3E%3Crect width='500' height='500' rx='101.9' ry='101.9' fill='%2300a4de'/%3E%3Cg fill='%23fff'%3E%3Cpath d='M278.2,258.1q-13.6-15.2-37.8-17c14.4-3.9,24.8-9.6,31.4-17.3s9.8-17.8,9.8-30.7A55,55,0,0,0,275,166a48.8,48.8,0,0,0-19.2-18.6c-7.3-4-16-6.9-26.2-8.6s-28.1-2.4-53.7-2.4H113.6V363.6h64.2q38.7,0,55.8-2.6c11.4-1.8,20.9-4.8,28.6-8.9a52.5,52.5,0,0,0,21.9-21.4c5.1-9.2,7.7-19.9,7.7-32.1C291.8,281.7,287.3,268.2,278.2,258.1Zm-107-71.4h13.3q23.1,0,31,5.2c5.3,3.5,7.9,9.5,7.9,18s-2.9,14-8.5,17.4-16.1,5-31.4,5H171.2V186.7Zm52.8,130.3c-6.1,3.7-16.5,5.5-31.1,5.5H171.2V273h22.6c15,0,25.4,1.9,30.9,5.7s8.4,10.4,8.4,20S230.1,313.4,223.9,317.1Z'/%3E%3Cpath d='M357.6,306.1a28.8,28.8,0,1,0,28.8,28.8A28.8,28.8,0,0,0,357.6,306.1Z'/%3E%3Crect x='332.6' y='136.4' width='50' height='151.52'/%3E%3C/g%3E%3C/svg%3E")}amp-social-share[type=twitter]{background-color:#000}.permalink{margin:0;padding:0;border:1px sold #fff;display:inline-block;position:relative;width:24px;height:24px;background-image:url("data:image/svg+xml,%3Csvg id='SVGRoot' width='24px' height='24px' version='1.1' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m15.279 8.659c2.8006 2.8036 2.7622 7.2984 0.0169 10.059-5e-3 6e-3 -0.0113 0.0117-0.0169 0.0173l-3.15 3.15c-2.7783 2.7783-7.2984 2.7779-10.076 0-2.7783-2.7778-2.7783-7.2984 0-10.076l1.7393-1.7393c0.46125-0.46125 1.2556-0.15469 1.2794 0.49716 0.0304 0.83071 0.17934 1.6653 0.45422 2.4713 0.0931 0.27291 0.0266 0.57478-0.17733 0.77869l-0.61345 0.61345c-1.3137 1.3137-1.3549 3.4528-0.0541 4.7794 1.3136 1.3396 3.4728 1.3476 4.7965 0.0239l3.15-3.1495c1.3215-1.3214 1.3159-3.4574 0-4.7733-0.17348-0.17315-0.34823-0.30769-0.48473-0.40167a0.75173 0.75173 0 0 1-0.32564-0.59091c-0.0186-0.49532 0.15694-1.0058 0.54834-1.3972l0.98691-0.98696c0.25879-0.25879 0.66478-0.29057 0.96487-0.0811a7.1476 7.1476 0 0 1 0.96197 0.80611zm6.6063-6.6067c-2.7779-2.7779-7.298-2.7783-10.076 0l-3.15 3.15c-6e-3 6e-3 -0.0117 0.0117-0.0169 0.0173-2.7453 2.7606-2.7838 7.2554 0.0169 10.059a7.1463 7.1463 0 0 0 0.96192 0.80606c0.30009 0.20944 0.70613 0.17761 0.96488-0.0811l0.9869-0.98695c0.39141-0.39141 0.56691-0.90183 0.54835-1.3972a0.75173 0.75173 0 0 0-0.32564-0.59091c-0.1365-0.094-0.31125-0.22851-0.48474-0.40167-1.3159-1.3159-1.3214-3.4518 0-4.7733l3.15-3.1495c1.3237-1.3237 3.4828-1.3157 4.7965 0.0239 1.3008 1.3266 1.2596 3.4657-0.0541 4.7794l-0.61346 0.61345c-0.2039 0.20391-0.27042 0.50578-0.17732 0.77869 0.27487 0.80597 0.42384 1.6406 0.45421 2.4713 0.0239 0.65184 0.81816 0.9584 1.2794 0.49715l1.7394-1.7393c2.7783-2.7778 2.7783-7.2984 4e-5 -10.076z' fill='currentColor' stroke-width='.046875'%2F%3E%3C%2Fsvg%3E")}.comment{display:none}.tdiary-profile-picture{border-radius:50%;width:30vw;max-width:260px;max-height:260px;margin-left:auto;margin-right:auto}.amazon-detail{display:flex;padding:var(--pico-spacing);border:thin solid #000;box-shadow:0 6px 10px -10px rgba(0,0,0,.7)}.amazon-detail-desc{margin-left:var(--pico-spacing)}@media(max-width: 768px){.tdiary-profile-picture{display:none}}*[id]:before{display:block;content:" ";margin-top:-120px;height:120px;visibility:hidden}    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <meta name="author" content="Youhei SASAKI">
    <!-- end: check google site verification -->
    <!-- end: alternate -->
    <!-- begin jekyll seo -->
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Emacs の設定 | Youhei SASAKI’s official site</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Emacs の設定" />
<meta name="author" content="Youhei SASAKI" />
<meta property="og:locale" content="ja" />
<link rel="canonical" href="https://uwabami.github.io/cc-env/Emacs.html" />
<meta property="og:url" content="https://uwabami.github.io/cc-env/Emacs.html" />
<meta property="og:site_name" content="Youhei SASAKI’s official site" />
<meta property="og:image" content="https://uwabami.github.io/assets/img/eyecatch_1600x900.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-02-10T22:17:35+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://uwabami.github.io/assets/img/eyecatch_1600x900.png" />
<meta property="twitter:title" content="Emacs の設定" />
<meta name="twitter:site" content="@uwabami_frozen" />
<meta name="twitter:creator" content="@Youhei SASAKI" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Youhei SASAKI","url":"https://uwabami.github.io/"},"dateModified":"2026-02-10T22:17:35+09:00","datePublished":"2026-02-10T22:17:35+09:00","headline":"Emacs の設定","image":"https://uwabami.github.io/assets/img/eyecatch_1600x900.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://uwabami.github.io/cc-env/Emacs.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://uwabami.github.io/assets/img/eyecatch_1600x900.png"},"name":"Youhei SASAKI"},"url":"https://uwabami.github.io/cc-env/Emacs.html"}</script>
<!-- End Jekyll SEO tag -->
    <!-- end jekyll seo -->
    <link rel="icon" type="image/x-icon" href="https://uwabami.github.io/assets/img/favicon.ico">
    <!-- apple icons -->
    <link rel="apple-touch-icon" href="https://uwabami.github.io/assets/img/favicon-256x256.png">
    <link rel="shortcut-icon" type="image/ico" href="/assets/img/favicon.ico">
    <meta name="amp-consent-blocking" content="amp-analytics">
  </head>
  <body>
    <amp-geo layout="nodisplay">
  <script type="application/json">
    {
      "ISOCountryGroups": {
        "eea": [ "at", "be", "bg", "cy", "cz", "de", "dk", "ee", "es", "fi", "fr",
        "gb", "gr", "hr", "hu", "ie", "is", "it", "li", "lt", "lu", "lv", "mt", "nl",
        "no", "pl", "pt", "ro", "se", "si", "sk"]
      }
    }
  </script>
</amp-geo>
<amp-consent layout="nodisplay" id="consent-element">
  <script type="application/json">
    {
        "consents": {
            "my_consent": {
                "promptIfUnknownForGeoGroup": "eea",
                "promptUI": "consent-ui"
            }
        }
    }
  </script>
  <div id="consent-ui">
    <p>I use cookies to analyze how visitors use my website via Google Analytics:</p>
    <button on="tap:consent-element.accept" role="button">Accept</button>
    <button on="tap:consent-element.reject" role="button">Reject</button>
    <button on="tap:consent-element.dismiss" role="button">Dismiss</button>
  </div>
</amp-consent>

    <div class="wrapper container" id="wholepage">
      <header>
        <!-- page loop -->
<nav>
  <ul>
    <li>
      <a href="/index.html">
        <amp-img layout="fixed"
                 width="1.2rem"
                 height="1.2rem"
                 src="/assets/img/top.webp"
                 alt="About"
                 id="top">
          <amp-img fallback
                   layout="fixed"
                   width="1.2rem"
                   height="1.2rem"
                   src="/assets/img/top.jpg"
                   alt="About"
                   id="top">
          </amp-img>
        </amp-img>
      </a>
    </li>
  </ul>
  <input class="menu-btn" type="checkbox" id="menu-btn"/>
  <label class="menu-icon" for="menu-btn"><span></span></label>
  <ul class="menu">
    <!-- lang ja -->
    <li>
      <a href="/research/index.html">
        Research
      </a>
    </li>
    <li>
      <details class="dropdown">
        <summary> Software</summary>
        <ul dir="rtl">
          <li>
            <a href="/software/index.html">
              Repository
            </a>
          </li>
          <li>
            <a href="/cc-env/index.html">
              Comp. Memo
            </a>
          </li>
        </ul>
      </details>
    </li>
    <li>
      <a href="https://uwabami.junkhub.org/log">blog</a>
    </li>
    <li>
      <form method="GET"
            action="https://www.google.com/cse"
            target="_top">
        <input name="cx" type="hidden"
               value="017455171263919107349:oumnpe4bynr" />
        <input name="ie" type="hidden" value="UTF-8" />
        <input type="search" placeholder="検索" name="q" required>
      </form>
    </li>
    
  </ul>
</nav>

        <nav aria-label="breadcrumb">
  <ul>
    <!-- create crumbs -->
    <li>
      <a href="/index.html">
        Top
      </a>
    </li>
    <li><a href="/cc-env/index.html">Cc-env</a></li>      <!-- end page loop -->
  </ul>
  <span class="langselector"><!-- end: lang selector -->
  </span>
</nav>

      </header>
      <main role="main">
        <div class="content">
          <h1 class="page-title">Emacs の設定</h1>
          <hr>
<p>
Related <a href="https://uwabami.github.io/cc-env/index.html">Index</a> <a href="https://uwabami.github.io/cc-env/Emacs.html">Emacs</a>
</p>
<div>
<h2 id="org66fa74cd">はじめに</h2>
<div class="outline-text-2" id="text-org66fa74cd">
<p>
ここでは私の Emacs の設定についてまとめています．
</p>

<span class="inline-block">
<amp-img src="https://github.com/uwabami/emacs/actions/workflows/build.yml/badge.svg" width="104px" height="20px" layout="fixed" class="github_badge"><amp-img src="https://github.com/uwabami/emacs/actions/workflows/build.yml/badge.svg" width="104px" height="20px" layout="fixed" class="github_badge" fallback></amp-img><noscript><img src="https://github.com/uwabami/emacs/actions/workflows/build.yml/badge.svg" width="104px" height="20px" class="github_badge"></noscript></amp-img>
<amp-img src="https://img.shields.io/badge/License-GPLv3-blue.svg" width="92px" height="20px" layout="fixed"><amp-img src="https://img.shields.io/badge/License-GPLv3-blue.svg" width="92px" height="20px" layout="fixed" fallback></amp-img><noscript><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" width="92px" height="20px"></noscript></amp-img>
<a href="https://github.com/uwabami/emacs"><span class="icon-github"><svg id="SVGRoot" width="20px" height="20px" version="1.1" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="m5.4144 12.761c0 0.0645-0.0742 0.11613-0.16774 0.11613-0.10645 0.01-0.18064-0.0419-0.18064-0.11613 0-0.0645 0.0742-0.11613 0.16774-0.11613 0.0968-0.01 0.18064 0.0419 0.18064 0.11613zm-1.0032-0.14516c-0.0226 0.0645 0.0419 0.13871 0.13871 0.15806 0.0839 0.0323 0.18064 0 0.2-0.0645 0.0194-0.0645-0.0419-0.13871-0.13871-0.16775-0.0839-0.0226-0.17742 0.01-0.2 0.0742zm1.4258-0.0548c-0.0935 0.0226-0.15806 0.0839-0.14838 0.15806 0.01 0.0645 0.0935 0.10645 0.19032 0.0839 0.0936-0.0226 0.15806-0.0839 0.14839-0.14838-0.01-0.0613-0.0968-0.10323-0.19033-0.0935zm2.1226-12.361c-4.4742 0-7.8968 3.3968-7.8968 7.871 0 3.5774 2.2516 6.6387 5.4677 7.7161 0.41291 0.0742 0.55807-0.18064 0.55807-0.39032 0-0.2-0.01-1.3032-0.01-1.9806 0 0-2.2581 0.48387-2.7323-0.96129 0 0-0.36774-0.93871-0.89677-1.1806 0 0-0.73871-0.50645 0.0516-0.49677 0 0 0.80323 0.0645 1.2452 0.83226 0.70645 1.2452 1.8903 0.88709 2.3516 0.67419 0.0742-0.51613 0.28387-0.87419 0.51613-1.0871-1.8032-0.2-3.6226-0.46129-3.6226-3.5645 0-0.8871 0.24516-1.3323 0.76129-1.9-0.0839-0.20968-0.35806-1.0742 0.0839-2.1903 0.6742-0.20967 2.2258 0.87097 2.2258 0.87097 0.64516-0.18064 1.3387-0.27419 2.0258-0.27419 0.68709 0 1.3806 0.0936 2.0258 0.27419 0 0 1.5516-1.0839 2.2258-0.87097 0.44193 1.1194 0.16774 1.9806 0.0839 2.1903 0.51613 0.57096 0.83226 1.0161 0.83226 1.9 0 3.1129-1.9 3.3613-3.7032 3.5645 0.29678 0.25484 0.54839 0.73871 0.54839 1.4968 0 1.0871-0.01 2.4322-0.01 2.6968 0 0.20968 0.14839 0.46452 0.55807 0.39032 3.2258-1.071 5.4129-4.1322 5.4129-7.7097 0-4.4742-3.629-7.871-8.1032-7.871zm-4.7613 11.126c-0.0419 0.0323-0.0323 0.10646 0.0226 0.16775 0.0516 0.0516 0.12581 0.0742 0.16775 0.0323 0.0419-0.0323 0.0323-0.10645-0.0226-0.16774-0.0516-0.0516-0.12581-0.0742-0.16775-0.0323zm-0.34838-0.26129c-0.0226 0.0419 0.01 0.0935 0.0742 0.12581 0.0516 0.0323 0.11613 0.0226 0.13871-0.0226 0.0226-0.0419-0.01-0.0935-0.0742-0.12581-0.0645-0.0194-0.11613-0.01-0.13871 0.0226zm1.0452 1.1484c-0.0516 0.0419-0.0323 0.13871 0.0419 0.2 0.0742 0.0742 0.16775 0.0839 0.20968 0.0323 0.0419-0.0419 0.0226-0.13871-0.0419-0.2-0.071-0.0742-0.16775-0.0839-0.20968-0.0323zm-0.36774-0.47419c-0.0516 0.0323-0.0516 0.11613 0 0.19032 0.0516 0.0742 0.13871 0.10645 0.18064 0.0742 0.0516-0.0419 0.0516-0.1258 0-0.2-0.0452-0.0742-0.12903-0.10645-0.18064-0.0645z" fill="currentColor" stroke-width=".032258"></path></svg></span></a>
</span>
</div>
</div>
<div>
<h2 id="org9ed6e948">基本方針</h2>
<div class="outline-text-2" id="text-org9ed6e948">
</div>
<div>
<h3 id="org5eaa4818">Debian パッケージがインストールされているならばそれを優先する</h3>
<div class="outline-text-3" id="text-org5eaa4818">
<p>
:<a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">Eating your own dog food - Wikipedia</a>
</p>

<p>
Emacsに関連するDebianパッケージを幾つかメンテナンスしているので,
可能な限りDebianパッケージを使うことにしています．
</p>
</div>
</div>
<div>
<h3 id="orgd2ba4ef2">
<a href="https://github.com/conao3/leaf.el">leaf.el</a>でEmacs のパッケージの導入と設定を行なう</h3>
<div class="outline-text-3" id="text-orgd2ba4ef2">
<p>
設定には<a href="https://github.com/conao3/leaf.el">leaf.el</a>を利用します．
VCS からインストールしたいパッケージは
<a href="https://github.com/conao3/leaf.el">leaf.el</a> の <code>:vc</code> キーワードで <code>package-vc-install</code> を使います.
</p>
</div>
</div>
<div>
<h3 id="org458d9cf4">設定は <a href="http://orgmode.org/">Org mode</a> で書きたい</h3>
<div class="outline-text-3" id="text-org458d9cf4">
<p>
以前こんなブログ記事を書きました→ <a href="http://uwabami.junkhub.org/log/20111213.html#p01">Emacsの設定ファイルをorgで書く</a>
</p>

<p>
というわけで, 設定は <a href="http://orgmode.org/worg/org-contrib/babel/intro.html">Org Babel</a> で書いています.
本ファイル(<code>README.org</code>) から,
Makefile 内の以下のスクリプトで <code>~/init.el</code> を生成し, byte-compile します.
</p>
<figure class="highlight"><pre><code class="language-makefile-gmake" data-lang="makefile-gmake"><span class="c"># -*- mode: makefile -*-
# ----------------------------------------------------------------------------
</span><span class="nv">EMACS</span>		<span class="o">?=</span> emacs
<span class="nv">EMACS_VER</span>	<span class="o">?=</span> <span class="p">$(</span>shell emacs <span class="nt">--version</span> | <span class="nb">head</span> <span class="nt">-1</span> | <span class="nb">cut</span> <span class="nt">-f</span> 3 <span class="nt">--d</span> <span class="se">\ </span><span class="p">)</span>
<span class="nv">EARLY_INIT</span>	<span class="o">?=</span> <span class="p">$(</span>shell <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span><span class="nb">echo</span> <span class="s2">"</span><span class="p">$(</span><span class="s2">EMACS_VER</span><span class="p">)</span><span class="s2"> &gt;= 27"</span> | bc<span class="sb">`</span> <span class="nt">-eq</span> 1 <span class="o">]</span> <span class="p">;</span> <span class="k">then </span><span class="nb">echo yes</span><span class="p">;</span> <span class="k">fi</span><span class="p">)</span>
<span class="nv">NATIVE_COMP</span>	<span class="o">?=</span> <span class="p">$(</span>shell <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span><span class="nb">echo</span> <span class="s2">"</span><span class="p">$(</span><span class="s2">EMACS_VER</span><span class="p">)</span><span class="s2"> &gt;= 28.1"</span> | bc<span class="sb">`</span> <span class="nt">-eq</span> 1 <span class="o">]</span> <span class="p">;</span> <span class="k">then </span><span class="nb">echo yes</span><span class="p">;</span> <span class="k">fi</span><span class="p">)</span>
<span class="nv">TREESIT</span>	<span class="o">?=</span> <span class="p">$(</span>shell <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span><span class="nb">echo</span> <span class="s2">"</span><span class="p">$(</span><span class="s2">EMACS_VER</span><span class="p">)</span><span class="s2"> &gt;= 29"</span> | bc<span class="sb">`</span> <span class="nt">-eq</span> 1 <span class="o">]</span>  <span class="p">;</span><span class="k">then </span><span class="nb">echo yes</span><span class="p">;</span> <span class="k">fi</span><span class="p">)</span>
<span class="nv">NATIVE_COMP_DIR</span> <span class="o">?=</span> <span class="p">$(</span>shell <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span><span class="nb">echo</span> <span class="s2">"</span><span class="p">$(</span><span class="s2">EMACS_VER</span><span class="p">)</span><span class="s2"> &gt;= 30"</span> | bc<span class="sb">`</span> <span class="nt">-eq</span> 1 <span class="o">]</span> <span class="p">;</span> <span class="k">then </span><span class="nb">echo yes</span><span class="p">;</span> <span class="k">fi</span><span class="p">)</span>
<span class="nv">EL</span>		<span class="o">=</span>

<span class="c"># ----------------------------------------------------------------------------
# check: early-init
</span><span class="k">ifeq</span> <span class="nv">($(EARLY_INIT),yes)</span>
<span class="nv">EL</span>		<span class="o">+=</span> early-init.el
<span class="nv">LOAD</span>		<span class="o">?=</span> <span class="nt">-l</span> early-init.el <span class="nt">-l</span> init.el
<span class="k">else</span>
<span class="nv">LOAD</span>		<span class="o">?=</span> <span class="nt">-l</span> init.el
<span class="k">endif</span>
<span class="c"># ----------------------------------------------------------------------------
# check: Wanderlust Debian package
</span><span class="k">ifneq</span> <span class="nv">(,$(wildcard /etc/emacs/site-start.d/65wl-beta.el))</span>
<span class="nv">EL</span>		<span class="o">+=</span> init-wl.el
<span class="k">endif</span>
<span class="c"># ----------------------------------------------------------------------------
# check: native compile or byte compile
</span><span class="k">ifeq</span> <span class="nv">($(NATIVE_COMP),yes)</span>
<span class="nl">all</span><span class="o">:</span> <span class="nf">$(EL)</span>
<span class="k">else</span>
<span class="nv">ELC</span>		<span class="o">=</span> <span class="p">$(</span>EL:%.el<span class="o">=</span>%.elc<span class="p">)</span>
<span class="nl">all</span><span class="o">:</span> <span class="nf">$(ELC) init.elc</span>
<span class="nl">%.elc</span><span class="o">:</span> <span class="nf">%.el</span>
	<span class="p">$(</span>EMACS<span class="p">)</span> <span class="p">$(</span>LOAD<span class="p">)</span> <span class="nt">-batch</span> <span class="nt">-f</span> batch-byte-compile <span class="nv">$&lt;</span>
<span class="k">endif</span>
<span class="c"># ----------------------------------------------------------------------------
# main part
</span><span class="nl">$(EL)</span><span class="o">:</span> <span class="nf">init.el</span>
<span class="nl">init.el</span><span class="o">:</span> <span class="nf">README.org</span>
	<span class="p">@</span><span class="nb">mkdir</span> <span class="nt">-p</span> elpa
	<span class="p">$(</span>EMACS<span class="p">)</span> <span class="nt">--batch</span> <span class="nt">--eval</span> <span class="se">\</span>
	   <span class="s2">"(progn </span><span class="se">\</span><span class="s2">
		  (require 'ob-tangle) </span><span class="se">\</span><span class="s2">
		  (org-babel-tangle-file </span><span class="se">\"</span><span class="nv">$&lt;</span><span class="se">\"</span><span class="s2"> </span><span class="se">\"</span><span class="nv">$@</span><span class="se">\"</span><span class="s2"> </span><span class="se">\"</span><span class="s2">emacs-lisp</span><span class="se">\"</span><span class="s2">))"</span>
	<span class="p">@</span><span class="k">if</span> <span class="o">[</span> x<span class="s2">"</span><span class="p">$(</span><span class="s2">TREESIT</span><span class="p">)</span><span class="s2">"</span> <span class="o">=</span> x<span class="s2">"yes"</span> <span class="nt">-a</span> <span class="o">!</span> <span class="nt">-f</span> tree-sitter/libtree-sitter-elisp.so <span class="o">]</span> <span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
		<span class="p">$(</span>EMACS<span class="p">)</span> <span class="nt">--batch</span> <span class="nt">--eval</span> <span class="se">\</span>
		  <span class="s2">"(progn </span><span class="se">\</span><span class="s2">
			(setq treesit-language-source-alist </span><span class="se">\</span><span class="s2">
			  '((elisp </span><span class="se">\"</span><span class="s2">https://github.com/Wilfred/tree-sitter-elisp</span><span class="se">\"</span><span class="s2">))) </span><span class="se">\</span><span class="s2">
			(treesit-install-language-grammar 'elisp)))"</span> <span class="p">;</span><span class="se">\</span>
	<span class="k">fi</span>
	<span class="p">$(</span>EMACS<span class="p">)</span> <span class="p">$(</span>LOAD<span class="p">)</span> <span class="nt">--batch</span> <span class="nt">--eval</span> <span class="s1">'(kill-emacs)'</span>
<span class="c"># ----------------------------------------------------------------------------
# create subdirectory symlink
</span><span class="k">ifeq</span> <span class="nv">($(NATIVE_COMP_DIR),yes)</span>
<span class="nl">README.org</span><span class="o">:</span> <span class="nf">tree-sitter</span>
<span class="k">else</span>
<span class="nl">README.org</span><span class="o">:</span> <span class="nf">eln-cache tree-sitter</span>
<span class="k">endif</span>
<span class="nl">tree-sitter</span><span class="o">:</span>
	<span class="p">@</span><span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-d</span> ~/.cache/emacs/tree-sitter <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
		<span class="nb">echo</span> <span class="s2">";; mkdir ~/.cache/emacs/tree-sitter"</span><span class="p">;</span> <span class="nb">mkdir</span> ~/.cache/emacs/tree-sitter <span class="p">;</span><span class="se">\</span>
	<span class="k">fi</span>
	<span class="p">@</span><span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-L</span> tree-sitter <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
		<span class="nb">echo</span> <span class="s2">";; ln -sf ~/.cache/emacs/tree-sitter . "</span><span class="p">;</span> <span class="nb">ln</span> <span class="nt">-sf</span> ~/.cache/emacs/tree-sitter <span class="nb">.</span> <span class="p">;</span><span class="se">\</span>
	<span class="k">fi</span>
<span class="nl">eln-cache</span><span class="o">:</span>
	<span class="p">@</span><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.cache/emacs
	<span class="p">@</span><span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-d</span> ~/.cache/emacs/eln-cache <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
		<span class="nb">echo</span> <span class="s2">";; mkdir ~/.cache/emacs/eln-cache"</span><span class="p">;</span> <span class="nb">mkdir</span> ~/.cache/emacs/eln-cache <span class="p">;</span><span class="se">\</span>
	<span class="k">fi</span>
	<span class="p">@</span><span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-L</span> <span class="nv">$@</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
		<span class="nb">echo</span> <span class="s2">";; ln -sf ~/.cache/emacs/eln-cache . "</span><span class="p">;</span> <span class="nb">ln</span> <span class="nt">-sf</span> ~/.cache/emacs/eln-cache <span class="nb">.</span> <span class="p">;</span><span class="se">\</span>
	<span class="k">fi</span>
<span class="c"># ----------------------------------------------------------------------------
</span><span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-fr</span> auto-save-list <span class="k">*</span>.el <span class="k">*</span>.elc <span class="k">*</span>~
<span class="nl">distclean</span><span class="o">:</span> <span class="nf">clean</span>
	<span class="nb">rm</span> <span class="nt">-fr</span> elpa
	<span class="nb">rm</span> <span class="nt">-fr</span> eln-cache/<span class="k">*</span>
	<span class="nb">rm</span> <span class="nt">-f</span> eln-cache
	<span class="nb">rm</span> <span class="nt">-fr</span> tree-sitter/<span class="k">*</span>
	<span class="nb">rm</span> <span class="nt">-f</span> tree-sitter
	<span class="nb">rm</span> <span class="nt">-f</span> ~/.cache/emacs/package-quickstart.<span class="k">*</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org990b5166">設定ファイルのヘッダ</h2>
<div class="outline-text-2" id="text-org990b5166">
<p>
出力される <code>init.el</code> 用のヘッダは以下の通り.
<code>lexsical-binding</code> を有効にしておきます．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -*- lexical-binding: t -*-</span>
<span class="c1">;; (require 'profiler)</span>
<span class="c1">;; (profiler-start 'cpu)</span></code></pre></figure>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -*- lexical-binding: t -*-</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org60bad8a3">
<span class="todo TODO">TODO</span> ディレクトリ構成の修正 <code>[0/2]</code>
</h2>
<div class="outline-text-2" id="text-org60bad8a3">
<p>
分割した設定ファイル群やパッケージでinstallしたパッケージ
の置き場所は <code>user-emacs-directory</code> 以下にまとめられます.
<del>パッケージによって置き方はかなり野放図ですよねぇ.</del>
</p>


<p>
ディレクトリ構成は以下のようにしました:
</p>
<pre class="example">
    ~/.emacs.d/
     |-- Makefile    ←  byte-compile 用の rule
     |-- README.org  ←  本ファイル．`org-babel-tangle' で init.el を生成
     |-- elpa/       ←  package.el で導入したパッケージが置かれる場所
     |-- share/      ←  (基本的に)参照するだけの資源置き場所
         `-- tree-sitter ← ~/.cache/emacs/tree-sitter への symlink: treesit-auto のインストール先
    ~/.cache/emacs   ←  一次ファイルの置き場所
</pre>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> <a href="https://github.com/rsnodgrass/emacs-xdg">rsnodgrass/emacs-xdg: XDG Base Directory Specification for Emacs</a> を使った方が良い?
<ul class="org-ul">
<li>Emacs ≧ 29.4 でサポートしている模様</li>
<li>
<code>early-init.el</code> で, これ↑ 使えるかな?</li>
</ul>
</li>
<li class="off">
<code>[ ]</code> <a href="https://github.com/emacscollective/no-littering">no-littering</a> あたりで整理した方が良いかなぁ.
<ul class="org-ul">
<li>treesit のインストール先がハードコードされている. これを変えたい</li>
<li>
<p>
~/.emacs.d/eln-cache を変更できないか? ← 少なくとも Emacs ≧ 29.1 ではできた.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">startup-redirect-eln-cache</span>
 <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"~/.local/share/emacs/eln-cache/"</span><span class="p">))</span></code></pre></figure>
<p>
で OK.
</p>
</li>
</ul>
</li>
</ul>

<p>
上記ディレクトリ構成を設定ファイルで使用するために
ディレクトリ配置を宣言しておきます.
ついでに, <code>share/elisp</code> 以下のディレクトリを load-path に追加しておきます.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-and-compile</span>
  <span class="p">(</span><span class="nb">when</span> <span class="nv">load-file-name</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">user-emacs-directory</span>
          <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nv">file-name-directory</span> <span class="nv">load-file-name</span><span class="p">)))))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:share</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"share/"</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:tmp</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"~/.cache/emacs"</span><span class="p">))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:org</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"~/Nextcloud/org"</span><span class="p">))</span>
<span class="c1">;;</span>
<span class="c1">;; (dolist (dir (let ((dir (expand-file-name "elisp" my:d:share)))</span>
<span class="c1">;;                (list dir (format "%s%d" dir emacs-major-version))))</span>
<span class="c1">;;   (when (and (stringp dir) (file-directory-p dir))</span>
<span class="c1">;;     (let ((default-directory dir))</span>
<span class="c1">;;       (add-to-list 'load-path default-directory)</span>
<span class="c1">;;       (normal-top-level-add-subdirs-to-load-path))))</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org87c9febb">Byte-Compile 時の Common Lisp の読み込み</h2>
<div class="outline-text-2" id="text-org87c9febb">
<p>
幾つかの関数で <code>Common-Lisp</code> 的挙動が期待されているので,
<code>cl-lib</code> を読み込んでおきます．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-when-compile</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'cl-lib</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span></code></pre></figure>
<p>
また, Emacs ≧ 27 は cl が読み込まれていると
`Package cl is deprecated' が表示されるので, これを止めておきます.
他にも幾つかの警告を無効化しておきます.
特に, 意図的に <code>setq</code> を優先して使っているので,
debug 時以外は <code>free-vars</code> と <code>unresolved</code> も無効化しておかないと騒々しいですよね.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-and-compile</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">byte-compile-warnings</span> <span class="o">'</span><span class="p">(</span><span class="nb">not</span> <span class="nv">cl-functions</span> <span class="nv">free-vars</span> <span class="nv">docstrings</span> <span class="nv">unresolved</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
<p>
native compile: 気になった時に動かしています.
Makefile から叩いて処理できると良いんですけどね…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:native-compile-async-all</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">native-comp-async-jobs-number</span> <span class="mi">8</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">native-compile-async</span> <span class="s">"~/.emacs.d/init.el"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">native-compile-async</span> <span class="s">"~/.emacs.d/early-init.el"</span><span class="p">)</span>
  <span class="c1">;; (native-compile-async "~/.emacs.d/share/elisp/" 'recursively)</span>
  <span class="p">(</span><span class="nv">native-compile-async</span> <span class="s">"~/.emacs.d/elpa"</span> <span class="ss">'recursively</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgae182d4d">
<code>early-init.el</code>: 起動の高速化</h2>
<div class="outline-text-2" id="text-orgae182d4d">
<p>
この辺は <a href="https://emacs-jp.github.io/tips/startup-optimization">Emacs の起動時間を"詰める"</a> を参考に.
</p>

<p>
<code>early-intt.el</code> は
Emacs ≧ 27 からの機能なので
org-tangle から init.el を生成する際には
</p>

<p>
<code>#+begin_src emacs-lisp :tangle (if (boundp 'early-init-file) "early-init.el" "init.el")</code>
</p>

<p>
としておく.
</p>

<p>
他にも設定しておいた方が良い事はあるかな?
</p>
</div>
<div>
<h3 id="org77e2f299">GC の設定</h3>
<div class="outline-text-3" id="text-org77e2f299">
<p>
起動時に garbage collection を発生させない様にする.
</p>

<p>
メモリ喰いな拡張を入れている場合には,
安易に <code>gc-cons-threshold</code> を上げるのは考えものである.
「gc が走る→大きな領域を掃除するのでその間 emacs が止まる」
という事を頻繁に経験することになるだろう.
</p>

<p>
とはいえ, デフォルト値のままだと
起動時に結構 garbage-collect が走って遅くなるので,
起動時には <code>most-positive-fixnum</code> にしておいて,
起動後に <code>emacs-startup-hook</code> で default に戻すようにしてみた.
</p>

<p>
ついでに <code>idle-timer</code> で入力が無い時に GC を走らせることにする
</p>
</div>
<div>
<h4 id="org3977c5ee">起動時の GC threshold の最大化</h4>
<div class="outline-text-4" id="text-org3977c5ee">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">gc-cons-threshold</span> <span class="nv">most-positive-fixnum</span>
      <span class="nv">garbage-collection-messages</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
<a href="#org0bd0c625"><code>esup</code></a> がまだ <code>early-init.el</code> を読まないので,
init.el でも gc-cons-threshold を設定しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">gc-cons-threshold</span> <span class="nv">most-positive-fixnum</span><span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li><a href="https://github.com/jschaf/esup/issues/93">early-init.el is not included in profiling · Issue #93 · jschaf/esup</a></li>
</ul>
</div>
</div>
<div>
<h4 id="org9584246f">
<span class="todo TODO">TODO</span> 起動後に GC Threshold を既定値に戻す <code>[/]</code>
</h4>
<div class="outline-text-4" id="text-org9584246f">
<p>
以前は以下を設定していたが, 最近は <code>gcmh</code> に任せる事にした.
→ <a href="#org414ff0d8"><code>gcmh</code>: 賢い garbage-collection</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">garbage-collection-messages</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; Run GC every 60 seconds if emacs is idle.</span>
<span class="p">(</span><span class="nv">run-with-idle-timer</span> <span class="mf">60.0</span> <span class="no">t</span> <span class="nf">#'</span><span class="nv">garbage-collect</span><span class="p">)</span>
<span class="c1">;; 起動後に初期値に戻す.</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'emacs-startup-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">gc-cons-threshold</span> <span class="mi">800000</span><span class="p">)))</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> gcmh は無駄にタイマーを増やし過ぎて, 結果, 自分が増やしたタイマーで GC を走らせる, という指摘もある.</li>
</ul>
</div>
</div>
</div>
<div>
<h3 id="orgd896c3a2">Package初期化処理</h3>
<div class="outline-text-3" id="text-orgd896c3a2">
<p>
本体でやっても良いけど, ここに持ってきても良いらしい.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">with-eval-after-load</span> <span class="s">"package"</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">package-archives</span> <span class="o">'</span><span class="p">((</span><span class="s">"gnu"</span>    <span class="o">.</span> <span class="s">"https://elpa.gnu.org/packages/"</span><span class="p">)</span>
                           <span class="p">(</span><span class="s">"melpa"</span>  <span class="o">.</span> <span class="s">"https://melpa.org/packages/"</span><span class="p">)</span>
                           <span class="p">(</span><span class="s">"nongnu"</span> <span class="o">.</span> <span class="s">"https://elpa.nongnu.org/nongnu/"</span><span class="p">)</span>
                           <span class="p">)</span>
        <span class="nv">package-enable-at-startup</span> <span class="no">nil</span>
        <span class="nv">package-gnupghome-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">".gnupg"</span> <span class="s">"~/"</span><span class="p">)</span>
        <span class="nv">package-quickstart</span> <span class="no">t</span>
        <span class="nv">package-quickstart-file</span> <span class="s">"~/.cache/emacs/package-quickstart.el"</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgc5c74cbf">Native Compile の設定</h3>
<div class="outline-text-3" id="text-orgc5c74cbf">
<p>
Native Compile に関連する設定(Emacs ≧ 29).
保存先の移動などなど.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">startup-redirect-eln-cache</span>
 <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"~/.cache/emacs/eln-cache/"</span><span class="p">))</span></code></pre></figure>
<p>
どうにも org-element-* は native compile すると挙動不振だったので外している.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">with-eval-after-load</span> <span class="s">"comp"</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">native-comp-async-jobs-number</span> <span class="mi">8</span>
        <span class="nv">native-comp-jit-compilation-deny-list</span> <span class="o">'</span><span class="p">(</span><span class="s">"\\(.*org-element.*\\|.*-loaddefs\\|.*-autoloads\\)\\.\\(el\\.gz\\|el\\)"</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgb6dd6727">Magic File Name を一時的に無効化</h3>
<div class="outline-text-3" id="text-orgb6dd6727">
<p>
これだけで 0.2秒縮まった. これは知見である.
</p>

<p>
起動時には一旦空にしておいて,
起動後に(諸々読み込まれて)更新された <code>file-name-handler</code> と合わせて復元する.
</p>
</div>
<div>
<h4 id="org812e4b3a">Magic File Name を無効化</h4>
<div class="outline-text-4" id="text-org812e4b3a">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:saved-file-name-handler-alist</span> <span class="nv">file-name-handler-alist</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">file-name-handler-alist</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org42900264">起動後の Magic File Name の復元</h4>
<div class="outline-text-4" id="text-org42900264">
<p>
起動後に <code>emacs-startup-hook</code> にて,
パッケージの読み込みで追加された値と save しておいた値を合わせて復元
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'emacs-startup-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">handler</span> <span class="nv">my:saved-file-name-handler-alist</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'file-name-handler-alist</span> <span class="nv">handler</span><span class="p">))))</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h3 id="orgcb2bfa7b">その他, 雑多な GUI 関連の設定</h3>
<div class="outline-text-3" id="text-orgcb2bfa7b">
<p>
見た目: tabbar, toolbar, menubar などの非表示, beep の無効化など
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">inhibit-x-resources</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">advice-add</span> <span class="ss">'x-apply-session-resources</span> <span class="ss">:override</span> <span class="ss">'ignore</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">inhibit-compacting-font-caches</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">default-frame-alist</span>
      <span class="o">'</span><span class="p">((</span><span class="nv">fullscreen</span> <span class="o">.</span> <span class="nv">maximized</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">menu-bar-lines</span> <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">tool-bar-lines</span> <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">vertical-scroll-bars</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">horizontal-scroll-bars</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">blink-cursor-mode</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">column-number-name</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">frame-inhibit-implied-resize</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">ring-bell-function</span> <span class="ss">'ignore</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">use-file-dialog</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">use-short-answers</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
スタートアップメッセージの抑制
昔設定していたアレコレは以下の様にマトめられていた
</p>
<ul class="org-ul">
<li>alias: <code>inhibit-splash-screen</code> → <code>inhibit-startup-screen</code>
</li>
<li>alias: <code>inhibit-startup-message</code> → <code>inhibit-startup-screen</code>
</li>
</ul>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">inhibit-startup-screen</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
起動時の自動生成ファイルを無効化
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; バックアップファイル(foo.txt~など)は生成しない</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">make-backup-files</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; 排他制御ロックファイル(.#foo.txtなど)は生成しない</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">create-lockfiles</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">auto-save-default</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">auto-save-list-file-prefix</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
以下はここで設定するのが良いのかいまいちわかっていないあれこれ.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">setq-default</span> <span class="nv">vc-handled-backends</span> <span class="o">'</span><span class="p">(</span><span class="nv">Git</span><span class="p">))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">vc-follow-symlinks</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">history-delete-duplicates</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">load-prefer-newer</span> <span class="nv">noninteractive</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">site-run-file</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nb">provide</span> <span class="ss">'early-init</span><span class="p">)</span>
<span class="c1">;;; early-init.el ends here</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org0242b000">起動時間の計測</h3>
<div class="outline-text-3" id="text-org0242b000">
<p>
<a href="https://zenn.dev/takeokunn/articles/56010618502ccc">Emacsを世界最速級で起動する方法</a> より
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:inhibit-startup-echo-area-message-advice</span> <span class="p">()</span>
  <span class="s">"Do nothing to inhibit the startup echo area message."</span>
  <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; 起動時の案内を表示する関数を「何もしない関数」に差し替える</span>
<span class="p">(</span><span class="nv">advice-add</span> <span class="ss">'display-startup-echo-area-message</span>
            <span class="ss">:override</span> <span class="nf">#'</span><span class="nv">my:inhibit-startup-echo-area-message-advice</span><span class="p">)</span>
<span class="c1">;; 起動時間の計測</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:before-load-init-time</span> <span class="p">(</span><span class="nv">current-time</span><span class="p">))</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:display-boot-summary</span> <span class="p">()</span>
  <span class="s">"Assemble and display a single boot summary message in the echo area."</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">(</span><span class="c1">;; Emacs 本体の起動時間 (before-init-time から after-init-time)</span>
         <span class="p">(</span><span class="nv">total-emacs-time</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">1000</span> <span class="p">(</span><span class="nv">float-time</span> <span class="p">(</span><span class="nv">time-subtract</span> <span class="nv">after-init-time</span> <span class="nv">before-init-time</span><span class="p">))))</span>
         <span class="c1">;; init.el のロード開始から after-init-hook までの時間</span>
         <span class="p">(</span><span class="nv">init-load-time</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">1000</span> <span class="p">(</span><span class="nv">float-time</span> <span class="p">(</span><span class="nv">time-subtract</span> <span class="nv">after-init-time</span> <span class="nv">my:before-load-init-time</span><span class="p">))))</span>
         <span class="c1">;; after-init-hook 自体の実行にかかった時間</span>
         <span class="p">(</span><span class="nv">after-init-hook-time</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">1000</span> <span class="p">(</span><span class="nv">float-time</span> <span class="p">(</span><span class="nv">time-subtract</span> <span class="p">(</span><span class="nv">current-time</span><span class="p">)</span> <span class="nv">after-init-time</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nv">message</span> <span class="s">"Boot Summary: Total %.0fms [Emacs: %.0fms, Init: %.0fms, Hooks: %.0fms]"</span>
             <span class="p">(</span><span class="nb">+</span> <span class="nv">total-emacs-time</span> <span class="nv">after-init-hook-time</span><span class="p">)</span> <span class="c1">; およその全体感</span>
             <span class="nv">total-emacs-time</span>
             <span class="nv">init-load-time</span>
             <span class="nv">after-init-hook-time</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'after-init-hook</span> <span class="nf">#'</span><span class="nv">my:display-boot-summary</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="orgcf4176e7">Package 関連: <a href="https://emacs-jp.github.io/packages/package-management/package-el">package.el</a>, <a href="https://github.com/conao3/leaf.el">leaf.el</a>
</h2>
<div class="outline-text-2" id="text-orgcf4176e7">
<p>
<a href="https://github.com/conao3/leaf.el">leaf.el</a>のおかげで,
無いと途方に暮れるパッケージ以外のインストールは無視できるようになります.
</p>
</div>
<div>
<h3 id="org61dc7202">
<span class="todo TODO">TODO</span> <a href="https://emacs-jp.github.io/packages/package-management/package-el">package.el</a> の初期化処理 <code>[/]</code>
</h3>
<div class="outline-text-3" id="text-org61dc7202">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; esup が early-init を呼ばない...</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">package-quickstart-file</span> <span class="s">"~/.cache/emacs/package-quickstart.el"</span>
      <span class="nv">package-quickstart</span> <span class="no">t</span><span class="p">)</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:package-quickstart-refresh-silently</span> <span class="p">()</span>
  <span class="s">"Compile-Log を表示せずに package-quickstart-refresh を実行するラッパー関数"</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">byte-compile-warnings</span> <span class="no">nil</span><span class="p">)</span>      <span class="c1">;; 警告を生成しない</span>
        <span class="p">(</span><span class="nv">byte-compile-verbose</span> <span class="no">nil</span><span class="p">)</span>       <span class="c1">;; 詳細ログを出さない</span>
        <span class="p">(</span><span class="nv">inhibit-message</span> <span class="no">t</span><span class="p">)</span>              <span class="c1">;; メッセージエリアの出力も抑制</span>
        <span class="c1">;; *Compile-Log* バッファが表示されようとしたら「何もしない」設定にする</span>
        <span class="p">(</span><span class="nv">display-buffer-alist</span>
         <span class="o">'</span><span class="p">((</span><span class="s">"\\*Compile-Log\\*"</span> <span class="nv">display-buffer-no-window</span> <span class="p">(</span><span class="nv">allow-no-window</span> <span class="o">.</span> <span class="no">t</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nv">with-current-buffer</span> <span class="p">(</span><span class="nv">get-buffer-create</span> <span class="s">"*Compile-Log*"</span><span class="p">)</span>
      <span class="c1">;; 念のためログバッファを空にしておく（以前のログが残っているとポップアップの原因になることがあるため）</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inhibit-read-only</span> <span class="no">t</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">erase-buffer</span><span class="p">)))</span>
    <span class="c1">;; 実行</span>
    <span class="p">(</span><span class="nv">package-quickstart-refresh</span><span class="p">)))</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'kill-emacs-hook</span> <span class="nf">#'</span><span class="nv">my:package-quickstart-refresh-silently</span><span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> 起動時にはここが一番時間がかかっている.</li>
</ul>
</div>
</div>
<div>
<h3 id="orgc2ededbf"><a href="https://github.com/conao3/leaf.el">leaf.el</a></h3>
<div class="outline-text-3" id="text-orgc2ededbf">
<p>
個々のパッケージの設定には<a href="https://github.com/conao3/leaf.el">leaf.el</a>を利用します.
以前は el-get も利用していましたが,
<code>:vc</code> キーワードで <code>package-vc-install</code> を呼び出せるので, こっちを使うようになりました.
</p>
<ul class="org-ul">
<li class="on">
<code>[X]</code> <code>package-vc-install</code> でインストールした諸々って, package-upgrade 後に delete 対象になる?
→ send PR: <a href="https://github.com/conao3/leaf.el/pull/552">leaf-handler-vc: Add package to package-selected-packages by uwabami · Pull Request #552 · conao3/leaf.el</a>
</li>
</ul>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; ---------------------------------------------------------------------------</span>
<span class="p">(</span><span class="nv">eval-and-compile</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">featurep</span> <span class="ss">'leaf</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="ss">'leaf</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">package-install</span> <span class="ss">'leaf</span> <span class="no">t</span><span class="p">))))</span>
<span class="c1">;; ---------------------------------------------------------------------------</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">leaf-keywords</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">blackout</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">shut-up</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">leaf-keywords-init</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org9c1823a4">
<code>package-vc-install</code> の調整</h3>
<div class="outline-text-3" id="text-org9c1823a4">
<p>
package-vc-install を直接叩く事は無くて,
leaf の <code>:vc</code> キーワードでインストールします.
ただ, package-vc-install はリポジトリに既に .el が存在すること前提としていて
make によって .el が生成される場合にはちょっと不便だったりします.
よって, これを解決する <code>:advice</code> で追加しておきます.
</p>

<p>
make を叩く必要があるパッケージは
個別に <code>:preface</code> キーワードで
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'package-vc-allow-build-commands</span> <span class="ss">'hogehero</span><span class="p">)</span></code></pre></figure>
<p>
と指定する様にしました.
</p>

<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">package-vc</span>
  <span class="ss">:doc</span> <span class="s">"Extend package-vc to support post-make autoload generation"</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="c1">;; 呼び出されるまで変数が見えないので custom に移動していくことに</span>
  <span class="ss">:custom</span> <span class="p">(</span><span class="nv">package-vc-allow-build-commands</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:package-vc-regenerate-autoloads-after-make</span> <span class="p">(</span><span class="nv">pkg-spec</span> <span class="nv">pkg-desc</span><span class="p">)</span>
    <span class="s">"Regenerate autoloads after `package-vc--make' if new .el files were generated."</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">pkg-dir</span> <span class="p">(</span><span class="nv">package-desc-dir</span> <span class="nv">pkg-desc</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">name</span> <span class="p">(</span><span class="nv">package-desc-name</span> <span class="nv">pkg-desc</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">lisp-dir</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">pkg-spec</span> <span class="ss">:lisp-dir</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">lisp-path</span> <span class="p">(</span><span class="nv">file-name-concat</span> <span class="nv">pkg-dir</span> <span class="nv">lisp-dir</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">lisp-path</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">message</span> <span class="s">"Regenerating autoloads for %s in %s..."</span> <span class="nv">name</span> <span class="nv">lisp-path</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">package-generate-autoloads</span> <span class="nv">name</span> <span class="nv">lisp-path</span><span class="p">))))</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:package-vc-register-as-selected</span> <span class="p">(</span><span class="nv">pkg</span> <span class="k">&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
    <span class="s">"Add PKG to `package-selected-packages' and save it to `custom-file'."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">pkg-name</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">listp</span> <span class="nv">pkg</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">pkg</span><span class="p">)</span> <span class="nv">pkg</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="nv">pkg-name</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">memq</span> <span class="nv">pkg-name</span> <span class="nv">package-selected-packages</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">customize-save-variable</span>
           <span class="ss">'package-selected-packages</span>
           <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'package-selected-packages</span> <span class="nv">pkg-name</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">message</span> <span class="s">"package-vc: Registered %s as a selected package."</span> <span class="nv">pkg-name</span><span class="p">)))))</span>
  <span class="ss">:advice</span>
  <span class="p">((</span><span class="ss">:after</span> <span class="nv">package-vc--make</span>
           <span class="nv">my:package-vc-regenerate-autoloads-after-make</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">:after</span> <span class="nv">package-vc-install</span>
           <span class="nv">my:package-vc-register-as-selected</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org34ff2306">独自関数など</h2>
<div class="outline-text-2" id="text-org34ff2306">
<p>
自分のためのツールなど.
</p>
</div>
<div>
<h3 id="org1eb544d6">OS判定用の定数</h3>
<div class="outline-text-3" id="text-org1eb544d6">
<p>
最近, あんまり環境で分岐していないので, 実は不要?
どちらかというと WSL 環境の判定が欲しい所.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defconst</span> <span class="nv">is-mac</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'darwin</span><span class="p">))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">is-linux</span> <span class="p">(</span><span class="nv">memq</span> <span class="nv">system-type</span> <span class="o">'</span><span class="p">(</span><span class="nv">gnu</span> <span class="nv">gnu/linux</span> <span class="nv">gnu/kfreebsd</span> <span class="nv">berkeley-unix</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">is-windows</span> <span class="p">(</span><span class="nv">memq</span> <span class="nv">system-type</span> <span class="o">'</span><span class="p">(</span><span class="nv">cygwin</span> <span class="nv">windows-nt</span> <span class="nv">ms-dos</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org452a76a8">ファイル名を minibuffer におさまる様に整形</h3>
<div class="outline-text-3" id="text-org452a76a8">
<p>
zsh prompt風味．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:shorten-file-path</span> <span class="p">(</span><span class="nv">fpath</span> <span class="nv">max-length</span><span class="p">)</span>
  <span class="s">"Show up to `max-length' characters of a directory name `fpath' like zsh"</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">path</span> <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nv">split-string</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span> <span class="nv">fpath</span><span class="p">)</span> <span class="s">"/"</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">output</span> <span class="s">""</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">top</span> <span class="p">(</span><span class="nv">mapconcat</span> <span class="ss">'identity</span> <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nb">last</span> <span class="nv">path</span> <span class="mi">3</span><span class="p">))</span> <span class="s">"/"</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">vmax</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">max-length</span> <span class="mi">4</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">top</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">path</span> <span class="p">(</span><span class="nb">butlast</span> <span class="nv">path</span> <span class="mi">3</span><span class="p">))</span>
         <span class="p">)</span>
    <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">path</span>
                <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">output</span><span class="p">)</span> <span class="nv">vmax</span><span class="p">)</span> <span class="c1">;; &gt; (for syntax)</span>
                     <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"/"</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">path</span><span class="p">)</span> <span class="nv">output</span><span class="p">))</span> <span class="nv">vmax</span><span class="p">)))</span> <span class="c1">;; &gt; (for syntax)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">output</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"/"</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">path</span><span class="p">)</span> <span class="nv">output</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">path</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">path</span><span class="p">)))</span>
    <span class="c1">;; 省略</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">path</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">output</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"/..."</span> <span class="nv">output</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="s">"%s%s"</span> <span class="nv">top</span> <span class="nv">output</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org5b521483">空になったファイルを尋ねずに自動削除</h3>
<div class="outline-text-3" id="text-org5b521483">
<p>
ゴミが残らないし, 地味に便利．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:delete-file-if-no-contents</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">buffer-file-name</span> <span class="p">(</span><span class="nv">current-buffer</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">=</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">delete-file</span>
     <span class="p">(</span><span class="nv">buffer-file-name</span> <span class="p">(</span><span class="nv">current-buffer</span><span class="p">)))))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'after-save-hook</span> <span class="ss">'my:delete-file-if-no-contents</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orge279b0e0">scratch を殺さない. 消したら再生成</h3>
<div class="outline-text-3" id="text-orge279b0e0">
<p>
…元ネタがどこだったのか忘れてしまった…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -------------------------------------------------------------------</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:make-scratch</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">arg</span><span class="p">)</span>
  <span class="s">" *scratch* を作成して buffer-list に放り込む."</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">progn</span>
    <span class="p">(</span><span class="nv">set-buffer</span> <span class="p">(</span><span class="nv">get-buffer-create</span> <span class="s">"*scratch*"</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">funcall</span> <span class="nv">initial-major-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">erase-buffer</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">initial-scratch-message</span> <span class="p">(</span><span class="nb">not</span> <span class="nv">inhibit-startup-message</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">insert</span> <span class="nv">initial-scratch-message</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">or</span> <span class="nv">arg</span>
        <span class="p">(</span><span class="k">progn</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">switch-to-buffer</span> <span class="s">"*scratch*"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">=</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">message</span> <span class="s">"*scratch* is cleared up."</span><span class="p">))</span>
          <span class="p">((</span><span class="nb">=</span> <span class="nv">arg</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">message</span> <span class="s">"another *scratch* is created"</span><span class="p">)))))</span>
<span class="c1">;; -------------------------------------------------------------------</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:buffer-name-list</span> <span class="p">()</span>
  <span class="s">"buffer 一覧の取得"</span>
  <span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">function</span> <span class="nv">buffer-name</span><span class="p">)</span> <span class="p">(</span><span class="nv">buffer-list</span><span class="p">)))</span>
<span class="c1">;; -------------------------------------------------------------------</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'kill-buffer-query-functions</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">string=</span> <span class="s">"*scratch*"</span> <span class="p">(</span><span class="nv">buffer-name</span><span class="p">))</span>
                <span class="p">(</span><span class="k">progn</span> <span class="p">(</span><span class="nv">my:make-scratch</span> <span class="mi">0</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
              <span class="no">t</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'after-save-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">member</span> <span class="s">"*scratch*"</span> <span class="p">(</span><span class="nv">my:buffer-name-list</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">my:make-scratch</span> <span class="mi">1</span><span class="p">))))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org194b826d">ターミナルで <code>C-M-</code> を打つために</h3>
<div class="outline-text-3" id="text-org194b826d">
<p>
詳細は
<a href="https://superuser.com/questions/83166/using-c-m-to-do-a-query-replace-regexp-in-emacs-running-in-mac-terminal">Using C-M-% to do a query-replace-regexp in Emacs running in Mac terminal</a>
を参照のこと. terminal では <code>C-%</code> (つまり <code>Control-Shift-5</code> )が入力できない, という話.
</p>

<p>
代わりに <code>C-x @</code> を <code>C-M-</code> に解釈させるように設定しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -------------------------------------------------------------------</span>
<span class="c1">;;;###autoload</span>
<span class="c1">; cargo cult adaptation of event-apply-control-modifier</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:event-apply-control-meta-modifiers</span> <span class="p">(</span><span class="nv">ignore-prompt</span><span class="p">)</span>
  <span class="p">(</span><span class="k">ignore</span> <span class="nv">ignore-prompt</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">vector</span>
   <span class="p">(</span><span class="nv">event-apply-modifier</span> <span class="p">(</span><span class="nv">event-apply-modifier</span> <span class="p">(</span><span class="nv">read-event</span><span class="p">)</span>
                                               <span class="ss">'control</span> <span class="mi">26</span> <span class="s">"C-"</span><span class="p">)</span>
                         <span class="ss">'meta</span> <span class="mi">27</span> <span class="s">"M-"</span><span class="p">)))</span>
<span class="c1">;; -------------------------------------------------------------------</span>
<span class="p">(</span><span class="nv">define-key</span> <span class="nv">function-key-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-x @"</span><span class="p">)</span> <span class="ss">'my:event-apply-control-meta-modifiers</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org92585125">カーソルのある位置の face を調べる関数</h3>
<div class="outline-text-3" id="text-org92585125">
<p>
わりと良く使う. 地味に便利
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -------------------------------------------------------------------</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:describe-face-at-point</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">message</span> <span class="s">"%s"</span> <span class="p">(</span><span class="nv">get-text-property</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="ss">'face</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org31cde696">行末からfill-columnの値まで線を引く</h3>
<div class="outline-text-3" id="text-org31cde696">
<p>
地味に便利
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -------------------------------------------------------------------</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:fill-line-with-char</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nb">char</span><span class="p">)</span>
  <span class="s">"行末から fill-column まで文字 (デフォルトは -) で埋めるコマンド.
行末が空白でない場合は, 自動的にスペースを 1 つ挿入してから線を引く.
C-u を付けて実行すると, 埋める文字を指定可能(例: = や * など). "</span>
  <span class="p">(</span><span class="nv">interactive</span> <span class="s">"P"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">target-char</span> <span class="p">(</span><span class="k">if</span> <span class="nb">char</span>
                         <span class="p">(</span><span class="nb">read-char</span> <span class="s">"Fill character: "</span><span class="p">)</span>
                       <span class="nv">?-</span><span class="p">)))</span> <span class="c1">;; デフォルトはハイフン</span>
    <span class="p">(</span><span class="nv">save-excursion</span>
      <span class="p">(</span><span class="nv">end-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">current</span> <span class="p">(</span><span class="nv">current-column</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">limit</span> <span class="nv">fill-column</span><span class="p">))</span>
        <span class="c1">;; 既に fill-column を超えている、または到達している場合は何もしない</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">current</span> <span class="nv">limit</span><span class="p">)</span>
          <span class="c1">;; 行末が空白でなく、かつ行頭でもない場合はスペースを1つ入れる</span>
          <span class="c1">;;    (例: "!" -&gt; "! " にしてから線を引くため)</span>
          <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">bolp</span><span class="p">)</span> <span class="p">(</span><span class="nv">memq</span> <span class="p">(</span><span class="nv">char-before</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nv">?\s</span> <span class="nv">?\t</span><span class="p">)))</span>
            <span class="p">(</span><span class="nv">insert</span> <span class="s">" "</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">current</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">current</span><span class="p">)))</span>
          <span class="c1">;; 3. 残りの幅を計算して文字を挿入</span>
          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">len</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">limit</span> <span class="nv">current</span><span class="p">)))</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">len</span> <span class="mi">0</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">insert-char</span> <span class="nv">target-char</span> <span class="nv">len</span><span class="p">))))))))</span>
<span class="c1">;; -------------------------------------------------------------------</span>
<span class="c1">;; とりあえず C-c l に割り当ててみる.</span>
<span class="c1">;; 何か意味のあるキーが良いのだけれどなぁ</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c l"</span><span class="p">)</span> <span class="nf">#'</span><span class="nv">my:fill-line-with-char</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org414ff0d8">
<code>gcmh</code>: 賢い garbage-collection</h2>
<div class="outline-text-2" id="text-org414ff0d8">
<p>
割と速い段階で設定しておきたくてここに書いたけれど,
実際には <code>emacs-startup-hook</code> で起動するので, 最後辺りで有効になる.
→ 「gcmh はタイマーを沢山増やすので, 結果として自分で GC をまわすことになるので有害」
  という話もあって悩み所.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">gcmh</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:blackout</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">gcmh-idle-delay</span> <span class="ss">'auto</span>  <span class="c1">; アイドル判定を自動調整</span>
        <span class="nv">gcmh-auto-idle-delay-factor</span> <span class="mi">10</span>
        <span class="nv">gcmh-high-cons-threshold</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">128</span> <span class="mi">1024</span> <span class="mi">1024</span><span class="p">))</span> <span class="c1">; 入力中は 128MB まで許容</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">gcmh-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org9abae8f2">
<code>exec-path-from-shell</code>: GUI起動時の環境変数の読み込み</h2>
<div class="outline-text-2" id="text-org9abae8f2">
<p>
ターミナルでEmacsを起動する場合は不要だけれど,
GUI でスタートアップした際に
shell(zsh)で設定した <code>PATH</code> などの環境変数がEmacsに渡らない場合があるので,
<a href="https://github.com/purcell/exec-path-from-shell">purcell/exec-path-from-shell</a> を使います.
</p>

<p>
今の所
</p>
<ul class="org-ul">
<li><code>DEBEMAIL</code></li>
<li><code>DEBFULLNAME</code></li>
<li><code>GPG_AGENT_INFO</code></li>
<li><code>GPG_KEY_ID</code></li>
<li><code>PASSWORD_STORE_DIR</code></li>
<li><code>PATH</code></li>
<li><code>SHELL</code></li>
<li><code>SKKSERVER</code></li>
<li><code>TEXMFHOME</code></li>
<li><code>WSL_DISTRO_NAME</code></li>
</ul>
<p>
を読み込んでいます(ちょっと多い…😅).
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf-safe-push</span> <span class="ss">'exec-path-from-shell</span> <span class="nv">package-selected-packages</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">exec-path-from-shell</span>
  <span class="ss">:if</span> <span class="nv">window-system</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">exec-path-from-shell-variables</span>
        <span class="o">'</span><span class="p">(</span><span class="s">"DEBEMAIL"</span>
          <span class="s">"DEBFULLNAME"</span>
          <span class="s">"GPG_AGENT_INFO"</span>
          <span class="s">"GPG_KEY_ID"</span>
          <span class="s">"PASSWORD_STORE_DIR"</span>
          <span class="s">"PATH"</span>
          <span class="s">"SHELL"</span>
          <span class="s">"SKKSERVER"</span>
          <span class="s">"TEXMFHOME"</span>
          <span class="s">"WSL_DISTRO_NAME"</span><span class="p">)</span>
        <span class="nv">exec-path-from-shell-arguments</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">exec-path-from-shell-initialize</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:password-store</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"PASSWORD_STORE_DIR"</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"Emacs/"</span> <span class="p">(</span><span class="nv">system-name</span><span class="p">))</span>
                        <span class="p">(</span><span class="nv">getenv</span> <span class="s">"PASSWORD_STORE_DIR"</span><span class="p">))</span>
    <span class="no">nil</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgadf8c6bf">言語の設定(含, フォント設定などなど)</h2>
<div class="outline-text-2" id="text-orgadf8c6bf">
<p>
最近のEmacsはlocaleから文字コードを自動判別するらしいので,
以前良く設定していた以下は不要らしいですね(ホントかな…?)。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">set-language-environment</span> <span class="s">"Japanese"</span><span class="p">)</span>
<span class="p">(</span><span class="nv">prefer-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-file-name-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-keyboard-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-terminal-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">set-default</span> <span class="ss">'buffer-file-coding-system</span> <span class="ss">'utf-8</span><span class="p">)</span></code></pre></figure>
<p>
なお, m17n.org の消滅によって上記設定に関する情報の参照元が消えた。
適切な参照元はどこだろう?
</p>
</div>
<div>
<h3 id="org58d8e6f8">cp5022x.el</h3>
<div class="outline-text-3" id="text-org58d8e6f8">
<p>
Emacs23 から内部が Unicode ベースになっています。
</p>

<p>
しかし文字コードの変換はGNU libcのiconvをベースにしているため,
機種依存文字を含む文字コードの変換をうまく行なえません。
そこで言語設定前に <code>cp5022x.el</code> をインストールすることにしています。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">cp5022x</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">set-charset-priority</span> <span class="ss">'ascii</span> <span class="ss">'japanese-jisx0208</span> <span class="ss">'latin-jisx0201</span>
                        <span class="ss">'katakana-jisx0201</span> <span class="ss">'iso-8859-1</span> <span class="ss">'unicode</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">set-coding-system-priority</span> <span class="ss">'utf-8</span> <span class="ss">'euc-jp</span> <span class="ss">'iso-2022-jp</span> <span class="ss">'cp932</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgd3ca00ac">
<span class="todo TODO">TODO</span> East Asian Ambiguos 対応 <code>[0/1]</code>
</h3>
<div class="outline-text-3" id="text-orgd3ca00ac">
<p>
<a href="https://khiker.hatenablog.jp/entry/20110327/emacs_cjkamb">Emacs23(以降) と 曖昧幅文字(East asian ambiguous)</a> あたりも参考に.
</p>

<p>
環境変数でいわゆる set-language-environment "Japanese" と判定されると,
EAW は 2文字幅に設定されてしまいます.
この強制を自分好みに調整する必要があります.
この調整には
</p>
<ul class="org-ul">
<li><a href="https://github.com/hamano/locale-eaw">hamano/locale-eaw: East Asian Ambiguous Width問題のための修正ロケール</a></li>
</ul>
<p>
を利用します.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">eaw-halfwidth</span>
  <span class="ss">:commands</span> <span class="nv">eaw-init</span>
  <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/uwabami/locale-eaw"</span>
            <span class="ss">:make</span> <span class="s">"all"</span>
            <span class="ss">:lisp-dir</span> <span class="s">"dist"</span>
            <span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'package-vc-allow-build-commands</span> <span class="ss">'eaw-halfwidth</span><span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                                <span class="p">(</span><span class="nv">eaw-init</span><span class="p">)</span>
                                <span class="p">(</span><span class="nv">global-auto-composition-mode</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
<p>
とりあえず祟りが少ないので EAW は 1 文字幅+調整済の <code>eaw-console</code> を利用しているが,
多くの日本語フォントがそうなっていないので, 割と辛い.
今のところ IBM Plex Mono をベースにした
</p>
<ul class="org-ul">
<li><a href="https://github.com/yuru7/PlemolJP">yuru7/PlemolJP: IBM Plex Mono と IBM Plex Sans JP を合成したプログラミングフォント PlemolJP (プレモル ジェイピー)</a></li>
</ul>
<p>
で提供されている PlemolJP Console NF あたりは記号類も1文字幅となっている.
見易いかどうかは別として.
</p>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> リテラシーの低い人からのメールで丸囲み数字が良く表われてシンドい(見切れる).
<ul class="org-ul">
<li>文字そのものの表示を別のモンにマッピングして表示する, という処理は可能だろうか?</li>
</ul>
</li>
</ul>
</div>
</div>
<div>
<h3 id="org356b9857">フォント</h3>
<div class="outline-text-3" id="text-org356b9857">
<p>
試行錯誤中. とはいえ, GUIで使う事は滅多に無いのでなかなか弄る機会が無い.
</p>
</div>
<div>
<h4 id="org100ad374">Xresouces の設定 <code>[1/1]</code>
</h4>
<div class="outline-text-4" id="text-org100ad374">
<p>
以下を追加しておく.
</p>
<figure class="highlight"><pre><code class="language-conf" data-lang="conf">! <span class="n">disable</span> <span class="n">XIM</span>
<span class="n">Emacs</span>*<span class="n">useXIM</span>: <span class="n">false</span>
! <span class="n">enable</span> <span class="n">antialias</span>
<span class="n">Emacs</span>.<span class="n">FontBackend</span>: <span class="n">xft</span>
! <span class="n">revese</span> <span class="n">video</span>
<span class="n">Emacs</span>.<span class="n">reverseVideo</span>: <span class="n">true</span></code></pre></figure>
<ul class="org-ul">
<li class="on">
<code>[X]</code> Wayland になったらどうなるだろうか? → 効かない模様.</li>
</ul>
</div>
</div>
<div>
<h4 id="org199c5479">フォント設定</h4>
<div class="outline-text-4" id="text-org199c5479">
<p>
GUIで, 絵文字と1:2のサイズ調整を行なうのってのは,
なかなかうまくいかないなぁ
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*gui</span>
  <span class="ss">:if</span> <span class="nv">window-system</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:setup-gui-fonts</span> <span class="p">(</span><span class="nv">default-font-name</span>
                             <span class="nv">default-font-height</span>
                             <span class="nv">cjk-font-name</span>
                             <span class="nv">cjk-font-scale</span>
                             <span class="nv">emoji-font-name</span>
                             <span class="nv">emoji-font-scale</span><span class="p">)</span>
    <span class="c1">;; 欧文フォント</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">member</span> <span class="nv">default-font-name</span> <span class="p">(</span><span class="nv">font-family-list</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'default</span> <span class="no">nil</span>
                          <span class="ss">:family</span> <span class="nv">default-font-name</span>
                          <span class="ss">:height</span> <span class="nv">default-font-height</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">set-frame-font</span> <span class="nv">default-font-name</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
    <span class="c1">;; 日本語フォント</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">member</span> <span class="nv">cjk-font-name</span> <span class="p">(</span><span class="nv">font-family-list</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">script</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'han</span> <span class="ss">'kana</span> <span class="ss">'cjk-misc</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">t</span> <span class="nv">script</span> <span class="nv">cjk-font-name</span><span class="p">)))</span>
    <span class="c1">;; 絵文字</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">member</span> <span class="nv">emoji-font-name</span> <span class="p">(</span><span class="nv">font-family-list</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">set-fontset-font</span> <span class="no">t</span> <span class="ss">'emoji</span> <span class="nv">emoji-font-name</span><span class="p">))</span>
    <span class="c1">;; Rescale the CJK and emoji fonts.</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">face-font-rescale-alist</span>
          <span class="o">`</span><span class="p">((</span><span class="o">,</span><span class="p">(</span><span class="nb">format</span> <span class="s">".*%s.*"</span> <span class="nv">cjk-font-name</span><span class="p">)</span> <span class="o">.</span> <span class="o">,</span><span class="nv">cjk-font-scale</span><span class="p">)</span>
            <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">format</span> <span class="s">".*%s.*"</span> <span class="nv">emoji-font-name</span><span class="p">)</span> <span class="o">.</span> <span class="o">,</span><span class="nv">emoji-font-scale</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="c1">;; ;;;###autoload</span>
  <span class="c1">;;   (defun my:apply-font-Moralerspace-Argon ()</span>
  <span class="c1">;;     (interactive)</span>
  <span class="c1">;;     (my:setup-gui-fonts "Moralerspace Argon HW" 130</span>
  <span class="c1">;;                         "Moralerspace Argon HW" 1.0</span>
  <span class="c1">;;                         "Moto Color Emoji-Moralerspace Argon" 1</span>
  <span class="c1">;;                         ))</span>
  <span class="c1">;; ;;;###autoload</span>
  <span class="c1">;;   (defun my:apply-font-PlemolJP-Console ()</span>
  <span class="c1">;;     (interactive)</span>
  <span class="c1">;;     (my:setup-gui-fonts "PlemolJP Console NF" 135</span>
  <span class="c1">;;                         "PlemolJP Console NF" 1.0</span>
  <span class="c1">;;                         ;; "Moto Color Emoji for PlemolJP" 1.0</span>
  <span class="c1">;;                         "EAW CONSOLE" 1.0</span>
  <span class="c1">;;                          ))</span>
<span class="c1">;; ;;;###autoload</span>
<span class="c1">;;   (defun my:apply-font-Cica ()</span>
<span class="c1">;;     (interactive)</span>
<span class="c1">;;     (my:setup-gui-fonts "PlemolJP Console NF" 135</span>
<span class="c1">;;                         "PlemolJP Console NF" 1.0</span>
<span class="c1">;;                         "Cica" 1.0</span>
<span class="c1">;;                          ))</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:apply-font-EAW-CONSOLE</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">my:setup-gui-fonts</span> <span class="s">"EAW CONSOLE"</span> <span class="mi">135</span>
                        <span class="s">"EAW CONSOLE"</span> <span class="mf">1.0</span>
                        <span class="s">"EAW CONSOLE"</span> <span class="mf">1.0</span>
                        <span class="p">))</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:setup-gui-frame</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">frame</span><span class="p">)</span>
    <span class="s">"GUI環境のみ reverse と alpha を適用する"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">f</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">frame</span> <span class="p">(</span><span class="nv">selected-frame</span><span class="p">))))</span>
      <span class="p">(</span><span class="nv">set-frame-parameter</span> <span class="nv">f</span> <span class="ss">'reverse</span> <span class="no">t</span><span class="p">)</span>
        <span class="c1">;; もの凄く重くなるので, 一旦保留. 透明度, 不透明度の順</span>
      <span class="p">(</span><span class="nv">set-frame-parameter</span> <span class="nv">f</span> <span class="ss">'alpha</span> <span class="o">'</span><span class="p">(</span><span class="mi">90</span> <span class="o">.</span> <span class="mi">70</span><span class="p">))</span>
      <span class="p">))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">scalable-fonts-allowed</span> <span class="no">nil</span>
        <span class="nv">buffer-face-mode-face</span> <span class="ss">'fixed-pitch</span>
        <span class="nv">use-default-font-for-symbols</span> <span class="no">nil</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">window-setup-hook</span>
    <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="nv">my:setup-gui-frame</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">my:apply-font-EAW-CONSOLE</span><span class="p">))</span>
    <span class="p">)</span>
   <span class="p">(</span><span class="nv">after-make-frame-functions</span>
    <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="nv">my:setup-gui-frame</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">my:apply-font-EAW-CONSOLE</span><span class="p">))</span>
    <span class="p">)</span>
   <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<p>
表示のテスト
</p>
<pre class="example">
 幅の確認: 絵文字は全角, 他は半角で 2:1 になっているかの確認用.

|abcdefghijkl|
|ABCDEFGHIJKL|
|'";:-+=/\~`?|
|∞≤≥∏∑∫×±≒≡⊆⊇|
|αβγδεζηθικλμ|
|ΑΒΓΔΕΖΗΘΙΚΛΜ|
|日本語の美観|
|あいうえおか|
|アイウエオカ|
|ｱｲｳｴｵｶｷｸｹｺｻｼ|

| hoge                 | hogeghoe | age             |
|----------------------+----------+-----------------|
| 今日もいい天気ですね | お、     | 等幅なった    🤔|
| 今日もいい天気ですね | お、     | 等幅なった👍🍺🤔|
|----------------------+----------+-----------------|
</pre>
</div>
</div>
<div>
<h4 id="orgd903bf1d">アイコンフォント: <code>nerd-icons</code>
</h4>
<div class="outline-text-4" id="text-orgd903bf1d">
<p>
以前は all-the-icons を利用していたけれども
</p>
<ul class="org-ul">
<li>Nerd Fonts の ver.2 まではアイコンが PUA をはみ出していて異体字の表示に支障があった → ver.3 からこれが解消された</li>
<li>ターミナルでの利用の際に複数フォントはシンドい.</li>
</ul>
<p>
ということで <a href="https://github.com/rainstormstudio/nerd-icons.el">nerd-icons</a> に乗り換えた.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">nerd-icons</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:defvar</span> <span class="nv">nerd-icons-mode-icon-alist</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="nv">nerd-icons-faicon</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">nerd-icons-font-family</span> <span class="s">"EAW CONSOLE"</span><span class="p">)</span>
  <span class="ss">:defer-config</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'nerd-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">wl-folder-mode</span> <span class="nv">nerd-icons-mdicon</span> <span class="s">"nf-md-folder"</span> <span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'nerd-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">wl-summary-mode</span> <span class="nv">nerd-icons-mdicon</span> <span class="s">"nf-md-folder_open"</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'nerd-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">wl-draft-mode</span> <span class="nv">nerd-icons-mdicon</span> <span class="s">"nf-md-email_edit"</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'nerd-icons-mode-icon-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">mime-view-mode</span> <span class="nv">nerd-icons-mdicon</span> <span class="s">"nf-md-email_open"</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">nerd-icons-dired</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">dired-mode</span> <span class="o">.</span> <span class="nv">nerd-icons-dired-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
</div>
<div>
<h2 id="org1927da44">主にEmacs本体, および同梱されている拡張に関する設定</h2>
<div class="outline-text-2" id="text-org1927da44">
</div>
<div>
<h3 id="orgd140a191">
<span class="todo TODO">TODO</span> 終了時に <code>custom.el</code> を消す <code>[0/1]</code>
</h3>
<div class="outline-text-3" id="text-orgd140a191">
<p>
設定ファイルに極力移す.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">cus-edit</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">custom-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"custom.el"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">kill-emacs-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                         <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">custom-file</span><span class="p">)</span>
                             <span class="p">(</span><span class="nb">delete-file</span> <span class="nv">custom-file</span><span class="p">)))))</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> 終了時に <code>custom.el</code> の内容を確認する様にした方が良いかな?</li>
</ul>
</div>
</div>
<div>
<h3 id="org2a427bfe">雑多な設定など</h3>
<div class="outline-text-3" id="text-org2a427bfe">
<p>
Emacs 本体に同梱されている関数などの雑多な設定.
設定が増えてきたり複雑になったら分ける(かも).
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">cus-start</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="c1">;; &lt; for show-paren syntax highlight</span>
  <span class="ss">:emacs&gt;</span> <span class="s">"28"</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/Sources/Git/salsa.debian.org/rlb/deb-emacs/src"</span><span class="p">)</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">find-function-C-source-directory</span>
              <span class="s">"~/Sources/Git/salsa.debian.org/rlb/deb-emacs/src"</span><span class="p">))</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="c1">;; デフォルト値を変更した方が良い変数など.</span>
  <span class="p">(</span><span class="nv">setq-default</span> <span class="nv">fill-column</span> <span class="mi">78</span>  <span class="c1">;; 70 → 78 RFC5322 風味</span>
                <span class="c1">;; org-element が tab 幅 8 に強制してくるので</span>
                <span class="nv">tab-width</span> <span class="mi">8</span>
                <span class="c1">;; デフォルトは折り返しなし.</span>
                <span class="nv">truncate-lines</span>  <span class="no">nil</span>
                <span class="c1">;; tab ではインデントしない</span>
                <span class="nv">indent-tabs-mode</span> <span class="no">nil</span>
                <span class="p">)</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="c1">;; setq か customize-set-variable か setop か, という話はあるものの.</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">user-full-name</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"DEBFULLNAME"</span><span class="p">))</span> <span class="c1">;; 名前</span>
        <span class="nv">user-mail-address</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"DEBEMAIL"</span><span class="p">))</span> <span class="c1">;; メールアドレス</span>
        <span class="c1">;; el と elc は新しい方を読み込む</span>
        <span class="nv">load-prefer-newer</span> <span class="no">t</span>
        <span class="c1">;; local network は常に信頼</span>
        <span class="nv">nsm-trust-local-network</span> <span class="no">t</span>
        <span class="c1">;; ファイル保存先を ~/.emacs.d 以下にブチ撒ける諸々の整理</span>
        <span class="nv">url-configuration-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"url"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">bookmark-default-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"bookmarks"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">eshell-directory-name</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eshell"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="c1">;; 表示関連 ----------------------------------------------------------</span>
        <span class="c1">;; scratch buffer は空っぽで</span>
        <span class="nv">initial-scratch-message</span> <span class="no">nil</span>
        <span class="c1">;; minibuffer も静かに: これは t だと shutup できない, という罠</span>
        <span class="nv">inhibit-startup-echo-area-message</span> <span class="nv">user-login-name</span>
        <span class="c1">;; modeline に行番号は表示しない</span>
        <span class="nv">line-number-mode</span> <span class="no">nil</span>
        <span class="c1">;; minibuffer は case insensitive</span>
        <span class="nv">read-file-name-completion-ignore-case</span> <span class="no">t</span>
        <span class="c1">;; 起動時の表示の更新を遅延させる: 0.5 → 1 秒に</span>
        <span class="nv">idle-update-delay</span> <span class="mf">1.0</span>
        <span class="c1">;; 編集関連 ----------------------------------------------------------</span>
        <span class="c1">;; バッファ終端で newline を入れない</span>
        <span class="nv">next-line-add-newlines</span> <span class="no">nil</span>
        <span class="c1">;; 折り返し無し</span>
        <span class="nv">truncate-partial-width-windows</span> <span class="no">nil</span>
        <span class="c1">;; SVG を編集可能にする: Custom で可能?</span>
        <span class="nv">auto-mode-alist</span> <span class="p">(</span><span class="nb">delete</span>
                         <span class="o">'</span><span class="p">(</span><span class="s">"\\.svgz?\\'"</span> <span class="o">.</span> <span class="nv">image-mode</span><span class="p">)</span> <span class="nv">auto-mode-alist</span><span class="p">)</span>
        <span class="c1">;; org-mode で有効にするローカル変数の追加 ← org-mode でやるべきでは?</span>
        <span class="nv">safe-local-variable-values</span> <span class="o">'</span><span class="p">((</span><span class="nv">org-link-file-path-type</span> <span class="o">.</span> <span class="nv">absolute</span><span class="p">))</span>
        <span class="c1">;; 保存, 履歴関連 ----------------------------------------------------</span>
        <span class="c1">;; バックアップファイル(foo.txt~など)は生成しない</span>
        <span class="c1">;; (setq make-backup-files nil) ;; → early-init で設定済</span>
        <span class="c1">;; 排他制御ロックファイル(.#foo.txtなど)は生成しない</span>
        <span class="c1">;; (setq create-lockfiles nil) ;; → early-init で設定済</span>
        <span class="c1">;; 履歴: 無制限(の筈)</span>
        <span class="nv">history-length</span> <span class="no">t</span>
        <span class="c1">;; ファイルが変更されたら再読み込み</span>
        <span class="nv">auto-revert-interval</span>  <span class="mf">0.1</span>
        <span class="c1">;; 一次保存の無効化(default は60秒毎に一時保存)</span>
        <span class="c1">;; auto-save-default nil ;; → early-init で設定済</span>
        <span class="c1">;; auto-save-list-file-prefix nil ;; → early-init で設定済</span>
        <span class="nv">auto-save-interval</span> <span class="mi">0</span>
        <span class="nv">delete-auto-save-files</span> <span class="no">t</span>
        <span class="c1">;; 自動保存の無効化</span>
        <span class="c1">;; auto-save-file-name-transforms `((".*" ,my:d:tmp  t))</span>
        <span class="c1">;; ;; backup で symlink は使わない</span>
        <span class="c1">;; backup-by-copying t</span>
        <span class="c1">;; backup ファイルの保存先</span>
        <span class="c1">;; backup-directory-alist  `((".*" . ,my:d:tmp))</span>
        <span class="c1">;; ;; backup ファイルの世代管理</span>
        <span class="c1">;; version-control t</span>
        <span class="c1">;; kept-new-versions 5</span>
        <span class="c1">;; kept-old-versions 5</span>
        <span class="c1">;; delete-old-versions t</span>
        <span class="c1">;; auto-save-visited-interval 30</span>
        <span class="c1">;;</span>
        <span class="c1">;; 略語は静かに保存</span>
        <span class="nv">save-abbrevs</span> <span class="ss">'silently</span>
        <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="c1">;; (defalias 'yes-or-no-p 'y-or-n-p)</span>
  <span class="c1">;; → use-short-answers t で良い筈</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">(</span><span class="c1">;; hl-line: 現在行のハイライト</span>
    <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">global-hl-line-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                            <span class="p">(</span><span class="nv">auto-fill-mode</span> <span class="no">nil</span><span class="p">)))</span>
    <span class="c1">;; SVG を表示ではなく XML 編集するために.</span>
    <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                            <span class="p">(</span><span class="nv">auto-image-file-mode</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="c1">;; transinet-mark: 選択リージョンに色付け</span>
    <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">transient-mark-mode</span><span class="p">)</span>
    <span class="c1">;; 3日変更の無かった buffer を自動的に閉じる</span>
    <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">midnight-mode</span><span class="p">)</span>
    <span class="c1">;; server 起動</span>
    <span class="c1">;; ファイルが変更されたら再読み込み</span>
    <span class="p">(</span><span class="nv">find-file-hook</span>     <span class="o">.</span> <span class="nv">global-auto-revert-mode</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org6e795c21">
<code>server</code>: Emacs server</h3>
<div class="outline-text-3" id="text-org6e795c21">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">server</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">server-running-p</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                          <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">server-running-p</span><span class="p">)</span>
                            <span class="p">(</span><span class="nv">server-start</span><span class="p">))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgdaed9c9c">
<code>paren</code>: 対応する括弧の設定</h3>
<div class="outline-text-3" id="text-orgdaed9c9c">
<p>
コメント内の不等号 &lt; &gt; にも反応するので, これの抑制を試みてみる
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">paren</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:custom</span> <span class="p">((</span><span class="nv">show-paren-style</span> <span class="o">.</span> <span class="ss">'mixed</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">show-paren-delay</span> <span class="o">.</span> <span class="mf">0.5</span><span class="p">))</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:show-paren-inhibit-p</span> <span class="p">()</span>
    <span class="s">"Return non-nil if point is inside a comment or a string."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">face</span> <span class="p">(</span><span class="nv">get-text-property</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="ss">'face</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">listp</span> <span class="nv">face</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">memq</span> <span class="ss">'font-lock-comment-face</span> <span class="nv">face</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">memq</span> <span class="ss">'font-lock-string-face</span> <span class="nv">face</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">memq</span> <span class="nv">face</span> <span class="o">'</span><span class="p">(</span><span class="nv">font-lock-comment-face</span> <span class="nv">font-lock-string-face</span><span class="p">)))))</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:around</span> <span class="nv">show-paren--default-data</span>
                   <span class="nv">my:show-paren-inhibit-p</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">show-paren-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orge3c80bea">
<code>time-stamp</code> 保存時に自動でタイムスタンプを更新</h3>
<div class="outline-text-3" id="text-orge3c80bea">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">time-stamp</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">time-stamp-active</span> <span class="no">t</span>
        <span class="nv">time-stamp-line-limit</span> <span class="mi">10</span>
        <span class="nv">time-stamp-start</span> <span class="s">"$Lastupdate: "</span>
        <span class="nv">time-stamp-end</span> <span class="s">"\\$"</span>
        <span class="nv">time-stamp-format</span> <span class="s">"%Y-%02m-%02d %02H:%02M:%02S"</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">before-save-hook</span>   <span class="o">.</span> <span class="nv">time-stamp</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org779d3217">
<code>savehist</code> minibuffer の履歴の保存</h3>
<div class="outline-text-3" id="text-org779d3217">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">savehist</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">savehist-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"history"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">savehist-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org77978fff">
<span class="todo TODO">TODO</span> <code>saveplace</code> 前回の修正位置の保存 <code>[0/1]</code>
</h3>
<div class="outline-text-3" id="text-org77978fff">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">saveplace</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">save-place-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"emacs-places"</span>  <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">save-place-limit</span> <span class="no">nil</span>
        <span class="nv">save-place-ignore-files-regexp</span>
        <span class="s">"\\(\\(?:COMMIT_EDITMSG\\|hg-editor-[[:alnum:]]+\\.txt\\|svn-commit\\.tmp\\|bzr_log\\.[[:alnum:]]+\\)$\\)\\|\\(\\`/[^/:]+:[^/:]*:\\)"</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">save-place-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> org-mode で fold されている場所に対して利用できるのか?</li>
</ul>
</div>
</div>
<div>
<h3 id="org3b23e2db">
<code>uniquify</code> ファイル位置の表示項目を増やす</h3>
<div class="outline-text-3" id="text-org3b23e2db">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">uniquify</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">uniquify-buffer-name-style</span> <span class="ss">'post-forward-angle-brackets</span>
        <span class="nv">uniquify-min-dir-content</span> <span class="mi">1</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgfb6d5852">
<code>tramp</code> リモートファイルの編集</h3>
<div class="outline-text-3" id="text-orgfb6d5852">
<p>
もっぱら root@localhost に繋いでの sudo 代わりだけど.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">tramp</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">tramp-persistency-file-name</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"tramp"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">tramp-completion-reread-directory-timeout</span> <span class="no">nil</span>
        <span class="nv">remote-file-name-inhibit-cache</span> <span class="no">nil</span>
        <span class="nv">vc-ignore-dir-regexp</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"\\(%s\\)\\|\\(%s\\)"</span>
                                     <span class="nv">locate-dominating-stop-dir-regexp</span>
                                     <span class="s">"\\`/[^/|:]+:"</span><span class="p">)</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">kill-emacs-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">tramp-persistency-file-name</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">delete-file</span> <span class="nv">tramp-persistency-file-name</span><span class="p">))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org31c3c060"><code>browse-url</code></h3>
<div class="outline-text-3" id="text-org31c3c060">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">browse-url</span>
  <span class="ss">:bind*</span> <span class="p">(</span><span class="s">"C-c C-j"</span> <span class="o">.</span> <span class="nv">browse-url-at-point</span><span class="p">)</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nv">getenv</span> <span class="s">"WSL_DISTRO_NAME"</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:browse-url-wsl-host-browser</span> <span class="p">(</span><span class="nv">url</span> <span class="k">&amp;rest</span> <span class="nv">_args</span><span class="p">)</span>
           <span class="s">"Browse URL with WSL host web browser."</span>
           <span class="p">(</span><span class="nb">prog1</span> <span class="p">(</span><span class="nv">message</span> <span class="s">"Open %s"</span> <span class="nv">url</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">shell-command-to-string</span>
              <span class="p">(</span><span class="nv">mapconcat</span> <span class="nf">#'</span><span class="nv">shell-quote-argument</span>
                         <span class="p">(</span><span class="nb">list</span> <span class="s">"/mnt/c/Windows/System32/cmd.exe"</span> <span class="s">"/c"</span> <span class="s">"start"</span> <span class="nv">url</span><span class="p">)</span>
                         <span class="s">" "</span><span class="p">))))</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">browse-url-browser-function</span> <span class="nf">#'</span><span class="nv">my:browse-url-wsl-host-browser</span><span class="p">))</span>
        <span class="p">((</span><span class="nv">executable-find</span> <span class="s">"xdg-open"</span><span class="p">)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">'browse-url-xdg-open</span>
               <span class="nv">browse-url-secondary-browser-function</span> <span class="ss">'browse-url-xdg-open</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'darwin</span><span class="p">)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">'browse-url-default-macosx-browser</span>
               <span class="nv">browse-url-secondary-browser-function</span> <span class="ss">'browse-url-default-macosx-browser</span><span class="p">))</span>
        <span class="p">(</span><span class="no">t</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">'eww-browse-url</span><span class="p">)</span>
         <span class="p">))</span>
<span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org6a5a84f9">
<code>eldoc</code>: emacs-lisp document</h3>
<div class="outline-text-3" id="text-org6a5a84f9">
<p>
minibuffer では eldoc にお黙り頂く。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">eldoc</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:shutup-eldoc-message</span> <span class="p">(</span><span class="nv">f</span> <span class="k">&amp;optional</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">active-minibuffer-window</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">funcall</span> <span class="nv">f</span> <span class="nb">string</span><span class="p">)))</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:around</span> <span class="nv">eldoc-message</span> <span class="nv">my:shutup-eldoc-message</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">eldoc-echo-area-prefer-doc-buffer</span> <span class="no">nil</span>
        <span class="nv">eldoc-print-after-edit</span> <span class="no">t</span>
        <span class="nv">eldoc-echo-area-use-multiline-p</span> <span class="no">nil</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">emacs-lisp-mode-hook</span> <span class="o">.</span> <span class="nv">turn-on-eldoc-mode</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org68c5e01b">
<code>whitespace</code>: 空白の強調表示</h3>
<div class="outline-text-3" id="text-org68c5e01b">
<p>
背景も変えようかなぁ…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">whitespace</span>
  <span class="ss">:preface</span>
  <span class="c1">;; 除外リストの定義</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:delete-trailing-whitespace-exclude-suffix</span>
    <span class="p">(</span><span class="nb">list</span> <span class="s">"\\.rd$"</span> <span class="s">"\\.md$"</span> <span class="s">"\\.rbt$"</span> <span class="s">"\\.rab$"</span><span class="p">))</span>
  <span class="c1">;; 除外リスト以外の trailing whitespace を削除</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:configure-whitespace-for-buffer</span> <span class="p">()</span>
    <span class="s">"Locally disable trailing whitespace cleanup if the file matches the
exclude list."</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">buffer-file-name</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">patterns</span> <span class="nv">my:delete-trailing-whitespace-exclude-suffix</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">found</span> <span class="no">nil</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nv">buffer-file-name</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">patterns</span> <span class="p">(</span><span class="nb">not</span> <span class="nv">found</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">string-match</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">patterns</span><span class="p">)</span> <span class="nv">file</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">found</span> <span class="no">t</span><span class="p">))</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">patterns</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">patterns</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="nv">found</span>
          <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'whitespace-style</span><span class="p">)</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">whitespace-style</span>
                <span class="p">(</span><span class="nb">delete</span> <span class="ss">'trailing</span> <span class="p">(</span><span class="nb">append</span> <span class="nv">whitespace-style</span> <span class="no">nil</span><span class="p">)))</span>
          <span class="p">))))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">whitespace-line-column</span> <span class="mi">72</span>
        <span class="nv">whitespace-style</span> <span class="o">'</span><span class="p">(</span><span class="nv">face</span>        <span class="c1">; faceを使う. *-mark に必要</span>
                           <span class="nv">trailing</span>    <span class="c1">; 行末の空白を対象.</span>
                           <span class="nv">tabs</span>        <span class="c1">; tab</span>
                           <span class="nv">spaces</span>      <span class="c1">; space</span>
                           <span class="c1">;; empty      ; 前後の空行</span>
                           <span class="nv">space-mark</span>  <span class="c1">; 可視化の際の置き換えを有効化</span>
                           <span class="nv">tab-mark</span>    <span class="c1">; 可視化の際の置き換えを有効化</span>
                           <span class="p">)</span>
        <span class="nv">whitespace-action</span> <span class="o">'</span><span class="p">(</span><span class="nv">auto-cleanup</span><span class="p">)</span>
        <span class="nv">whitespace-display-mappings</span> <span class="o">'</span><span class="p">(</span><span class="c1">;; (space-mark ?\u3000 [?\□])</span>
                                      <span class="p">(</span><span class="nv">tab-mark</span> <span class="nv">?\t</span> <span class="nv">[?\u00BB</span> <span class="nv">?\t]</span> <span class="nv">[?\\</span> <span class="nv">?\t]</span><span class="p">))</span>
        <span class="nv">whitespace-space-regexp</span> <span class="s">"\\(\u3000+\\)"</span>
        <span class="nv">whitespace-trailing-regexp</span>  <span class="s">"\\([ \u00A0]+\\)$"</span>
        <span class="nv">whitespace-global-modes</span> <span class="o">'</span><span class="p">(</span><span class="nb">not</span> <span class="nv">eww-mode</span>
                                      <span class="nv">term-mode</span>
                                      <span class="nv">eshell-mode</span>
                                      <span class="nv">org-agenda-mode</span>
                                      <span class="nv">calendar-mode</span><span class="p">))</span>
  <span class="ss">:hook</span> <span class="p">((</span><span class="nv">find-file-hook</span> <span class="o">.</span> <span class="nv">my:configure-whitespace-for-buffer</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">after-change-major-mode-hook</span> <span class="o">.</span> <span class="nv">my:configure-whitespace-for-buffer</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">global-whitespace-mode</span><span class="p">)</span>
         <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgdd48e2df">
<span class="todo TODO">TODO</span> buffer の印刷 <code>[0/1]</code>
</h3>
<div class="outline-text-3" id="text-orgdd48e2df">
<ul class="org-ul">
<li class="off">
<code>[ ]</code> フォントの指定を上手くできんかなぁ…</li>
</ul>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ps-mule</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"lpr"</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">ps-multibyte-buffer</span>       <span class="ss">'non-latin-printer</span>
        <span class="nv">ps-printer-name</span>           <span class="s">"PDF"</span>
        <span class="nv">ps-paper-size</span>             <span class="ss">'a4</span>
        <span class="c1">;; (ps-n-up-printing        .  2)</span>
        <span class="nv">ps-print-header</span>            <span class="no">t</span>
        <span class="nv">ps-print-footer</span>            <span class="no">nil</span>
        <span class="nv">ps-font-family</span>            <span class="ss">'Courier</span>
        <span class="nv">ps-font-size</span>              <span class="o">'</span><span class="p">(</span><span class="mi">9</span> <span class="o">.</span> <span class="mi">10</span><span class="p">)</span>
        <span class="nv">ps-header-font-family</span>     <span class="ss">'Helvetica</span>
        <span class="nv">ps-header-font-size</span>       <span class="o">'</span><span class="p">(</span><span class="mi">10</span> <span class="o">.</span> <span class="mi">12</span><span class="p">)</span>
        <span class="nv">ps-header-title-font-size</span> <span class="o">'</span><span class="p">(</span><span class="mi">12</span> <span class="o">.</span> <span class="mi">14</span><span class="p">)</span>
        <span class="nv">ps-line-number</span>            <span class="no">nil</span>
        <span class="c1">;; (ps-line-number-font "Times-Italic")</span>
        <span class="c1">;; (ps-line-number-font-size 6)</span>
        <span class="c1">;; (ps-line-number-start   1)</span>
        <span class="c1">;; (ps-line-number-step    1)</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">defalias</span> <span class="ss">'ps-mule-header-string-charset</span> <span class="ss">'ignore</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="c1">;; (setq ps-mule-font-info-database-default</span>
  <span class="c1">;;       '((iso-8859-1</span>
  <span class="c1">;;          (normal nil nil))</span>
  <span class="c1">;;         (katakana-jisx0201</span>
  <span class="c1">;;          (normal builtin "Ryumin-Light-Katakana")</span>
  <span class="c1">;;          (bold builtin "GothicBBB-Medium-Katakana"))</span>
  <span class="c1">;;         (latin-jisx0201</span>
  <span class="c1">;;          (normal builtin "Ryumin-Light-Hankaku")</span>
  <span class="c1">;;          (bold builtin "GothicBBB-Medium-Hankaku"))</span>
  <span class="c1">;;         (japanese-jisx0208</span>
  <span class="c1">;;          (normal builtin "Ryumin-Light-Ext-H")</span>
  <span class="c1">;;          (bold builtin "GothicBBB-Medium-Ext-H"))</span>
  <span class="c1">;;         (japanese-jisx0213-2</span>
  <span class="c1">;;          (normal builtin "Ryumin-Light-Ext-H")</span>
  <span class="c1">;;          (bold builtin "GothicBBB-Medium-Ext-H"))</span>
  <span class="c1">;;         (japanese-jisx0213.2004-1</span>
  <span class="c1">;;          (normal builtin "Ryumin-Light-2004-H")</span>
  <span class="c1">;;          (bold builtin "GothicBBB-Medium-H"))</span>
  <span class="c1">;;         (unicode-bmp</span>
  <span class="c1">;;          (normal builtin "Ryumin-Light-Ext-H")</span>
  <span class="c1">;;          (bold builtin "GothicBBB-Medium-Ext-H"))</span>
  <span class="c1">;;         )</span>
  <span class="c1">;;       )</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgcc9538d1">
<code>tab-bar-mode</code>: Emacsの「TAB」</h3>
<div class="outline-text-3" id="text-orgcc9538d1">
<p>
Emacs27から同梱された <code>tab-bar-mode</code> に elscreen から乗り換えた.
手癖で "C-o" を prefix で使いたいので, その設定をしていたり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">tab-bar-mode</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">make-sparse-keymap</span><span class="p">)</span>
    <span class="s">"My original keymap binded to C-o."</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defalias</span> <span class="ss">'my:ctrl-o-prefix</span> <span class="nv">my:ctrl-o-map</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-o"</span><span class="p">)</span> <span class="ss">'my:ctrl-o-prefix</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"c"</span><span class="p">)</span>   <span class="ss">'tab-new</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c"</span><span class="p">)</span> <span class="ss">'tab-new</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"k"</span><span class="p">)</span>   <span class="ss">'tab-close</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-k"</span><span class="p">)</span> <span class="ss">'tab-close</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"n"</span><span class="p">)</span>   <span class="ss">'tab-next</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-n"</span><span class="p">)</span> <span class="ss">'tab-next</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"p"</span><span class="p">)</span>   <span class="ss">'tab-previous</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-key</span> <span class="nv">my:ctrl-o-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-p"</span><span class="p">)</span> <span class="ss">'tab-previous</span><span class="p">)</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:tab-bar-tab-name-truncated</span> <span class="p">()</span>
  <span class="s">"Custom: Generate tab name from the buffer of the selected window."</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">tab-name</span> <span class="p">(</span><span class="nv">buffer-name</span> <span class="p">(</span><span class="nv">window-buffer</span> <span class="p">(</span><span class="nv">minibuffer-selected-window</span><span class="p">))))</span>
        <span class="p">(</span><span class="nv">ellipsis</span> <span class="p">(</span><span class="nb">cond</span>
                   <span class="p">(</span><span class="nv">tab-bar-tab-name-ellipsis</span><span class="p">)</span>
                   <span class="p">((</span><span class="nv">char-displayable-p</span> <span class="nv">?</span><span class="err">…</span><span class="p">)</span> <span class="s">"…"</span><span class="p">)</span>
                   <span class="p">(</span><span class="s">"..."</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">tab-name</span><span class="p">)</span> <span class="nv">tab-bar-tab-name-truncated-max</span><span class="p">)</span> <span class="c1">;; &gt;</span>
        <span class="p">(</span><span class="nb">format</span> <span class="s">"%-12s"</span> <span class="nv">tab-name</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">propertize</span> <span class="p">(</span><span class="nv">truncate-string-to-width</span>
                   <span class="nv">tab-name</span> <span class="nv">tab-bar-tab-name-truncated-max</span> <span class="no">nil</span> <span class="no">nil</span>
                   <span class="nv">ellipsis</span><span class="p">)</span>
                  <span class="ss">'help-echo</span> <span class="nv">tab-name</span><span class="p">))))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">tab-bar-close-button-show</span>      <span class="no">nil</span>
        <span class="nv">tab-bar-close-last-tab-choice</span>  <span class="no">nil</span>
        <span class="nv">tab-bar-close-tab-select</span>       <span class="ss">'left</span>
        <span class="nv">tab-bar-history-mode</span>           <span class="no">nil</span>
        <span class="nv">tab-bar-new-tab-choice</span>         <span class="s">"*scratch*"</span>
        <span class="nv">tab-bar-format</span>                 <span class="o">'</span><span class="p">(</span><span class="nv">tab-bar-format-tabs</span><span class="p">)</span>
        <span class="nv">tab-bar-tab-name-function</span>      <span class="ss">'my:tab-bar-tab-name-truncated</span>
        <span class="nv">tab-bar-tab-name-truncated-max</span> <span class="mi">12</span>
        <span class="nv">tab-bar-separator</span>              <span class="s">"|"</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">tab-bar-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li><a href="https://masutaka.net/chalow/2011-09-28-1.html">ターミナルの zsh と Emacs を風のように駆け抜ける！</a></li>
</ul>
</div>
</div>
<div>
<h3 id="org64c49495">
<code>vc</code>: バージョン管理</h3>
<div class="outline-text-3" id="text-org64c49495">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">vc</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">vc-handled-backends</span> <span class="o">'</span><span class="p">(</span><span class="nv">Git</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org1a8b35da">認証関連: <code>plstore</code>, <code>password-store</code> など</h2>
<div class="outline-text-2" id="text-org1a8b35da">
<ul class="org-ul">
<li>
<code>leaf-plstore</code> で <code>plstore</code> が使えるようになったので,
その設定をしておく.</li>
<li>
<code>auth-password-store</code> で auth-source として <code>password-store</code> を使う.</li>
</ul>
<p>
といった事をしている.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"GPG_KEY_ID"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">my:d:password-store</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">auth-source</span>
    <span class="ss">:tag</span> <span class="s">"builtin"</span>
    <span class="ss">:leaf-defer</span> <span class="no">t</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">auth-source-gpg-encrypt-to</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nv">getenv</span> <span class="s">"GPG_KEY_ID"</span><span class="p">))))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">plstore</span>
    <span class="ss">:tag</span> <span class="s">"builtin"</span>
    <span class="ss">:leaf-defer</span> <span class="no">t</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">plstore-secret-keys</span> <span class="ss">'silent</span>
          <span class="nv">plstore-encrypt-to</span>  <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nv">getenv</span> <span class="s">"GPG_KEY_ID"</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">password-store</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">auth-source-pass</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">leaf-default-plstore</span>
        <span class="p">(</span><span class="nv">plstore-open</span>
         <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"plstore.plist"</span> <span class="nv">my:d:password-store</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'vc-directory-exclusion-list</span>
               <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">my:d:password-store</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgb83f65a0">日本語入力: <code>ddskk</code>
</h2>
<div class="outline-text-2" id="text-orgb83f65a0">
<p>
<a href="http://openlab.ring.gr.jp/skk/ddskk-ja.html">Daredevil SKK (DDSKK)</a> をメインで使用中．無いと途方に暮れる．
ちなみにGTKが有効になっていると <code>gtk-immodule</code> なんかと衝突するので
<code>~/.Xresources</code> で im を無効にしておくと良い．
例えば以下の様に:
</p>
<figure class="highlight"><pre><code class="language-conf" data-lang="conf">! <span class="n">disable</span> <span class="n">XIM</span>
<span class="n">Emacs</span>*<span class="n">useXIM</span>: <span class="n">false</span></code></pre></figure>
<p>
以前は別ファイルで行なっていた設定を customize にまとめた.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">skk</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">skk-make-indicator-alist</span>
             <span class="nv">skk-mode-exit</span><span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x j"</span>   <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x C-j"</span> <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">)</span>
         <span class="c1">;; ("C-x C-j" . skk-auto-fill-mode)</span>
         <span class="c1">;; ("C-j"     . skk-mode)</span>
         <span class="p">(</span><span class="s">"C-\\"</span>    <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">)</span>
         <span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"skk"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="k">progn</span>
      <span class="p">(</span><span class="nv">make-empty-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"skk/keep"</span> <span class="nv">my:d:tmp</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">make-empty-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"skk-jisyo/keep"</span> <span class="nv">my:d:tmp</span><span class="p">)</span> <span class="no">t</span><span class="p">)))</span>
  <span class="c1">;; override - -;</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">skk-get-jisyo-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"skk-jisyo"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">skk-extra-jisyo-file-list</span> <span class="no">nil</span><span class="p">)</span>
  <span class="c1">;;</span>
  <span class="c1">;;(defun my:skk-open-server-decoding-utf-8 ()</span>
  <span class="c1">;;  "辞書サーバと接続する。サーバープロセスを返す。 decoding coding-system が euc ではなく utf8 となる。"</span>
  <span class="c1">;;  (unless (skk-server-live-p)</span>
  <span class="c1">;;    (setq skkserv-process (skk-open-server-1))</span>
  <span class="c1">;;    (when (skk-server-live-p)</span>
  <span class="c1">;;      (let ((code (cdr (assoc "euc" skk-coding-system-alist))))</span>
  <span class="c1">;;        (set-process-coding-system skkserv-process 'utf-8 code))))</span>
  <span class="c1">;;  skkserv-process)</span>
  <span class="c1">;; :advice (:override skk-open-server</span>
  <span class="c1">;;                    my:skk-open-server-decoding-utf-8)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">default-input-method</span> <span class="s">"japanese-skk"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-user-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"skk"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="c1">;; 設定ファイルは Customize にまとめる. → 別ファイルでの設定はしない</span>
        <span class="nv">skk-init-file</span> <span class="s">""</span>
        <span class="c1">;; init ファイルは空なのでコンパイルしない</span>
        <span class="nv">skk-byte-compile-init-file</span> <span class="no">nil</span>
        <span class="c1">;; sticky shift  を ; に割り当て</span>
        <span class="nv">skk-sticky-key</span> <span class="s">";"</span>
        <span class="c1">;; 変換候補の表示数</span>
        <span class="nv">skk-henkan-number-to-display-candidates</span> <span class="mi">10</span>
        <span class="c1">;; メニューを日本語にしない. どうせ menu は使わないし</span>
        <span class="nv">skk-show-japanese-menu</span> <span class="no">nil</span>
        <span class="c1">;; 半角ｶﾀｶﾅを入力可能に</span>
        <span class="nv">skk-use-jisx0201-input-method</span> <span class="no">t</span>
        <span class="c1">;; インジケータのカスタマイズ</span>
        <span class="nv">skk-latin-mode-string</span>          <span class="s">"[_A]"</span>
        <span class="nv">skk-hiragana-mode-string</span>       <span class="s">"[あ]"</span>
        <span class="nv">skk-katakana-mode-string</span>       <span class="s">"[ア]"</span>
        <span class="nv">skk-jisx0208-latin-mode-string</span> <span class="s">"[Ａ]"</span>
        <span class="nv">skk-jisx0201-mode-string</span>       <span class="s">"[_ｱ]"</span>
        <span class="nv">skk-abbrev-mode-string</span>         <span class="s">"[aA]"</span>
        <span class="c1">;; カーソルに色は付けない</span>
        <span class="nv">skk-use-color-cursor</span> <span class="no">nil</span>
        <span class="nv">skk-indicator-use-cursor-color</span> <span class="no">nil</span>
        <span class="c1">;; Enter で改行しない</span>
        <span class="nv">skk-egg-like-newline</span> <span class="no">t</span>
        <span class="c1">;; 対応する括弧の自動入力</span>
        <span class="nv">skk-auto-insert-paren</span> <span class="no">t</span>
        <span class="c1">;; 句読点変換ルールの追加</span>
        <span class="nv">skk-kuten-touten-alist</span> <span class="o">'</span><span class="p">((</span><span class="nv">jp</span>    <span class="o">.</span> <span class="p">(</span><span class="s">"。"</span> <span class="o">.</span> <span class="s">"、"</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">jp-en</span> <span class="o">.</span> <span class="p">(</span><span class="s">"。"</span> <span class="o">.</span> <span class="s">", "</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">en-jp</span> <span class="o">.</span> <span class="p">(</span><span class="s">"．"</span> <span class="o">.</span> <span class="s">"，"</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">en</span>    <span class="o">.</span> <span class="p">(</span><span class="s">". "</span> <span class="o">.</span> <span class="s">", "</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">EN</span>    <span class="o">.</span> <span class="p">(</span><span class="s">"．"</span> <span class="o">.</span> <span class="s">"，"</span><span class="p">))</span>
                                 <span class="p">)</span>
        <span class="c1">;; 句読点変換ルール: default は ,.</span>
        <span class="nv">skk-kutouten-type</span> <span class="ss">'en</span>
        <span class="c1">;; 送り仮名が厳密に正しい候補を優先</span>
        <span class="nv">skk-henkan-strict-okuri-precedence</span> <span class="no">t</span>
        <span class="c1">;; 変換ルールの追加: 全角スペース入力ルールと日付入力無効化.</span>
        <span class="nv">skk-rom-kana-rule-list</span> <span class="o">'</span><span class="p">((</span><span class="s">"z "</span> <span class="no">nil</span> <span class="s">"　"</span><span class="p">)</span>
                                 <span class="p">(</span><span class="s">"@"</span> <span class="no">nil</span> <span class="s">"@"</span><span class="p">))</span>
        <span class="c1">;; 辞書サーバ</span>
        <span class="nv">skk-server-host</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"SKKSERVER"</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
        <span class="nv">skk-aux-large-jisyo</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-readable-p</span> <span class="s">"/usr/share/skk/SKK-JISYO.L"</span><span class="p">)</span> <span class="s">"/usr/share/skk/SKK-JISYO.L"</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
        <span class="c1">;; 冗長...?</span>
        <span class="nv">skk-large-jisyo</span> <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nv">getenv</span> <span class="s">"SKKSERVER"</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
                              <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-readable-p</span> <span class="s">"/usr/share/skk/SKK-JISYO.L"</span><span class="p">)</span> <span class="s">"/usr/share/skk/SKK-JISYO.L"</span><span class="p">))</span>
                              <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"skk-jisyo/SKK-JISYO.L"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
        <span class="c1">;; インクリメンタルサーチは migemo に任せる. hook も参照</span>
        <span class="nv">skk-isearch-mode-enable</span> <span class="no">nil</span>
        <span class="c1">;; 不要?</span>
        <span class="nv">skk-isearch-start-mode</span>  <span class="ss">'latin</span>
        <span class="c1">;; ja-dic は利用しない</span>
        <span class="nv">skk-inhibit-ja-dic-search</span> <span class="no">t</span>
        <span class="c1">;; 辞書登録の際に送り仮名を削除</span>
        <span class="nv">skk-check-okurigana-on-touroku</span> <span class="ss">'auto</span>
        <span class="c1">;; 漢字登録のミスをチェック</span>
        <span class="nv">skk-check-okurigana-on-touroku</span> <span class="no">t</span>
        <span class="c1">;; 個人辞書の文字コード</span>
        <span class="nv">skk-jisyo-code</span> <span class="ss">'utf-8-unix</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="c1">;; minibuffer では skk を無効化</span>
   <span class="p">(</span><span class="nv">skk-mode-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                      <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">skk-in-minibuffer-p</span><span class="p">)</span>
                           <span class="p">(</span><span class="nv">skk-mode-exit</span><span class="p">))))</span>
   <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="c1">;; 環境毎に辞書の設定が煩雑になっていて, どうしたモンかなぁ...</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"SKKSERVER"</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">file-readable-p</span> <span class="s">"/usr/share/skk/SKK-JISYO.L"</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">file-exists-p</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"SKK-JISYO.L"</span> <span class="nv">skk-get-jisyo-directory</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">skk-get</span> <span class="nv">skk-get-jisyo-directory</span><span class="p">))</span>
  <span class="c1">;; 丸数字の変換などの辞書を追加</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/usr/share/skk/SKK-JISYO.JIS3_4"</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'skk-extra-jisyo-file-list</span>
                   <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"/usr/share/skk/SKK-JISYO.JIS3_4"</span><span class="p">)</span> <span class="ss">'euc-jisx0213</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">cond</span>
   <span class="p">((</span><span class="nv">file-exists-p</span> <span class="s">"/usr/local/share/skkdic/SKK-JISYO.emoji.utf8"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">file</span>
             <span class="o">'</span><span class="p">(</span><span class="s">"SKK-JISYO.chibutsu.utf8"</span>
               <span class="s">"SKK-JISYO.tanudic4.utf8"</span>
               <span class="s">"SKK-JISYO.matsucon.utf8"</span>
               <span class="s">"SKK-JISYO.emoji.utf8"</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'skk-extra-jisyo-file-list</span>
                   <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">file</span> <span class="s">"/usr/local/share/skkdic/"</span><span class="p">)</span> <span class="ss">'utf-8</span><span class="p">)</span> <span class="no">t</span> <span class="p">)))</span>
   <span class="p">(</span><span class="no">t</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-extra-jisyo-file-list</span> <span class="no">nil</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org43970469">
<code>recentf</code>: 最近使ったファイル履歴の保管</h2>
<div class="outline-text-2" id="text-org43970469">
<p>
結局履歴を貯める設定をしている事になっている.
ディレクトリの履歴も取れるので recentf-ext を入れておく
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">switch-buffer-functions</span>
  <span class="ss">:doc</span> <span class="s">"バッファ切り替え時の hook を提供する拡張"</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:recentf-track-visited-file</span> <span class="p">(</span><span class="nv">_prev</span> <span class="nv">_curr</span><span class="p">)</span>
    <span class="s">"バッファ切り替え時に、必要なら recentf を起動してリストを更新する。"</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">buffer-file-name</span>
      <span class="p">(</span><span class="nb">unless</span> <span class="nv">recentf-mode</span>
        <span class="p">(</span><span class="nv">recentf-mode</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">recentf-add-file</span> <span class="nv">buffer-file-name</span><span class="p">)))</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">switch-buffer-functions</span> <span class="o">.</span> <span class="nv">my:recentf-track-visited-file</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">recentf</span>
  <span class="ss">:defun</span>
  <span class="p">(</span><span class="nv">recentf-save-list</span> <span class="nv">recentf-cleanup</span> <span class="nv">recentf-add-file</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:recentf-cleanup-shutup</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
    <span class="s">"Run `recentf-cleanup' silently."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inhibit-message</span> <span class="no">t</span><span class="p">))</span> <span class="c1">; メッセージ出力を一時的に無効化</span>
      <span class="p">(</span><span class="nb">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)))</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:around</span> <span class="nv">recentf-cleanup</span>
                   <span class="nv">my:recentf-cleanup-shutup</span><span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">((</span><span class="nv">find-file-hook</span> <span class="o">.</span> <span class="nv">recentf-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">after-save-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                              <span class="p">(</span><span class="nv">recentf-mode</span> <span class="mi">1</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">recentf-add-file</span> <span class="p">(</span><span class="nv">buffer-file-name</span><span class="p">))))</span>
         <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">recentf-ext</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">recentf-save-file</span>       <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"recentf"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">recentf-max-saved-items</span> <span class="mi">1000</span>
        <span class="nv">recentf-auto-cleanup</span>    <span class="s">"04:00am"</span>
        <span class="nv">recentf-exclude</span>         <span class="o">`</span><span class="p">(</span><span class="c1">;; TRAMP は無視</span>
                                  <span class="o">,</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">boundp</span> <span class="ss">'tramp-file-name-regexp</span><span class="p">)</span>
                                       <span class="nv">tramp-file-name-regexp</span>
                                     <span class="s">"\\`/[^/|:]+:"</span><span class="p">)</span>
                                  <span class="s">".recentf"</span>
                                  <span class="s">"^/tmp\\.*"</span>
                                  <span class="s">"^/private\\.*"</span>
                                  <span class="s">"^/var/folders\\.*"</span>
                                  <span class="s">"/TAGS$"</span>
                                  <span class="s">"\\.*草稿\\.*"</span>
                                  <span class="s">"^#\\.*"</span>
                                  <span class="s">"^/[^/:]+:"</span>
                                  <span class="s">"bookmarks"</span>
                                  <span class="s">"org-recent-headings.dat"</span>
                                  <span class="s">"\\.*COMMIT_EDITMSG$"</span>
                                  <span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org12fd2b4e">Copy &amp; Paste:</h2>
<div class="outline-text-2" id="text-org12fd2b4e">
</div>
<div>
<h3 id="org1689d1f5">Linux と macOS では <code>xclip.el</code> を利用</h3>
<div class="outline-text-3" id="text-org1689d1f5">
<p>
気がついたら, Wayland(wl-copy/wl-paste) でも macOS (pbcopy/pbpaste) でもこれで OK っぽい.
WSLでは <code>powershell/clip.exe</code> を使う様になっているけど, <b>遅い</b> ので <code>w32yank.exe</code> を使うことにしている.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">xclip</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">system-type</span> <span class="ss">'gnu/linux</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"/mnt/c"</span><span class="p">))</span>
           <span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span>
         <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">xclip-mode</span> <span class="mi">+1</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgb182b45f">WSLでは <code>win32yank.exe</code> を利用</h3>
<div class="outline-text-3" id="text-orgb182b45f">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*win32yank</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"/mnt/c"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"win32yank.exe"</span><span class="p">))</span>
  <span class="ss">:init</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:win32yank-copy</span> <span class="p">(</span><span class="nv">text</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">interactive</span> <span class="s">"r"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">with-temp-buffer</span>
      <span class="p">(</span><span class="nv">insert</span> <span class="nv">text</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">shell-command-on-region</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)</span> <span class="s">"win32yank.exe -i"</span> <span class="no">t</span><span class="p">)))</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:win32yank-paste</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="s">"win32yank.exe -o --lf"</span><span class="p">))</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">interprogram-cut-function</span> <span class="ss">'my:win32yank-copy</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">interprogram-paste-function</span> <span class="ss">'my:win32yank-paste</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org8aa6f45e">キーバインドの設定</h2>
<div class="outline-text-2" id="text-org8aa6f45e">
<p>
既に手癖になってしまっているアレコレ．
特に <code>[home]</code> と <code>[end]</code> は無いと途方に暮れます．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf-keys</span> <span class="p">((</span><span class="s">"C-h"</span>     <span class="o">.</span> <span class="nv">backward-delete-char</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-a"</span> <span class="o">.</span> <span class="nv">align-regexp</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c ;"</span>   <span class="o">.</span> <span class="nv">comment-region</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-;"</span> <span class="o">.</span> <span class="nv">uncomment-region</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-/"</span>     <span class="o">.</span> <span class="nv">undo</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-r"</span> <span class="o">.</span> <span class="nv">replace-regexp</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c r"</span>   <span class="o">.</span> <span class="nv">replace-string</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"&lt;home&gt;"</span>  <span class="o">.</span> <span class="nv">beginning-of-buffer</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"&lt;end&gt;"</span>   <span class="o">.</span> <span class="nv">end-of-buffer</span><span class="p">)</span>
            <span class="p">(</span><span class="s">"C-c M-l"</span> <span class="o">.</span> <span class="nv">toggle-truncate-lines</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org5d9ade19">
<code>migemo</code>: インクリメンタル検索</h2>
<div class="outline-text-2" id="text-org5d9ade19">
<p>
無いと途方に暮れる．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">migemo</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"cmigemo"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">migemo-user-dictionary</span>  <span class="no">nil</span>
        <span class="nv">migemo-regex-dictionary</span> <span class="no">nil</span>
        <span class="nv">migemo-options</span>          <span class="o">'</span><span class="p">(</span><span class="s">"-q"</span> <span class="s">"--emacs"</span><span class="p">)</span>
        <span class="nv">migemo-command</span>          <span class="s">"cmigemo"</span>
        <span class="nv">migemo-coding-system</span>    <span class="ss">'utf-8-unix</span>
        <span class="nv">migemo-dictionary</span>       <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/usr/local/share/migemo/utf-8/migemo-dict"</span><span class="p">)</span>
                                        <span class="s">"/usr/local/share/migemo/utf-8/migemo-dict"</span><span class="p">)</span>
                                    <span class="s">"/usr/share/cmigemo/utf-8/migemo-dict"</span><span class="p">)</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">migemo-init</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org35bd4bc4">
<code>eww</code>: 内蔵ブラウザ</h2>
<div class="outline-text-2" id="text-org35bd4bc4">
<p>
リンクを簡単に辿る(Hit-a-Hint) のために <code>ace-link</code> も入れておく
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">eww</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eww"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">make-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eww"</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">ace-link</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">shr</span>
    <span class="ss">:init</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">shr-use-colors</span>    <span class="no">nil</span>
          <span class="nv">shr-use-fonts</span>     <span class="no">nil</span>
          <span class="nv">shr-image-animate</span> <span class="no">nil</span>
          <span class="nv">shr-width</span>         <span class="mi">72</span>
          <span class="p">)</span>
    <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">eww-bookmarks-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"eww"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">eww-search-prefix</span> <span class="s">"https://www.google.com/search?&amp;gws_rd=cr&amp;complete=0&amp;pws=0&amp;tbs=li:1&amp;q="</span>
        <span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"&lt;f2&gt;"</span> <span class="o">.</span> <span class="nv">eww</span><span class="p">)</span>
         <span class="p">(</span><span class="ss">:eww-mode-map</span>
          <span class="p">(</span><span class="s">"r"</span>   <span class="o">.</span> <span class="nv">eww-reload</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"o"</span>   <span class="o">.</span> <span class="nv">eww</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"&amp;"</span>   <span class="o">.</span> <span class="nv">eww-browse-with-external-browser</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"b"</span>   <span class="o">.</span> <span class="nv">eww-back-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"]"</span>   <span class="o">.</span> <span class="nv">eww-next-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"["</span>   <span class="o">.</span> <span class="nv">eww-previous-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"g"</span>   <span class="o">.</span> <span class="nv">eww-top-url</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"h"</span>   <span class="o">.</span> <span class="nv">backward-char</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"j"</span>   <span class="o">.</span> <span class="nv">next-line</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-n"</span> <span class="o">.</span> <span class="nv">next-line</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"k"</span>   <span class="o">.</span> <span class="nv">previous-line</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"C-p"</span> <span class="o">.</span> <span class="nv">previous-line</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"l"</span>   <span class="o">.</span> <span class="nv">forward-char</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"/"</span>   <span class="o">.</span> <span class="nv">isearch-forward</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"?"</span>   <span class="o">.</span> <span class="nv">isearch-backward</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"n"</span>   <span class="o">.</span> <span class="nv">isearch-next</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"N"</span>   <span class="o">.</span> <span class="nv">isearch-previous</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"f"</span>   <span class="o">.</span> <span class="nv">ace-link-eww</span><span class="p">))</span>
         <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">ace-link-setup-default</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org5f756509">
<code>ibuffer</code>: buffer の操作</h2>
<div class="outline-text-2" id="text-org5f756509">
<p>
buffer を眺めるのは ibuffer が好み
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ibuffer</span>
  <span class="ss">:defun</span> <span class="p">(</span><span class="nv">ibuffer-current-buffer</span><span class="p">)</span>
  <span class="ss">:defvar</span> <span class="p">(</span><span class="nv">ibuffer-formats</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:ibuffer-find-file</span> <span class="p">()</span>
    <span class="s">"Like `find-file', but default to the directory of the buffer at point."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">default-directory</span>
            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">buf</span> <span class="p">(</span><span class="nv">ibuffer-current-buffer</span><span class="p">)))</span>
              <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">buffer-live-p</span> <span class="nv">buf</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">with-current-buffer</span> <span class="nv">buf</span>
                    <span class="nv">default-directory</span><span class="p">)</span>
                <span class="nv">default-directory</span><span class="p">))))</span>
      <span class="p">(</span><span class="nv">find-file</span> <span class="nv">default-directory</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x C-b"</span> <span class="o">.</span> <span class="nv">ibuffer-other-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x b"</span>   <span class="o">.</span> <span class="nv">ibuffer-other-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x M-b"</span> <span class="o">.</span> <span class="nv">ibuffer</span><span class="p">)</span>
         <span class="p">(</span><span class="ss">:ibuffer-mode-map</span>
          <span class="p">(</span><span class="s">"C-x C-f"</span> <span class="o">.</span> <span class="nv">my:ibuffer-find-file</span><span class="p">))</span>
         <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org5fd7347f">補完: <code>vertico</code>, <code>marginalia</code>, <code>consult</code>, <code>corfu</code>
</h2>
<div class="outline-text-2" id="text-org5fd7347f">
<p>
最近話題になりだしたので, ちょっと使い始めてみたら,
無いと割と途方に暮れる様になってしまった.
…でも重い(?)ので、また <code>ido-vertical</code> に戻るかも.
</p>
</div>
<div>
<h3 id="orgff7e02fd">helm, ivy の無効化</h3>
<div class="outline-text-3" id="text-orgff7e02fd">
<p>
依存する拡張がまだまだ多いので, 一度インストールして邪魔しないようにしておくことに.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">helm</span> <span class="ss">:defer-config</span> <span class="p">(</span><span class="nv">helm-mode</span> <span class="mi">-1</span><span class="p">))</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">ivy</span> <span class="ss">:defer-config</span> <span class="p">(</span><span class="nv">ivy-mode</span> <span class="mi">-1</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgbf52614c">無視する拡張子の追加設定</h3>
<div class="outline-text-3" id="text-orgbf52614c">
<p>
とりあえず, 無視するファイルの拡張子を指定しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*completion</span>
  <span class="ss">:init</span>
  <span class="c1">;; 補完で無視する拡張子の追加．そのうち増える．</span>
  <span class="p">(</span><span class="nv">cl-loop</span> <span class="nv">for</span> <span class="nv">ext</span> <span class="nv">in</span>
           <span class="o">'</span><span class="p">(</span><span class="c1">;; TeX</span>
             <span class="s">".dvi"</span>
             <span class="s">".fdb_latexmk"</span>
             <span class="s">".fls"</span>
             <span class="s">".ilg"</span>
             <span class="s">".jqz"</span>
             <span class="s">".nav"</span>
             <span class="s">".out"</span>
             <span class="s">".snm"</span>
             <span class="s">".synctex\\.gz"</span>
             <span class="s">".vrb"</span>
             <span class="c1">;; fortran &gt;= 90</span>
             <span class="s">".mod"</span>
             <span class="c1">;; zsh</span>
             <span class="s">".zwc"</span>
             <span class="c1">;; libtool</span>
             <span class="s">".in"</span>
             <span class="s">".libs/"</span>
             <span class="c1">;; fxxkin Apple</span>
             <span class="s">".DS_Store"</span>
             <span class="s">"._DS_Store"</span>
             <span class="c1">;; "org-id-locations"</span>
             <span class="p">)</span>
           <span class="nb">do</span> <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'completion-ignored-extensions</span> <span class="nv">ext</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org8362fd9f">
<code>vertico</code>: 本体</h3>
<div class="outline-text-3" id="text-org8362fd9f">
<p>
<a href="https://scrapbox.io/emacs/find-file%E3%81%A7Helm%E3%81%BF%E3%81%9F%E3%81%84%E3%81%ABC-l%E3%81%A7%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E9%81%A1%E3%82%8B">find-fileでHelmみたいにC-lでディレクトリを遡る - emacs</a>
より, <code>C-l</code> で一つ上の階層へ上がれる様にしたり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">vertico</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:preface</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:disable-selection</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">minibuffer-completion-table</span> <span class="nf">#'</span><span class="nv">org-tags-completion-function</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">vertico-map</span> <span class="nv">minibuffer-local-completion-map</span>
                  <span class="nv">completion-cycle-threshold</span> <span class="no">nil</span>
                  <span class="nv">completion-styles</span> <span class="o">'</span><span class="p">(</span><span class="nv">basic</span><span class="p">))))</span>
  <span class="c1">;;</span>
  <span class="c1">;; @see https://misohena.jp/blog/2022-08-15-transition-ivy-to-vertico.html</span>
  <span class="c1">;; 候補更新時に最初の候補を選択しない -&gt; (vertico-preselect . 'prompt)</span>

  <span class="c1">;; ただし require-matchがt(やそれに類するもの)で入力が空ではなくマッチする候</span>
  <span class="c1">;; 補がある場合は、その候補の先頭を選択する。</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:vertico--recompute</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="nv">pt</span> <span class="nv">content</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">result</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">orig-fun</span> <span class="nv">pt</span> <span class="nv">content</span> <span class="nv">args</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">equal</span> <span class="nv">content</span> <span class="s">""</span><span class="p">))</span>
               <span class="c1">;; 入力が空の時は(require-matchであっても)defaultまたはnilを返</span>
               <span class="c1">;; すことになっている。</span>
               <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">alist-get</span> <span class="ss">'vertico--total</span> <span class="nv">result</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">;; &lt; for syntax</span>
               <span class="c1">;; completing-readの説明によれば</span>
               <span class="c1">;; nil,confirm,confirm-after-completion以外はtのように</span>
               <span class="c1">;; 振る舞うべき。</span>
               <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">memq</span> <span class="nv">minibuffer--require-match</span>
                          <span class="o">'</span><span class="p">(</span><span class="no">nil</span> <span class="nv">confirm</span> <span class="nv">confirm-after-completion</span><span class="p">))))</span>
          <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">alist-get</span> <span class="ss">'vertico--index</span> <span class="nv">result</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
      <span class="nv">result</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:filename-upto-parent</span> <span class="p">()</span>
    <span class="s">"Move to parent directory like \"cd ..\" in find-file."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">sep</span> <span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nv">regexp-opt</span> <span class="o">'</span><span class="p">(</span><span class="s">"/"</span> <span class="s">"\\"</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nv">save-excursion</span>
        <span class="p">(</span><span class="nv">left-char</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="nv">sep</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">delete-char</span> <span class="mi">1</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">save-match-data</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">search-backward-regexp</span> <span class="nv">sep</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">right-char</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">filter-buffer-substring</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">save-excursion</span> <span class="p">(</span><span class="nv">end-of-line</span><span class="p">)</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
                                   <span class="nf">#'</span><span class="nb">delete</span><span class="p">)))))</span>
  <span class="ss">:advice</span>
  <span class="p">((</span><span class="ss">:before</span> <span class="nv">vertico--setup</span>
            <span class="nv">my:disable-selection</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">:around</span> <span class="nv">vertico--recompute-candidates</span>
            <span class="nv">my:vertico--recompute</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="ss">:bind</span>
  <span class="p">(</span><span class="ss">:vertico-map</span> <span class="p">((</span><span class="s">"C-l"</span> <span class="o">.</span> <span class="nv">my:filename-upto-parent</span><span class="p">)))</span>
<span class="c1">;;  :custom-face</span>
<span class="c1">;;  `((vertico-current</span>
<span class="c1">;;     . '((t (:inherit hl-line :background unspecified)))))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">vertico-count</span> <span class="mi">8</span>
        <span class="nv">vertico-cycle</span> <span class="no">t</span>
        <span class="nv">vertico-preselect</span> <span class="ss">'prompt</span>
        <span class="nv">vertico-multiline</span> <span class="o">'</span><span class="p">((</span><span class="s">"↓"</span> <span class="mi">0</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">face</span> <span class="nv">vertico-multiline</span><span class="p">))</span>
                            <span class="p">(</span><span class="s">"…"</span> <span class="mi">0</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">face</span> <span class="nv">vertico-multiline</span><span class="p">)))</span>
        <span class="p">)</span>
  <span class="c1">;; :config</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">vertico-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orge9265e4d">
<code>marginalia</code>: リッチな注釈(Enable richer annotations)</h3>
<div class="outline-text-3" id="text-orge9265e4d">
<p>
行揃えが微妙. あと, ファイル名を省略表示できないのかな?
⇒ <a href="https://github.com/minad/marginalia/issues/70">Better truncation method for file names #70</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">marginalia</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="c1">;; 補完でも icon 表示</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">nerd-icons-completion</span>
   <span class="ss">:ensure</span> <span class="no">t</span>
   <span class="ss">:hook</span>
   <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">nerd-icons-completion-mode</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"M-A"</span> <span class="o">.</span> <span class="nv">marginalia-cycle</span><span class="p">)</span>
         <span class="p">(</span><span class="ss">:minibuffer-local-map</span>
          <span class="p">(</span><span class="s">"M-A"</span> <span class="o">.</span> <span class="nv">marginalia-cycle</span><span class="p">)</span>
          <span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">marginalia-annotators</span>    <span class="o">'</span><span class="p">(</span><span class="nv">marginalia-annotators-light</span>
                                   <span class="nv">marginalia-annotators-heavy</span>
                                   <span class="no">nil</span><span class="p">)</span>
        <span class="nv">marginalia-align</span>         <span class="ss">'right</span>
        <span class="nv">marginalia-align-offset</span>  <span class="mi">-2</span> <span class="c1">;; icon 分引いておく</span>
        <span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">marginalia-mode</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">marginalia-mode-hook</span> <span class="o">.</span> <span class="nv">nerd-icons-completion-marginalia-setup</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orged5e5627">
<code>consult</code>: 便利コマンド集</h3>
<div class="outline-text-3" id="text-orged5e5627">
<p>
とりあえず recetnf が使えないと途方に暮れるので
<code>consult-recent-file</code> のカスタマイズのみ.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">consult</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x C-r"</span> <span class="o">.</span> <span class="nv">my:consult-recent-file</span><span class="p">))</span>
  <span class="c1">;; :defvar recentf-list</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">consult-narrow-key</span>          <span class="s">"&lt;"</span>
        <span class="nv">consult-async-refresh-delay</span> <span class="mf">0.2</span>
        <span class="nv">consult-preview-key</span>         <span class="no">nil</span>
        <span class="c1">;; 増やさないと preview 時に theme がロードされない模様.</span>
        <span class="c1">;; とりあえず default の 10 倍にしている. 1 MB かな?</span>
        <span class="nv">consult-preview-raw-size</span> <span class="mi">1024000</span>
        <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:consult-recent-file</span> <span class="p">()</span>
    <span class="s">"Find recent using `completing-read' with shorten filename"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'recentf</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">recentf-mode</span> <span class="mi">+1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">files</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">f</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">my:shorten-file-path</span> <span class="nv">f</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">window-width</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">f</span><span class="p">))</span>
                         <span class="nv">recentf-list</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">selected</span>
             <span class="p">(</span><span class="nv">consult--read</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#'</span><span class="nb">car</span> <span class="nv">files</span><span class="p">)</span>
                            <span class="ss">:prompt</span> <span class="s">"Find recent file: "</span>
                            <span class="ss">:sort</span> <span class="no">nil</span>
                            <span class="ss">:require-match</span> <span class="no">t</span>
                            <span class="ss">:category</span> <span class="ss">'file</span>
                            <span class="ss">:state</span> <span class="p">(</span><span class="nv">consult--file-preview</span><span class="p">)</span>
                            <span class="ss">:history</span> <span class="ss">'file-name-history</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nv">assoc-default</span> <span class="nv">selected</span> <span class="nv">files</span><span class="p">)))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org3b1ea0b6">
<code>cape</code>: 補完 backend</h3>
<div class="outline-text-3" id="text-org3b1ea0b6">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">cape</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">cape-dabbrev-check-other-buffers</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'completion-at-point-functions</span> <span class="ss">'cape-keyword</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'completion-at-point-functions</span> <span class="ss">'cape-dabbrev</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'completion-at-point-functions</span> <span class="ss">'cape-file</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'completion-at-point-functions</span> <span class="ss">'cape-tex</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'completion-at-point-functions</span> <span class="ss">'cape-emoji</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgc12df551">
<code>orderless</code>: 補完候補の選択</h3>
<div class="outline-text-3" id="text-orgc12df551">
<p>
イロイロと凝れそうだけど, とりあえずはデフォルトのままで.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">orderless</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">completion-styles</span> <span class="o">'</span><span class="p">(</span><span class="nv">orderless</span><span class="p">)</span>
        <span class="nv">orderless-matching-styles</span> <span class="o">'</span><span class="p">(</span><span class="nv">orderless-prefixes</span>
                                    <span class="nv">orderless-flex</span>
                                    <span class="nv">orderless-regexp</span>
                                    <span class="nv">orderless-initialism</span>
                                    <span class="nv">orderless-literal</span><span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org80404324">
<code>kind-icon</code>: corfu で補完候補にアイコン表示</h3>
<div class="outline-text-3" id="text-org80404324">
<p>
svg-lib でのアイコン表示ではなく nerd-icons を利用するように.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">kind-icon</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:after</span> <span class="nv">corfu-terminal</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">kind-icon-default-face</span> <span class="ss">'corfu-default</span>
        <span class="nv">kind-icon-use-icons</span>    <span class="no">nil</span>
        <span class="nv">kind-icon-mapping</span>      <span class="o">`</span><span class="p">(</span>
                                 <span class="p">(</span><span class="nc">array</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_array"</span><span class="p">)</span>       <span class="ss">:face</span> <span class="nv">font-lock-type-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="kt">boolean</span>        <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_boolean"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-builtin-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nc">class</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_class"</span><span class="p">)</span>       <span class="ss">:face</span> <span class="nv">font-lock-type-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">color</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_color"</span><span class="p">)</span>       <span class="ss">:face</span> <span class="nv">success</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">command</span>        <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-terminal"</span><span class="p">)</span>           <span class="ss">:face</span> <span class="nv">default</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">constant</span>       <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_constant"</span><span class="p">)</span>    <span class="ss">:face</span> <span class="nv">font-lock-constant-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">constructor</span>    <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-triangle_right"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-function-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">enummember</span>     <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_enum_member"</span><span class="p">)</span> <span class="ss">:face</span> <span class="nv">font-lock-builtin-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">enum-member</span>    <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_enum_member"</span><span class="p">)</span> <span class="ss">:face</span> <span class="nv">font-lock-builtin-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">enum</span>           <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_enum"</span><span class="p">)</span>        <span class="ss">:face</span> <span class="nv">font-lock-builtin-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">event</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_event"</span><span class="p">)</span>       <span class="ss">:face</span> <span class="nv">font-lock-warning-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">field</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_field"</span><span class="p">)</span>       <span class="ss">:face</span> <span class="nv">font-lock-variable-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">file</span>           <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_file"</span><span class="p">)</span>        <span class="ss">:face</span> <span class="nv">font-lock-string-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">folder</span>         <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-folder"</span><span class="p">)</span>             <span class="ss">:face</span> <span class="nv">font-lock-doc-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">interface</span>      <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_interface"</span><span class="p">)</span>   <span class="ss">:face</span> <span class="nv">font-lock-type-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="kt">keyword</span>        <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_keyword"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-keyword-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">macro</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_misc"</span><span class="p">)</span>        <span class="ss">:face</span> <span class="nv">font-lock-keyword-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">magic</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-wand"</span><span class="p">)</span>               <span class="ss">:face</span> <span class="nv">font-lock-builtin-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nc">method</span>         <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_method"</span><span class="p">)</span>      <span class="ss">:face</span> <span class="nv">font-lock-function-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="k">function</span>       <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_method"</span><span class="p">)</span>      <span class="ss">:face</span> <span class="nv">font-lock-function-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">module</span>         <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-file_submodule"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-preprocessor-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">numeric</span>        <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_numeric"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-builtin-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">operator</span>       <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_operator"</span><span class="p">)</span>    <span class="ss">:face</span> <span class="nv">font-lock-comment-delimiter-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">param</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_parameter"</span><span class="p">)</span>   <span class="ss">:face</span> <span class="nv">default</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">property</span>       <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_property"</span><span class="p">)</span>    <span class="ss">:face</span> <span class="nv">font-lock-variable-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">reference</span>      <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-references"</span><span class="p">)</span>         <span class="ss">:face</span> <span class="nv">font-lock-variable-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">snippet</span>        <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_snippet"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-string-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nb">string</span>         <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_string"</span><span class="p">)</span>      <span class="ss">:face</span> <span class="nv">font-lock-string-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">struct</span>         <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_structure"</span><span class="p">)</span>   <span class="ss">:face</span> <span class="nv">font-lock-variable-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">text</span>           <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-text_size"</span><span class="p">)</span>          <span class="ss">:face</span> <span class="nv">font-lock-doc-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">typeparameter</span>  <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-list_unordered"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-type-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">type-parameter</span> <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-list_unordered"</span><span class="p">)</span>     <span class="ss">:face</span> <span class="nv">font-lock-type-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">unit</span>           <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_ruler"</span><span class="p">)</span>       <span class="ss">:face</span> <span class="nv">font-lock-constant-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">value</span>          <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_field"</span><span class="p">)</span>       <span class="ss">:face</span> <span class="nv">font-lock-builtin-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">variable</span>       <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-symbol_variable"</span><span class="p">)</span>    <span class="ss">:face</span> <span class="nv">font-lock-variable-name-face</span><span class="p">)</span>
                                 <span class="p">(</span><span class="no">t</span>              <span class="o">,</span><span class="p">(</span><span class="nv">nerd-icons-codicon</span> <span class="s">"nf-cod-code"</span><span class="p">)</span>               <span class="ss">:face</span> <span class="nv">font-lock-warning-face</span><span class="p">))</span>
        <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'corfu-margin-formatters</span> <span class="nf">#'</span><span class="nv">kind-icon-margin-formatter</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org37d21658">
<code>corfu</code>: on the fly completions</h3>
<div class="outline-text-3" id="text-org37d21658">
<p>
<code>company</code> より使い勝手が良い, 気がする.
</p>
<p>
:CUSTOM<sub>ID</sub>: orgb72396fd
</p>
<p>
<a href="https://misohena.jp/blog/2024-02-15-separate-notification-and-selection-with-corfu-auto.html">Corfuの自動補完で候補の存在を伝える事と候補を選べるようにする事を分離する</a> を参考に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">corfu</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nv">defvar-keymap</span> <span class="nv">my:corfu-auto-map</span>
    <span class="ss">:doc</span> <span class="s">"Keymap used when popup is shown automatically."</span>
    <span class="s">"C-g"</span> <span class="nf">#'</span><span class="nv">corfu-quit</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:corfu-in-auto-complete</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:corfu--auto-complete-deferred:around</span> <span class="p">(</span><span class="nv">oldfun</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="c1">;; 自動補完時に呼び出される</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">my:corfu-in-auto-complete</span> <span class="no">t</span><span class="p">))</span>
    <span class="c1">;; 元の関数を呼び出す. 補完候補があるなら setup が呼ばれる</span>
    <span class="p">(</span><span class="nb">apply</span> <span class="nv">oldfun</span> <span class="nv">args</span><span class="p">)))</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:corfu--setup:around</span> <span class="p">(</span><span class="nv">oldfun</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="nv">my:corfu-in-auto-complete</span>
      <span class="c1">;; 自動補完の時</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nb">setf</span> <span class="c1">;; (alist-get 'alpha corfu--frame-parameters) 90</span>
              <span class="p">(</span><span class="nv">alist-get</span> <span class="ss">'tab-line-format</span> <span class="nv">corfu--buffer-parameters</span><span class="p">)</span> <span class="s">"   C-M-i:補完"</span>
              <span class="c1">;; 最初の候補を選ばない</span>
              <span class="nv">corfu-preselect</span> <span class="ss">'prompt</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="c1">;; キー割り当てを極力無くす</span>
              <span class="p">(</span><span class="nv">corfu-map</span> <span class="nv">my:corfu-auto-map</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">apply</span> <span class="nv">oldfun</span> <span class="nv">args</span><span class="p">)))</span>
    <span class="c1">;; 手動補完の時</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="c1">;; (alist-get 'alpha corfu--frame-parameters) 100</span>
          <span class="p">(</span><span class="nv">alist-get</span> <span class="ss">'tab-line-format</span> <span class="nv">corfu--buffer-parameters</span><span class="p">)</span> <span class="no">nil</span>
          <span class="c1">;; 最初の候補を選ぶ</span>
          <span class="nv">corfu-preselect</span> <span class="ss">'first</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">apply</span> <span class="nv">oldfun</span> <span class="nv">args</span><span class="p">)))</span>
  <span class="ss">:advice</span> <span class="p">((</span><span class="ss">:around</span> <span class="nv">corfu--auto-complete-deferred</span>
                    <span class="nv">my:corfu--auto-complete-deferred:around</span><span class="p">)</span>
           <span class="p">(</span><span class="ss">:around</span> <span class="nv">corfu--setup</span>
                    <span class="nv">my:corfu--setup:around</span><span class="p">)</span>
           <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">corfu-terminal</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">corfu-terminal-disable-on-gui</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:bind</span>
  <span class="p">(</span><span class="ss">:corfu-map</span>
   <span class="p">(</span><span class="s">"TAB"</span>       <span class="o">.</span> <span class="nv">corfu-next</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"&lt;tab&gt;"</span>     <span class="o">.</span> <span class="nv">corfu-next</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"S-TAB"</span>     <span class="o">.</span> <span class="nv">corfu-previous</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"&lt;backtab&gt;"</span> <span class="o">.</span> <span class="nv">corfu-previous</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-j"</span>       <span class="o">.</span> <span class="nv">corfu-next</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-n"</span>       <span class="o">.</span> <span class="nv">corfu-next</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-p"</span>       <span class="o">.</span> <span class="nv">corfu-previous</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-k"</span>       <span class="o">.</span> <span class="nv">corfu-previous</span><span class="p">)</span>
   <span class="p">(</span><span class="s">"C-g"</span>       <span class="o">.</span> <span class="nv">corfu-quit</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                                <span class="p">(</span><span class="nv">corfu-terminal-mode</span> <span class="mi">+1</span><span class="p">)</span>
                                <span class="p">(</span><span class="nv">global-corfu-mode</span><span class="p">)))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">completion-cycle-threshold</span> <span class="mi">4</span>
        <span class="nv">tab-always-indent</span>          <span class="ss">'complete</span>
        <span class="nv">corfu-cycle</span>                <span class="no">t</span>
        <span class="nv">corfu-auto</span>                 <span class="no">t</span>
        <span class="nv">corfu-preselect</span>            <span class="ss">'prompt</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org21392594">
<code>chezmoi</code>: 設定ファイルの編集補助</h2>
<div class="outline-text-2" id="text-org21392594">
<p>
設定ファイルの管理に <a href="https://www.chezmoi.io/">chezmoi</a> を使うようになったので,
その編集補助に.
</p>

<p>
地味ながら, 非常に便利.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">chezmoi</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"chezmoi"</span><span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-c C f"</span> <span class="o">.</span> <span class="nv">chezmoi-find</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c C s"</span> <span class="o">.</span> <span class="nv">chezmoi-write</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="org31fb6f15">言語毎のモードの設定など</h2>
<div class="outline-text-2" id="text-org31fb6f15">
</div>
<div>
<h3 id="org11b26f5a">
<code>rainbow-delimiters</code>: 対応する括弧を色付け</h3>
<div class="outline-text-3" id="text-org11b26f5a">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">rainbow-delimiters</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">prog-mode-hook</span> <span class="o">.</span> <span class="nv">rainbow-delimiters-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org1f0e431b">
<code>rainbow-mode</code>: カラーコードに色付け</h3>
<div class="outline-text-3" id="text-org1f0e431b">
<p>
<code>#RRGGBB</code> のカラーコードに勝手に色が付く．CSS の編集中なんかで地味に便利．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">rainbow-mode</span> <span class="ss">:ensure</span> <span class="no">t</span> <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">rainbow-mode</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgc773dfbe">
<code>markdown-mode</code>: Markdown 関連</h3>
<div class="outline-text-3" id="text-orgc773dfbe">
<p>
色々な所で使われているので, とりあえずここで設定
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">markdown-mode</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:mode</span> <span class="p">(</span><span class="s">"\\.md\\'"</span> <span class="s">"\\.markdown\\'"</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">markdown-command</span> <span class="s">"pandoc"</span><span class="p">)</span> <span class="c1">;; プレビュー等で利用するコマンド</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org80208e5d">
<code>treesit</code>: 賢いシンタックスハイライト</h3>
<div class="outline-text-3" id="text-org80208e5d">
<p>
Emacs 同梱の treesit を使う
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">treesit</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"tree-sitter"</span><span class="p">)</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:treesit-install-grammar-all</span> <span class="p">()</span>
    <span class="s">"install all tree-sitter-grammer's"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">mapc</span>
     <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">lang</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">treesit-language-available-p</span> <span class="nv">lang</span> <span class="no">nil</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">treesit-install-language-grammar</span> <span class="nv">lang</span><span class="p">)))</span>
     <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#'</span><span class="nb">car</span> <span class="nv">treesit-language-source-alist</span><span class="p">)))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">treesit-language-source-alist</span>
        <span class="o">'</span><span class="p">(</span><span class="c1">;;</span>
          <span class="p">(</span><span class="nv">elisp</span> <span class="s">"https://github.com/Wilfred/tree-sitter-elisp"</span><span class="p">)</span>
          <span class="c1">;; (markdown "https://github.com/ikatyang/tree-sitter-markdown")</span>
          <span class="p">(</span><span class="nv">gitcommit</span> <span class="s">"https://github.com/gbprod/tree-sitter-gitcommit"</span><span class="p">)</span>
          <span class="c1">;; (bash "https://github.com/tree-sitter/tree-sitter-bash")</span>
          <span class="c1">;; (clojure "https://github.com/sogaiu/tree-sitter-clojure")</span>
          <span class="c1">;; (cmake "https://github.com/uyha/tree-sitter-cmake")</span>
          <span class="c1">;; (css "https://github.com/tree-sitter/tree-sitter-css")</span>
          <span class="c1">;; (dockerfile "https://github.com/camdencheek/tree-sitter-dockerfile")</span>
          <span class="c1">;; (latex "https://github.com/latex-lsp/tree-sitter-latex")</span>
          <span class="c1">;; (go "https://github.com/tree-sitter/tree-sitter-go")</span>
          <span class="c1">;; (html "https://github.com/tree-sitter/tree-sitter-html")</span>
          <span class="c1">;; (javascript "https://github.com/tree-sitter/tree-sitter-javascript" "master" "src")</span>
          <span class="c1">;; (json "https://github.com/tree-sitter/tree-sitter-json")</span>
          <span class="c1">;; (make "https://github.com/alemuller/tree-sitter-make")</span>
          <span class="c1">;; (nix "https://github.com/nix-community/tree-sitter-nix")</span>
          <span class="c1">;; (python "https://github.com/tree-sitter/tree-sitter-python")</span>
          <span class="c1">;; (rust "https://github.com/tree-sitter/tree-sitter-rust")</span>
          <span class="p">(</span><span class="nv">toml</span> <span class="s">"https://github.com/tree-sitter/tree-sitter-toml"</span><span class="p">)</span>
          <span class="c1">;; (tsx "https://github.com/tree-sitter/tree-sitter-typescript" "master" "tsx/src")</span>
          <span class="c1">;; (typescript "https://github.com/tree-sitter/tree-sitter-typescript" "master" "typescript/src")</span>
          <span class="c1">;; (yaml "https://github.com/ikatyang/tree-sitter-yaml")</span>
          <span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org49a03d08">
<code>f90-ts-mode</code>: fortran の色付けを tree-sitter で</h3>
<div class="outline-text-3" id="text-org49a03d08">
<p>
あまり好みでないので, 諸々じたばた…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">f90-ts-mode</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"tree-sitter"</span><span class="p">)</span>
  <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"git@github.com:uwabami/emacs-f90-ts-mode.git"</span><span class="p">)</span>
  <span class="ss">:mode</span> <span class="p">(</span><span class="s">"\\.f90\\'"</span> <span class="s">"\\.F90\\'"</span> <span class="s">"\\.f95\\'"</span> <span class="s">"\\.F95\\'"</span> <span class="s">"\\.F\\'"</span><span class="p">)</span>
  <span class="ss">:defvar</span> <span class="nv">treesit-language-source-alist</span>
  <span class="ss">:bind</span> <span class="p">(</span><span class="ss">:f90-ts-mode-map</span>
         <span class="p">(</span><span class="s">"C-c '"</span> <span class="o">.</span> <span class="nv">separedit</span><span class="p">))</span>
  <span class="ss">:preface</span>
  <span class="c1">;;  --------------------------------------------------- --------------------</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:install-fortran-grammar-with-generate</span> <span class="p">()</span>
    <span class="s">"install 時に tree-sitter generateを実行してから install"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">lang</span> <span class="ss">'fortran</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">url</span> <span class="s">"https://github.com/mscfd/tree-sitter-fortran"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">revision</span> <span class="s">"master"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">tmp-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"tree-sitter-fortran-tmp"</span> <span class="nv">temporary-file-directory</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">tmp-dir</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">delete-directory</span> <span class="nv">tmp-dir</span> <span class="no">t</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">message</span> <span class="s">"Cloning %s..."</span> <span class="nv">url</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">call-process</span> <span class="s">"git"</span> <span class="no">nil</span> <span class="no">nil</span> <span class="no">nil</span> <span class="s">"clone"</span> <span class="s">"-b"</span> <span class="nv">revision</span> <span class="s">"--depth"</span> <span class="s">"1"</span> <span class="nv">url</span> <span class="nv">tmp-dir</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">message</span> <span class="s">"Running tree-sitter generate..."</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">default-directory</span> <span class="nv">tmp-dir</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">call-process-shell-command</span> <span class="s">"tree-sitter generate"</span> <span class="no">nil</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">treesit-language-source-alist</span> <span class="o">`</span><span class="p">((</span><span class="o">,</span><span class="nv">lang</span> <span class="o">,</span><span class="nv">tmp-dir</span> <span class="no">nil</span> <span class="s">"src"</span><span class="p">))))</span>
        <span class="p">(</span><span class="nv">treesit-install-language-grammar</span> <span class="nv">lang</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">message</span> <span class="s">"Fortran grammar installed successfully from generated source!"</span><span class="p">)))</span>
  <span class="c1">;; ------------------------------------------------------------------------</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:f90-ts-toggle-mode</span> <span class="p">()</span>
    <span class="s">"Toggle between `f90-mode' (legacy) and `f90-ts-mode'."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">major-mode</span> <span class="ss">'f90-ts-mode</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">fboundp</span> <span class="ss">'f90-mode</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">f90-mode</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">message</span> <span class="s">"Legacy `f90-mode' not available"</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">f90-ts-mode</span><span class="p">)))</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:fixed-f90-ts-rules-variable</span> <span class="p">()</span>
    <span class="s">"Fixed font-lock rules for variables, declarations, and module control."</span>
    <span class="p">(</span><span class="nv">treesit-font-lock-rules</span>
     <span class="ss">:language</span> <span class="ss">'fortran</span>
     <span class="ss">:feature</span> <span class="ss">'variable</span>
     <span class="o">'</span><span class="p">(</span>
       <span class="c1">;; 1. 変数宣言 (integer :: nm, real :: x=1.0)</span>
       <span class="p">(</span><span class="nv">variable_declaration</span> <span class="p">(</span><span class="nv">init_declarator</span> <span class="nv">left:</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@font-lock-variable-name-face</span><span class="p">))</span>
       <span class="p">(</span><span class="nv">variable_declaration</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@font-lock-variable-name-face</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">variable_declaration</span> <span class="p">(</span><span class="nv">sized_declarator</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@font-lock-variable-name-face</span><span class="p">))</span>
       <span class="c1">;; 2. SAVE</span>
       <span class="p">(</span><span class="nv">save_statement</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@font-lock-variable-name-face</span><span class="p">)</span>
       <span class="c1">;; 3. モジュール制御 (use, only, private, public)</span>
       <span class="p">(</span><span class="nv">use_statement</span> <span class="p">(</span><span class="nv">module_name</span><span class="p">)</span> <span class="nv">@font-lock-constant-face</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">included_items</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@font-lock-variable-name-face</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">public_statement</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@font-lock-function-name-face</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">private_statement</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@font-lock-function-name-face</span><span class="p">)</span>
       <span class="c1">;; 4. プログラム単位の名前</span>
       <span class="p">(</span><span class="nv">module_statement</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span> <span class="nv">@font-lock-function-name-face</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">program_statement</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span> <span class="nv">@font-lock-function-name-face</span><span class="p">)</span>
       <span class="c1">;; 5. 元のルール (self)</span>
       <span class="p">((</span><span class="nv">identifier</span><span class="p">)</span> <span class="nv">@f90-ts-font-lock-special-var-face</span>
        <span class="p">(</span><span class="ss">:pred</span> <span class="nv">f90-ts-special-var-p</span> <span class="nv">@f90-ts-font-lock-special-var-face</span><span class="p">))</span>
       <span class="p">)))</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'major-mode-remap-alist</span> <span class="o">'</span><span class="p">(</span><span class="nv">f90-mode</span> <span class="o">.</span> <span class="nv">f90-ts-mode</span><span class="p">))</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="c1">;; (:override f90-ts--font-lock-rules-function my:fixed-f90-ts-rules-function)</span>
   <span class="p">(</span><span class="ss">:override</span> <span class="nv">f90-ts--font-lock-rules-variable</span> <span class="nv">my:fixed-f90-ts-rules-variable</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="ss">:custom-face</span>
  <span class="p">(</span><span class="nv">f90-ts-font-lock-intrinsic-face</span>       <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">font-lock-builtin-face</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">f90-ts-font-lock-delimiter-face</span>       <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">font-lock-delimiter-face</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">f90-ts-font-lock-operator-face</span>        <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">font-lock-operator-face</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">f90-ts-font-lock-openmp-face</span>          <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">font-lock-preprocessor-face</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">f90-ts-font-lock-bracket-face</span>         <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">font-lock-bracket-face</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">f90-ts-font-lock-special-var-face</span>     <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">font-lock-constant-face</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">f90-ts-font-lock-special-comment-face</span> <span class="o">.</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">font-lock-doc-face</span><span class="p">)))</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">f90-ts-indent-toplevel</span> <span class="mi">2</span>
        <span class="nv">f90-ts-indent-contain</span> <span class="mi">2</span>
        <span class="nv">f90-ts-indent-block</span> <span class="mi">2</span>
        <span class="nv">f90-ts-indent-continued</span> <span class="mi">2</span>
        <span class="nv">f90-ts-indent-openmp-style</span> <span class="ss">'context</span>
        <span class="nv">f90-ts-indent-lists-region</span> <span class="ss">'continued-line</span>
        <span class="nv">f90-ts-indent-lists-line</span>   <span class="ss">'continued-line</span>
        <span class="nv">f90-ts-smart-end</span> <span class="ss">'no-blink</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">f90-ts-indent-rules-openmp</span>
        <span class="o">`</span><span class="p">(</span>
          <span class="c1">;; ,@(f90-ts-indent-rules-info "openmp")</span>
          <span class="p">((</span><span class="nv">f90-ts--openmp-comment-is</span><span class="p">)</span> <span class="nv">prev-sibling</span> <span class="mi">0</span><span class="p">)</span>
          <span class="p">((</span><span class="nv">f90-ts--openmp-comment-is</span><span class="p">)</span> <span class="nv">parent-bol</span> <span class="nv">f90-ts-indent-block</span><span class="p">))</span>
        <span class="p">)</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">f90-ts-mode-hook</span>
   <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
       <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">comment-start</span> <span class="s">"!"</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">comment-start-skip</span> <span class="s">"\\(!&gt;\\|!+\\)[ \t]*"</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">font-lock-add-keywords</span>
        <span class="no">nil</span>
        <span class="o">'</span><span class="p">((</span><span class="s">"!&gt;.*\\(\\*\\*\\(.*?\\)\\*\\*\\)"</span> <span class="p">(</span><span class="mi">1</span> <span class="ss">'font-lock-bold-face</span> <span class="nv">prepend</span><span class="p">))</span>
          <span class="p">(</span><span class="s">"!&gt;.*\\(`\\(.*?\\)`\\)"</span> <span class="p">(</span><span class="mi">1</span> <span class="ss">'font-lock-constant-face</span> <span class="nv">prepend</span><span class="p">))</span>
          <span class="p">(</span><span class="s">"!&gt;\\([ \t]*-[ \t]+\\)"</span> <span class="p">(</span><span class="mi">1</span> <span class="ss">'font-lock-keyword-face</span> <span class="nv">prepend</span><span class="p">))</span>
          <span class="p">(</span><span class="s">"!&gt;\\([ \t]*#+ .*\\)$"</span> <span class="p">(</span><span class="mi">1</span> <span class="ss">'font-lock-builtin-face</span> <span class="nv">prepend</span><span class="p">)))</span>
        <span class="ss">'append</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">treesit-font-lock-level</span> <span class="mi">5</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">treesit-font-lock-recompute-features</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">treesit-fold-mode</span><span class="p">)</span>
       <span class="p">)</span>
   <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org43e560a9">
<code>treesit-fold</code>: コードの「折り畳み」</h3>
<div class="outline-text-3" id="text-org43e560a9">
<p>
fortran-parser を追加するためにじたばた…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">treesit-fold</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"tree-sitter"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-c f"</span> <span class="o">.</span> <span class="nv">treesit-fold-toggle</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c F"</span> <span class="o">.</span> <span class="nv">my:treesit-fold-toggle-all</span><span class="p">)</span>
         <span class="p">)</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:treesit-fold-toggle-all</span> <span class="p">()</span>
    <span class="s">"Toggle between `treesit-fold-open-all' and `treesit-fold-close-all'."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">found-folded</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">save-excursion</span>
        <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">ov</span> <span class="p">(</span><span class="nv">overlays-in</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">eq</span> <span class="p">(</span><span class="nv">overlay-get</span> <span class="nv">ov</span> <span class="ss">'invisible</span><span class="p">)</span> <span class="ss">'treesit-fold</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">found-folded</span> <span class="no">t</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">if</span> <span class="nv">found-folded</span>
          <span class="p">(</span><span class="k">progn</span>
            <span class="p">(</span><span class="nv">treesit-fold-open-all</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">message</span> <span class="s">"All nodes opened"</span><span class="p">))</span>
        <span class="p">(</span><span class="k">progn</span>
          <span class="p">(</span><span class="nv">treesit-fold-close-all</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">message</span> <span class="s">"All nodes closed"</span><span class="p">)))))</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:treesit-fold-toggle-override</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">_args</span><span class="p">)</span>
    <span class="s">"Toggle fold at point. If opening, open recursively."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">if-let*</span> <span class="p">((</span><span class="nv">node</span> <span class="p">(</span><span class="nv">treesit-fold--foldable-node-at-pos</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">ov</span> <span class="p">(</span><span class="nv">treesit-fold-overlay-at</span> <span class="nv">node</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">treesit-fold-open-recursively</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">treesit-fold-close</span><span class="p">)))</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:override</span> <span class="nv">treesit-fold-toggle</span> <span class="nv">my:treesit-fold-toggle-override</span><span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">((</span><span class="nv">treesit-fold-mode-hook</span> <span class="o">.</span> <span class="nv">treesit-fold-line-comment-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">emacs-lisp-mode-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">treesit-parser-create</span> <span class="ss">'elisp</span><span class="p">)))</span>
         <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="c1">;; ---------------------------------------------------------------------------</span>
  <span class="c1">;; Fortran Support Implementation</span>
  <span class="c1">;; ---------------------------------------------------------------------------</span>
  <span class="c1">;; Constants of fold target</span>
  <span class="p">(</span><span class="nv">defconst</span> <span class="nv">treesit-fold-fortran-declaration-nodes</span>
    <span class="o">'</span><span class="p">(</span><span class="s">"use_statement"</span> <span class="s">"implicit_statement"</span> <span class="s">"import_statement"</span> <span class="s">"include_statement"</span>
      <span class="s">"private_statement"</span> <span class="s">"public_statement"</span> <span class="s">"save_statement"</span> <span class="s">"parameter_statement"</span>
      <span class="s">"data_statement"</span> <span class="s">"variable_declaration"</span> <span class="s">"namelist_statement"</span> <span class="s">"common_statement"</span>
      <span class="s">"equivalence_statement"</span> <span class="s">"entry_statement"</span> <span class="s">"format_statement"</span><span class="p">)</span>
    <span class="s">"List of declaration node types in Fortran to be folded as a group."</span><span class="p">)</span>
  <span class="c1">;; Check Sibling Node</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">treesit-fold-range-fortran--sibling</span> <span class="p">(</span><span class="nv">node</span> <span class="nv">next</span><span class="p">)</span>
    <span class="s">"Find the nearest sibling of NODE.
If NEXT is non-nil, search forwards; otherwise, search backwards.
Skips comments, newlines, and end-of-statement markers."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">iter</span> <span class="p">(</span><span class="k">if</span> <span class="nv">next</span> <span class="p">(</span><span class="nv">treesit-node-next-sibling</span> <span class="nv">node</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">treesit-node-prev-sibling</span> <span class="nv">node</span><span class="p">))))</span>
      <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">iter</span>
                  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="k">type</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">iter</span><span class="p">)))</span>
                    <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">string-equal</span> <span class="k">type</span> <span class="s">"comment"</span><span class="p">)</span>
                        <span class="p">(</span><span class="nb">string-equal</span> <span class="k">type</span> <span class="s">"\n"</span><span class="p">)</span>
                        <span class="p">(</span><span class="nv">string-prefix-p</span> <span class="s">"_end_of_"</span> <span class="k">type</span><span class="p">)</span>
                        <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">"\\`\\s-*\\'"</span> <span class="k">type</span><span class="p">))))</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">iter</span> <span class="p">(</span><span class="k">if</span> <span class="nv">next</span> <span class="p">(</span><span class="nv">treesit-node-next-sibling</span> <span class="nv">iter</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">treesit-node-prev-sibling</span> <span class="nv">iter</span><span class="p">))))</span>
      <span class="nv">iter</span><span class="p">))</span>
  <span class="c1">;; Range Parsers</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">treesit-fold-range-fortran-declarations</span> <span class="p">(</span><span class="nv">node</span> <span class="nv">offset</span><span class="p">)</span>
    <span class="s">"Calculate the fold range for consecutive declaration blocks.
Merges adjacent declaration nodes into a single fold.
Also includes trailing comments (e.g. !$omp or normal comments) in the block."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="k">type</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">node</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">member</span> <span class="k">type</span> <span class="nv">treesit-fold-fortran-declaration-nodes</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">prev</span> <span class="p">(</span><span class="nv">treesit-fold-range-fortran--sibling</span> <span class="nv">node</span> <span class="no">nil</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">next</span> <span class="p">(</span><span class="nv">treesit-fold-range-fortran--sibling</span> <span class="nv">node</span> <span class="no">t</span><span class="p">)))</span>
          <span class="c1">;; Only fold from the first node in a sequence of declarations.</span>
          <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">prev</span> <span class="p">(</span><span class="nb">member</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">prev</span><span class="p">)</span> <span class="nv">treesit-fold-fortran-declaration-nodes</span><span class="p">))</span>
            <span class="c1">;; 1. Determine the end of the strict declaration block</span>
            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">last-node</span> <span class="nv">node</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">iter-node</span> <span class="nv">next</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">iter-node</span>
                          <span class="p">(</span><span class="nb">member</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">iter-node</span><span class="p">)</span> <span class="nv">treesit-fold-fortran-declaration-nodes</span><span class="p">))</span>
                <span class="p">(</span><span class="k">setq</span> <span class="nv">last-node</span> <span class="nv">iter-node</span><span class="p">)</span>
                <span class="p">(</span><span class="k">setq</span> <span class="nv">iter-node</span> <span class="p">(</span><span class="nv">treesit-fold-range-fortran--sibling</span> <span class="nv">iter-node</span> <span class="no">t</span><span class="p">)))</span>
              <span class="c1">;; 2. 通常の sibling 取得関数はコメントを飛ばしてしまうため,</span>
              <span class="c1">;;    ここでは生の next-sibling を取得し, コメントか改行なら範囲を拡張する</span>
              <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">scan-node</span> <span class="p">(</span><span class="nv">treesit-node-next-sibling</span> <span class="nv">last-node</span><span class="p">)))</span>
                <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">scan-node</span>
                            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">t-type</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">scan-node</span><span class="p">)))</span>
                              <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">string-equal</span> <span class="nv">t-type</span> <span class="s">"comment"</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nb">string-equal</span> <span class="nv">t-type</span> <span class="s">"\n"</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">"\\`\\s-*\\'"</span> <span class="nv">t-type</span><span class="p">))))</span>
                  <span class="c1">;; コメントノードが見つかったら、そこをブロックの末尾とする</span>
                  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">string-equal</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">scan-node</span><span class="p">)</span> <span class="s">"comment"</span><span class="p">)</span>
                    <span class="p">(</span><span class="k">setq</span> <span class="nv">last-node</span> <span class="nv">scan-node</span><span class="p">))</span>
                  <span class="p">(</span><span class="k">setq</span> <span class="nv">scan-node</span> <span class="p">(</span><span class="nv">treesit-node-next-sibling</span> <span class="nv">scan-node</span><span class="p">))))</span>
              <span class="c1">;; 3. Create fold if range is valid</span>
              <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">node</span> <span class="nv">last-node</span><span class="p">))</span>
                <span class="p">(</span><span class="nv">treesit-fold--cons-add</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">treesit-node-start</span> <span class="nv">node</span><span class="p">)</span>
                                              <span class="p">(</span><span class="nv">treesit-node-end</span> <span class="nv">last-node</span><span class="p">))</span>
                                        <span class="nv">offset</span><span class="p">))))))))</span>
  <span class="c1">;; Comment block</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">treesit-fold-range-fortran-comment</span> <span class="p">(</span><span class="nv">node</span> <span class="nv">offset</span><span class="p">)</span>
    <span class="s">"Calculate the fold range for consecutive comment blocks.
Skips empty lines and non-comment whitespace between comments."</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">string-equal</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">node</span><span class="p">)</span> <span class="s">"comment"</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">prev</span> <span class="p">(</span><span class="nv">treesit-node-prev-sibling</span> <span class="nv">node</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">is-continuation</span> <span class="no">nil</span><span class="p">))</span>
        <span class="c1">;; Check if this node is a continuation of a previous comment block.</span>
        <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">prev</span>
                    <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">string-equal</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">prev</span><span class="p">)</span> <span class="s">"comment"</span><span class="p">)</span>
                        <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">"\\`\\s-*\\'"</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">prev</span><span class="p">))))</span>
          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">string-equal</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">prev</span><span class="p">)</span> <span class="s">"comment"</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">is-continuation</span> <span class="no">t</span><span class="p">))</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">prev</span> <span class="p">(</span><span class="nv">treesit-node-prev-sibling</span> <span class="nv">prev</span><span class="p">)))</span>
        <span class="c1">;; Only fold if this is the start of the block.</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="nv">is-continuation</span>
          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">next</span> <span class="p">(</span><span class="nv">treesit-node-next-sibling</span> <span class="nv">node</span><span class="p">))</span>
                <span class="p">(</span><span class="nv">last-comment</span> <span class="nv">node</span><span class="p">))</span>
            <span class="c1">;; Find the end of the comment block.</span>
            <span class="p">(</span><span class="nv">while</span> <span class="nv">next</span>
              <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="k">type</span> <span class="p">(</span><span class="nv">treesit-node-type</span> <span class="nv">next</span><span class="p">)))</span>
                <span class="p">(</span><span class="nb">cond</span>
                 <span class="p">((</span><span class="nb">string-equal</span> <span class="k">type</span> <span class="s">"comment"</span><span class="p">)</span>
                  <span class="p">(</span><span class="k">setq</span> <span class="nv">last-comment</span> <span class="nv">next</span><span class="p">)</span>
                  <span class="p">(</span><span class="k">setq</span> <span class="nv">next</span> <span class="p">(</span><span class="nv">treesit-node-next-sibling</span> <span class="nv">next</span><span class="p">)))</span>
                 <span class="p">((</span><span class="nv">string-match-p</span> <span class="s">"\\`\\s-*\\'"</span> <span class="k">type</span><span class="p">)</span>
                  <span class="p">(</span><span class="k">setq</span> <span class="nv">next</span> <span class="p">(</span><span class="nv">treesit-node-next-sibling</span> <span class="nv">next</span><span class="p">)))</span>
                 <span class="p">(</span><span class="no">t</span>
                  <span class="p">(</span><span class="k">setq</span> <span class="nv">next</span> <span class="no">nil</span><span class="p">)))))</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">last-comment</span> <span class="nv">node</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">treesit-fold--cons-add</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">treesit-node-start</span> <span class="nv">node</span><span class="p">)</span>
                                            <span class="p">(</span><span class="nv">treesit-node-end</span> <span class="nv">last-comment</span><span class="p">))</span>
                                      <span class="nv">offset</span><span class="p">)))))))</span>
  <span class="c1">;; Normal fold blocks</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">treesit-fold-range-fortran-blocks</span> <span class="p">(</span><span class="nv">node</span> <span class="nv">offset</span><span class="p">)</span>
    <span class="s">"Calculate the fold range for generic blocks (e.g., subroutines, loops).
Folds the content between the header (first child) and the footer (last child)."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">header</span> <span class="p">(</span><span class="nv">treesit-node-child</span> <span class="nv">node</span> <span class="mi">0</span> <span class="no">t</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">footer</span> <span class="p">(</span><span class="nv">treesit-node-child</span> <span class="nv">node</span> <span class="mi">-1</span> <span class="no">t</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">header</span> <span class="nv">footer</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">header</span> <span class="nv">footer</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">treesit-fold--cons-add</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">treesit-node-end</span> <span class="nv">header</span><span class="p">)</span>
                                      <span class="p">(</span><span class="nv">treesit-node-start</span> <span class="nv">footer</span><span class="p">))</span>
                                <span class="nv">offset</span><span class="p">))))</span>
  <span class="c1">;; Summary Parser</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">treesit-fold-summary-fortran-doc</span> <span class="p">(</span><span class="nv">doc-str</span><span class="p">)</span>
    <span class="s">"Extract summary from Fortran comments.
Handles Doxygen style (!&gt;) and ignores code blocks or separator lines."</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">"\\`\\s-*!"</span> <span class="nv">doc-str</span><span class="p">)</span>
      <span class="c1">;; Ensure the content is strictly a comment block (no code lines).</span>
      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">"\n[ \t]*[^! \t\n]"</span> <span class="nv">doc-str</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">lines</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">doc-str</span> <span class="s">"\n"</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">summary</span> <span class="no">nil</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">line</span> <span class="nv">lines</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">unless</span> <span class="nv">summary</span>
              <span class="c1">;; Remove '!', '!&gt;', or whitespace.</span>
              <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">content</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">"\\`\\s-*!+&gt;?\\s-*"</span> <span class="s">""</span> <span class="nv">line</span><span class="p">)))</span>
                <span class="p">(</span><span class="nb">cond</span>
                 <span class="p">((</span><span class="nv">string-empty-p</span> <span class="nv">content</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
                 <span class="p">((</span><span class="nv">string-match-p</span> <span class="s">"-[*]-"</span> <span class="nv">line</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">; Ignore mode lines</span>
                 <span class="p">((</span><span class="nb">not</span> <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">"[[:alnum:]]"</span> <span class="nv">content</span><span class="p">))</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">; Ignore separators</span>
                 <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">summary</span> <span class="nv">content</span><span class="p">))))))</span>
          <span class="nv">summary</span><span class="p">))))</span>
  <span class="c1">;; Definition of Rules</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">treesit-fold-parsers-fortran</span> <span class="p">()</span>
    <span class="s">"Return the folding rules for f90-ts-mode."</span>
    <span class="o">`</span><span class="p">((</span><span class="nv">subroutine</span>                 <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="k">function</span>                   <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">interface</span>                  <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">derived_type_definition</span>    <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">do_loop</span>                    <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">if_statement</span>               <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">select_case_statement</span>      <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">select_type_statement</span>      <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">block_construct</span>            <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">associate_statement</span>        <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">coarray_critical_statement</span> <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">forall_statement</span>           <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">where_statement</span>            <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">module</span>                     <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">program</span>                    <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">submodule</span>                  <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-blocks</span><span class="p">)</span>
      <span class="o">,@</span><span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="k">type</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">intern</span> <span class="k">type</span><span class="p">)</span> <span class="ss">'treesit-fold-range-fortran-declarations</span><span class="p">))</span>
                <span class="nv">treesit-fold-fortran-declaration-nodes</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">comment</span>                    <span class="o">.</span> <span class="nv">treesit-fold-range-fortran-comment</span><span class="p">)))</span>
  <span class="c1">;; Register summary parser for f90-ts-mode.</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'treesit-fold-summary-parsers-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="nv">f90-ts-mode</span> <span class="o">.</span> <span class="nv">treesit-fold-summary-fortran-doc</span><span class="p">))</span>
  <span class="c1">;; 以下は私の好み.</span>
  <span class="c1">;; module や program が fold されると全部 fold されるので構造がわかりにくい.</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'treesit-fold-range-alist</span>
               <span class="p">(</span><span class="nb">cons</span> <span class="ss">'f90-ts-mode</span>
                     <span class="p">(</span><span class="nv">seq-remove</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">memq</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nv">module</span> <span class="nv">program</span> <span class="nv">submodule</span><span class="p">)))</span>
                                 <span class="p">(</span><span class="nv">treesit-fold-parsers-fortran</span><span class="p">))))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org2fd5bd6c">
<code>separedit</code>: コード内の特定の部分を別バッファ・別モードで編集</h3>
<div class="outline-text-3" id="text-org2fd5bd6c">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">separedit</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">separedit-default-mode</span> <span class="ss">'markdown-mode</span>
        <span class="nv">separedit-remove-trailing-spaces-in-comment</span> <span class="no">t</span>
        <span class="nv">separedit-preserve-string-indentation</span> <span class="no">t</span>
        <span class="nv">separedit-continue-fill-column</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:defer-config</span>
  <span class="p">(</span><span class="nb">push</span> <span class="o">'</span><span class="p">((</span><span class="s">"!&gt;"</span> <span class="s">"!"</span><span class="p">)</span> <span class="o">.</span> <span class="nv">f90-ts-mode</span><span class="p">)</span> <span class="nv">separedit-comment-delimiter-alist</span><span class="p">)</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:around</span> <span class="nv">separedit</span> <span class="nv">my:speparedit-doxygen-fortran</span><span class="p">)</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:speparedit-doxygen-fortran</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="s">"Forran で Doxygen (!&gt;) と 通常コメント (!) を分離して編集する補助関数"</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">'f90-ts-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cond</span>
       <span class="c1">;; -------------------------------------------------------------------</span>
       <span class="c1">;; パターンA: Doxygen (!&gt;) 行の場合</span>
       <span class="c1">;; -------------------------------------------------------------------</span>
       <span class="p">((</span><span class="nv">save-excursion</span> <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*!&gt;"</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">beg</span> <span class="p">(</span><span class="nv">save-excursion</span>
                     <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">bobp</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">save-excursion</span>
                                   <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">-1</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*!&gt;"</span><span class="p">)))</span>
                       <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">-1</span><span class="p">))</span>
                     <span class="p">(</span><span class="nv">point</span><span class="p">)))</span>
              <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nv">save-excursion</span>
                     <span class="p">(</span><span class="nv">end-of-line</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">eobp</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">save-excursion</span>
                                   <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">1</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*!&gt;"</span><span class="p">)))</span>
                       <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">1</span><span class="p">))</span>
                     <span class="p">(</span><span class="nv">end-of-line</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">point</span><span class="p">))))</span>
          <span class="c1">;; 明示的に !&gt; デリミタを指定して起動</span>
          <span class="p">(</span><span class="nb">funcall</span> <span class="nv">orig-fun</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">:beginning</span> <span class="nv">beg</span>
                                  <span class="ss">:end</span> <span class="nv">end</span>
                                  <span class="ss">:lang-mode</span> <span class="ss">'markdown-mode</span>
                                  <span class="ss">:comment-delimiter</span> <span class="s">"^[ \t]*!&gt;[ \t]*"</span><span class="p">))))</span>

       <span class="c1">;; -------------------------------------------------------------------</span>
       <span class="c1">;; パターンB: 通常コメント (!) 行の場合</span>
       <span class="c1">;; ※ !&gt; ではないが、! で始まっている行</span>
       <span class="c1">;; -------------------------------------------------------------------</span>
       <span class="p">((</span><span class="nv">save-excursion</span> <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*![^&gt;]"</span><span class="p">))</span>
        <span class="c1">;; 注意: "^[ \t]*!" だけだと !&gt; にもマッチするので、! の後ろが &gt; じゃないことを確認</span>
        <span class="c1">;; または、既に上の条件で !&gt; は弾いているので、単純に ! 開始でも良いが、念のため。</span>

        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">beg</span> <span class="p">(</span><span class="nv">save-excursion</span>
                     <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span>
                     <span class="c1">;; 上へ遡る (! のみ。!&gt; が来たら止まる)</span>
                     <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">bobp</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">save-excursion</span>
                                   <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">-1</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*!"</span><span class="p">)</span>
                                        <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*!&gt;"</span><span class="p">)))))</span>
                       <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">-1</span><span class="p">))</span>
                     <span class="p">(</span><span class="nv">point</span><span class="p">)))</span>
              <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nv">save-excursion</span>
                     <span class="p">(</span><span class="nv">end-of-line</span><span class="p">)</span>
                     <span class="c1">;; 下へ進む (! のみ。!&gt; が来たら止まる)</span>
                     <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">eobp</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nv">save-excursion</span>
                                   <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">1</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*!"</span><span class="p">)</span>
                                        <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">looking-at-p</span> <span class="s">"^[ \t]*!&gt;"</span><span class="p">)))))</span>
                       <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">1</span><span class="p">))</span>
                     <span class="p">(</span><span class="nv">end-of-line</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">point</span><span class="p">))))</span>

          <span class="c1">;; 明示的に ! デリミタを指定して起動</span>
          <span class="c1">;; これにより、下に !&gt; があっても巻き込まず、書き戻しも ! になる</span>
          <span class="p">(</span><span class="nb">funcall</span> <span class="nv">orig-fun</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">:beginning</span> <span class="nv">beg</span>
                                  <span class="ss">:end</span> <span class="nv">end</span>
                                  <span class="ss">:lang-mode</span> <span class="ss">'markdown-mode</span> <span class="c1">;; あるいは nil (自動判定)</span>
                                  <span class="ss">:comment-delimiter</span> <span class="s">"^[ \t]*![ \t]*"</span><span class="p">))))</span>

       <span class="c1">;; -------------------------------------------------------------------</span>
       <span class="c1">;; パターンC: その他</span>
       <span class="c1">;; -------------------------------------------------------------------</span>
       <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)))</span>

    <span class="c1">;; f90-ts-mode 以外</span>
    <span class="p">(</span><span class="nb">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)))</span>
<span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org1d7a5ece">
<code>eglot</code>: Language Server による補完</h3>
<div class="outline-text-3" id="text-org1d7a5ece">
<p>
Emacs 29から 本体に同梱されることになったので <code>eglot</code> を利用することに.
サーバの呼び出し自体は言語毎に hook で設定する.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">eglot</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"M-t"</span> <span class="o">.</span> <span class="nv">xref-find-definitions</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"M-r"</span> <span class="o">.</span> <span class="nv">xref-find-references</span><span class="p">))</span>
<span class="c1">;;  :init</span>
<span class="c1">;;;###autoload</span>
<span class="c1">;; (defun my:eglot-capf()</span>
<span class="c1">;;   (setq-local completion-at-point-functions</span>
<span class="c1">;;               (list (cape-super-capf</span>
<span class="c1">;;                      #'eglot-completion-at-point)</span>
<span class="c1">;;                     #'cape-keyword</span>
<span class="c1">;;                     #'cape-dabbrev</span>
<span class="c1">;;                     #'cape-file)</span>
<span class="c1">;;               ))</span>
<span class="c1">;;  :hook</span>
<span class="c1">;;  ((eglot-managed-mode-hook . my:eglot-capf))</span>
  <span class="ss">:config</span>
  <span class="c1">;; digestif は日本語TeXとイマイチ相性が悪い(上手く使い熟せていない...).</span>
  <span class="p">(</span><span class="nb">delete</span> <span class="p">(</span><span class="nb">assoc</span> <span class="o">'</span><span class="p">(</span><span class="nv">tex-mode</span> <span class="nv">context-mode</span> <span class="nv">texinfo-mode</span> <span class="nv">bibtex-mode</span><span class="p">)</span>
                 <span class="nv">eglot-server-programs</span><span class="p">)</span>
          <span class="nv">eglot-server-programs</span><span class="p">)</span>
<span class="c1">;;   (add-to-list 'eglot-server-programs</span>
<span class="c1">;;              '((latex-mode tex-mode context-mode texinfo-mode bibtex-mode) . ("texlab")))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'eglot-server-programs</span>
             <span class="o">'</span><span class="p">((</span><span class="nv">latex-mode</span> <span class="nv">tex-mode</span> <span class="nv">texinfo-mode</span> <span class="nv">bibtex-mode</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="s">"texlab"</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org82f6778a">
<code>flaymake</code>: on-the-fly syntax checker</h3>
<div class="outline-text-3" id="text-org82f6778a">
<p>
<code>eglot</code> と同時に利用されるので、一応設定しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">flymake</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">(</span><span class="ss">:flymake-mode-map</span>
         <span class="p">(</span><span class="s">"C-c C-p"</span> <span class="o">.</span> <span class="nv">flymake-goto-prev-error</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c C-n"</span> <span class="o">.</span> <span class="nv">flymake-goto-next-error</span><span class="p">)</span>
         <span class="p">)</span>
  <span class="ss">:config</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'flymake-proc</span> <span class="no">nil</span> <span class="ss">'noerror</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">flymake-diagnostic-at-point</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:after</span> <span class="nv">flymake</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">flymake-mode-hook</span> <span class="o">.</span> <span class="nv">flymake-diagnostic-at-point-mode</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org88a3cb1b">TeX: <code>AUCTeX</code>
</h3>
<div class="outline-text-3" id="text-org88a3cb1b">
<p>
やっている事は
</p>
<ul class="org-ul">
<li>japanese-latex-mode において, 幾つかのコマンドが追加/上書きされているものの,
あまり使うことの無いコマンドが表示されるのが嫌なのでそれらを削除．</li>
<li>コンパイルには<a href="http://personal.psu.edu/jcc8/software/latexmk/">Latexmk</a>を使う</li>
</ul>
<p>
と言った所.
…ただ, Beamerのクラスなんかだと勝手にdefault コマンドが LaTeX に変更されたりするので挙動がイマイチ良くわからん.
async で <code>latexmk -pvc</code> を走らせておいた方が気持が良い, 気がしている.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">tex-site</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"uplatex"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"latexmk"</span><span class="p">))</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/auto"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="k">progn</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/auto"</span> <span class="nv">my:d:tmp</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/style"</span> <span class="nv">my:d:tmp</span><span class="p">)</span> <span class="no">t</span><span class="p">)))</span>
  <span class="ss">:mode</span> <span class="p">(</span><span class="s">"\\.tex\\'"</span> <span class="o">.</span> <span class="nv">japanese-latex-mode</span><span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="c1">;;</span>
         <span class="p">(</span><span class="nv">LaTeX-mode-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                              <span class="p">(</span><span class="nv">turn-on-reftex</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">TeX-source-correlate-mode</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">TeX-PDF-mode</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">LaTeX-math-mode</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">outline-minor-mode</span><span class="p">)</span>
                              <span class="p">(</span><span class="k">setq</span> <span class="nv">TeX-command-default</span> <span class="s">"LatexMk"</span>
                                    <span class="nv">japanese-LaTeX-command-default</span> <span class="s">"LatexMk"</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">eglot-ensure</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'TeX-command-list</span>
                                           <span class="o">'</span><span class="p">(</span><span class="s">"upLaTeXmk"</span>
                                             <span class="s">"latexmk -e '$latex=q/uplatex %%O -kanji=utf8 -no-guess-input-enc %(file-line-error) %(extraopts) %S %(mode) %%S/' -e '$bibtex=q/bibtexu %%O %%B/' -e '$biber=q/biber %%O --bblencoding=utf8 -u -U --output_safechars %%B/' -e '$makeindex=q/upmendex %%O -o %%D %%S/' -e '$dvipdf=q/dvipdfmx %%O -o %%D %%S/' -norc -gg -pdfdvi %t"</span>
                                             <span class="nv">TeX-run-TeX</span> <span class="no">nil</span> <span class="p">(</span><span class="nv">latex-mode</span><span class="p">)</span> <span class="ss">:help</span> <span class="s">"Run upLaTeXmk"</span><span class="p">))</span>
                              <span class="p">))</span>
         <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">with-eval-after-load</span> <span class="ss">'tex-jp</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">command</span> <span class="o">'</span><span class="p">(</span><span class="s">"pTeX"</span> <span class="s">"pLaTeX"</span> <span class="s">"pBibTeX"</span> <span class="s">"jTeX"</span> <span class="s">"jLaTeX"</span> <span class="s">"jBibTeX"</span> <span class="s">"Mendex"</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">delq</span> <span class="p">(</span><span class="nb">assoc</span> <span class="nv">command</span> <span class="nv">TeX-command-list</span><span class="p">)</span> <span class="nv">TeX-command-list</span><span class="p">)))</span>
  <span class="c1">;; reftex</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">reftex-plug-into-AUCTeX</span> <span class="no">t</span>
        <span class="nv">reftex-cite-prompt-optional-args</span> <span class="no">t</span>
        <span class="p">)</span>
  <span class="c1">;; tex-site</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">TeX-auto-local</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/auto"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">TeX-style-local</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"auctex/style"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">TeX-auto-untabify</span> <span class="no">t</span>
        <span class="nv">japanese-TeX-engine-default</span> <span class="ss">'uptex</span>
        <span class="nv">japanese-LaTeX-default-style</span> <span class="s">"jsarticle"</span> <span class="c1">;; bxjsarticle? jlreq?</span>
        <span class="nv">TeX-engine</span> <span class="ss">'luatex</span>
        <span class="nv">TeX-view-program-selection</span>  <span class="o">'</span><span class="p">((</span><span class="nv">output-dvi</span> <span class="s">"xdvi"</span><span class="p">)</span>
                                      <span class="p">(</span><span class="nv">output-pdf</span> <span class="s">"Okular"</span><span class="p">)</span>
                                      <span class="c1">;; (output-pdf "Atril")</span>
                                      <span class="c1">;; (output-pdf "Fwdevince")</span>
                                      <span class="p">(</span><span class="nv">output-html</span> <span class="s">"xdg-open"</span><span class="p">)</span>
                                      <span class="p">)</span>
        <span class="nv">TeX-source-correlate-method</span> <span class="ss">'synctex</span>
        <span class="nv">TeX-source-correlate-start-server</span> <span class="no">t</span>
        <span class="nv">TeX-source-correlate-mode</span> <span class="no">t</span>
        <span class="nv">LaTeX-math-mode</span> <span class="no">t</span>
        <span class="nv">TeX-command-default</span> <span class="s">"upLaTeXmk"</span>
        <span class="nv">TeX-ispell-extend-skip-list</span> <span class="no">t</span>
        <span class="nv">TeX-command-output-list</span> <span class="o">'</span><span class="p">((</span><span class="s">"upLatexMk"</span> <span class="p">(</span><span class="s">"pdf"</span><span class="p">)))</span>
        <span class="nv">TeX-electric-sub-and-superscript</span> <span class="no">t</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">LaTeX-figure-label</span> <span class="s">"fig:"</span>
        <span class="nv">LaTeX-table-label</span> <span class="s">"tab:"</span>
        <span class="nv">LaTeX-section-label</span> <span class="s">"sec:"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">font-latex-fontify-script</span> <span class="no">nil</span>
        <span class="nv">font-latex-script-display</span> <span class="no">nil</span>
        <span class="nv">font-latex-fontify-sectioning</span>  <span class="mf">1.0</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="orgc6b67eb9">VCSなど, ソースコード管理関係</h2>
<div class="outline-text-2" id="text-orgc6b67eb9">
<p>
まあ, ほとんど Git 関連な訳ですが．
</p>
</div>
<div>
<h3 id="org76c99d7f">
<span class="todo TODO">TODO</span> <code>project.el</code> <code>[0/2]</code>
</h3>
<div class="outline-text-3" id="text-org76c99d7f">
<p>
Emacs 27.1 から built-in となった.
<code>eglot</code> でも使われているので, 設定しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">project</span>
  <span class="ss">:tag</span> <span class="s">"builtin"</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">project-list-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"projects"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">project-switch-use-entire-map</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> ghq の list を追加できないかな?
<ul class="org-ul">
<li>できれば <code>--full-path</code> じゃない表示にしたい(<code>my:shorten-file-path</code> を噛ませたい).</li>
</ul>
</li>
<li class="off">
<code>[ ]</code> 何故か↑の <code>project-list-file</code> が効かずに <code>~/.emacs.d/project</code> が生成される事が.
<ul class="org-ul">
<li>これはなんだろうか?</li>
</ul>
</li>
</ul>
</div>
</div>
<div>
<h3 id="org90f5d475">
<code>consult-ghq</code>: ghq を consult で.</h3>
<div class="outline-text-3" id="text-org90f5d475">
<p>
<code>project.el</code> で ghq を使うようになったら不要かもしれないけど, とりあえず.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">consult-ghq</span>
  <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/uwabami/consult-ghq"</span><span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x f"</span> <span class="o">.</span> <span class="nv">consult-ghq-open</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">consult-ghq-short-list</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org59371622">
<code>magit</code>: Emacs の Git Frontend</h3>
<div class="outline-text-3" id="text-org59371622">
<p>
magit は Emacs の Git Frontend.
結局の所 CUI でコマンド叩く事も多いけれど, これはこれで重宝している．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">magit</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x g"</span> <span class="o">.</span> <span class="nv">magit-status</span><span class="p">))</span>
  <span class="ss">:commands</span> <span class="nv">git-commit-mode</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">transient</span>
    <span class="ss">:init</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">transient-history-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"transient-history.el"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
          <span class="nv">transient-levels-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"transient-levels.el"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
          <span class="nv">transient-values-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"transient-values.el"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
          <span class="nv">transient-force-fixed-pitch</span> <span class="no">t</span>
          <span class="p">)</span>
    <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">magit-completing-read-function</span> <span class="ss">'magit-builtin-completing-read</span>
        <span class="nv">magit-refs-show-commit-count</span>   <span class="ss">'all</span>
        <span class="nv">magit-log-buffer-file-locked</span>   <span class="no">t</span>
        <span class="nv">magit-revision-show-gravatars</span>  <span class="no">nil</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgb6921ead"><code>git-commit-ts-mode</code></h3>
<div class="outline-text-3" id="text-orgb6921ead">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">git-commit-ts-mode</span>
  <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/danilshvalov/git-commit-ts-mode"</span><span class="p">)</span>
  <span class="ss">:mode</span> <span class="s">"\\COMMIT_EDITMSG\\'"</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org779f9ba7">翻訳</h2>
<div class="outline-text-2" id="text-org779f9ba7">
</div>
<div>
<h3 id="orga528b584">DeepL 翻訳</h3>
<div class="outline-text-3" id="text-orga528b584">
<p>
ブラウザ呼び出し
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*deepl-translate</span>
  <span class="ss">:commands</span> <span class="nv">my:deepl-translate</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x T"</span> <span class="o">.</span> <span class="nv">my:deepl-translate</span><span class="p">))</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'url-util</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:deepl-translate</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nb">string</span>
          <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">stringp</span> <span class="nb">string</span><span class="p">)</span> <span class="nb">string</span><span class="p">)</span>
                <span class="p">((</span><span class="nv">use-region-p</span><span class="p">)</span>
                 <span class="p">(</span><span class="nv">buffer-substring</span> <span class="p">(</span><span class="nv">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nv">region-end</span><span class="p">)))</span>
                <span class="p">(</span><span class="no">t</span>
                 <span class="p">(</span><span class="nv">save-excursion</span>
                   <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">forward-char</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">backward-sentence</span><span class="p">)</span>
                     <span class="p">(</span><span class="k">setq</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
                     <span class="p">(</span><span class="nv">forward-sentence</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">buffer-substring</span> <span class="nv">s</span> <span class="p">(</span><span class="nv">point</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="nv">run-at-time</span> <span class="mf">0.1</span> <span class="no">nil</span> <span class="ss">'deactivate-mark</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">browse-url</span>
     <span class="p">(</span><span class="nv">concat</span>
      <span class="s">"https://www.deepl.com/translator#en/ja/"</span>
      <span class="p">(</span><span class="nv">url-hexify-string</span> <span class="nb">string</span><span class="p">)</span>
      <span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org48ef2f56">Google 翻訳</h3>
<div class="outline-text-3" id="text-org48ef2f56">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">google-translate</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:defvar</span> <span class="nv">google-translate-backend-method</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">google-translate-translation-directions-alist</span> <span class="o">'</span><span class="p">((</span><span class="s">"en"</span> <span class="o">.</span> <span class="s">"ja"</span><span class="p">)</span> <span class="p">(</span><span class="s">"ja"</span> <span class="o">.</span> <span class="s">"en"</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">popup</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:google-translate--search-tkk</span> <span class="p">()</span>
    <span class="s">"Search TKK. @see https://github.com/atykhonov/google-translate/issues/52"</span>
    <span class="p">(</span><span class="nb">list</span> <span class="mi">430675</span> <span class="mi">2721866130</span><span class="p">))</span>
  <span class="ss">:bind</span>
  <span class="p">(</span><span class="s">"C-x t"</span> <span class="o">.</span> <span class="nv">google-translate-smooth-translate</span><span class="p">)</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:override</span> <span class="nv">google-translate--search-tkk</span>
                     <span class="nv">my:google-translate--search-tkk</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">google-translate-translation-directions-alist</span> <span class="o">'</span><span class="p">((</span><span class="s">"en"</span> <span class="o">.</span> <span class="s">"ja"</span><span class="p">)</span> <span class="p">(</span><span class="s">"ja"</span> <span class="o">.</span> <span class="s">"en"</span><span class="p">))</span>
        <span class="nv">google-translate-backend-method</span> <span class="ss">'curl</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org15a06190">校正, 辞書等</h2>
<div class="outline-text-2" id="text-org15a06190">
</div>
<div>
<h3 id="org3737a28e">
<code>ispell</code>, <code>flyspell</code>: spell checker, on-the-fly spell checker</h3>
<div class="outline-text-3" id="text-org3737a28e">
<p>
ispell はコマンドとして <code>aspell</code> を利用する.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">flyspell</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"aspell"</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">ispell-program-name</span>   <span class="s">"aspell"</span>
        <span class="nv">ispell-check-comments</span> <span class="no">nil</span>
        <span class="nv">ispell-skip-html</span>      <span class="no">t</span>
        <span class="nv">ispell-silently-savep</span> <span class="no">t</span>
        <span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">(</span><span class="ss">:flyspell-mode-map</span>
         <span class="p">(</span><span class="s">"C-."</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-,"</span> <span class="o">.</span> <span class="no">nil</span><span class="p">))</span>
  <span class="ss">:defer-config</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'ispell-skip-region-alist</span> <span class="o">'</span><span class="p">(</span><span class="s">"[^\000-\377]+"</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org3002f57f">
<code>lookup</code>: 電子辞書の検索</h3>
<div class="outline-text-3" id="text-org3002f57f">
<p>
EPWING化した辞書群を検索するために <code>lookup-el</code> ver. 1.4 系列を利用
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">lookup</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/etc/emacs/site-start.d/50lookup-el.el"</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/usr/local/share/dict/lookup-enabled"</span><span class="p">))</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">lookup</span> <span class="nv">lookup-region</span> <span class="nv">lookup-pattern</span><span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-c w"</span> <span class="o">.</span> <span class="nv">lookup-pattern</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c W"</span> <span class="o">.</span> <span class="nv">lookup-word</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">lookup-search-agents</span> <span class="o">'</span><span class="p">((</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/eijiro"</span> <span class="ss">:alias</span> <span class="s">"英辞郎"</span><span class="p">)</span>
                               <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/waeijiro"</span> <span class="ss">:alias</span> <span class="s">"和英辞郎"</span><span class="p">)</span>
                               <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/rikagaku5"</span> <span class="ss">:alias</span> <span class="s">"理化学辞典 第5版"</span><span class="p">)</span>
                               <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/koujien4"</span> <span class="ss">:alias</span> <span class="s">"広辞苑 第4版"</span><span class="p">)</span>
                               <span class="p">(</span><span class="nv">ndeb</span> <span class="s">"/usr/local/share/dict/wadai5"</span> <span class="ss">:alias</span> <span class="s">"研究社 和英大辞典 第5版"</span><span class="p">)</span>
                               <span class="c1">;; (ndeb "/usr/local/share/dict/eidai6" :alias "研究社 英和大辞典 第6版")</span>
                               <span class="c1">;; (ndeb "/usr/local/share/dict/colloc" :alias "研究社 英和活用大辞典 ")</span>
                               <span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org501da28b">
<code>text-adjust</code>: 全角文字の撲滅</h3>
<div class="outline-text-3" id="text-org501da28b">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">text-adjust</span> <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/uwabami/text-adjust.el"</span><span class="p">))</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org2c2abb9b">MUA の設定: <code>wanderulst</code>
</h2>
<div class="outline-text-2" id="text-org2c2abb9b">
<p>
MUA として Wanderlust を使っている
</p>
<ul class="org-ul">
<li><a href="https://wanderlust.github.io/wl-docs/wl-ja.html">Wanderlust – Yet Another Message Interface On Emacsen –</a></li>
</ul>
</div>
<div>
<h3 id="org587385af">
<span class="todo TODO">TODO</span> rail <code>[/]</code>
</h3>
<div class="outline-text-3" id="text-org587385af">
<p>
SEMI や FLIM などの UA の表示に <a href="http://uwabami.github.com/rail/">rail</a> を使っている.
</p>

<p>
ちなみに rail を有効にすると, 以下の様に User-Agent が表示される
</p>
<div class="col-7 px2 mx-auto">
<amp-img layout="responsive" width="640" height="400" src="https://uwabami.github.io/software/rail/wanderlust_with_or_without_rail.webp" alt="rail preview"><amp-img layout="responsive" width="640" height="400" src="https://uwabami.github.io/software/rail/wanderlust_with_or_without_rail.png" alt="rail preview" fallback></amp-img><noscript><img width="640" height="400" src="https://uwabami.github.io/software/rail/wanderlust_with_or_without_rail.png" alt="rail preview"></noscript></amp-img>
</div>

<ul class="org-ul">
<li class="off">
<code>[ ]</code> autoload を使う様に改善すること.</li>
</ul>

<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">rail</span>
  <span class="c1">;; :vc (:url "https://github.com/uwabami/rail")</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">rail-emulate-genjis</span> <span class="no">t</span><span class="p">)</span>
  <span class="c1">;; :require t</span>
  <span class="ss">:leaf-defer</span> <span class="no">t</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org47a9ca66">Emacs 本体側の設定(wanderlust)</h3>
<div class="outline-text-3" id="text-org47a9ca66">
<p>
Emacs 本体での設定は以下の通り. Wanderlust 自体の設定は別ファイルで行なわれる．
ここでは <code>wl-init-file</code> を指定することで, 設定ファイルを明示している．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">wl</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="s">"/etc/emacs/site-start.d/65wl-beta.el"</span><span class="p">)</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">wl</span>
             <span class="nv">wl-other-frame</span>
             <span class="nv">wl-draft</span>
             <span class="nv">wl-user-agent</span>
             <span class="nv">wl-user-agent-compose</span>
             <span class="nv">wl-draft-send</span>
             <span class="nv">wl-draft-kill</span><span class="p">)</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="ss">:wl-draft-mode-map</span>
          <span class="p">(</span><span class="s">"C-c C-n"</span> <span class="o">.</span> <span class="nv">wl-template-select</span><span class="p">))</span>
         <span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nv">defconst</span> <span class="nv">my:d:wl-cache-directory</span>
    <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"~/.cache/wl"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span>
           <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"local/trash"</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">make-directory</span>
     <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"local/trash"</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:wl-mode-line-buffer-identification</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">id</span><span class="p">)</span>
    <span class="s">"ignore `id'"</span>
    <span class="p">(</span><span class="k">ignore</span> <span class="nv">id</span><span class="p">)</span> <span class="p">(</span><span class="nv">force-mode-line-update</span> <span class="no">t</span><span class="p">))</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:override</span> <span class="nv">wl-mode-line-buffer-identification</span>
                     <span class="nv">my:wl-mode-line-buffer-identification</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-msgdb-directory</span> <span class="nv">my:d:wl-cache-directory</span>
        <span class="nv">elmo-localdir-folder-path</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"local"</span> <span class="nv">my:d:wl-cache-directory</span><span class="p">)</span>
        <span class="nv">read-mail-command</span> <span class="nf">#'</span><span class="nv">wl</span>
        <span class="nv">wl-init-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"init-wl"</span> <span class="nv">user-emacs-directory</span><span class="p">)</span>
        <span class="nv">wl-mime-charset</span> <span class="ss">'iso-2022-jp</span>
        <span class="nv">wl-demo</span>  <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">define-mail-user-agent</span>
    <span class="ss">'wl-user-agent</span>
    <span class="ss">'wl-user-agent-compose</span>
    <span class="ss">'wl-draft-send</span>
    <span class="ss">'wl-draft-kill</span>
    <span class="ss">'mail-send-hook</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">load</span> <span class="nv">wl-info-file</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">'wl-draft-send-hook</span> <span class="ss">'wl-draft-config-exec</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">wl-init-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span><span class="p">()</span>
                      <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mime-charset-coding-system-alist</span>
                                   <span class="o">'</span><span class="p">(</span><span class="nv">iso-2022-jp</span> <span class="o">.</span> <span class="nv">cp50220</span><span class="p">))</span>
                      <span class="c1">;; fxxkin outlook</span>
                      <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mime-charset-coding-system-alist</span>
                                   <span class="o">'</span><span class="p">(</span><span class="nv">gb2312</span> <span class="o">.</span> <span class="nv">gbk</span><span class="p">))))</span>
    <span class="c1">;; From に応じて wl-from, wl-envelope-from,</span>
    <span class="c1">;; smtp サーバを送信時に変更.</span>
    <span class="p">(</span><span class="nv">wl-draft-send-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span><span class="p">()</span>
                            <span class="p">(</span><span class="nb">set</span> <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'wl-from</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">std11-fetch-field</span> <span class="s">"From"</span><span class="p">))))</span>
    <span class="p">)</span>
  <span class="ss">:pl-setq</span> <span class="p">(</span><span class="nv">wl-address-file</span>
            <span class="nv">wl-folders-file</span>
            <span class="nv">elmo-passwd-alist-file-name</span>
            <span class="nv">wl-info-file</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<p>
割と <code>/etc/emacs/site-start.d/65wl-beta.el</code> と重複している気がするが.
</p>
</div>
</div>
<div>
<h3 id="org160184bf">Wanderlust 本体の設定</h3>
<div class="outline-text-3" id="text-org160184bf">
<p>
実際の設定は以下の通り
</p>
</div>
<div>
<h4 id="orge2af69a1">byte-compile の準備</h4>
<div class="outline-text-4" id="text-orge2af69a1">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -*- lexical-binding: t -*-</span>
<span class="p">(</span><span class="nv">eval-when-compile</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'leaf-keywords</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'cp5022x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'wl</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'mime-def</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf-keywords-init</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org9638e017">依存/追加ライブラリのインストールと読み込み</h4>
<div class="outline-text-4" id="text-org9638e017">
</div>
<div>
<h5 id="orga4113e25">cp5022x を使う</h5>
<div class="outline-text-5" id="text-orga4113e25">
<p>
ISO-2022-JP を CP50220 として扱う.
<a href="http://d.hatena.ne.jp/kiwanami/20091103/1257243524">Wanderlustと文字コード</a> も参照のこと.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (add-to-list 'mime-charset-coding-system-alist</span>
<span class="c1">;;              '(iso-2022-jp . cp50220))</span>
<span class="c1">;; fxxkin outlook</span>
<span class="c1">;; (add-to-list 'mime-charset-coding-system-alist</span>
<span class="c1">;;              '(gb2312 . gbk))</span>
<span class="c1">;;</span>
<span class="c1">;; (setq wl-mime-charset 'iso-2022-jp)</span>
<span class="c1">;; (setq wl-mime-charset 'utf-8-unix)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgc4ec7a62">SEMI の追加設定</h5>
<div class="outline-text-5" id="text-orgc4ec7a62">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">eval-and-compile</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'mime-w3m</span><span class="p">))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">w3m-fill-column</span> <span class="mi">78</span><span class="p">)</span></code></pre></figure>
<p>
HTML メールを表示するために eww を使う.
mime-setup がロードされる前に記述する必要あり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (leaf mime-setup</span>
<span class="c1">;;   :preface</span>
<span class="c1">;;   (setq mime-view-text/html-previewer 'shr)</span>
<span class="c1">;;   )</span></code></pre></figure>
<p>
どのアプリケーションで開くか?
以前はOSに合わせて <code>open</code> か <code>xdg-open</code> に分岐していたが,
Debian 12 あたりから
<code>/usr/bin/open</code> → <code>/etc/alternatives/open</code> → <code>xdg-open</code> となったので,
特に分岐は不要になった.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:mime-preview-play-current-entity-appname</span> <span class="s">"open"</span>
  <span class="s">"WSL なら wslview あたりなのかな. macOS と Linux なら open で良い筈"</span><span class="p">)</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">functionp</span> <span class="nf">#'</span><span class="nv">mime-preview-play-current-entity-orig</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">fset</span> <span class="nf">#'</span><span class="nv">mime-preview-play-current-entity-orig</span>
        <span class="p">(</span><span class="nb">symbol-function</span> <span class="nf">#'</span><span class="nv">mime-preview-play-current-entity</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">mime-preview-play-current-entity</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">ignore-examples</span> <span class="nv">mode</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">interactive</span> <span class="s">"P"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">mode</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">equal</span> <span class="nv">mode</span> <span class="s">"play"</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">mime-preview-play-current-entity-orig</span> <span class="nv">ignore-examples</span> <span class="nv">mode</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">entity</span> <span class="p">(</span><span class="nv">get-text-property</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="ss">'mime-view-entity</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">name</span> <span class="p">(</span><span class="nv">mime-entity-safe-filename</span> <span class="nv">entity</span><span class="p">))</span>
           <span class="c1">;; WinApps の Word や Excel で開くには $HOME 以下にファイルが無いと駄目なので</span>
           <span class="p">(</span><span class="nv">filename</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">name</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">string=</span> <span class="nv">name</span> <span class="s">""</span><span class="p">)))</span>
                                           <span class="nv">name</span>
                                         <span class="s">"~/Downloads/"</span><span class="p">)</span>
                                       <span class="s">"~/Downloads/"</span><span class="p">))</span>
           <span class="c1">;; 以下, 古い設定: /tmp/EMIXXXX/ 以下にファイルを保存し open で開く場合</span>
           <span class="c1">;; (filename (expand-file-name (if (and name (not (string= name "")))</span>
           <span class="c1">;;                                 name</span>
           <span class="c1">;;                               (make-temp-name "EMI"))</span>
           <span class="c1">;;                             (make-temp-file "EMI" 'directory)))</span>
           <span class="p">)</span>
      <span class="p">(</span><span class="nv">mime-write-entity-content</span> <span class="nv">entity</span> <span class="nv">filename</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">message</span> <span class="s">"External method is starting..."</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">process-name</span>
              <span class="p">(</span><span class="nv">concat</span> <span class="nv">my:mime-preview-play-current-entity-appname</span> <span class="s">" "</span> <span class="nv">filename</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">process</span>
              <span class="p">(</span><span class="nv">start-process</span> <span class="nv">process-name</span>
                             <span class="nv">mime-echo-buffer-name</span>
                             <span class="nv">my:mime-preview-play-current-entity-appname</span>
                             <span class="nv">filename</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">set-alist</span> <span class="ss">'mime-mailcap-method-filename-alist</span> <span class="nv">process</span> <span class="nv">filename</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">set-process-sentinel</span> <span class="nv">process</span> <span class="ss">'mime-mailcap-method-sentinel</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">mime-play-delete-file-immediately</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">mime-view-mailcap-files</span> <span class="o">'</span><span class="p">(</span><span class="s">"~/.mailcap"</span><span class="p">))</span></code></pre></figure>
<p>
<code>~/.mailcap</code> 自体は以下
</p>
<figure class="highlight"><pre><code class="language-conf" data-lang="conf"><span class="n">applications</span>/*; <span class="n">xdg</span>-<span class="n">open</span> %<span class="n">s</span>;
<span class="n">image</span>/*; <span class="n">xdg</span>-<span class="n">open</span> %<span class="n">s</span>;
<span class="n">video</span>/*; <span class="n">xdg</span>-<span class="n">open</span> %<span class="n">s</span>;</code></pre></figure>
<p>
MIME の例の保存先の変更
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-situation-examples-file</span>
      <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"mime-example"</span> <span class="nv">my:d:tmp</span><span class="p">))</span></code></pre></figure>
<p>
text/plain を html より優先.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-view-type-subtype-score-alist</span>
      <span class="o">'</span><span class="p">(((</span><span class="nv">text</span> <span class="o">.</span> <span class="nv">plain</span><span class="p">)</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">((</span><span class="nv">text</span> <span class="o">.</span> <span class="nv">html</span><span class="p">)</span>  <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">))</span></code></pre></figure>
<p>
音を鳴らすアレやコレの無効化
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-play-find-every-situations</span> <span class="no">nil</span>
      <span class="nv">process-connection-type</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org6dae78eb">個人情報の設定</h4>
<div class="outline-text-4" id="text-org6dae78eb">
<p>
具体的な設定内容は <code>wl-info-file</code> に書いている
</p>

<p>
設定している内容は以下の通り
</p>
</div>
<div>
<h5 id="org7f87384b">自身のメールアドレスと購読メーリングリストの設定</h5>
<div class="outline-text-5" id="text-org7f87384b">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; From: の設定</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-from</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">user-full-name</span> <span class="s">" &lt;"</span> <span class="nv">user-mail-address</span> <span class="s">"&gt;"</span><span class="p">))</span>
<span class="c1">;; (system-name) が FQDN を返さない場合、</span>
<span class="c1">;; `wl-local-domain' にホスト名を除いたドメイン名を設定</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-local-domain</span> <span class="s">"example.com"</span><span class="p">)</span>
<span class="c1">;; 自分のメールアドレスのリスト</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-user-mail-address-list</span>
      <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">wl-address-header-extract-address</span> <span class="nv">wl-from</span><span class="p">)</span>
            <span class="c1">;; "e-mail2@example.com"</span>
            <span class="c1">;; "e-mail3@example.net" ...</span>
            <span class="p">))</span>
<span class="c1">;; 自分の参加しているメーリングリストのリスト</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-subscribed-mailing-list</span>
      <span class="o">'</span><span class="p">(</span><span class="s">"wl@lists.airs.net"</span>
        <span class="s">"apel-ja@m17n.org"</span>
        <span class="s">"emacs-mime-ja@m17n.org"</span>
        <span class="c1">;; "ml@example.com" ...</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgba8bc2e7">送受信用サーバの設定</h5>
<div class="outline-text-5" id="text-orgba8bc2e7">
<p>
受信(IMAP)
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-default-server</span> <span class="s">"your imap server"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-default-port</span> <span class="ss">'993</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-default-stream-type</span> <span class="ss">'ssl</span><span class="p">)</span></code></pre></figure>
<p>
送信(SMTP)
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-posting-server</span> <span class="s">"your smtp server"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-posting-user</span> <span class="s">"your account"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-posting-port</span> <span class="mi">587</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-connection-type</span> <span class="ss">'starttls</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-smtp-authenticate-type</span> <span class="s">"login"</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org9af3a565">From に応じて送信サーバをきりかえる.</h5>
<div class="outline-text-5" id="text-org9af3a565">
<p>
本来はメール作成時/返信時の template の切り替えなのだれど,
送信時の SMTP の設定を from に合わせてきりかえるようにする.
default に二重に指定しているのは,
一度別のアカウントに切り替えた後に再びトグルして戻って来た際に元に戻す(上書き)するため.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-template-alist</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"default"</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="nv">wl-from</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"your smtp server"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">"login"</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">"example1"</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="s">"Your Name &lt;account@example1.com&gt;"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"smtp.example1.com"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">"login"</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">"example2"</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="s">"Your Name &lt;account@example2.com&gt;"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"smtp.example2.com"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">"plain"</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">"ssh:smtp"</span>
         <span class="c1">;; need ssh tunnel</span>
         <span class="c1">;; ssh -f -N -L 20025:localhost:25 smtp.server.com</span>
         <span class="p">(</span><span class="s">"From"</span> <span class="o">.</span> <span class="s">"Your Name &lt;account@example3.com&gt;"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">"localhost"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">"your ssh account"</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">20025</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">'nil</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="ss">'nil</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">))</span></code></pre></figure>
<p>
ssh tunnel を自動的にやる事はできないモンだろうか
(送信時に open して, 送信後に close する, みたいなの).
</p>

<p>
ついでに template の切り替えに関して幾つか設定.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; template 切り替え時に 内容を表示</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-template-visible-select</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
<code>draft-mode</code> で <code>C-c C-n</code> をするとテンプレートを切り替え
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (define-key wl-draft-mode-map "\C-c\C-n" 'wl-template-select)</span></code></pre></figure>
<p>
from に応じて wl-from, wl-envelope-from,
送信 smtp サーバを変更する送信時に変更
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (add-hook 'wl-draft-send-hook</span>
<span class="c1">;;           (lambda ()</span>
<span class="c1">;;             (set (make-local-variable 'wl-from)</span>
<span class="c1">;;                  (std11-fetch-field "From"))))</span></code></pre></figure>
<p>
送信時に自動的に wl-draft-config-alist を適用…しない?
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (remove-hook 'wl-draft-send-hook 'wl-draft-config-exec)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org19ec5248">基本設定</h4>
<div class="outline-text-4" id="text-org19ec5248">
</div>
<div>
<h5 id="org69cc3854">imap 関連</h5>
<div class="outline-text-5" id="text-org69cc3854">
<p>
デフォルトの認証設定
フォルダ名は UTF-7 でエンコードされているので,
表示する際にこれをデコードする
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-imap4-use-modified-utf7</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org2d8166ce">非同期チェック</h5>
<div class="outline-text-5" id="text-org2d8166ce">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-folder-check-async</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org6572a382">フォルダの位置の default からの変更</h5>
<div class="outline-text-5" id="text-org6572a382">
<p>
<code>~/.cache/wl/</code> に集約している
local の Mail folder(MH) の位置
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (setq elmo-localdir-folder-path "~/.cache/wl/local")</span></code></pre></figure>
<p>
local フォルダの設定:
<code>.lost+found</code> は <code>elmo-localdir-folder-path</code> からの相対パスになっていることに注意
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-lost+found-folder</span> <span class="s">"+lost+found"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-queue-folder</span> <span class="s">"+queue"</span><span class="p">)</span></code></pre></figure>
<p>
folders の位置の変更
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (setq wl-folders-file "~/.mu(concat my:d:password-store "/wl-folders.gpg"))</span></code></pre></figure>
<p>
Drafts, Trash の置き場所
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-folder</span> <span class="s">"+drafts"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-trash-folder</span> <span class="s">"+trash"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-temporary-file-directory</span> <span class="s">"~/Downloads/"</span><span class="p">)</span></code></pre></figure>
<p>
アドレス帳
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-use-petname</span> <span class="no">t</span><span class="p">)</span>
<span class="c1">;; (setq wl-address-file  "~/.mua/Address")</span></code></pre></figure>
<p>
LDAP サーバからアドレスを引くことも可能.
以前は GCALDaemon を使って local に ldap サーバを上げていたのだけれども,
Google Contacts の API が変わったらしく
GCALDaemon で LDAP サーバは使えなくなったのでコメントアウト.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-use-ldap</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-ldap-server</span> <span class="s">"localhost"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-ldap-port</span> <span class="s">"389"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-ldap-base</span> <span class="s">"dc=math,dc=kyoto-u,dc=ac,dc=jp"</span><span class="p">)</span></code></pre></figure>
<p>
パスワードの保存先
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (setq elmo-passwd-alist-file-name (concat my:d:password-store "/wl-passwd.gpg"))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org72bfee4a">フォルダ編集時に backup を作成しない.</h5>
<div class="outline-text-5" id="text-org72bfee4a">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-fldmgr-make-backup</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org223d5fa2">FCC, BCC の設定</h5>
<div class="outline-text-5" id="text-org223d5fa2">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-fcc</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; (setq wl-fcc "%Sent")</span></code></pre></figure>
<p>
fcc を既読にする場合は以下．=wl-fcc= が nil の場合には意味は無い
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-fcc-force-as-read</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
bcc は常に自身に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-bcc</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">user-mail-address</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org4378f104">起動時に <code>%INBOX</code> のみをチェック</h5>
<div class="outline-text-5" id="text-org4378f104">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-auto-check-folder-name</span> <span class="s">"%INBOX"</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org6efc7670">フォルダ選択時の初期設定</h5>
<div class="outline-text-5" id="text-org6efc7670">
<p>
imap の namespace を毎度入力するのが面倒なので, これを追加しておく.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-default-spec</span> <span class="s">"%"</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgb2cf2b53">confirm 関連の設定</h5>
<div class="outline-text-5" id="text-orgb2cf2b53">
<p>
スキャン時の問い合わせの無効化.
ちなみに confirm を nil にしても 問い合わせが無いだけで
threshold は効くので, 明示的に nil に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-folder-update-confirm</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-folder-update-threshold</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-message-fetch-confirm</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-message-fetch-threshold</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-prefetch-confirm</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-prefetch-threshold</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
終了時に確認しない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-interactive-exit</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
送信時は確認する
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-interactive-send</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org83490625">dispose, delete の設定</h5>
<div class="outline-text-5" id="text-org83490625">
<p>
Gmail用に%INBOXでは削除を <code>wl-trash-folder</code> への移動ではなく, 「delete」に．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'wl-dispose-folder-alist</span>
             <span class="o">'</span><span class="p">(</span><span class="s">"^%INBOX"</span> <span class="o">.</span> <span class="nb">delete</span><span class="p">))</span></code></pre></figure>
<p>
迷惑メール関連も
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'wl-dispose-folder-alist</span>
             <span class="o">'</span><span class="p">(</span><span class="s">".*Junk$"</span> <span class="o">.</span> <span class="nb">delete</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgd88be525">折り返しの設定</h5>
<div class="outline-text-5" id="text-orgd88be525">
<p>
message は折り返す.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-truncate-lines</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
draft も折り返す
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-truncate-lines</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgb31f5f2c">mode-line の設定</h5>
<div class="outline-text-5" id="text-orgb31f5f2c">
<p>
長いと嫌なのでイロイロ削る
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-mode-line-format</span> <span class="s">""</span><span class="p">)</span> <span class="c1">; "%f {%t}(%n/%u/%a)"</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-mode-line-format</span> <span class="s">""</span><span class="p">)</span> <span class="c1">; "&lt;&lt; %f:%F&gt;&gt; [%m]"</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org14b77860">
<span class="todo SOMEDAY">SOMEDAY</span> misc.</h5>
<div class="outline-text-5" id="text-org14b77860">
<p>
大きいメッセージを送信時に分割しない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-edit-split-message</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
スレッドは常に閉じる
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-thread-insert-opened</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
3 pain 表示 -&gt; 使わない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-stay-folder-window</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
未読を優先的に読む
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-move-order</span> <span class="ss">'unread</span><span class="p">)</span></code></pre></figure>
<p>
改ページ無視
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-break-pages</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
icon を使わない → GUI でもメニュー表示してないし, 体感的には遅くなる
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-highlight-folder-with-icon</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
<p>
印刷 → ps-print-buffer に任せる←まだ保留. エラー吐きよる….
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-print-buffer-function</span> <span class="ss">'ps-print-buffer</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org51dfe1e0">キーバインド関連</h4>
<div class="outline-text-4" id="text-org51dfe1e0">
<p>
<code>C-c C-j</code> を browse-url に明け渡す
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">"\C-c\C-j"</span> <span class="ss">'browse-url-at-point</span><span class="p">)</span></code></pre></figure>
<p>
<code>M-u</code> で unread にする
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"\M-u"</span> <span class="ss">'wl-summary-mark-as-unread</span><span class="p">)</span></code></pre></figure>
<p>
<code>i</code> で sync &lt;- Mew 風
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"i"</span> <span class="ss">'wl-summary-sync-update</span><span class="p">)</span></code></pre></figure>
<p>
<code>C-o</code> は elscreen で使う
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"\C-o"</span> <span class="no">nil</span> <span class="p">)</span></code></pre></figure>
<p>
<code>M-o</code> で <code>auto-refile</code>  (Mew 風)
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"\M-o"</span> <span class="ss">'wl-summary-auto-refile</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org460a927d">flag とフォルダを行き来する関数の追加</h4>
<div class="outline-text-4" id="text-org460a927d">
<p>
"=" でフラグ付きフォルダと
実際にメッセージのあるフォルダを行き来する.
Gmail の「スター付き」フォルダでも有効
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">'elmo</span> <span class="no">nil</span> <span class="ss">'noerror</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:wl-summary-jump-to-referer-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">wl-summary-message-number</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq</span> <span class="p">(</span><span class="nv">elmo-folder-type-internal</span> <span class="nv">wl-summary-buffer-elmo-folder</span><span class="p">)</span> <span class="ss">'flag</span><span class="p">)</span>
        <span class="p">(</span><span class="k">progn</span>
          <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">referer</span> <span class="p">(</span><span class="nv">elmo-flag-folder-referrer</span>
                           <span class="nv">wl-summary-buffer-elmo-folder</span>
                           <span class="p">(</span><span class="nv">wl-summary-message-number</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nv">folder</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">referer</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
                             <span class="p">(</span><span class="nv">completing-read</span>
                              <span class="p">(</span><span class="nb">format</span> <span class="s">"Jump to (%s): "</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">referer</span><span class="p">)))</span>
                              <span class="nv">referer</span>
                              <span class="no">nil</span> <span class="no">t</span> <span class="no">nil</span> <span class="no">nil</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">referer</span><span class="p">)))</span>
                           <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">referer</span><span class="p">)))))</span>
            <span class="p">(</span><span class="nv">wl-summary-goto-folder-subr</span> <span class="nv">folder</span> <span class="ss">'no-sync</span> <span class="no">nil</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">wl-summary-jump-to-msg</span> <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">assoc</span> <span class="nv">folder</span> <span class="nv">referer</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">eq</span> <span class="p">(</span><span class="nv">elmo-folder-type</span> <span class="nv">wl-summary-last-visited-folder</span><span class="p">)</span> <span class="ss">'internal</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">wl-summary-goto-last-visited-folder</span><span class="p">)))))</span>
<span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">"="</span> <span class="ss">'my:wl-summary-jump-to-referer-message</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org433d7a5c">summary-mode の表示のカスタマイズ</h4>
<div class="outline-text-4" id="text-org433d7a5c">
</div>
<div>
<h5 id="org63a385a5">自分が差出人である mail は To:某 と表示</h5>
<div class="outline-text-5" id="text-org63a385a5">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-showto-folder-regexp</span> <span class="s">".*"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-from-function</span> <span class="ss">'wl-summary-default-from</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org94145d9c">サマリ行の表示関連</h5>
<div class="outline-text-5" id="text-org94145d9c">
<p>
サマリ行のフォーマット指定
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-line-format</span>
      <span class="s">"%T%P%1@%1&gt;%Y/%M/%D %21(%t%[%19(%c %f%)%]%) %#%~%s"</span>
      <span class="nv">wl-summary-width</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nv">window-width</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span></code></pre></figure>
<p>
サマリ表示は切り詰めない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-subject-length-limit</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
スレッドの幅の指定
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-thread-indent-level</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-thread-have-younger-brother-str</span> <span class="s">"+"</span> <span class="c1">;; "├" ;; "+"</span>
      <span class="nv">wl-thread-youngest-child-str</span> <span class="s">"+"</span> <span class="c1">;; "└" ;; "+"</span>
      <span class="nv">wl-thread-vertical-str</span> <span class="s">"|"</span><span class="c1">;; "│" ;; "|"</span>
      <span class="nv">wl-thread-horizontal-str</span> <span class="s">"-"</span><span class="c1">;; "─" ;; "-"</span>
      <span class="nv">wl-thread-space-str</span> <span class="s">" "</span><span class="p">)</span></code></pre></figure>
<p>
以下の二つの設定を有効にするには
<code>elmo-msgdb-extra-fields</code> を設定する必要がある.
この変数は振り分け判定にも使用するのでそこで設定している
</p>
</div>
</div>
<div>
<h5 id="orga083aeb5">Gmail 風に, 自分宛のメールに "&gt;" をつけて表示する</h5>
<div class="outline-text-5" id="text-orga083aeb5">
<p>
元ネタ <a href="http://d.hatena.ne.jp/khiker/20080206/wanderlust">http://d.hatena.ne.jp/khiker/20080206/wanderlust</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; 一覧表示での置き換え規則に追加</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:wl-summary-line-for-me</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">catch</span> <span class="ss">'found</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">to</span> <span class="p">(</span><span class="nv">elmo-message-entity-field</span> <span class="nv">wl-message-entity</span> <span class="ss">'to</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">cc</span> <span class="p">(</span><span class="nv">elmo-message-entity-field</span> <span class="nv">wl-message-entity</span> <span class="ss">'cc</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">to</span><span class="p">)</span> <span class="nv">cc</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">to</span>
                  <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">to</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">to</span><span class="p">)</span> <span class="nv">to</span><span class="p">)</span>
                          <span class="p">(</span><span class="nb">when</span> <span class="nv">cc</span>
                            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">cc</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">cc</span><span class="p">)</span> <span class="nv">cc</span><span class="p">)))))</span>
          <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">i</span> <span class="nv">to</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">wl-address-user-mail-address-p</span> <span class="p">(</span><span class="nv">eword-decode-string</span> <span class="nv">i</span><span class="p">))</span>
              <span class="p">(</span><span class="k">throw</span> <span class="ss">'found</span> <span class="no">t</span><span class="p">)))))</span>
      <span class="s">"&gt;"</span>
    <span class="s">""</span><span class="p">))</span>
<span class="c1">;; &gt; を summary-line-format に追加</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-line-format-spec-alist</span>
      <span class="p">(</span><span class="nb">append</span> <span class="nv">wl-summary-line-format-spec-alist</span>
              <span class="o">'</span><span class="p">((</span><span class="nv">?&gt;</span> <span class="p">(</span><span class="nv">my:wl-summary-line-for-me</span><span class="p">)))))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org04b0fd69">添付ファイルがあったら, サマリ行に @ を付ける</h5>
<div class="outline-text-5" id="text-org04b0fd69">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-line-format-spec-alist</span>
      <span class="p">(</span><span class="nb">append</span> <span class="nv">wl-summary-line-format-spec-alist</span>
              <span class="o">'</span><span class="p">((</span><span class="nv">?@</span> <span class="p">(</span><span class="nv">wl-summary-line-attached</span><span class="p">)))))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgb972bff6">日本語添付ファイルの処理</h5>
<div class="outline-text-5" id="text-orgb972bff6">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;; とりあえず, デコードする長さを default の 1000 から二桁増やしておく.</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">mime-field-decoding-max-size</span> <span class="mi">100000</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">eword-decode</span>
  <span class="c1">;; 日本語ファイル名の添付ファイルを処理するための advice で使うために</span>
  <span class="c1">;; 以下を autoload 扱いにする</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">eword-decode-string</span>
             <span class="nv">eword-encode-string</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">mime-set-field-decoder</span>
   <span class="ss">'From</span> <span class="no">nil</span> <span class="ss">'eword-decode-and-unfold-unstructured-field-body</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">mime-set-field-decoder</span>
   <span class="ss">'CC</span> <span class="no">nil</span> <span class="ss">'eword-decode-and-unfold-unstructured-field-body</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">mime-set-field-decoder</span>
   <span class="ss">'To</span> <span class="no">nil</span> <span class="ss">'eword-decode-and-unfold-unstructured-field-body</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">mime</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:decode-mime-filename-around</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
    <span class="s">"Decode the filename returned by the original function if it's a string."</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">return-value</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">return-value</span><span class="p">)</span>
          <span class="p">(</span><span class="k">progn</span>
            <span class="p">(</span><span class="nv">eword-decode-string</span> <span class="nv">return-value</span> <span class="no">t</span><span class="p">))</span>
      <span class="nv">return-value</span><span class="p">)))</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:around</span> <span class="nv">mime-entity-filename</span>
           <span class="nv">my:decode-mime-filename-around</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">std11</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:encode-string-filter-args</span> <span class="p">(</span><span class="nv">args</span><span class="p">)</span>
    <span class="s">"Encode the first argument in a list of ARGS."</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">original-string</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">args</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">encoded-string</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">eword-encode-string</span> <span class="nv">original-string</span><span class="p">)</span> <span class="s">""</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">cons</span> <span class="nv">encoded-string</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">args</span><span class="p">))))</span>
  <span class="ss">:advice</span>
  <span class="p">(</span><span class="ss">:filter-args</span> <span class="nv">encode-string</span>
                <span class="nv">my:encode-string-filter-args</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org8e1a38e8">Subject が変わってもスレッドを切らない</h5>
<div class="outline-text-5" id="text-org8e1a38e8">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-divide-thread-when-subject-changed</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org4a68d8d4">Subject での Tab や複数スペースを無視</h5>
<div class="outline-text-5" id="text-org4a68d8d4">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (defadvice std11-unfold-string (after simply activate)</span>
<span class="c1">;;   (setq ad-return-value</span>
<span class="c1">;;         (replace-regexp-in-string ad-return-value "[ \t]+" " ")))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org84fec166">重複メッセージを非表示に</h5>
<div class="outline-text-5" id="text-org84fec166">
<p>
フォルダ内の Message-ID が同じメールを非表示にする
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-folder-process-duplicates-alist</span>
      <span class="o">'</span><span class="p">(</span>
        <span class="p">(</span><span class="s">".*"</span> <span class="o">.</span> <span class="nv">hide</span><span class="p">)</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgc0e5bbcf">sort 順: 返信が来た順</h5>
<div class="outline-text-5" id="text-orgc0e5bbcf">
<p>
元ネタは <a href="http://ikazuhiro.s206.xrea.com/article.php/20140920115345919">Re: wanderlust で GMail 風、新着レス順にソート</a>.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">wl-summary-overview-entity-compare-by-reply-date</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="s">"Compare message A and B by latest date of replies including thread."</span>
  <span class="p">(</span><span class="nv">cl-letf</span> <span class="p">(((</span><span class="nb">symbol-function</span> <span class="ss">'string-max2</span><span class="p">)</span>
             <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">string&lt;</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">y</span><span class="p">)</span> <span class="c1">;;&gt;</span>
                                 <span class="p">(</span><span class="ss">'t</span> <span class="nv">x</span><span class="p">))))</span>
            <span class="p">((</span><span class="nb">symbol-function</span> <span class="ss">'elmo-entity-to-number</span><span class="p">)</span>
             <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">elt</span> <span class="p">(</span><span class="nb">cddr</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)))</span>

            <span class="p">((</span><span class="nb">symbol-function</span> <span class="ss">'thread-number-get-date</span><span class="p">)</span>
             <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">timezone-make-date-sortable</span>
                          <span class="p">(</span><span class="nv">elmo-msgdb-overview-entity-get-date</span>
                           <span class="p">(</span><span class="nv">elmo-message-entity</span>
                            <span class="nv">wl-summary-buffer-elmo-folder</span>
                            <span class="nv">x</span><span class="p">)))))</span>
            <span class="p">((</span><span class="nb">symbol-function</span> <span class="ss">'thread-get-family</span><span class="p">)</span>
             <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">cons</span> <span class="nv">x</span> <span class="p">(</span><span class="nv">wl-thread-entity-get-descendant</span>
                        <span class="p">(</span><span class="nv">wl-thread-get-entity</span> <span class="nv">x</span><span class="p">)))))</span>
            <span class="p">((</span><span class="nb">symbol-function</span> <span class="ss">'max-reply-date</span><span class="p">)</span>
             <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">eq</span> <span class="ss">'nil</span> <span class="nv">x</span><span class="p">)</span>
                                <span class="ss">'nil</span><span class="p">)</span>
                               <span class="p">((</span><span class="nb">eq</span> <span class="ss">'nil</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">))</span>
                                <span class="p">(</span><span class="nv">thread-number-get-date</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">)))</span>
                               <span class="p">(</span><span class="ss">'t</span>
                                <span class="p">(</span><span class="nv">string-max2</span> <span class="p">(</span><span class="nv">thread-number-get-date</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">))</span>
                                             <span class="p">(</span><span class="nv">max-reply-date</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">)))))))</span>
            <span class="p">)</span>
    <span class="p">(</span><span class="nb">string&lt;</span>  <span class="c1">;;&gt;</span>
     <span class="p">(</span><span class="nv">max-reply-date</span> <span class="p">(</span><span class="nv">thread-get-family</span> <span class="p">(</span><span class="nv">elmo-entity-to-number</span> <span class="nv">a</span><span class="p">)))</span>
     <span class="p">(</span><span class="nv">max-reply-date</span> <span class="p">(</span><span class="nv">thread-get-family</span> <span class="p">(</span><span class="nv">elmo-entity-to-number</span> <span class="nv">b</span><span class="p">))))))</span>
<span class="c1">;; (defun wl-summary-overview-entity-compare-by-reply-date (a b)</span>
<span class="c1">;;   "Compare message A and B by latest date of replies including thread."</span>
<span class="c1">;;   (flet ((string-max2 (x y) (cond ((string&lt; x y) y) ;;&gt;</span>
<span class="c1">;;                                   ('t x)))</span>
<span class="c1">;;          (elmo-entity-to-number (x)</span>
<span class="c1">;;                                 (elt (cddr x) 0))</span>
<span class="c1">;;          (thread-number-get-date (x)</span>
<span class="c1">;;                                  (timezone-make-date-sortable</span>
<span class="c1">;;                                   (elmo-msgdb-overview-entity-get-date</span>
<span class="c1">;;                                    (elmo-message-entity</span>
<span class="c1">;;                                     wl-summary-buffer-elmo-folder</span>
<span class="c1">;;                                     x))))</span>
<span class="c1">;;          (thread-get-family (x)</span>
<span class="c1">;;                             (cons x (wl-thread-entity-get-descendant</span>
<span class="c1">;;                                      (wl-thread-get-entity x))))</span>
<span class="c1">;;          (max-reply-date  (x)</span>
<span class="c1">;;                           (cond ((eq 'nil x)</span>
<span class="c1">;;                                  'nil)</span>
<span class="c1">;;                                 ((eq 'nil (cdr x))</span>
<span class="c1">;;                                  (thread-number-get-date (car x)))</span>
<span class="c1">;;                                 ('t</span>
<span class="c1">;;                                  (string-max2 (thread-number-get-date (car x))</span>
<span class="c1">;;                                               (max-reply-date (cdr x))))))</span>
<span class="c1">;;          )</span>
<span class="c1">;;         (string&lt;  ;;&gt;</span>
<span class="c1">;;          (max-reply-date (thread-get-family (elmo-entity-to-number a)))</span>
<span class="c1">;;          (max-reply-date (thread-get-family (elmo-entity-to-number b))))))</span>
<span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'wl-summary-sort-specs</span> <span class="ss">'reply-date</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-default-sort-spec</span> <span class="ss">'reply-date</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="orgbeaff272">振り分け設定</h4>
<div class="outline-text-4" id="text-orgbeaff272">
<p>
<code>$</code> 以外を振り分け対象に
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-summary-auto-refile-skip-marks</span> <span class="o">'</span><span class="p">(</span><span class="s">"$"</span><span class="p">))</span></code></pre></figure>
</div>
<div>
<h5 id="org1581be27">振り分け判定に使用するヘッダ</h5>
<div class="outline-text-5" id="text-org1581be27">
<p>
添付の有無の表示にも使うので <code>Content-Type</code> も登録.
あと <code>Delivered-To</code> はメールの検索の時に結構重宝している.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-msgdb-extra-fields</span>
      <span class="o">'</span><span class="p">(</span>
        <span class="s">"List-Post"</span>
        <span class="s">"List-Id"</span>
        <span class="s">"List-ID"</span>                  <span class="c1">;; たまに List-ID で来るメールあるよね?</span>
        <span class="s">"Resent-CC"</span>
        <span class="s">"Mailing-List"</span>
        <span class="s">"X-Mailing-List"</span>
        <span class="s">"X-ML-Address"</span>
        <span class="s">"X-ML-Name"</span>
        <span class="s">"X-ML-To"</span>
        <span class="s">"X-Loop"</span>
        <span class="s">"Delivered-To"</span>
        <span class="s">"Content-Type"</span>              <span class="c1">;; 添付の有無の表示の為に追加</span>
        <span class="s">"X-Google-Appengine-App-Id"</span> <span class="c1">;; GAEの送信するメールの振り分け用</span>
        <span class="s">"To"</span>
        <span class="s">"Cc"</span>
        <span class="s">"From"</span>
        <span class="s">"Subject"</span>
        <span class="s">"Reply-To"</span>
        <span class="s">"Auto-Submitted"</span>            <span class="c1">;; Git commit/Cron notify</span>
        <span class="s">"X-GitLab-Project-Path"</span>     <span class="c1">;; salsa gitlab notification</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org1c00dc9a">メッセージ表示</h4>
<div class="outline-text-4" id="text-org1c00dc9a">
</div>
<div>
<h5 id="orgbdcad743">いったん全て非表示に</h5>
<div class="outline-text-5" id="text-orgbdcad743">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-ignored-field-list</span> <span class="o">'</span><span class="p">(</span><span class="s">"^.*:"</span><span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org279f859d">見たいヘッダだけ表示</h5>
<div class="outline-text-5" id="text-org279f859d">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-visible-field-list</span>
      <span class="o">'</span><span class="p">(</span><span class="s">"^Subject:"</span>
        <span class="s">"^From:"</span>
        <span class="s">"^To:"</span>
        <span class="s">"^Cc:"</span>
        <span class="s">"^Date:"</span>
        <span class="s">"^Message-ID:"</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org594e5622">表示順の変更</h5>
<div class="outline-text-5" id="text-org594e5622">
<p>
Mew 風…
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-sort-field-list</span>
      <span class="o">'</span><span class="p">(</span><span class="s">"^Subject:"</span>
        <span class="s">"^From:"</span>
        <span class="s">"^To:"</span>
        <span class="s">"^Cc:"</span>
        <span class="s">"^Date:"</span>
        <span class="s">"^Message-ID:"</span>
        <span class="p">))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org452d7cdb">From, To を省略表示しない</h5>
<div class="outline-text-5" id="text-org452d7cdb">
<p>
To や From にアドレスが沢山指定されていると省略されるので, これを無効化
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-message-use-header-narrowing</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="org1bf4b420">Wanderlust: Face の設定</h4>
<div class="outline-text-4" id="text-org1bf4b420">
<p>
デフォルトより細かく指定するために幾つかの face 定義を追加.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-highlight-message-header-alist</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"Subject[ \t]*:"</span> <span class="o">.</span> <span class="nv">wl-highlight-message-subject-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"From[ \t]*:"</span> <span class="o">.</span> <span class="nv">wl-highlight-message-from-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"Date[ \t]*:"</span> <span class="o">.</span> <span class="nv">wl-highlight-message-date-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"\\(.*To\\|Cc\\|Newsgroups\\)[ \t]*:"</span> <span class="o">.</span> <span class="nv">wl-highlight-message-important-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"\\(User-Agent\\|X-Mailer\\|X-Newsreader\\)[ \t]*:"</span> <span class="o">.</span> <span class="nv">wl-highlight-message-unimportant-header-contents</span><span class="p">)</span>
        <span class="p">))</span>
<span class="c1">;; use modus-vivendi color pallete</span>
<span class="p">(</span><span class="nv">face-spec-set</span> <span class="o">`</span><span class="nv">wl-highlight-message-subject-header-contents</span>     <span class="o">`</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#ff7f9f"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="p">))))</span>  <span class="c1">; red-cooler</span>
<span class="p">(</span><span class="nv">face-spec-set</span> <span class="o">`</span><span class="nv">wl-highlight-message-from-header-contents</span>        <span class="o">`</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#fec43f"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="p">))))</span>  <span class="c1">; yellow-warmer</span>
<span class="p">(</span><span class="nv">face-spec-set</span> <span class="o">`</span><span class="nv">wl-highlight-message-date-header-contents</span>        <span class="o">`</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#88ca9f"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="p">))))</span>  <span class="c1">; green-faint</span>
<span class="p">(</span><span class="nv">face-spec-set</span> <span class="o">`</span><span class="nv">wl-highlight-message-important-header-contents</span>   <span class="o">`</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#ff66ff"</span> <span class="p">))))</span>          <span class="c1">; magenta-intence</span>
<span class="p">(</span><span class="nv">face-spec-set</span> <span class="o">`</span><span class="nv">wl-highlight-message-unimportant-header-contents</span> <span class="o">`</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#9f9f9f"</span> <span class="p">))))</span>          <span class="c1">; fg-dim</span></code></pre></figure>
<p>
以下, 元々定義されているfaceの設定
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; ;; face の色付け</span>
<span class="c1">;; ;;;###autoload</span>
<span class="c1">;; (defun my:wl-set-face (face spec)</span>
<span class="c1">;;   (make-face face)</span>
<span class="c1">;;   (cond ((fboundp 'face-spec-set)</span>
<span class="c1">;;          (face-spec-set face spec))</span>
<span class="c1">;;         (t</span>
<span class="c1">;;          (wl-declare-face face spec))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-closed-face</span>
<span class="c1">;;                 '((t (:foreground "#4cff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-few-face</span>
<span class="c1">;;                 '((t (:foreground "#FF4C4C" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-zero-face</span>
<span class="c1">;;                 '((t (:foreground "#f6f3e8" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-1</span>
<span class="c1">;;                 '((t (:foreground "#7fff7f" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-2</span>
<span class="c1">;;                 '((t (:foreground "#ffff7f" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-3</span>
<span class="c1">;;                 '((t (:foreground "#7f7fff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-4</span>
<span class="c1">;;                 '((t (:foreground "#7fffff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-5</span>
<span class="c1">;;                 '((t (:foreground "#ff7fff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-6</span>
<span class="c1">;;                 '((t (:foreground "#ff7f7f" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-7</span>
<span class="c1">;;                 '((t (:foreground "#4cff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-8</span>
<span class="c1">;;                 '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-9</span>
<span class="c1">;;                 '((t (:foreground "#4c4cff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-10</span>
<span class="c1">;;                 '((t (:foreground "#4cffff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-11</span>
<span class="c1">;;                 '((t (:foreground "#ff4cff" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-cited-text-12</span>
<span class="c1">;;                 '((t (:foreground "#ff4c4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-date-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-headers</span>
<span class="c1">;;                 '((t (:foreground "#4CFFFF" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-important-header-contents2</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-signature</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-important-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#FF4CFF" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-subject-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#FF4C4C" :bold t :italic nil :weight bold ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-unimportant-header-contents</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-answered-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-refiled-face</span>
<span class="c1">;;                 '((t (:foreground "#7F7FFF" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-thread-top-face</span>
<span class="c1">;;                 '((t (:foreground "#F6F3E8" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-important-flag-face</span>
<span class="c1">;;                 '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-killed-face</span>
<span class="c1">;;                 '((t (:foreground "#4c4c4c" :5Dbold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-many-face</span>
<span class="c1">;;                 '((t (:foreground "#ff7fbf" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-opened-face</span>
<span class="c1">;;                 '((t (:foreground "#4cffff" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-path-face</span>
<span class="c1">;;                 '((t (:underline t :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-unknown-face</span>
<span class="c1">;;                 '((t (:foreground "#4cffff" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-folder-unread-face</span>
<span class="c1">;;                 '((t (:foreground "#4c4cff" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-header-separator-face</span>
<span class="c1">;;                 '((t (:inherit highlight :bold t ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-message-citation-header</span>
<span class="c1">;;                 '((t (:foreground "#7fff7f" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-copied-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFFFF" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-deleted-face</span>
<span class="c1">;;                 '((t (:foreground "#4c4c4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-displaying-face</span>
<span class="c1">;;                 '((t (:underline t :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-disposed-face</span>
<span class="c1">;;                 '((t (:foreground "#aaaaaa" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-flagged-face</span>
<span class="c1">;;                 '((t (:foreground "#ffff7f" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-forwarded-face</span>
<span class="c1">;;                 '((t (:foreground "#7f7fff" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-high-read-face</span>
<span class="c1">;;                 '((t (:foreground "#7fff7f" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-high-unread-face</span>
<span class="c1">;;                 '((t (:foreground "#ffb347" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-important-face</span>
<span class="c1">;;                 '((t (:foreground "#ffff4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-killed-face</span>
<span class="c1">;;                 '((t (:foreground "#4c4c4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-l:read-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFF4C" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-l:unread-face</span>
<span class="c1">;;                 '((t (:foreground "#7fbfff" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-new-face</span>
<span class="c1">;;                 '((t (:foreground "#ff4c4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-normal-face</span>
<span class="c1">;;                 '((t (:foreground "#f6f3e8" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-prefetch-face</span>
<span class="c1">;;                 '((t (:foreground "#4c4cee" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-resend-face</span>
<span class="c1">;;                 '((t (:foreground "#ffb347" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-target-face</span>
<span class="c1">;;                 '((t (:foreground "#4CFFFF" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-temp-face</span>
<span class="c1">;;                 '((t (:foreground "##ee4cee" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-summary-unread-face</span>
<span class="c1">;;                 '((t (:foreground "#ff4c4c" :bold nil :italic nil ))))</span>
<span class="c1">;; (my:wl-set-face 'wl-highlight-thread-indent-face</span>
<span class="c1">;;                 '((t (:underline t :bold nil :italic nil ))))</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org32b816f3">作成/返信設定</h4>
<div class="outline-text-4" id="text-org32b816f3">
<p>
自分宛のメールに返信する場合は <code>To:</code>, <code>Cc:</code> から自分のアドレスを削除
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-draft-always-delete-myself</span> <span class="no">t</span><span class="p">)</span></code></pre></figure>
<p>
"a" (without-argument)では <code>Reply-To:</code> や <code>From:</code> などで
指定された唯一人または唯一つの投稿先に返信.
また, <code>X-ML-Name:</code> と <code>Reply-To:</code> がついているなら <code>Reply-To:</code> 宛に返信
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (setq wl-draft-reply-without-argument-list</span>
<span class="c1">;;       '(</span>
<span class="c1">;;         (("X-ML-Name" "Reply-To") . (("Reply-To") nil nil))</span>
<span class="c1">;;         ("X-ML-Name" . (("To" "Cc") nil nil))</span>
<span class="c1">;;         ("Followup-To" . (nil nil ("Followup-To")))</span>
<span class="c1">;;         ("Newsgroups" . (nil nil ("Newsgroups")))</span>
<span class="c1">;;         ("Reply-To" . (("Reply-To") nil nil))</span>
<span class="c1">;;         ("Mail-Reply-To" . (("Mail-Reply-To") nil nil))</span>
<span class="c1">;;         ("From" . (("From") nil nil)))</span>
<span class="c1">;;       )</span></code></pre></figure>
<p>
<code>C-u a</code> (with-argument)であれば関係する全ての人・投稿先に返信
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (setq wl-draft-reply-with-argument-list</span>
<span class="c1">;;       '(</span>
<span class="c1">;;         (("X-ML-Name" "Reply-To") . (("Reply-To") nil nil))</span>
<span class="c1">;;         ("X-ML-Name" . (("To" "Cc") nil nil))</span>
<span class="c1">;;         ("Followup-To" . (nil nil ("Followup-To")))</span>
<span class="c1">;;         ("Newsgroups" . (nil nil ("Newsgroups")))</span>
<span class="c1">;;         ("Reply-To" . (("Reply-To") nil nil))</span>
<span class="c1">;;         ("Mail-Reply-To" . (("Mail-Reply-To") nil nil))</span>
<span class="c1">;;         ("From" . (("From") nil nil)))</span>
<span class="c1">;;       )</span></code></pre></figure>
<p>
サマリ表示には petname を使うが, 引用には使わない
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">wl-default-draft-cite-decorate-author</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
<div>
<h5 id="orgc8e9533f">ドラフトの自動保存の無効化</h5>
<div class="outline-text-5" id="text-orgc8e9533f">
<p>
偶に暴発している様な…? elscreen のせいかしら.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; (setq wl-auto-save-drafts-interval 300)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">wl-auto-save-drafts-interval</span> <span class="no">nil</span><span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgccd69748">メール本文の文字コード</h5>
<div class="outline-text-5" id="text-orgccd69748">
<p>
丸囲み数字なんかが入ってしまうと
勝手にエンコーディングが変わってしまって鬱陶しい. どうしたモンだろうかね.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'wl-draft-mode-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mime-charset-type-list</span> <span class="o">'</span><span class="p">(</span><span class="nv">utf-8</span> <span class="mi">8</span> <span class="no">nil</span><span class="p">))))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="org62a575b3">draft mode で orgtbl を有効に</h5>
<div class="outline-text-5" id="text-org62a575b3">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'wl-draft-mode-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="k">progn</span>
              <span class="p">(</span><span class="nb">require</span> <span class="ss">'org-table</span><span class="p">)</span>
              <span class="nf">#'</span><span class="nv">turn-on-orgtbl</span><span class="p">)))</span></code></pre></figure>
</div>
</div>
<div>
<h5 id="orgc1db3638">c-sig</h5>
<div class="outline-text-5" id="text-orgc1db3638">
<p>
署名の選択に c-sig を使用している.
設定は以下の通り. Mew 風に <code>C-c &lt;tab&gt;</code> で signature を挿入するようにしている
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">c-sig</span>
  <span class="ss">:commands</span> <span class="nv">insert-signature-eref</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">sig-alist-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"signature.alist"</span> <span class="nv">my:d:share</span><span class="p">))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'wl</span><span class="p">))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">sig-insert-end</span> <span class="no">t</span>
        <span class="nv">sig-save-to-sig-name-alist</span> <span class="no">nil</span>
        <span class="nv">message-signature-file</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">)</span>
<span class="c1">;; bind で設定できないなぁ...</span>
<span class="p">(</span><span class="nv">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">"\C-c\t"</span> <span class="ss">'insert-signature-eref</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h4 id="orgda22b5d8">GPG 署名</h4>
<div class="outline-text-4" id="text-orgda22b5d8">
<p>
以前は mailcrypt を使っていたけれど,
epa があるので主にキーバインドの設定のみ.
<code>draft-mode</code> の文字コードをあらかじめ指定しておかないと,
送信時に文字コードが変換されるので不正な署名となってしまう.
</p>

<p>
もっとうまい方法/正攻法がありそうな気がするけれど,
使えてるから, まあ良いかな, とか.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">mime-pgp-verify-when-preview</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:epa-wl-decrypt-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">save-window-excursion</span>
    <span class="p">(</span><span class="nv">wl-summary-jump-to-current-message</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">wl-message-decrypt-pgp-nonmime</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:epa-wl-verify-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">save-selected-window</span>
    <span class="p">(</span><span class="nv">wl-summary-jump-to-current-message</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">wl-message-verify-pgp-nonmime</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">leaf-keys</span> <span class="p">((</span><span class="ss">:wl-summary-mode-map</span>
             <span class="p">(</span><span class="s">"C-c : d"</span> <span class="o">.</span> <span class="nv">my:epa-wl-decrypt-message</span><span class="p">)</span>
             <span class="p">(</span><span class="s">"C-c : v"</span> <span class="o">.</span> <span class="nv">my:epa-wl-verify-message</span><span class="p">))</span>
            <span class="p">(</span><span class="ss">:wl-draft-mode-map</span>
             <span class="p">(</span><span class="s">"C-c : s"</span> <span class="o">.</span> <span class="nv">epa-mail-sign</span><span class="p">)</span>
             <span class="p">(</span><span class="s">"C-c : e"</span> <span class="o">.</span> <span class="nv">epa-mail-encrypt</span><span class="p">)))</span>
           <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org5d7309d7">検索</h4>
<div class="outline-text-4" id="text-org5d7309d7">
<p>
notmuchを使う.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">elmo-search</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">elmo-search-register-engine</span> <span class="ss">'notmuch-custom</span> <span class="ss">'local-file</span>
                               <span class="ss">:prog</span> <span class="s">"notmuch-query-custom"</span>
                               <span class="ss">:args</span> <span class="o">'</span><span class="p">(</span><span class="nv">elmo-search-split-pattern-list</span><span class="p">)</span>
                               <span class="ss">:charset</span> <span class="ss">'utf-8</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-search-default-engine</span> <span class="ss">'notmuch-custom</span><span class="p">))</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">wl-qs</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">wl-quicksearch-folder</span> <span class="s">"[]"</span>
        <span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf-keys</span> <span class="p">((</span><span class="ss">:wl-summary-mode-map</span>
             <span class="p">(</span><span class="s">"v"</span> <span class="o">.</span> <span class="nv">wl-quicksearch-goto-search-folder-wrapper</span><span class="p">))</span>
            <span class="p">(</span><span class="ss">:wl-folder-mode-map</span>
             <span class="p">(</span><span class="s">"v"</span> <span class="o">.</span> <span class="nv">wl-quicksearch-goto-search-folder-wrapper</span><span class="p">)))</span>
           <span class="p">)</span></code></pre></figure>
<p>
実際の呼び出しはスレッドを全部取得したいので以下を呼び出している
</p>
<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> x<span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span> <span class="o">=</span> x<span class="s2">""</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nv">res</span><span class="o">=</span><span class="si">$(</span>notmuch search <span class="nt">--output</span><span class="o">=</span>threads <span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span><span class="si">)</span>
<span class="k">fi
if</span> <span class="o">[</span> <span class="o">!</span> x<span class="s2">"</span><span class="nv">$res</span><span class="s2">"</span> <span class="o">=</span> x<span class="s2">""</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="nv">$res</span> | xargs notmuch search <span class="nt">--sort</span><span class="o">=</span>oldest-first <span class="nt">--output</span><span class="o">=</span>files
<span class="k">fi</span></code></pre></figure>
<p>
検索時にメールが多すぎると怒られるので. 数字は適当.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">elmo-multi-divide-number</span> <span class="mi">2000000</span>
      <span class="nv">elmo-multi-number</span> <span class="mi">2000000</span><span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h3 id="orgcfa9b17b">Linux Desktop で <code>mailto:</code> リンクを扱うために</h3>
<div class="outline-text-3" id="text-orgcfa9b17b">
<p>
ついでに <code>mailto</code> のリンクを emacsclient で扱うために,
以下の関数を定義しておく
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:mailto-compose-mail</span> <span class="p">(</span><span class="nv">mailto-url</span><span class="p">)</span>
  <span class="s">"Custom: handling mailto: link"</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">mailto-url</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">string-match</span> <span class="s">"\\`mailto:"</span> <span class="nv">mailto-url</span><span class="p">))</span>
      <span class="p">(</span><span class="k">progn</span>
        <span class="p">(</span><span class="nv">eval-and-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'rfc6068</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">headers</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">h</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">intern</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">h</span><span class="p">))</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">h</span><span class="p">)))</span>
                                <span class="p">(</span><span class="nv">rfc6068-parse-mailto-url</span> <span class="nv">mailto-url</span><span class="p">)))</span>
               <span class="p">(</span><span class="nv">good-headers</span> <span class="p">(</span><span class="nv">cl-remove-if</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">h</span><span class="p">)</span> <span class="p">(</span><span class="nb">member</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">h</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nv">Body</span><span class="p">)))</span> <span class="nv">headers</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">body</span> <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">assoc</span> <span class="ss">'Body</span> <span class="nv">headers</span><span class="p">))))</span>
          <span class="p">(</span><span class="nv">wl-draft</span> <span class="nv">good-headers</span> <span class="no">nil</span> <span class="no">nil</span> <span class="nv">body</span><span class="p">)))))</span></code></pre></figure>
<p>
Desktop の設定では
</p>
<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>

Tested-by: Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;
Tested-by: Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;
Tested-by: Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;

<span class="c"># emacs-mailto-handler</span>

<span class="nv">mailto</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">mailto</span><span class="o">=</span><span class="s2">"mailto:</span><span class="k">${</span><span class="nv">mailto</span><span class="p">#mailto</span>:<span class="k">}</span><span class="s2">"</span>
<span class="nv">mailto</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$mailto</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'s/[\"]/\\&amp;/g'</span><span class="si">)</span>
<span class="nv">elisp_expr</span><span class="o">=</span><span class="s2">"(my:mailto-compose-mail </span><span class="se">\"</span><span class="nv">$mailto</span><span class="se">\"</span><span class="s2">)"</span>

emacsclient <span class="nt">-a</span> <span class="s2">""</span> <span class="nt">-n</span> <span class="nt">--eval</span> <span class="s2">"</span><span class="nv">$elisp_expr</span><span class="s2">"</span> <span class="se">\</span>
            <span class="s1">'(set-window-dedicated-p (selected-window) t)'</span></code></pre></figure>
<p>
をメーラとして指定すれば良い．
GNOME は <code>.desktop</code> ファイルが無いと「お気に入り」登録ができないので
以下のファイルを適当な名前で <code>~/.local/share/applications/</code> 以下に放り込んでおくと良いだろう
</p>
<figure class="highlight"><pre><code class="language-conf" data-lang="conf">[<span class="n">Desktop</span> <span class="n">Entry</span>]
<span class="n">Name</span>=<span class="n">Emacs</span> <span class="n">Mail</span> <span class="n">Handler</span>
<span class="n">GenericName</span>=<span class="n">Mail</span> <span class="n">User</span> <span class="n">Agent</span>
<span class="n">X</span>-<span class="n">GNOME</span>-<span class="n">FullName</span>=<span class="n">Emacs</span> <span class="n">Mail</span> <span class="n">Handler</span>
<span class="n">Comment</span>=<span class="n">Use</span> <span class="n">emacsclient</span> <span class="n">as</span> <span class="n">MUA</span>, <span class="n">handling</span> <span class="n">mailto</span> <span class="n">link</span>
<span class="n">Keywords</span>=<span class="n">email</span>
<span class="n">Exec</span>=/<span class="n">home</span>/<span class="n">uwabami</span>/<span class="n">bin</span>/<span class="n">emacs</span>-<span class="n">mailto</span>-<span class="n">handler</span> %<span class="n">U</span>
<span class="n">Icon</span>=<span class="n">emacs25</span>
<span class="n">Terminal</span>=<span class="n">false</span>
<span class="n">Type</span>=<span class="n">Application</span>
<span class="n">Categories</span>=<span class="n">GNOME</span>;<span class="n">GTK</span>;<span class="n">Office</span>;<span class="n">Email</span>;
<span class="n">StartupNotify</span>=<span class="n">false</span>
<span class="n">MimeType</span>=<span class="n">application</span>/<span class="n">mbox</span>;<span class="n">message</span>/<span class="n">rfc822</span>;<span class="n">x</span>-<span class="n">scheme</span>-<span class="n">handler</span>/<span class="n">mailto</span>;</code></pre></figure>
</div>
</div>
<div>
<h3 id="org8f3efb7c">mbsync</h3>
<div class="outline-text-3" id="text-org8f3efb7c">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">mbsync</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"mbsync"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org7d9d4027">カレンダー設定</h2>
<div class="outline-text-2" id="text-org7d9d4027">
<p>
表示の更新と <code>japanese-holidays</code> による日本の休日の追加
</p>
</div>
<div>
<h3 id="org6ac86c8d">カレンダー本体の設定</h3>
<div class="outline-text-3" id="text-org6ac86c8d">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">calendar</span>
  <span class="ss">:defvar</span> <span class="nv">calendar-holidays</span> <span class="nv">japanese-holidays</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span>
   <span class="c1">;; 月と曜日の表示調整</span>
   <span class="nv">calendar-month-name-array</span>   <span class="nv">[</span><span class="s">"01"</span> <span class="s">"02"</span> <span class="s">"03"</span> <span class="s">"04"</span> <span class="s">"05"</span> <span class="s">"06"</span>
                                <span class="s">"07"</span> <span class="s">"08"</span> <span class="s">"09"</span> <span class="s">"10"</span> <span class="s">"11"</span> <span class="s">"12"</span> <span class="nv">]</span>
   <span class="nv">calendar-day-name-array</span>     <span class="nv">[</span><span class="s">"日"</span> <span class="s">"月"</span> <span class="s">"火"</span> <span class="s">"水"</span> <span class="s">"木"</span> <span class="s">"金"</span> <span class="s">"土"</span><span class="nv">]</span>
   <span class="nv">calendar-day-header-array</span>   <span class="nv">[</span><span class="s">"日"</span> <span class="s">"月"</span> <span class="s">"火"</span> <span class="s">"水"</span> <span class="s">"木"</span> <span class="s">"金"</span> <span class="s">"土"</span><span class="nv">]</span>
   <span class="c1">;; 日曜開始</span>
   <span class="nv">calendar-week-start-day</span>     <span class="mi">0</span>
   <span class="c1">;; 祝日をカレンダーに表示</span>
   <span class="nv">calendar-mark-holidays-flag</span> <span class="no">t</span>
   <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">with-eval-after-load</span> <span class="ss">'japanese-holidays</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">calendar-holidays</span> <span class="p">(</span><span class="nb">append</span> <span class="nv">japanese-holidays</span> <span class="nv">holiday-local-holidays</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org60295429">日本の休日の追加: <code>japanese-holidays</code>
</h3>
<div class="outline-text-3" id="text-org60295429">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">japanese-holidays</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:after</span> <span class="nv">calendar</span>
  <span class="ss">:require</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">japanese-holiday-weekend</span>        <span class="o">'</span><span class="p">(</span><span class="mi">0</span> <span class="mi">6</span><span class="p">)</span>
        <span class="nv">japanese-holiday-weekend-marker</span> <span class="o">'</span><span class="p">(</span><span class="nv">holiday</span>  <span class="c1">;; 日</span>
                                          <span class="no">nil</span>      <span class="c1">;; 月</span>
                                          <span class="no">nil</span>      <span class="c1">;; 火</span>
                                          <span class="no">nil</span>      <span class="c1">;; 水</span>
                                          <span class="no">nil</span>      <span class="c1">;; 木</span>
                                          <span class="no">nil</span>      <span class="c1">;; 金</span>
                                          <span class="nv">japanese-holiday-saturday</span><span class="p">)</span>
        <span class="p">)</span>
  <span class="ss">:config</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:japanese-holiday-show</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">_args</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">date</span> <span class="p">(</span><span class="nv">calendar-cursor-to-date</span> <span class="no">t</span><span class="p">))</span>
           <span class="c1">;; (calendar-date-display-form '((format "%s年 %s月 %s日（%s）" year month day dayname)))</span>
           <span class="p">(</span><span class="nv">date-string</span> <span class="p">(</span><span class="nv">calendar-date-string</span> <span class="nv">date</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">holiday-list</span> <span class="p">(</span><span class="nv">calendar-check-holidays</span> <span class="nv">date</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">holiday-list</span>
        <span class="p">(</span><span class="nv">message</span> <span class="s">"%s: %s"</span> <span class="nv">date-string</span> <span class="p">(</span><span class="nv">mapconcat</span> <span class="nf">#'</span><span class="nb">identity</span> <span class="nv">holiday-list</span> <span class="s">"; "</span><span class="p">)))))</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">calendar-move-hook</span>            <span class="o">.</span> <span class="nv">my:japanese-holiday-show</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">calendar-today-visible-hook</span>   <span class="o">.</span> <span class="nv">japanese-holiday-mark-weekend</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">calendar-today-invisible-hook</span> <span class="o">.</span> <span class="nv">japanese-holiday-mark-weekend</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">calendar-today-visible-hook</span>   <span class="o">.</span> <span class="nv">calendar-mark-today</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="org7b7eccc9">Org-mode</h2>
<div class="outline-text-2" id="text-org7b7eccc9">
<p>
<code>org-mode</code> が無いと生きていけない体になりました
</p>
</div>
<div>
<h3 id="orgb143e870">基本設定</h3>
<div class="outline-text-3" id="text-orgb143e870">
<p>
目新しい設定はしていない, と思う．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="c1">;; 昔のメモ(howm)も org-mode で開く</span>
  <span class="ss">:mode</span> <span class="s">"\\.org\\'"</span> <span class="s">"\\.howm\\'"</span>
  <span class="ss">:bind</span> <span class="p">((</span><span class="s">"C-x n s"</span> <span class="o">.</span> <span class="nv">org-narrow-to-subtree</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x n w"</span> <span class="o">.</span> <span class="nv">widen</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c a"</span>   <span class="o">.</span> <span class="nv">org-agenda</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-x m"</span>   <span class="o">.</span> <span class="nv">org-capture</span><span class="p">)</span>
         <span class="p">(</span><span class="s">"C-c $"</span>   <span class="o">.</span> <span class="nv">my:org-archive-with-tag</span><span class="p">)</span>
         <span class="p">)</span>
  <span class="ss">:preface</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-timestamp-hook</span> <span class="p">()</span>
  <span class="s">"`timestamp-start Change'の変更. org-mode では #+date: をひっかける"</span>
  <span class="p">(</span><span class="nb">set</span> <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'time-stamp-start</span><span class="p">)</span> <span class="s">"#\\+date: "</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">set</span> <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'time-stamp-end</span><span class="p">)</span>   <span class="s">"\$"</span><span class="p">)</span>
  <span class="p">)</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-archive-with-tag</span> <span class="p">()</span>
  <span class="s">"現在のエントリに ARCHIVE タグを付けてから、標準のアーカイブを実行する"</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">org-toggle-tag</span> <span class="s">"ARCHIVE"</span> <span class="ss">'on</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">call-interactively</span> <span class="ss">'org-archive-subtree</span><span class="p">))</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-compat-adjust-tab-width-in-buffer</span> <span class="p">(</span><span class="nv">old-width</span><span class="p">)</span>
  <span class="s">"公式提供: Adjust visual indentation from `tab-width' equal OLD-WIDTH to 8."</span>
  <span class="p">(</span><span class="nv">interactive</span> <span class="s">"nOld `tab-width': "</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">cl-assert</span> <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">'org-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">old-width</span> <span class="mi">8</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-with-wide-buffer</span>
     <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
     <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">bound</span>
           <span class="p">(</span><span class="nv">repl</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">old-width</span> <span class="mi">8</span><span class="p">)</span> <span class="c1">;; &gt;</span>
                     <span class="p">(</span><span class="nb">make-string</span> <span class="nv">old-width</span> <span class="nv">?\s</span><span class="p">)</span>
                   <span class="p">(</span><span class="nv">concat</span> <span class="s">"\t"</span> <span class="p">(</span><span class="nb">make-string</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">old-width</span> <span class="mi">8</span><span class="p">)</span> <span class="nv">?\s</span><span class="p">)))))</span>
       <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"^ *\t"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">skip-chars-forward</span> <span class="s">" \t"</span><span class="p">)</span>
         <span class="p">(</span><span class="k">setq</span> <span class="nv">bound</span> <span class="p">(</span><span class="nv">point-marker</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">forward-line</span> <span class="mi">0</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">search-forward</span> <span class="s">"\t"</span> <span class="nv">bound</span> <span class="no">t</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">replace-match</span> <span class="nv">repl</span><span class="p">)))))))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">((</span><span class="nv">org-mode-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                       <span class="p">(</span><span class="nv">my:org-timestamp-hook</span><span class="p">)</span>
                       <span class="p">(</span><span class="nv">org-tempo-setup</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">org-tab-before-tab-emulation-hook</span> <span class="o">.</span> <span class="nv">org-tempo-complete-tag</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-tempo</span> <span class="ss">:commands</span> <span class="p">(</span><span class="nv">org-tempo-setup</span> <span class="nv">org-tempo-complete-tag</span><span class="p">))</span>
  <span class="ss">:config</span>
  <span class="c1">;; Nextcloud に保存する</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">my:d:org</span><span class="p">)</span>
        <span class="c1">;; return でリンクを辿る</span>
        <span class="nv">org-return-follows-link</span>    <span class="no">t</span>
        <span class="c1">;; 見出しを畳んで表示</span>
        <span class="nv">org-startup-folded</span>         <span class="no">t</span>
        <span class="c1">;; 折り返し無し</span>
        <span class="nv">org-startup-truncated</span>      <span class="no">t</span>
        <span class="c1">;; インデントする</span>
        <span class="nv">org-adapt-indentation</span>      <span class="no">t</span>
        <span class="c1">;; link handler → xdg-open 任せ</span>
        <span class="nv">org-file-apps-defaults</span>     <span class="o">'</span><span class="p">((</span><span class="nv">remote</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nv">system</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)</span>
                                     <span class="p">(</span><span class="no">t</span>      <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">))</span>
        <span class="nv">org-file-apps-defaults-gnu</span> <span class="o">'</span><span class="p">((</span><span class="nv">remote</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nv">system</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)</span>
                                     <span class="p">(</span><span class="no">t</span>      <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">))</span>
        <span class="nv">org-file-apps</span>              <span class="o">'</span><span class="p">((</span><span class="nv">auto-mode</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"\\.mm\\'"</span> <span class="o">.</span> <span class="nv">default</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"\\.x?html?\\'"</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"\\.pdf\\'"</span> <span class="o">.</span> <span class="s">"xdg-open %s"</span><span class="p">))</span>
        <span class="c1">;; GTD: 状態の追加</span>
        <span class="nv">org-todo-keywords</span>          <span class="o">'</span><span class="p">((</span><span class="nc">sequence</span> <span class="s">"TODO(t)"</span> <span class="s">"WAIT(w)"</span> <span class="s">"SOMEDAY(s)"</span> <span class="s">"|"</span> <span class="s">"DONE(d)"</span> <span class="s">"CANCEL(c)"</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nc">sequence</span> <span class="s">"新規"</span> <span class="s">"進行中"</span> <span class="s">"解決"</span> <span class="s">"フィードバック"</span> <span class="s">"貸し出し可能"</span> <span class="s">"貸し出し中"</span> <span class="s">"|"</span> <span class="s">"終了"</span> <span class="s">"却下"</span> <span class="s">"廃棄"</span><span class="p">)</span>
                                     <span class="p">(</span><span class="k">type</span> <span class="s">"ARTICLE(a)"</span> <span class="s">"|"</span> <span class="s">"DONE(d)"</span><span class="p">)</span>
                                     <span class="p">(</span><span class="k">type</span> <span class="s">"MEMO(m)"</span> <span class="s">"|"</span> <span class="s">"DONE(d)"</span><span class="p">))</span>
        <span class="nv">org-todo-keyword-faces</span>     <span class="o">'</span><span class="p">((</span><span class="s">"TODO"</span>    <span class="o">.</span> <span class="nv">org-todo</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"WAIT"</span>    <span class="o">.</span> <span class="nv">org-todo</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"ARTICLE"</span> <span class="o">.</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7fbfff"</span> <span class="ss">:weight</span> <span class="nv">bold</span><span class="p">))</span>
                                     <span class="p">(</span><span class="s">"MEMO"</span>    <span class="o">.</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7fbfff"</span> <span class="ss">:weight</span> <span class="nv">bold</span><span class="p">))</span>
                                     <span class="p">(</span><span class="s">"SOMEDAY"</span> <span class="o">.</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7fff7f"</span> <span class="ss">:weight</span> <span class="nv">bold</span><span class="p">)))</span>
        <span class="c1">;; GTD: タグの追加</span>
        <span class="nv">org-tag-alist</span>              <span class="o">'</span><span class="p">((</span><span class="s">"OFFICE"</span>     <span class="o">.</span> <span class="nv">?o</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"HOME"</span>       <span class="o">.</span> <span class="nv">?h</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"MAIL"</span>       <span class="o">.</span> <span class="nv">?m</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"WORK"</span>       <span class="o">.</span> <span class="nv">?w</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"Debian"</span>     <span class="o">.</span> <span class="nv">?d</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"Computer"</span>   <span class="o">.</span> <span class="nv">?c</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"Book"</span>       <span class="o">.</span> <span class="nv">?b</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"Emacs"</span>      <span class="o">.</span> <span class="nv">?e</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"TeX"</span>        <span class="o">.</span> <span class="nv">?t</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"Ruby"</span>       <span class="o">.</span> <span class="nv">?r</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"IGNORE"</span>     <span class="o">.</span> <span class="nv">?i</span><span class="p">)</span>
                                     <span class="p">(</span><span class="s">"PLANNED"</span>    <span class="o">.</span> <span class="nv">?p</span><span class="p">)</span>
                                     <span class="p">)</span>
        <span class="c1">;; Archive.org の位置指定</span>
        <span class="nv">org-archive-location</span>       <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Archive.org::"</span> <span class="nv">my:d:org</span><span class="p">)</span>
        <span class="c1">;; Archive コマンドの指定</span>
        <span class="c1">;; org-archive-default-command #'my:org-archive-with-tag</span>
        <span class="c1">;; modules → とりあえずクリアしておく</span>
        <span class="nv">org-modules</span>  <span class="o">'</span><span class="p">()</span>
        <span class="c1">;; element-cache は使わない...うまく使えると良いんだけれど.</span>
        <span class="nv">org-element-use-cache</span> <span class="no">nil</span>
        <span class="c1">;; org-agenda で設定するべきかなぁ...</span>
        <span class="nv">org-agenda-inhibit-startup</span>  <span class="no">t</span>
        <span class="c1">;;</span>
        <span class="nv">org-emphasis-alist</span>
        <span class="p">(</span><span class="nb">cons</span> <span class="o">'</span><span class="p">(</span><span class="s">"+"</span> <span class="o">'</span><span class="p">(</span><span class="ss">:strike-through</span> <span class="no">t</span> <span class="ss">:foreground</span> <span class="s">"#999999"</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">cl-delete</span> <span class="s">"+"</span> <span class="nv">org-emphasis-alist</span> <span class="ss">:key</span> <span class="ss">'car</span> <span class="ss">:test</span> <span class="ss">'equal</span><span class="p">))</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org99399f3b">
<span class="todo TODO">TODO</span> Org-Babel</h3>
<div class="outline-text-3" id="text-org99399f3b">
<ul class="org-ul">
<li class="off">
<code>[ ]</code> ox-latex → ob-latex の順で呼ばないとエラーになる様な?</li>
</ul>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-src</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-src-fontify-natively</span>         <span class="no">t</span> <span class="c1">;; font-lock</span>
        <span class="c1">;; TAB の挙動</span>
        <span class="nv">org-src-tab-acts-natively</span>        <span class="no">t</span>
        <span class="c1">;; インデント</span>
        <span class="nv">org-edit-src-content-indentation</span> <span class="mi">0</span>
        <span class="c1">;; インデントを残す</span>
        <span class="nv">org-src-preserve-indentation</span>     <span class="no">t</span>
        <span class="c1">;; load languages</span>
        <span class="p">)</span>
  <span class="p">)</span>
<span class="c1">;; (leaf org-babel</span>
<span class="c1">;;   :config</span>
<span class="c1">;;   (setq org-babel-load-languages '((emacs-lisp . t)))</span>
<span class="c1">;;   ;; (if (file-exists-p "/usr/share/ditaa/ditaa.jar")</span>
<span class="c1">;;   ;;     (add-to-list 'org-babel-load-languages '(ditaa . t)))</span>
<span class="c1">;;   ;; (if (executable-find "uplatex")</span>
<span class="c1">;;   ;;     (add-to-list 'org-babel-load-languages '(latex . t)))</span>
<span class="c1">;;   )</span>
<span class="c1">;; (leaf ob-ditaa</span>
<span class="c1">;;   :init</span>
<span class="c1">;;   (setq org-ditaa-jar-path "/usr/share/ditaa/ditaa.jar")</span>
<span class="c1">;;   )</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org99f3c6e6">Org-Id</h3>
<div class="outline-text-3" id="text-org99f3c6e6">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-id</span>
  <span class="ss">:bind</span>
  <span class="p">((</span><span class="s">"C-c n o"</span> <span class="o">.</span> <span class="nv">org-id-get-create</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-macs</span> <span class="ss">:commands</span> <span class="nv">org-with-point-at</span><span class="p">)</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-id-add-custom-id</span> <span class="p">()</span>
  <span class="s">"Add \"CUSTOM_ID\" to the current tree if not assigned yet."</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">my:org-custom-id-get</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-id-get-custom-id</span> <span class="p">()</span>
  <span class="s">"Return a part of UUID with an \"org\" prefix.
g. \"org3ca6ef0c\"."</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">id</span> <span class="p">(</span><span class="nv">org-id-new</span> <span class="s">""</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-uuidgen-p</span> <span class="nv">id</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">downcase</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"org"</span>  <span class="p">(</span><span class="nv">substring</span> <span class="p">(</span><span class="nv">org-id-new</span> <span class="s">""</span><span class="p">)</span> <span class="mi">0</span> <span class="mi">8</span><span class="p">))))))</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-custom-id-get</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">pom</span> <span class="nv">create</span><span class="p">)</span>
  <span class="s">"Get the CUSTOM_ID property of the entry at point-or-marker POM.
e https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">eval-when-compile</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'org-macs</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="nv">pom</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">id</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="no">nil</span> <span class="s">"CUSTOM_ID"</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">cond</span>
       <span class="p">((</span><span class="nb">and</span> <span class="nv">id</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">id</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">"\\S-"</span> <span class="nv">id</span><span class="p">))</span>
        <span class="nv">id</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">create</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">id</span> <span class="p">(</span><span class="nv">my:org-id-get-custom-id</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="nv">id</span>
          <span class="p">(</span><span class="nb">error</span> <span class="s">"Invalid ID"</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">org-entry-put</span> <span class="nv">pom</span> <span class="s">"CUSTOM_ID"</span> <span class="nv">id</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">message</span> <span class="s">"--- CUSTOM_ID assigned: %s"</span> <span class="nv">id</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org-id-add-location</span> <span class="nv">id</span> <span class="p">(</span><span class="nv">buffer-file-name</span> <span class="p">(</span><span class="nv">buffer-base-buffer</span><span class="p">)))</span>
        <span class="nv">id</span><span class="p">)))))</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-id-delete-all-id-in-file</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">goto-char</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">eq</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">org-next-visible-heading</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">id</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="s">"ID"</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">id</span>
        <span class="p">(</span><span class="nv">message</span> <span class="s">"ID: %s"</span> <span class="nv">id</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org-delete-property</span> <span class="s">"ID"</span><span class="p">))))</span>
  <span class="p">(</span><span class="nv">message</span> <span class="s">"--- done."</span><span class="p">))</span>
<span class="c1">;;;###autoload</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-id-add-to-headlines-in-file</span> <span class="p">()</span>
  <span class="s">"Add CUSTOM_ID properties to all headlines in the current file.
e https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">save-excursion</span>
    <span class="p">(</span><span class="nv">widen</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"^#\\+options:.*auto-id:t"</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">org-map-entries</span>
       <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">my:org-custom-id-get</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="ss">'create</span><span class="p">))))))</span>
  <span class="c1">;;</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">before-save-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                              <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">eq</span> <span class="nv">major-mode</span> <span class="ss">'org-mode</span><span class="p">)</span>
                                         <span class="p">(</span><span class="nb">eq</span> <span class="nv">buffer-read-only</span> <span class="no">nil</span><span class="p">))</span>
                                <span class="p">(</span><span class="nv">my:org-id-add-to-headlines-in-file</span><span class="p">))))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-id-locations-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-id-locations"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">org-id-link-to-org-use-id</span> <span class="ss">'create-if-interactive-and-no-custom-id</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org456c87fa">Org-journal: 日記</h3>
<div class="outline-text-3" id="text-org456c87fa">
<p>
orgで日記. org-roam のメモにする前のエントリもどんどん書き込んでいたり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-journal</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="ss">:commands</span> <span class="nv">org-journal-new-entry</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">org-journal-mode-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span><span class="p">()</span>
                              <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">truncate-lines</span> <span class="no">t</span><span class="p">))))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-journal-file-type</span>                 <span class="ss">'yearly</span>
        <span class="nv">org-journal-dir</span>                       <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"journal"</span> <span class="nv">my:d:org</span><span class="p">)</span>
        <span class="nv">org-journal-file-format</span>               <span class="s">"%Y.org"</span>
        <span class="nv">org-journal-cache-file</span>                <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-journal.cache"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">org-journal-date-format</span>               <span class="s">"%x (%a)"</span>
        <span class="nv">org-journal-time-format</span>               <span class="s">"&lt;%Y-%m-%d %R&gt; "</span>
        <span class="nv">org-journal-time-prefix</span>               <span class="s">"** MEMO "</span>
        <span class="nv">org-journal-enable-agenda-integration</span> <span class="no">t</span>
        <span class="nv">org-journal-find-file</span>                 <span class="ss">'find-file</span>
        <span class="c1">;; org-journal-carryover-items           "TODO=\"TODO\""</span>
        <span class="nv">org-journal-carryover-delete-empty-journal</span> <span class="ss">'always</span>
        <span class="nv">org-journal-start-on-weekday</span>          <span class="mi">0</span>
        <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c C-j"</span><span class="p">)</span> <span class="ss">'browse-url-at-point</span><span class="p">)</span> <span class="c1">;; 🤔？</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgbe835a6b">Org-capture: メモ取り</h3>
<div class="outline-text-3" id="text-orgbe835a6b">
<p>
キーバインドは以前 changelog memo をやっていた時の癖で <code>C-x m</code> をメモにしている.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-capture</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="ss">:commands</span> <span class="nv">org-capture</span>
  <span class="ss">:defvar</span> <span class="p">(</span><span class="nv">my:org:calendar1</span> <span class="nv">my:org:calendar2</span> <span class="nv">my:org:calendar3</span> <span class="nv">my:org:calendar4</span><span class="p">)</span>
  <span class="ss">:pl-setq</span> <span class="p">(</span><span class="nv">my:org:calendar1</span> <span class="nv">my:org:calendar2</span> <span class="nv">my:org:calendar3</span> <span class="nv">my:org:calendar4</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-journal-add-date-entry-capture</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">org-journal-new-entry</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-default-notes-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"INBOX.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-capture-templates</span>
        <span class="o">`</span><span class="p">(</span>
          <span class="p">(</span><span class="s">"t"</span> <span class="s">"TODO"</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="k">function</span> <span class="nv">my:org-journal-add-date-entry-capture</span><span class="p">)</span>
           <span class="s">"** TODO %(format-time-string org-journal-time-format)%^{title} %^g\n  %?\n  %a"</span>
           <span class="ss">:prepend</span> <span class="no">nil</span>
           <span class="c1">;; :unnarrowed nil</span>
           <span class="ss">:kill-buffer</span> <span class="no">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">"m"</span> <span class="s">"メモを追加"</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="k">function</span> <span class="nv">my:org-journal-add-date-entry-capture</span><span class="p">)</span>
           <span class="s">"** MEMO %(format-time-string org-journal-time-format)%?"</span>
           <span class="ss">:prepend</span> <span class="no">nil</span>
           <span class="c1">;; :unnarrowed nil</span>
           <span class="ss">:kill-buffer</span> <span class="no">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">"a"</span> <span class="s">"少し長めの記事を追加する"</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="k">function</span> <span class="nv">my:org-journal-add-date-entry-capture</span><span class="p">)</span>
           <span class="s">"** ARTICLE %(format-time-string org-journal-time-format)%? "</span>
           <span class="ss">:prepend</span> <span class="no">nil</span>
           <span class="c1">;; :unnarrowed nil</span>
           <span class="ss">:kill-buffer</span> <span class="no">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">"s"</span> <span class="s">"個人予定表スケジュールを追加"</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Schedule.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
           <span class="s">"* %^{prompt}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar1)\n  :org-gcal-managed: org\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
           <span class="ss">:prepend</span> <span class="no">nil</span>
           <span class="c1">;; :unnarrowed nil</span>
           <span class="ss">:kill-buffer</span> <span class="no">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">"u"</span> <span class="s">"仕事予定表スケジュールを追加"</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Univ.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
           <span class="s">"* %^{prompt}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar2)\n  :org-gcal-managed: org\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
           <span class="ss">:prepend</span> <span class="no">nil</span>
           <span class="c1">;; :unnarrowed nil</span>
           <span class="ss">:kill-buffer</span> <span class="no">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">"g"</span> <span class="s">"GFD 関連 スケジュールを追加"</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"GFD.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
           <span class="s">"* %^{prompt}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar3)\n  :org-gcal-managed: org\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
           <span class="ss">:prepend</span> <span class="no">nil</span>
           <span class="c1">;; :unnarrowed nil</span>
           <span class="ss">:kill-buffer</span> <span class="no">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">"h"</span> <span class="s">"有給休暇・特別休暇を追加"</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Holidays.org"</span> <span class="nv">my:d:org</span><span class="p">))</span>
           <span class="s">"* %^{prompt}\n  :PROPERTIES:\n  :calendar-id: %(format \"%s\" my:org:calendar4)\n  :org-gcal-managed: org\n  :END:\n  :org-gcal:\n%?\n%i\n  :END:"</span>
           <span class="ss">:prepend</span> <span class="no">nil</span>
           <span class="c1">;; :unnarrowed nil</span>
           <span class="ss">:kill-buffer</span> <span class="no">t</span>
           <span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org016dbf67">Org-agenda: スケジュール, TODO 表示</h3>
<div class="outline-text-3" id="text-org016dbf67">
<p>
GTD 用の設定．後述の <code>org-gcal</code> と <code>orgmine</code> で取得したデータも表示している．
ついでに
</p>
<ul class="org-ul">
<li>土曜日をの face を追加.</li>
<li>祝日, 休日を日曜と同じfaceにする.</li>
</ul>
<p>
なんて事もやっている．元ネタは <a href="https://julien.danjou.info/blog/2010/org-mode-and-holidays">Org-mode and holidays</a>.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-agenda</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="c1">;; org-agenda での色付け設定</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-date-saturday</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7FBFFF"</span> <span class="ss">:bold</span> <span class="no">t</span> <span class="p">)))</span>
    <span class="s">"Agenda 表示中の土曜日用のface"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="c1">;; こっからは org-gcal で同期したカレンダーの色</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-Univ</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7FFF7F"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, Univ.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-Schedule</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#7FFFFF"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, Schedule.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-GFD</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#FFFF7F"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, GFD.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-DebianJP</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#BF7FFF"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, DebianJP.org の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>
  <span class="c1">;; mastodon の ログファイルの表示</span>
  <span class="p">(</span><span class="nv">defface</span> <span class="nv">my:org-agenda-calendar-SNS</span> <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="ss">:foreground</span> <span class="s">"#CCCCCC"</span><span class="p">)))</span>
    <span class="s">"Agenda 表示中, Mastodon log の表示 face"</span>
    <span class="ss">:group</span> <span class="ss">'org-agenda</span> <span class="p">)</span>

  <span class="c1">;; (正規表現 . Face名)のペアを作成しておく</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">my:org-agenda-highlight-rules</span>
    <span class="o">'</span><span class="p">((</span><span class="s">"Univ:"</span> <span class="o">.</span> <span class="nv">my:org-agenda-calendar-Univ</span><span class="p">)</span>
      <span class="p">(</span><span class="s">"Schedule:"</span> <span class="o">.</span> <span class="nv">my:org-agenda-calendar-Schedule</span><span class="p">)</span>
      <span class="p">(</span><span class="s">"DebianJP:"</span> <span class="o">.</span> <span class="nv">my:org-agenda-calendar-DebianJP</span><span class="p">)</span>
      <span class="p">(</span><span class="s">"GFD:"</span> <span class="o">.</span> <span class="nv">my:org-agenda-calendar-GFD</span><span class="p">)</span>
      <span class="p">(</span><span class="s">"祝日\\|休日\\|Holidays\\|誕生日"</span> <span class="o">.</span> <span class="nv">org-agenda-date-weekend</span><span class="p">)</span>
      <span class="c1">;; 土曜日の設定例 (必要ならコメントアウトを外してください)</span>
      <span class="p">(</span><span class="s">"(土)\\|(Sat)"</span> <span class="o">.</span> <span class="nv">my:org-agenda-date-saturday</span><span class="p">)</span>
      <span class="p">(</span><span class="s">"mstdn-\*"</span> <span class="o">.</span> <span class="nv">my:org-agenda-calendar-SNS</span><span class="p">)</span>
      <span class="p">))</span>

  <span class="c1">;; font-lock の適用</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-agenda-finalize-font-lock</span> <span class="p">()</span>
    <span class="s">"Apply custom font-lock based my:org-agenda-hilighlight-rules"</span>
    <span class="p">(</span><span class="nv">save-excursion</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inhibit-read-only</span> <span class="no">t</span><span class="p">))</span> <span class="c1">;; AgendaバッファがRead onlyの場合の対策</span>
      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">rule</span> <span class="nv">my:org-agenda-highlight-rules</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">regex</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">rule</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">face</span>  <span class="p">(</span><span class="nb">cdr</span> <span class="nv">rule</span><span class="p">)))</span>
          <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="nv">regex</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">add-text-properties</span> <span class="p">(</span><span class="nv">match-beginning</span> <span class="mi">0</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nv">line-end-position</span><span class="p">)</span>
                                 <span class="o">`</span><span class="p">(</span><span class="nv">face</span> <span class="o">,</span><span class="nv">face</span><span class="p">))))))))</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">org-agenda-finalize-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                                      <span class="p">(</span><span class="nv">my:org-agenda-finalize-font-lock</span><span class="p">)</span>
                                      <span class="c1">;; カーソルを先頭行に</span>
                                      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">)))</span>
                                  <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-super-agenda</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:config</span>
    <span class="ss">:hook</span> <span class="p">(</span><span class="nv">org-agenda-mode-hook</span> <span class="o">.</span> <span class="nv">org-super-agenda-mode</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-agenda-day-face-function</span>
        <span class="c1">;; ---</span>
        <span class="c1">;; 「org-modeのアジェンダで土曜日と日本の祝日を色づけする」</span>
        <span class="c1">;; https://misohena.jp/blog/2021-08-29-colorize-saturday-and-japanese-holidays-in-org-agenda.html</span>
        <span class="c1">;; ちょっと順番を変えて(「祝日, 日曜」を赤にしたいので)先に「日曜か日本の祝日」をチェックしている</span>
        <span class="c1">;; ---</span>
        <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">date</span><span class="p">)</span>
          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">face</span>
                 <span class="p">(</span><span class="nb">cond</span>
                  <span class="c1">;; 日曜日か日本の祝日</span>
                  <span class="p">((</span><span class="nb">or</span> <span class="p">(</span><span class="nb">=</span> <span class="p">(</span><span class="nv">calendar-day-of-week</span> <span class="nv">date</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
                       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">calendar-holidays</span> <span class="nv">japanese-holidays</span><span class="p">))</span>
                         <span class="p">(</span><span class="nv">calendar-check-holidays</span> <span class="nv">date</span><span class="p">)))</span>
                   <span class="ss">'org-agenda-date-weekend</span><span class="p">)</span>
                  <span class="c1">;; 土曜日</span>
                  <span class="p">((</span><span class="nb">=</span> <span class="p">(</span><span class="nv">calendar-day-of-week</span> <span class="nv">date</span><span class="p">)</span> <span class="mi">6</span><span class="p">)</span>
                   <span class="ss">'my:org-agenda-date-saturday</span><span class="p">)</span>
                  <span class="c1">;; 普通の日</span>
                  <span class="p">(</span><span class="no">t</span> <span class="ss">'org-agenda-date</span><span class="p">))))</span>
            <span class="c1">;; 今日は色を反転</span>
            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">org-agenda-today-p</span> <span class="nv">date</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">:inherit</span> <span class="nv">face</span> <span class="ss">:underline</span> <span class="no">t</span><span class="p">)</span> <span class="nv">face</span><span class="p">)))</span>
        <span class="c1">;;</span>
        <span class="nv">org-agenda-span</span> <span class="ss">'week</span>
        <span class="nv">org-agenda-start-on-weekday</span> <span class="no">nil</span> <span class="c1">;; today!</span>
        <span class="nv">org-agenda-format-date</span> <span class="s">"%Y/%m/%d (%a)"</span>
        <span class="nv">org-agenda-weekend-days</span> <span class="o">'</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>    <span class="c1">;; sunday.</span>
        <span class="nv">org-agenda-ignore-properties</span> <span class="o">'</span><span class="p">(</span><span class="nv">effort</span> <span class="nv">appt</span><span class="p">)</span>
        <span class="c1">;; org-agenda-repeating-timestampo-show-all t ;; 🤔</span>
        <span class="nv">org-agenda-sorting-strategy</span> <span class="o">'</span><span class="p">((</span><span class="nv">agenda</span> <span class="nv">habit-down</span> <span class="nv">time-up</span> <span class="nv">timestamp-down</span> <span class="nv">priority-down</span> <span class="nv">category-keep</span><span class="p">)</span>
                                      <span class="p">(</span><span class="nv">todo</span> <span class="nv">category-keep</span> <span class="nv">timestamp-down</span> <span class="nv">priority-down</span><span class="p">)</span>
                                      <span class="p">(</span><span class="nv">tags</span> <span class="nv">category-keep</span> <span class="nv">priority-down</span><span class="p">)</span>
                                      <span class="p">(</span><span class="nb">search</span> <span class="nv">category-keep</span><span class="p">))</span>
        <span class="nv">org-agenda-custom-commands</span>  <span class="o">'</span><span class="p">((</span><span class="s">"n"</span> <span class="s">"agenda and all TODO list"</span>
                                       <span class="p">((</span><span class="nv">agenda</span> <span class="s">""</span>
                                                <span class="p">((</span><span class="nv">org-agenda-ndays</span> <span class="mi">1</span><span class="p">)</span>
                                                 <span class="p">(</span><span class="nv">org-agenda-entry-types</span> <span class="o">'</span><span class="p">(</span><span class="ss">:timestamp</span> <span class="ss">:sexp</span><span class="p">))))</span>
                                       <span class="p">(</span><span class="nv">todo</span> <span class="s">"TODO"</span><span class="p">)</span>
                                       <span class="p">(</span><span class="nv">todo</span> <span class="s">"新規|着手|進行中|確認"</span>
                                             <span class="p">((</span><span class="nv">org-super-agenda-groups</span> <span class="o">'</span><span class="p">((</span><span class="ss">:auto-property</span> <span class="s">"om_project"</span><span class="p">))))</span>
                                             <span class="p">)</span>
                                       <span class="p">(</span><span class="nv">todo</span> <span class="s">"WAIT|SOMEDAY"</span><span class="p">)</span>
                                       <span class="c1">;; (todo "MEMO|ARTICLE")</span>
                                        <span class="p">)</span>
                                       <span class="no">nil</span> <span class="c1">;;</span>
                                       <span class="p">)</span>
                                      <span class="p">(</span><span class="s">"w"</span> <span class="nv">todo</span> <span class="s">"TODO"</span><span class="p">)</span>
                                      <span class="p">)</span>
        <span class="p">)</span>
  <span class="c1">;; ディレクトリ構成に基づいて org-agenda-files と search-extra-files を構築</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">base-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">my:d:org</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">current-year</span> <span class="p">(</span><span class="nv">format-time-string</span> <span class="s">"%Y"</span><span class="p">))</span>
         <span class="c1">;; --- ディレクトリ定義 ---</span>
         <span class="p">(</span><span class="nv">journal-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"journal/"</span> <span class="nv">base-dir</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">mstdn-dir</span>   <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"mstdn/"</span> <span class="nv">base-dir</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">twitter-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"twitter/"</span> <span class="nv">base-dir</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">redmine-arch-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"redmine_archive/"</span> <span class="nv">base-dir</span><span class="p">))</span>
         <span class="c1">;; --- 1. ファイルリストの取得 ---</span>
         <span class="c1">;; Root: 全ての .org ファイル (Gcal, Redmine現行, Archiveなど)</span>
         <span class="c1">;; NOTE: ディレクトリ自身 (. や ..) は除外される</span>
         <span class="p">(</span><span class="nv">root-files</span> <span class="p">(</span><span class="nv">directory-files</span> <span class="nv">base-dir</span> <span class="no">t</span> <span class="s">"\\.org$"</span><span class="p">))</span>
         <span class="c1">;; Journal: 今年と全ファイル(分ける必要は無いかも)</span>
         <span class="p">(</span><span class="nv">journal-current</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"%s.org"</span> <span class="nv">current-year</span><span class="p">)</span> <span class="nv">journal-dir</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">journal-all</span>     <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">journal-dir</span><span class="p">)</span>
                               <span class="p">(</span><span class="nv">directory-files</span> <span class="nv">journal-dir</span> <span class="no">t</span> <span class="s">"^[0-9]+\\.org$"</span><span class="p">)))</span>
         <span class="c1">;; Mastodon: 今年と全ファイル</span>
         <span class="p">(</span><span class="nv">mstdn-current</span>   <span class="p">(</span><span class="nv">expand-file-name</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"mstdn-%s.org"</span> <span class="nv">current-year</span><span class="p">)</span> <span class="nv">mstdn-dir</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">mstdn-all</span>       <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">mstdn-dir</span><span class="p">)</span>
                               <span class="p">(</span><span class="nv">directory-files</span> <span class="nv">mstdn-dir</span> <span class="no">t</span> <span class="s">"^mstdn-.*\\.org$"</span><span class="p">)))</span>
         <span class="c1">;; Twitter: 全過去ログ (検索のみ)</span>
         <span class="p">(</span><span class="nv">twitter-all</span>     <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">twitter-dir</span><span class="p">)</span>
                               <span class="p">(</span><span class="nv">directory-files</span> <span class="nv">twitter-dir</span> <span class="no">t</span> <span class="s">"\\.org$"</span><span class="p">)))</span>
         <span class="c1">;; Redmine Archive: 全過去ログ (検索のみ)</span>
         <span class="p">(</span><span class="nv">redmine-archives</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">redmine-arch-dir</span><span class="p">)</span>
                                <span class="p">(</span><span class="nv">directory-files</span> <span class="nv">redmine-arch-dir</span> <span class="no">t</span> <span class="s">"\\.org$"</span><span class="p">)))</span>
         <span class="c1">;; 除外対象: ルートにある Archive.org</span>
         <span class="p">(</span><span class="nv">archive-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Archive.org"</span> <span class="nv">base-dir</span><span class="p">))</span>
         <span class="c1">;; 作業用リスト</span>
         <span class="nv">my:agenda-list</span>
         <span class="nv">my:search-list</span><span class="p">)</span>
    <span class="c1">;; ==========================================================</span>
    <span class="c1">;; A. org-agenda-files (アジェンダ用: 現在・未来・TODO)</span>
    <span class="c1">;; ==========================================================</span>
    <span class="c1">;; 1. ルートのファイルをベースにする (ここには Gcal, Redmine現行が含まれる)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">my:agenda-list</span> <span class="nv">root-files</span><span class="p">)</span>
    <span class="c1">;; 2. Archive.org をリストから削除 (破壊的操作だがローカル変数なのでOK)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">my:agenda-list</span> <span class="p">(</span><span class="nb">delete</span> <span class="nv">archive-file</span> <span class="nv">my:agenda-list</span><span class="p">))</span>
    <span class="c1">;; 3. 全ての Journal を追加 (ファイルが存在する場合のみ)</span>
    <span class="c1">;; (when (file-exists-p journal-current)</span>
    <span class="c1">;;   (add-to-list 'my:agenda-list journal-current))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">journal-all</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">my:agenda-list</span> <span class="p">(</span><span class="nb">append</span> <span class="nv">my:agenda-list</span> <span class="nv">journal-all</span><span class="p">)))</span>
    <span class="c1">;; 4. 今年の Mastodon を追加 (ファイルが存在する場合のみ)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">mstdn-current</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">push</span> <span class="nv">mstdn-current</span> <span class="nv">my:agenda-list</span><span class="p">))</span>
    <span class="c1">;; グローバル変数へ適用</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">org-agenda-files</span> <span class="nv">my:agenda-list</span><span class="p">)</span>
    <span class="c1">;; ==========================================================</span>
    <span class="c1">;; B. org-agenda-text-search-extra-files (検索用: 過去ログ・アーカイブ)</span>
    <span class="c1">;; ==========================================================</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">my:search-list</span>
          <span class="p">(</span><span class="nb">append</span>
           <span class="c1">;; 1. Archive.org</span>
           <span class="p">(</span><span class="nb">list</span> <span class="nv">archive-file</span><span class="p">)</span>
           <span class="c1">;; 2. Twitter ログ全て</span>
           <span class="nv">twitter-all</span>
           <span class="c1">;; 3. Redmine Archives 全て</span>
           <span class="nv">redmine-archives</span>
           <span class="c1">;; 4. 過去の Journal (全リストから今年を除去)</span>
           <span class="p">(</span><span class="nb">remove</span> <span class="nv">journal-current</span> <span class="nv">journal-all</span><span class="p">)</span>
           <span class="c1">;; 5. 過去の Mastodon (全リストから今年を除去)</span>
           <span class="p">(</span><span class="nb">remove</span> <span class="nv">mstdn-current</span> <span class="nv">mstdn-all</span><span class="p">)))</span>
    <span class="c1">;; グローバル変数へ適用 (実在するファイルのみフィルタリング)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">org-agenda-text-search-extra-files</span>
          <span class="p">(</span><span class="nv">seq-filter</span> <span class="ss">'file-exists-p</span> <span class="nv">my:search-list</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org6a1d2f0c">OrgとGoogle カレンダーの連携: <code>org-gcal</code>
</h3>
<div class="outline-text-3" id="text-org6a1d2f0c">
<p>
request token 等の置き場所の変更
実際の情報等は <code>password-store</code> を使って設定しておく.
ついでに agenda 表示の際の色付けを設定．
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-gcal</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"curl"</span><span class="p">)))</span>
  <span class="ss">:pl-setq</span> <span class="p">(</span><span class="nv">org-gcal-client-id</span>
            <span class="nv">org-gcal-client-secret</span>
            <span class="nv">org-gcal-file-alist</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">org-gcal-reload-client-id-secret</span><span class="p">)</span>
  <span class="ss">:preface</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-gcal-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-gcal"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">org-gcal-dir</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">org-gcal-dir</span><span class="p">))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">oauth2-auto</span>
    <span class="c1">;; 🤔</span>
    <span class="ss">:init</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">oauth2-auto-plstore</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"oauth2-auto.plist"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-generic-id</span>
    <span class="ss">:init</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">org-generic-id-locations-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-generic-id-locations"</span>  <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">request-deferred</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">request</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:preface</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">request-storage-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"request"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">request-storage-directory</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">request-storage-directory</span><span class="p">))</span>
    <span class="c1">;; :config</span>
    <span class="c1">;; (setq request-storage-directory (expand-file-name "request" my:d:tmp))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">persist</span>
    <span class="ss">:ensure</span> <span class="no">t</span>
    <span class="ss">:preface</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">persist--directory-location</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"persist"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">persist--directory-location</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">persist--directory-location</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="c1">;; suppress warning</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-gcal-client-id</span> <span class="s">"temp"</span>
        <span class="nv">org-gcal-client-secret</span> <span class="s">"temp"</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-gcal-dir</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-gcal"</span> <span class="nv">my:d:tmp</span><span class="p">)</span> <span class="c1">;; preface で設定済?</span>
        <span class="nv">org-gcal-token-file</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-gcal/org-gcal-token"</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">org-gcal-down-days</span> <span class="mi">180</span>  <span class="c1">;; 未来 180 日</span>
        <span class="nv">org-gcal-up-days</span> <span class="mi">60</span>  <span class="c1">;; 過去 30 日</span>
        <span class="nv">org-gcal-auto-archive</span> <span class="no">t</span>
        <span class="nv">org-gcal-notify-p</span> <span class="no">nil</span>
        <span class="nv">org-gcal-remove-api-cancelled-evetnts</span> <span class="no">t</span>
        <span class="nv">org-gcal-remove-events-with-cancelled-todo</span> <span class="no">t</span>
        <span class="nv">org-gcal-remove-api-cancelled-events</span>  <span class="no">t</span>
        <span class="nv">alert-log-messages</span> <span class="no">t</span>
        <span class="nv">alert-default-style</span> <span class="ss">'libnotify</span>
        <span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">oauth2-auto-additional-providers-alist</span>
          <span class="p">(</span><span class="nv">assq-delete-all</span> <span class="ss">'org-gcal</span> <span class="nv">oauth2-auto-additional-providers-alist</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">org-gcal-reload-client-id-secret</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org5908f7b5">OrgとRedmine の連携: <code>orgmine</code>
</h3>
<div class="outline-text-3" id="text-org5908f7b5">
<p>
素晴しい!!
<a href="https://github.com/kametoku/orgmine">kametoku/orgmine: Emacs minor mode for org-mode with redmine integration</a>
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">*orgmine</span>
  <span class="ss">:if</span>  <span class="p">(</span><span class="nb">and</span> <span class="nv">my:d:password-store</span>
            <span class="p">(</span><span class="nv">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">))</span>
  <span class="ss">:hook</span>
  <span class="o">`</span><span class="p">(</span><span class="nv">org-mode-hook</span>
    <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">assoc</span> <span class="s">"om_server"</span> <span class="nv">org-keyword-properties</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">orgmine-mode</span><span class="p">))))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">enable-local-variables</span> <span class="ss">:safe</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">elmine</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="c1">;; (add-hook 'org-mode-hook</span>
  <span class="c1">;;           (lambda ()</span>
  <span class="c1">;;             (if (assoc "om_server" org-file-properties) (orgmine-mode))))</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">orgmine</span>
    <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/kametoku/orgmine"</span> <span class="p">)</span>
    <span class="ss">:commands</span> <span class="p">(</span><span class="nv">orgmine-mode</span><span class="p">)</span>
    <span class="ss">:init</span>
    <span class="c1">;; (defun my:orgmine-default-todo-keyword ()</span>
    <span class="c1">;;   "Custom: use `org-file-properties' for backward compatibility."</span>
    <span class="c1">;;   (or (cdr (assoc-string "om_default_todo" org-file-properties))</span>
    <span class="c1">;;       orgmine-default-todo-keyword</span>
    <span class="c1">;;       (nth 0 org-todo-keywords-1)</span>
    <span class="c1">;;       1))</span>

    <span class="c1">;; (defun my:orgmine-setup ()</span>
    <span class="c1">;;   "Custom: use `org-file-properties' for backward compatibility."</span>
    <span class="c1">;;   (let* ((server (cdr (assoc-string "om_server" org-file-properties t)))</span>
    <span class="c1">;;          (config (cdr (assoc-string server orgmine-servers t))))</span>
    <span class="c1">;;     (if config</span>
    <span class="c1">;;         (set (make-local-variable 'orgmine-server) server))</span>
    <span class="c1">;;     (mapc (lambda (elem)</span>
    <span class="c1">;;             (let* ((key (car elem))</span>
    <span class="c1">;;                 (symbol (intern (format "orgmine-%s" key)))</span>
    <span class="c1">;;                 (value (cdr elem)))</span>
    <span class="c1">;;               (if (memq key orgmine-valid-variables)</span>
    <span class="c1">;;                (progn</span>
    <span class="c1">;;                  (set (make-local-variable symbol) value)</span>
    <span class="c1">;;                  (if (eq key 'custom-fields)</span>
    <span class="c1">;;                      (orgmine-setup-custom-fields value)))</span>
    <span class="c1">;;              (message "orgmine-setup: %s: skipped - invalid name" key))))</span>
    <span class="c1">;;           config))</span>
    <span class="c1">;;   (orgmine-setup-tags)</span>
    <span class="c1">;;   (run-hooks 'orgmine-setup-hook))</span>
    <span class="c1">;; :advice</span>
    <span class="c1">;; '((:override orgmine-default-todo-keyword my:orgmine-default-todo-keyword)</span>
    <span class="c1">;;   (:override orgmine-setup my:orgmine-setup))</span>
    <span class="ss">:pl-setq</span> <span class="nv">orgmine-servers</span>
    <span class="ss">:config</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">orgmine-note-block-begin</span> <span class="s">"#+begin_src gfm"</span>   <span class="c1">;; 要調整</span>
          <span class="nv">orgmine-note-block-end</span>   <span class="s">"#+end_src\n"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org5f8d1640">Org-Wiki</h3>
<div class="outline-text-3" id="text-org5f8d1640">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">org-wiki</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/Public/cc-env"</span><span class="p">)</span>
  <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/uwabami/org-wiki"</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-wiki-location-alist</span>     <span class="o">'</span><span class="p">(</span><span class="s">"~/Public/cc-env"</span><span class="p">)</span>
        <span class="nv">org-wiki-location</span>           <span class="s">"~/Public/cc-env"</span>
        <span class="nv">org-wiki-publish-relative</span>   <span class="no">t</span>
        <span class="nv">org-wiki-publish-root</span>       <span class="s">"{{site.url}}/cc-env"</span>
        <span class="nv">org-wiki-completing-backend</span> <span class="ss">'completing-read</span>
        <span class="nv">org-wiki-template</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">"#+TITLE: %n\n"</span>
                                  <span class="s">"#+date: 20\n"</span>
                                  <span class="s">"#+LAYOUT: default\n"</span>
                                  <span class="s">"#+PREMALINK: /cc-env/%n.html\n"</span>
                                  <span class="s">"#+options: auto-id:nil\n"</span>
                                  <span class="s">"#+REF: cc-env/%n\n"</span>
                                  <span class="s">"Related [[wiki:index][Index]] [[~/Public/cc-env/index.org::#orge0707863][Debian]]\n"</span>
                                  <span class="s">"* %n\n"</span>
                                  <span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org54ab7934">Org-Export</h3>
<div class="outline-text-3" id="text-org54ab7934">
</div>
<div>
<h4 id="org06031219">全般設定</h4>
<div class="outline-text-4" id="text-org06031219">
<p>
latex, beamer,jekyll(後述) のみを有効に.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox</span>
  <span class="ss">:preface</span>
  <span class="c1">;; 空行の削除</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:remove-org-newlines-at-cjk-text</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">_mode</span><span class="p">)</span>
    <span class="s">"先頭が '*', '#', '|' でなく、改行の前後が日本の文字の場合は改行を除去"</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">re-search-forward</span> <span class="s">"^\\([^|#*\n].+\\)\\(.\\)\n *\\(.\\)"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
      <span class="c1">;; &lt; &lt;</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">string-to-char</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">2</span><span class="p">))</span> <span class="m">#x2000</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">string-to-char</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">3</span><span class="p">))</span> <span class="m">#x2000</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">replace-match</span> <span class="s">"\\1\\2\\3"</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">line-beginning-position</span><span class="p">))))</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-export-backends</span>             <span class="o">'</span><span class="p">(</span><span class="c1">;; remove somve built-in</span>
                                          <span class="c1">;; html</span>
                                          <span class="nv">jekyll</span>
                                          <span class="nv">latex</span>
                                          <span class="nv">beamer</span><span class="p">)</span>
        <span class="nv">org-export-with-toc</span>             <span class="no">nil</span>
        <span class="nv">org-export-with-section-numbers</span> <span class="no">nil</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="orgd48f8f82">
<span class="todo TODO">TODO</span> Jekyll, HTML</h4>
<div class="outline-text-4" id="text-orgd48f8f82">
<p>
Web サイトは Jekyll で作成しています.
以前は org file を直接 jekyll で処理していましたが,
最近は org を html に export して, それを処理する様にしています.
</p>

<ul class="org-ul">
<li class="off">
<code>[ ]</code> finalized の呼び出しがダサいので整理すること!</li>
</ul>

<p>
exporter は <a href="https://uwabami.github.com/ox-jekyll">uwabami/ox-jekyll</a> にあります.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-jekyll</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/Public/cc-env"</span><span class="p">)</span>
  <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/uwabami/ox-jekyll"</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-html</span>
  <span class="ss">:after</span> <span class="nv">ox</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">s</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-html-table-align-individual-fields</span> <span class="no">nil</span>
        <span class="nv">org-html-table-default-attributes</span>      <span class="no">nil</span>
        <span class="nv">org-html-html5-fancy</span>                   <span class="no">t</span>
        <span class="nv">org-html-doctype</span>                       <span class="s">"html5"</span>
        <span class="nv">org-html-inline-image-rules</span>           <span class="o">'</span><span class="p">((</span><span class="s">"file"</span>  <span class="o">.</span> <span class="s">"\\.\\(jpeg\\|jpg\\|png\\|gif\\|webp\\|svg\\)\\'"</span><span class="p">)</span>
                                                <span class="p">(</span><span class="s">"http"</span>  <span class="o">.</span> <span class="s">"\\.\\(jpeg\\|jpg\\|png\\|gif\\|webp\\|svg\\)\\'"</span><span class="p">)</span>
                                                <span class="p">(</span><span class="s">"https"</span> <span class="o">.</span> <span class="s">"\\.\\(jpeg\\|jpg\\|png\\|gif\\|webp\\|svg\\)\\'"</span><span class="p">))</span>
        <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized1</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="k">ignore</span> <span class="nv">info</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">require</span> <span class="ss">'s</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">s-replace</span>
       <span class="p">(</span><span class="nb">format</span> <span class="s">"&lt;a href=\"file://%sREADME.html"</span>
               <span class="p">(</span><span class="nv">expand-file-name</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
       <span class="s">"&lt;a href=\"{{baseurl}}/cc-env/Emacs.html"</span>
       <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized2</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="k">ignore</span> <span class="nv">info</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">require</span> <span class="ss">'s</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">s-replace</span>
       <span class="p">(</span><span class="nb">format</span> <span class="s">"&lt;a href=\"file://%s"</span>
               <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"Public/"</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)))</span>
       <span class="s">"&lt;a href=\"{{site.url}}/"</span>
       <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized3</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="k">ignore</span> <span class="nv">info</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">" id=\"outline-container-org.+\" class=\"outline-.+\""</span>
       <span class="s">""</span> <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized4</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="k">ignore</span> <span class="nv">info</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">"&lt;a id=\"org.+?\"&gt;&lt;/a&gt;"</span>
       <span class="s">""</span> <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized5</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="k">ignore</span> <span class="nv">info</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">"&lt;pre class=\"example\" id=\".+?\"&gt;"</span>
       <span class="s">"&lt;pre class=\"example\"&gt;"</span> <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-jekyll-finalized6</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Replace some URL"</span>
    <span class="p">(</span><span class="k">ignore</span> <span class="nv">info</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">'jekyll</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
       <span class="s">"&lt;figure id=\".+?\"&gt;"</span>
       <span class="s">"&lt;figure&gt;"</span> <span class="nv">contents</span><span class="p">)))</span>
  <span class="c1">;; 整理しないと...</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span> <span class="ss">'my:org-wiki-jekyll-finalized1</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span> <span class="ss">'my:org-wiki-jekyll-finalized2</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span> <span class="ss">'my:org-wiki-jekyll-finalized3</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span> <span class="ss">'my:org-wiki-jekyll-finalized4</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span> <span class="ss">'my:org-wiki-jekyll-finalized5</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-filter-body-functions</span> <span class="ss">'my:org-wiki-jekyll-finalized6</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="org4d9c6533">LaTeX, Beamer</h4>
<div class="outline-text-4" id="text-org4d9c6533">
<p>
LaTeX 関連
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-latex</span>
  <span class="ss">:after</span> <span class="nv">ox</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">oc-natbib</span> <span class="ss">:after</span> <span class="nv">ox</span> <span class="ss">:require</span> <span class="no">t</span><span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-latex-default-class</span> <span class="s">"my:uplatex"</span>
        <span class="nv">org-latex-pdf-process</span>   <span class="o">'</span><span class="p">(</span><span class="s">"latexmk -r ~/.latexmkrc -pdfdvi -recorder -output-directory='%o' %f"</span><span class="p">)</span>
        <span class="nv">org-latex-compiler</span>      <span class="s">"latexmk"</span>
        <span class="nv">org-latex-listings</span>      <span class="ss">'minted</span>
        <span class="nv">org-latex-minted-options</span> <span class="o">'</span><span class="p">((</span><span class="s">"frame"</span> <span class="s">"lines"</span><span class="p">)</span>
                                   <span class="p">(</span><span class="s">"framesep=2mm"</span><span class="p">)</span>
                                   <span class="p">(</span><span class="s">"linenos=true"</span><span class="p">)</span>
                                   <span class="p">(</span><span class="s">"baselinestretch=1.2"</span><span class="p">)</span>
                                   <span class="p">(</span><span class="s">"breaklines"</span><span class="p">))</span>
        <span class="nv">org-latex-default-packages-alist</span>  <span class="o">'</span><span class="p">((</span><span class="s">"utf8"</span> <span class="s">"inputenc"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="c1">;; ("prefernoncjk" "pxcjkcat" t nil)</span>
                                            <span class="p">(</span><span class="s">"T1"</span> <span class="s">"fontenc"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"graphicx"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">"normalem"</span> <span class="s">"ulem"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">;; udline に変更すべきかな?</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"amsmath"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"amssymb"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"physics"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="c1">;; ("" "siunitx" t nil)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"hyperref"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"multirow"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"ltablex"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"wrapfig"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"silence"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">(</span><span class="s">""</span> <span class="s">"arydshln"</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
                                            <span class="p">)</span>
        <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-format-latex-header</span> <span class="s">"\\documentclass[dvipdfmx]{standalone}
\\usepackage[usenames]{color}
\\usepackage{pgfplots}
\\usepgfplotslibrary{fillbetween,patchplots}
\\pgfplotsset{compat=newest}
\\usepackage{tikz}
\\usetikzlibrary{intersections,calc,arrows,arrows.meta,decorations.markings,fadings,decorations.pathreplacing,patterns}
\\definecolor{cud_blue}{HTML}{005aff}
\\definecolor{cud_green}{HTML}{03af7a}
\\definecolor{cud_orange}{HTML}{f6aa00}
\\definecolor{cud_red}{HTML}{ff4b00}
\\definecolor{cud_yellow}{HTML}{fff100}
\\definecolor{cud_cyan}{HTML}{4dc4ff}
\\definecolor{cud_pink}{HTML}{ff8082}
\\definecolor{cud_purple}{HTML}{990099}
\\definecolor{cud_brown}{HTML}{804000}
\\definecolor{cud_lightgrey}{HTML}{c8c8cb}
\\definecolor{cud_grey}{HTML}{84919e}
\\definecolor{blackblue}{HTML}{2C3E50}
\\def\\pgfsysdriver{pgfsys-dvipdfmx.def}
\[PACKAGES]
\[DEFAULT-PACKAGES]"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-latex-hyperref-template</span> <span class="s">"\\hypersetup{
pdfauthor={%a},
pdftitle={%t},
pdfkeywords={%k},
pdfsubject={%s},
pdfcreator={%c},
pdflang={%l}}
"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-latex-classes</span> <span class="o">'</span><span class="p">((</span><span class="s">"my:uplatex"</span>
                             <span class="s">"\\RequirePackage{plautopatch}\n\\documentclass[a4paper,uplatex,dvipdfmx]{jsarticle}\n\\plautopatchdisable{eso-pic}\n\\ifdefined\\endofdump\\else\\let\\endofdump\\relax\\fi
            [DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
                             <span class="p">(</span><span class="s">"\\section\{%s\}"</span> <span class="o">.</span> <span class="s">"\\section*\{%s\}"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsection*\{%s\}"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsubsection\{%s\}"</span> <span class="o">.</span> <span class="s">"\\subsubsection*\{%s\}"</span><span class="p">))</span>
                            <span class="p">(</span><span class="s">"my:beamer"</span>
                             <span class="s">"\\RequirePackage{plautopatch}\n\\documentclass[dvipdfmx,c,presentation]{beamer}\n\\plautopatchdisable{eso-pic}\n\\ifdefined\\endofdump\\else\\let\\endofdump\\relax\\fi
            [DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
                             <span class="p">(</span><span class="s">"\\section\{%s\}"</span> <span class="o">.</span> <span class="s">"%% %s"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsection\{%s\}"</span> <span class="o">.</span> <span class="s">"%% %s"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsubsection\{%s\}"</span> <span class="o">.</span> <span class="s">"%% %s"</span><span class="p">))</span>
                            <span class="p">(</span><span class="s">"my:beamer169"</span>
                             <span class="s">"\\RequirePackage{plautopatch}\n\\documentclass[dvipdfmx,c,presentation,aspectratio=169]{beamer}\n\\plautopatchdisable{eso-pic}\n\\ifdefined\\endofdump\\else\\let\\endofdump\\relax\\fi
            [DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
                             <span class="p">(</span><span class="s">"\\section\{%s\}"</span> <span class="o">.</span> <span class="s">"%% %s"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsection\{%s\}"</span> <span class="o">.</span> <span class="s">"%% %s"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsubsection\{%s\}"</span> <span class="o">.</span>  <span class="s">"%% %s"</span><span class="p">))</span>
                            <span class="p">(</span><span class="s">"my:lualatex:beamer"</span>
                             <span class="s">"\\documentclass[dvipdfmx,c,presentation,aspectratio=169]{beamer}
            [DEFAULT-PACKAGES] [NO-PACKAGES] [NO-EXTRA]"</span>
                             <span class="p">(</span><span class="s">"\\section\{%s\}"</span> <span class="o">.</span> <span class="s">"%% %s"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsection\{%s\}"</span> <span class="o">.</span> <span class="s">"%% %s"</span><span class="p">)</span>
                             <span class="p">(</span><span class="s">"\\subsubsection\{%s\}"</span> <span class="o">.</span>  <span class="s">"%% %s"</span><span class="p">))</span>
                            <span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<p>
Beamer 関連: <code>SHORT</code> 系を追加している
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-beamer</span>
  <span class="ss">:after</span> <span class="nv">ox-latex</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-beamer-frame-level</span> <span class="mi">2</span>
        <span class="nv">org-beamer-frame-default-options</span> <span class="s">"fragile"</span>
    <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="ss">:shortdate</span>      <span class="s">"SHORT_DATE"</span>      <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="ss">:shorttitle</span>     <span class="s">"SHORT_TITLE"</span>     <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="ss">:shortauthor</span>    <span class="s">"SHORT_AUTHOR"</span>    <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="ss">:institute</span>      <span class="s">"INSTITUTE"</span>       <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="ss">:shortinstitute</span> <span class="s">"SHORT_INSTITUTE"</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'org-export-options-alist</span>
               <span class="o">'</span><span class="p">(</span><span class="ss">:outlinetitle</span>   <span class="s">"OUTLINE_TITLE"</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
  <span class="c1">;; customize</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-beamer-template</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
    <span class="s">"Custom: support shortdate, shorttile, shortauthor, institute for beamer export"</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">title</span> <span class="p">(</span><span class="nv">org-export-data</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:title</span><span class="p">)</span> <span class="nv">info</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">subtitle</span> <span class="p">(</span><span class="nv">org-export-data</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:subtitle</span><span class="p">)</span> <span class="nv">info</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">concat</span>
       <span class="c1">;; Time-stamp.</span>
       <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:time-stamp-file</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">format-time-string</span> <span class="s">"%% Created %Y-%m-%d %a %H:%M\n"</span><span class="p">))</span>
       <span class="c1">;; LaTeX compiler</span>
       <span class="p">(</span><span class="nv">org-latex--insert-compiler</span> <span class="nv">info</span><span class="p">)</span>
       <span class="c1">;; Document class and packages.</span>
       <span class="p">(</span><span class="nv">org-latex-make-preamble</span> <span class="nv">info</span><span class="p">)</span>
       <span class="c1">;; Insert themes.</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">format-theme</span>
              <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">prop</span> <span class="nv">command</span><span class="p">)</span>
                <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">theme</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="nv">prop</span><span class="p">)))</span>
                  <span class="p">(</span><span class="nb">when</span> <span class="nv">theme</span>
                    <span class="p">(</span><span class="nv">concat</span> <span class="nv">command</span>
                            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">"\\[.*\\]"</span> <span class="nv">theme</span><span class="p">))</span>
                                <span class="p">(</span><span class="nb">format</span> <span class="s">"{%s}\n"</span> <span class="nv">theme</span><span class="p">)</span>
                              <span class="p">(</span><span class="nb">format</span> <span class="s">"%s{%s}\n"</span>
                                      <span class="p">(</span><span class="nv">match-string</span> <span class="mi">0</span> <span class="nv">theme</span><span class="p">)</span>
                                      <span class="p">(</span><span class="nv">org-trim</span>
                                       <span class="p">(</span><span class="nv">replace-match</span> <span class="s">""</span> <span class="no">nil</span> <span class="no">nil</span> <span class="nv">theme</span><span class="p">))))))))))</span>
         <span class="p">(</span><span class="nv">mapconcat</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">args</span><span class="p">)</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">format-theme</span> <span class="nv">args</span><span class="p">))</span>
                    <span class="o">'</span><span class="p">((</span><span class="ss">:beamer-theme</span> <span class="s">"\\usetheme"</span><span class="p">)</span>
                      <span class="p">(</span><span class="ss">:beamer-color-theme</span> <span class="s">"\\usecolortheme"</span><span class="p">)</span>
                      <span class="p">(</span><span class="ss">:beamer-font-theme</span> <span class="s">"\\usefonttheme"</span><span class="p">)</span>
                      <span class="p">(</span><span class="ss">:beamer-inner-theme</span> <span class="s">"\\useinnertheme"</span><span class="p">)</span>
                      <span class="p">(</span><span class="ss">:beamer-outer-theme</span> <span class="s">"\\useoutertheme"</span><span class="p">))</span>
                    <span class="s">""</span><span class="p">))</span>
       <span class="c1">;; Possibly limit depth for headline numbering.</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">sec-num</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:section-numbers</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">integerp</span> <span class="nv">sec-num</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">format</span> <span class="s">"\\setcounter{secnumdepth}{%d}\n"</span> <span class="nv">sec-num</span><span class="p">)))</span>
       <span class="c1">;; custom: Author support `shortauthor'</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">author</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:with-author</span><span class="p">)</span>
                          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">auth</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:author</span><span class="p">)))</span>
                            <span class="p">(</span><span class="nb">and</span> <span class="nv">auth</span> <span class="p">(</span><span class="nv">org-export-data</span> <span class="nv">auth</span> <span class="nv">info</span><span class="p">)))))</span>
             <span class="p">(</span><span class="nv">shortauthor</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:shortauthor</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">email</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:with-email</span><span class="p">)</span>
                         <span class="p">(</span><span class="nv">org-export-data</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:email</span><span class="p">)</span> <span class="nv">info</span><span class="p">))))</span>
         <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">and</span> <span class="nv">author</span> <span class="nv">shortauthor</span><span class="p">)</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"\\author[%s]{%s}\n"</span> <span class="nv">shortauthor</span> <span class="nv">author</span><span class="p">))</span>
               <span class="p">((</span><span class="nb">and</span> <span class="nv">author</span> <span class="nv">shortauthor</span> <span class="nv">email</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">string=</span> <span class="s">""</span> <span class="nv">email</span><span class="p">)))</span>
                <span class="p">(</span><span class="nb">format</span> <span class="s">"\\author[%s]{%s\\thanks{%s}}\n"</span> <span class="nv">shortauthor</span> <span class="nv">author</span> <span class="nv">email</span><span class="p">))</span>
               <span class="p">((</span><span class="nb">and</span> <span class="nv">author</span> <span class="nv">email</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">string=</span> <span class="s">""</span> <span class="nv">email</span><span class="p">)))</span>
                <span class="p">(</span><span class="nb">format</span> <span class="s">"\\author{%s\\thanks{%s}}\n"</span> <span class="nv">author</span> <span class="nv">email</span><span class="p">))</span>
               <span class="p">((</span><span class="nb">or</span> <span class="nv">author</span> <span class="nv">email</span><span class="p">)</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"\\author{%s}\n"</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">author</span> <span class="nv">email</span><span class="p">)))))</span>
       <span class="c1">;; custom: Date support `shortdate'</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">date</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:with-date</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-export-get-date</span> <span class="nv">info</span><span class="p">)))</span>
             <span class="p">(</span><span class="nv">shortdate</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:shortdate</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">and</span> <span class="nv">date</span> <span class="nv">shortdate</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">format</span> <span class="s">"\\date[%s]{%s}\n"</span> <span class="nv">shortdate</span> <span class="p">(</span><span class="nv">org-export-data</span> <span class="nv">date</span> <span class="nv">info</span><span class="p">)))</span>
               <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"\\date{%s}\n"</span> <span class="p">(</span><span class="nv">org-export-data</span> <span class="nv">date</span> <span class="nv">info</span><span class="p">)))))</span>
       <span class="c1">;; custom: Title support `shorttitle'</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">shorttitle</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:shorttitle</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">and</span> <span class="nv">title</span> <span class="nv">shorttitle</span><span class="p">)</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"\\title[%s]{%s}\n"</span> <span class="nv">shorttitle</span> <span class="nv">title</span><span class="p">))</span>
               <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"\\title{%s}\n"</span> <span class="nv">title</span><span class="p">))))</span>
       <span class="c1">;; custom: support `institute', `shortinstitute'</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">institute</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:institute</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">shortinstitute</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:shortinstitute</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">and</span> <span class="nv">institute</span> <span class="nv">shortinstitute</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">format</span> <span class="s">"\\institute[%s]{%s}\n"</span> <span class="nv">shortinstitute</span> <span class="nv">institute</span><span class="p">))</span>
               <span class="p">((</span><span class="nb">or</span> <span class="nv">institute</span> <span class="nv">shortinstitute</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">format</span> <span class="s">"\\institute{%s}\n"</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">shortinstitute</span> <span class="nv">institute</span><span class="p">)))))</span>
       <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-string-nw-p</span> <span class="nv">subtitle</span><span class="p">)</span>
         <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nb">format</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:beamer-subtitle-format</span><span class="p">)</span> <span class="nv">subtitle</span><span class="p">)</span> <span class="s">"\n"</span><span class="p">))</span>
       <span class="c1">;; Beamer-header</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">beamer-header</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:beamer-header</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">when</span> <span class="nv">beamer-header</span>
           <span class="p">(</span><span class="nb">format</span> <span class="s">"%s\n"</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:beamer-header</span><span class="p">))))</span>
       <span class="c1">;; 9. Hyperref options.</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">template</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:latex-hyperref-template</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">template</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">format-spec</span> <span class="nv">template</span> <span class="p">(</span><span class="nv">org-latex--format-spec</span> <span class="nv">info</span><span class="p">))))</span>
       <span class="c1">;; Document start.</span>
       <span class="s">"\\begin{document}\n\n"</span>
       <span class="c1">;; Title command.</span>
       <span class="p">(</span><span class="nv">org-element-normalize-string</span>
        <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">not</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:with-title</span><span class="p">))</span> <span class="no">nil</span><span class="p">)</span>
              <span class="p">((</span><span class="nb">string=</span> <span class="s">""</span> <span class="nv">title</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
              <span class="p">((</span><span class="nb">not</span> <span class="p">(</span><span class="nb">stringp</span> <span class="nv">org-latex-title-command</span><span class="p">))</span> <span class="no">nil</span><span class="p">)</span>
              <span class="p">((</span><span class="nv">string-match</span> <span class="s">"\\(?:[^%]\\|^\\)%s"</span>
                             <span class="nv">org-latex-title-command</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">format</span> <span class="nv">org-latex-title-command</span> <span class="nv">title</span><span class="p">))</span>
              <span class="p">(</span><span class="no">t</span> <span class="nv">org-latex-title-command</span><span class="p">)))</span>
       <span class="c1">;; Table of contents.</span>
       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">depth</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:with-toc</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">when</span> <span class="nv">depth</span>
           <span class="p">(</span><span class="nv">concat</span>
            <span class="p">(</span><span class="nb">format</span> <span class="s">"\\begin{frame}%s{%s}\n"</span>
                    <span class="p">(</span><span class="nv">org-beamer--normalize-argument</span>
                     <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:beamer-outline-frame-options</span><span class="p">)</span> <span class="ss">'option</span><span class="p">)</span>
                    <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:outlinetitle</span><span class="p">)</span>
                           <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:outlinetitle</span><span class="p">))</span>
                          <span class="p">(</span><span class="no">t</span>
                           <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:beamer-outline-frame-title</span><span class="p">)))</span>
                    <span class="p">)</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">wholenump</span> <span class="nv">depth</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">format</span> <span class="s">"\\setcounter{tocdepth}{%d}\n"</span> <span class="nv">depth</span><span class="p">))</span>
            <span class="s">"\\tableofcontents\n"</span>
            <span class="s">"\\end{frame}\n\n"</span><span class="p">)))</span>
       <span class="c1">;; Document's body.</span>
       <span class="nv">contents</span>
       <span class="c1">;; Creator.</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:with-creator</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">plist-get</span> <span class="nv">info</span> <span class="ss">:creator</span><span class="p">)</span> <span class="s">"\n"</span><span class="p">)</span>
         <span class="s">""</span><span class="p">)</span>
       <span class="c1">;; Document end.</span>
       <span class="s">"\\end{document}"</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="ss">:advice</span> <span class="p">((</span><span class="ss">:override</span> <span class="nv">org-beamer-template</span>
                      <span class="nv">my:org-beamer-template</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h4 id="orge77c5c82">Publish</h4>
<div class="outline-text-4" id="text-orge77c5c82">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">ox-publish</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">file-directory-p</span> <span class="s">"~/Public/cc-env"</span><span class="p">)</span>
  <span class="ss">:after</span> <span class="p">(</span><span class="nv">ox-jekyll</span> <span class="nv">org-wiki</span><span class="p">)</span>
  <span class="ss">:commands</span> <span class="nv">my:org-wiki-publish</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-publish-timestamp-directory</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">"org-timestamps/"</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:org-wiki-publish</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-publish</span> <span class="p">(</span><span class="nv">org-wiki-make-org-publish-plist</span>
                  <span class="ss">'org-jekyll-publish-to-html</span><span class="p">)</span>
                 <span class="no">t</span><span class="p">))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
</div>
<div>
<h2 id="org9992a617">
<span class="todo SOMEDAY">SOMEDAY</span> 日記: <code>tDiary</code> <code>[0/1]</code>
</h2>
<div class="outline-text-2" id="text-org9992a617">
<ul class="org-ul">
<li class="off">
<code>[ ]</code> org2blog で tDiary を更新できないか妄想している</li>
</ul>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">tdiary-mode</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nv">file-directory-p</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)</span> <span class="s">"/Nextcloud/tdiary"</span><span class="p">)))</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">tdiary-mode</span> <span class="nv">tdiary-replace</span> <span class="nv">tdiary-append</span> <span class="nv">tdiary-passwd-file-load</span><span class="p">)</span>
  <span class="ss">:defvar</span> <span class="p">(</span><span class="nv">tdiary-csrf-key</span> <span class="nv">tdiary-passwd-file</span> <span class="nv">tdiary-passd-file</span><span class="p">)</span>
  <span class="ss">:pl-setq</span> <span class="p">(</span><span class="nv">tdiary-csrf-key</span> <span class="nv">tdiary-passwd-file</span><span class="p">)</span>
  <span class="ss">:vc</span> <span class="p">(</span><span class="ss">:url</span> <span class="s">"https://github.com/uwabami/tdiary-mode"</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">tdiary-text-directory</span> <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">getenv</span> <span class="s">"HOME"</span><span class="p">)</span> <span class="s">"/Nextcloud/tdiary/"</span><span class="p">)</span>
        <span class="nv">tdiary-diary-list</span> <span class="o">'</span><span class="p">((</span><span class="s">"log"</span> <span class="s">"https://uwabami.junkhub.org/log/"</span><span class="p">))</span>
        <span class="nv">tdiary-style-mode</span> <span class="ss">'org-mode</span>
        <span class="nv">tdiary-text-suffix</span> <span class="s">".org"</span>
        <span class="nv">tdiary-http-timeout</span> <span class="mi">100</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">tdiary-passwd-file-load</span><span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orga28ad005">その他のモード設定</h2>
<div class="outline-text-2" id="text-orga28ad005">
<p>
ほぼ読み込むだけの mode の設定. 設定が増えたら別途まとめる。
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">fill-column-indicator</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">git-commit-mode</span> <span class="o">.</span> <span class="nv">fci-mode</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="p">)</span>
<span class="c1">;;;</span>
<span class="c1">;; (leaf hideshow</span>
<span class="c1">;;   :bind (:f90-mode-map</span>
<span class="c1">;;          ("TAB" . my:f90-hs-smart-tab)</span>
<span class="c1">;;          )</span>
<span class="c1">;;   :hook (f90-mode-hook . hs-minor-mode)</span>
<span class="c1">;;   :preface</span>
<span class="c1">;; ;;;###autoload</span>
<span class="c1">;; (defun my:f90-hs-smart-tab ()</span>
<span class="c1">;;   "インデントを行い、変化がなければ hideshow のトグルを試みる。"</span>
<span class="c1">;;   (interactive)</span>
<span class="c1">;;   (let ((prev-indent (current-indentation)))</span>
<span class="c1">;;     ;; まずは標準のインデントを実行</span>
<span class="c1">;;     (indent-for-tab-command)</span>
<span class="c1">;;     ;; インデント幅が変わっていない（既に整形済み）場合のみトグルを試行</span>
<span class="c1">;;     (when (= prev-indent (current-indentation))</span>
<span class="c1">;;       ;; カーソル位置にブロックがなくてもエラーにしない (ignore-errors)</span>
<span class="c1">;;       (ignore-errors</span>
<span class="c1">;;         (hs-toggle-hiding)))))</span>
<span class="c1">;;   :config</span>
<span class="c1">;;   ;;  F90モード用のブロック定義</span>
<span class="c1">;;   ;;  対象: program, module, submodule, subroutine, function</span>
<span class="c1">;;   ;; (add-to-list 'hs-special-modes-alist</span>
<span class="c1">;;   ;;              '(f90-mode</span>
<span class="c1">;;   ;;                "\\_&lt;\\(program\\|module\\|submodule\\|subroutine\\|function\\|interface\\)\\_&gt;"</span>
<span class="c1">;;   ;;                "\\_&lt;end\\_&gt;"</span>
<span class="c1">;;   ;;                "!"</span>
<span class="c1">;;   ;;                f90-end-block</span>
<span class="c1">;;   ;;                nil))</span>
<span class="c1">;;   )</span>
<span class="c1">;; (leaf origami</span>
<span class="c1">;;   :ensure t</span>
<span class="c1">;;   :hook (f90-mode-hook . origami-mode)</span>
<span class="c1">;;   :bind</span>
<span class="c1">;;   (:origami-mode-map</span>
<span class="c1">;;    ("TAB"  . my:origami-toggle-or-indent)</span>
<span class="c1">;;    ("C-c f f" . origami-toggle-node)</span>
<span class="c1">;;    ("C-c @ C-c" . origami-toggle-node)</span>
<span class="c1">;;    ("C-c f a" . origami-toggle-all-nodes)</span>
<span class="c1">;;    ("C-c a C-a" . origami-toggle-all-nodes)</span>
<span class="c1">;;    )</span>
<span class="c1">;;   :preface</span>
<span class="c1">;; ;;;###autoload</span>
<span class="c1">;; (defun my:origami-toggle-or-indent ()</span>
<span class="c1">;;   "Indent line, or toggle folding if already indented."</span>
<span class="c1">;;   (interactive)</span>
<span class="c1">;;   (let ((prev-indent (current-indentation))</span>
<span class="c1">;;         (prev-point  (point)))</span>
<span class="c1">;;     (indent-for-tab-command)</span>
<span class="c1">;;     (when (and (= prev-indent (current-indentation)) ;; &lt;</span>
<span class="c1">;;                (&gt;= (current-indentation) (current-column)))</span>
<span class="c1">;;       ;; origami のトグルを実行</span>
<span class="c1">;;       (origami-toggle-node (current-buffer) (point)))))</span>
<span class="c1">;;   :config</span>
<span class="c1">;;   (add-to-list 'origami-parser-alist</span>
<span class="c1">;;                '(f90-mode . origami-indent-parser)) ;; インデントパーサを使用</span>
<span class="c1">;;   )</span>
<span class="c1">;;</span>
<span class="c1">;;</span>
<span class="c1">;; (leaf hideshow-org :ensure t)</span>
<span class="c1">;; (leaf treesit</span>
<span class="c1">;;   :init</span>
<span class="c1">;;   :config</span>
<span class="c1">;;   (setq treesit-font-lock-level 4)</span>
<span class="c1">;;   )</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">ruby-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">lua-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">ssh-config-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">fish-mode</span> <span class="ss">:ensure</span> <span class="no">t</span> <span class="ss">:mode</span> <span class="s">"\\.fish\\'"</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">rd-mode</span>
  <span class="ss">:mode</span> <span class="s">"\\.rd\\'"</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">rd-mode-hook</span> <span class="o">.</span> <span class="nv">rd-show-other-block-all</span><span class="p">))</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">scss-mode</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="nv">leaf</span> <span class="nv">css-mode</span>
    <span class="ss">:init</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">css-indent-offset</span> <span class="mi">2</span><span class="p">))</span>
  <span class="ss">:mode</span> <span class="s">"\\.sass\\'"</span> <span class="s">"\\.scss\\'"</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">generic-x</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">systemd</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="c1">;; (leaf *misc-mode</span>
<span class="c1">;;   :init</span>
<span class="c1">;;   (leaf systemd :ensure t)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">debian-el</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">debian-bug-download-directory</span> <span class="s">"~/Downloads"</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">yaml-mode</span> <span class="ss">:ensure</span> <span class="no">t</span> <span class="ss">:mode</span> <span class="s">"\\.yml\\'"</span> <span class="s">"\\.yaml\\'"</span><span class="p">)</span>
<span class="c1">;;   (leaf textile-mode :ensure t)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">dpkg-dev-el</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="c1">;;   (leaf sh-mode</span>
<span class="c1">;;     :custom ((system-uses-terminfo . nil))</span>
<span class="c1">;;     )</span>
<span class="c1">;;   (leaf apt-sources-list</span>
<span class="c1">;;     :custom</span>
<span class="c1">;;     ((apt-sources-list-suites</span>
<span class="c1">;;       . '("stable" "stable-backports"</span>
<span class="c1">;;           "testing" "testing-backports"</span>
<span class="c1">;;           "unstable" "experimental"</span>
<span class="c1">;;           "jessie" "jessie-backports"</span>
<span class="c1">;;           "stretch" "stretch-backports"</span>
<span class="c1">;;           "buster" "buster-backports"</span>
<span class="c1">;;           "bullseye" "bullseye-backports"</span>
<span class="c1">;;           "sid")))</span>
<span class="c1">;;     )</span>
<span class="c1">;;   (leaf info-colors</span>
<span class="c1">;;     :ensure t</span>
<span class="c1">;;     :hook</span>
<span class="c1">;;     (Info-selection #'info-colors-fontify-node))</span>
<span class="c1">;;   )</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgbf458527">テーマとモードライン</h2>
<div class="outline-text-2" id="text-orgbf458527">
</div>
<div>
<h3 id="orgbea9b769">
<code>modus-theme</code>: 視認性の良いテーマ</h3>
<div class="outline-text-3" id="text-orgbea9b769">
<p>
Emacs 本体に同梱されるし, 沢山のテーマに対応しているし,
ということで <a href="https://protesilaos.com/emacs/modus-themes">Modus Themes | Protesilaos Stavrou</a> を利用することにした.
</p>

<p>
たた, 元々このテーマはアクセシビリティ対応のテーマでもあるので,
配色がちょっと好みではない.
というわけで, 幾つかの配色の palettte を上書きして
デフォルトの font-lock を(好みに合わせて)入れ替えたり.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">modus-themes</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:bind</span> <span class="p">(</span><span class="s">"&lt;f5&gt;"</span> <span class="o">.</span> <span class="nv">modus-themes-toggle</span><span class="p">)</span>
  <span class="c1">;; autoload が無いので発火点を作成しておく</span>
  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">modus-themes-load-theme</span>
             <span class="nv">modus-themes-with-colors</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">((</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span><span class="p">()</span>
                           <span class="p">(</span><span class="nv">modus-themes-load-theme</span> <span class="ss">'modus-vivendi</span><span class="p">)</span>
                           <span class="p">(</span><span class="nv">load-theme</span> <span class="ss">'modus-vivendi</span> <span class="ss">:no-confirm</span><span class="p">)))</span>
   <span class="p">(</span><span class="nv">modus-themes-after-load-theme-hook</span> <span class="o">.</span> <span class="nv">my:modus-themes-custom-faces</span><span class="p">)</span>
   <span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">modus-themes-custom-auto-reload</span> <span class="no">t</span>
        <span class="nv">modus-themes-disable-other-themes</span> <span class="no">t</span>
        <span class="nv">modus-themes-bold-constructs</span> <span class="no">nil</span>
        <span class="nv">modus-themes-italic-constructs</span> <span class="no">nil</span>
        <span class="nv">modus-themes-mixed-fonts</span> <span class="no">nil</span>
        <span class="nv">modus-themes-prompts</span>     <span class="o">'</span><span class="p">(</span><span class="nv">bold</span> <span class="nv">bold</span><span class="p">)</span>
        <span class="nv">modus-themes-completions</span> <span class="o">'</span><span class="p">((</span><span class="nv">matches</span>   <span class="o">.</span> <span class="p">(</span><span class="nv">bold</span><span class="p">))</span>
                                   <span class="p">(</span><span class="nv">selection</span> <span class="o">.</span> <span class="p">(</span><span class="nv">bold</span> <span class="nv">underline</span><span class="p">)))</span>
        <span class="nv">modus-themes-headings</span>    <span class="o">'</span><span class="p">((</span><span class="no">t</span> <span class="o">.</span> <span class="p">(</span><span class="nv">bold</span><span class="p">)))</span>
        <span class="nv">modus-themes-variable-pitch-ui</span> <span class="no">nil</span>
        <span class="nv">modus-vivendi-palette-overrides</span>
        <span class="o">`</span><span class="p">(</span><span class="c1">;;</span>
          <span class="p">(</span><span class="nv">bg-main</span> <span class="o">,</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">display-graphic-p</span><span class="p">)</span>
                        <span class="s">"#000000"</span>     <span class="c1">; GUIなら背景色</span>
                      <span class="ss">'unspecified</span><span class="p">))</span>  <span class="c1">; ターミナルなら色は指定しない</span>
          <span class="c1">;; Basic color override</span>
          <span class="p">(</span><span class="nv">green-cooler</span>   <span class="s">"#bfff7f"</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">green-intense</span>  <span class="s">"#4ceea5"</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">yellow</span>         <span class="s">"#efef00"</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">yellow-warmer</span>  <span class="s">"#ffb347"</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">yellow-intense</span> <span class="s">"#ffff7f"</span><span class="p">)</span>
          <span class="c1">;;</span>
          <span class="p">(</span><span class="nv">orange</span>         <span class="s">"#ff9040"</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">purple</span>         <span class="s">"#d57bff"</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">teal</span>           <span class="s">"#40e0d0"</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">pink</span>           <span class="s">"#ff88e0"</span><span class="p">)</span>
          <span class="c1">;; (bg-hl-line "#556b2f")</span>
          <span class="c1">;; (bg-hl-line "DarkSlateBlue")</span>
          <span class="c1">;;</span>
          <span class="c1">;; Code remapping</span>
          <span class="c1">;;</span>
          <span class="p">(</span><span class="nv">builtin</span> <span class="nv">blue-warmer</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">comment</span> <span class="nv">fg-dim</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">constant</span> <span class="nv">yellow-warmer</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">delimiter</span> <span class="nv">red-warmer</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">docstring</span> <span class="nv">green-intense</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">docmarkup</span> <span class="nv">teal</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fnname</span> <span class="nv">magenta-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fnname-call</span> <span class="nv">pink</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">preprocessor</span> <span class="nv">magenta</span><span class="p">)</span>
          <span class="p">(</span><span class="kt">keyword</span> <span class="nv">red-faint</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">preprocessor</span> <span class="nv">red-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">property</span> <span class="nv">cyan</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">string</span> <span class="nv">cyan-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="k">type</span> <span class="nv">yellow-intense</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">variable</span> <span class="nv">blue</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">variable-use</span> <span class="nv">slate</span><span class="p">)</span>
          <span class="c1">;;</span>
          <span class="p">(</span><span class="nv">rx-construct</span> <span class="nv">blue-faint</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rx-backslash</span> <span class="nv">green-cooler</span><span class="p">)</span>
          <span class="c1">;;</span>
          <span class="c1">;; Org Agenda view</span>
          <span class="c1">;; (date-common fg-alt)</span>
          <span class="c1">;; (date-deadline red-faint)</span>
          <span class="c1">;; (date-event fg-alt)</span>
          <span class="c1">;;</span>
          <span class="c1">;; -----------------------------------------------------------------</span>
          <span class="p">(</span><span class="nv">date-common</span> <span class="nv">fg-alt</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">date-weekday</span> <span class="nv">fg-main</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">date-weekend</span> <span class="nv">red-faint</span><span class="p">)</span>
          <span class="c1">;; headline --------------------------------------------------------</span>
          <span class="p">(</span><span class="nv">fg-heading-0</span> <span class="nv">cyan-intense</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-1</span> <span class="nv">magenta-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-2</span> <span class="nv">blue-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-3</span> <span class="nv">yellow-warmer</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-4</span> <span class="nv">green-faint</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-5</span> <span class="nv">yellow-intense</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-6</span> <span class="nv">red-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-7</span> <span class="nv">magenta-warmer</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">fg-heading-8</span> <span class="nv">orange</span><span class="p">)</span>
          <span class="c1">;; rainbow ---------------------------------------------------------</span>
          <span class="p">(</span><span class="nv">rainbow-0</span> <span class="nv">cyan-intense</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-1</span> <span class="nv">magenta-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-2</span> <span class="nv">blue-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-3</span> <span class="nv">yellow-warmer</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-4</span> <span class="nv">green-faint</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-5</span> <span class="nv">yellow-intense</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-6</span> <span class="nv">red-cooler</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-7</span> <span class="nv">magenta-warmer</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">rainbow-8</span> <span class="nv">orange</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
  <span class="c1">;; -------------------------------------------------------------------------</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:modus-themes-custom-faces</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">_args</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">modus-themes-with-colors</span>
      <span class="p">(</span><span class="nv">custom-set-faces</span>
       <span class="c1">;; vertico</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">vertico-current</span>                                  <span class="p">((</span><span class="no">t</span> <span class="ss">:inherit</span> <span class="nv">hl-line</span> <span class="p">)))</span>
       <span class="c1">;; wanderlust</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-closed-face</span>                  <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">green-cooler</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-few-face</span>                     <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">red-cooler</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-killed-face</span>                  <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-alt</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-many-face</span>                    <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">magenta</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-opened-face</span>                  <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">cyan-cooler</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-unknown-face</span>                 <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">cyan-warmer</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-unread-face</span>                  <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">blue-warmer</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-zero-face</span>                    <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-main</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-citation-header</span>             <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">green-warmer</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-1</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">green-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-2</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">yellow-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-3</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">blue-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-4</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">cyan-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-5</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">magenta-cooler</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-6</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">red-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-7</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">green-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-8</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">yellow-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-9</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">blue-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-cited-text-10</span>               <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">cyan-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-header-contents</span>             <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">magenta-cooler</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-headers</span>                     <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">cyan-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-important-header-contents2</span>  <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">magenta-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-message-signature</span>                   <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-dim</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-answered-face</span>               <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">green-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-deleted-face</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">blue-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-disposed-face</span>               <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-dim</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-flagged-face</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">yellow-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-high-unread-face</span>            <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">red-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-low-unread-face</span>             <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">red-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-normal-face</span>                 <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-main</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-refiled-face</span>                <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">blue-warmer</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-spam-face</span>                   <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">magenta-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-thread-top-face</span>             <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-main</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-unread-face</span>                 <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-main</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-new-face</span>                    <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">red-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-summary-displaying-face</span>             <span class="p">((</span><span class="no">t</span> <span class="ss">:underline</span> <span class="no">t</span> <span class="ss">:bold</span> <span class="no">t</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">wl-highlight-folder-path-face</span>                    <span class="p">((</span><span class="no">t</span> <span class="ss">:underline</span> <span class="no">t</span> <span class="ss">:bold</span> <span class="no">t</span><span class="p">)))</span>
       <span class="c1">;; whitespace-mode</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">whitespace-trailing</span>                              <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">magenta-intense</span> <span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">whitespace-tab</span>                                   <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">blue-intense</span> <span class="ss">:underline</span> <span class="no">t</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">whitespace-space</span>                                 <span class="p">((</span><span class="no">t</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">green-intense</span> <span class="ss">:bold</span> <span class="no">t</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">whitespace-empty</span>                                 <span class="p">((</span><span class="no">t</span> <span class="ss">:background</span> <span class="o">,</span><span class="nv">red-intense</span> <span class="p">)))</span>
       <span class="c1">;; org-block</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-block</span>                                        <span class="p">((</span><span class="no">t</span> <span class="ss">:background</span> <span class="o">,</span><span class="nv">bg-main</span> <span class="ss">:extend</span> <span class="no">t</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-block-begin-line</span>                             <span class="p">((</span><span class="no">t</span> <span class="ss">:background</span> <span class="o">,</span><span class="nv">bg-main</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-prose-block-delimiter</span> <span class="ss">:extend</span> <span class="no">t</span><span class="p">)))</span>
       <span class="o">`</span><span class="p">(</span><span class="nv">org-block-end-line</span>                               <span class="p">((</span><span class="no">t</span> <span class="ss">:background</span> <span class="o">,</span><span class="nv">bg-main</span> <span class="ss">:foreground</span> <span class="o">,</span><span class="nv">fg-prose-block-delimiter</span> <span class="ss">:extend</span> <span class="no">t</span><span class="p">)))</span>
       <span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orgf37b53c3">modeline: <code>powerline</code>
</h3>
<div class="outline-text-3" id="text-orgf37b53c3">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">powerline</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:defvar</span>
  <span class="p">(</span><span class="nv">skk-indicator-alist</span>
   <span class="nv">skk-hiragana-mode-string</span>
   <span class="nv">skk-katakana-mode-string</span>
   <span class="nv">skk-latin-mode-string</span>
   <span class="nv">skk-jisx0208-latin-mode-string</span>
   <span class="nv">skk-jisx0201-mode-string</span>
   <span class="nv">skk-abbrev-mode-string</span>
   <span class="nv">skk-modeline-input-mode</span>
   <span class="p">)</span>
  <span class="ss">:init</span>
  <span class="c1">;; (defun my:major-mode-icon (mode)</span>
  <span class="c1">;;   "Update file icon in mode-line, just display major-mode icon. not filename."</span>
  <span class="c1">;;   (let* ((icon (all-the-icons-icon-for-mode mode)))</span>
  <span class="c1">;;     (if (symbolp icon)</span>
  <span class="c1">;;         (all-the-icons-faicon "file-code-o"</span>
  <span class="c1">;;                               :face 'all-the-icons-dsilver</span>
  <span class="c1">;;                               :height 1.0)</span>
  <span class="c1">;;       icon)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:skk-init-modeline-input-mode</span> <span class="p">()</span>
    <span class="s">"Custom skkが読み込まれていなくても skk-modeline-input-mode に値を設定"</span>
    <span class="p">(</span><span class="nb">cond</span>
     <span class="p">((</span><span class="nb">not</span> <span class="p">(</span><span class="nb">boundp</span> <span class="ss">'skk-modeline-input-mode</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-modeline-input-mode</span> <span class="s">"--SKK"</span><span class="p">))</span>
     <span class="p">(</span><span class="no">t</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)))</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:skk-modeline-input-mode</span> <span class="p">()</span>
    <span class="s">"Custom: powerline 用に skk の indicator を準備"</span>
    <span class="p">(</span><span class="nb">cond</span>
     <span class="p">((</span><span class="nv">string-match</span> <span class="s">"--SKK"</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)</span> <span class="s">"[--]"</span><span class="p">)</span>
     <span class="p">((</span><span class="nv">string-match</span> <span class="nv">skk-hiragana-mode-string</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)</span> <span class="s">"[あ]"</span><span class="p">)</span>
     <span class="p">((</span><span class="nv">string-match</span> <span class="nv">skk-katakana-mode-string</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)</span> <span class="s">"[ア]"</span><span class="p">)</span>
     <span class="p">((</span><span class="nv">string-match</span> <span class="nv">skk-latin-mode-string</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)</span>    <span class="s">"[_A]"</span><span class="p">)</span>
     <span class="p">((</span><span class="nv">string-match</span> <span class="nv">skk-jisx0208-latin-mode-string</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)</span> <span class="s">"[Ａ]"</span><span class="p">)</span>
     <span class="p">((</span><span class="nv">string-match</span> <span class="nv">skk-jisx0201-mode-string</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)</span> <span class="s">"[_ｱ]"</span><span class="p">)</span>
     <span class="p">((</span><span class="nv">string-match</span> <span class="nv">skk-abbrev-mode-string</span> <span class="nv">skk-modeline-input-mode</span><span class="p">)</span>   <span class="s">"[aA]"</span><span class="p">)</span>
     <span class="p">(</span><span class="no">t</span> <span class="s">"[--]"</span><span class="p">)</span>
     <span class="p">)</span>
    <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:skk-setup-modeline</span> <span class="p">()</span>
    <span class="s">"skk-setup-modeline による modeline の更新を無効化"</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">skk-indicator-alist</span> <span class="p">(</span><span class="nv">skk-make-indicator-alist</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">force-mode-line-update</span> <span class="no">t</span><span class="p">))</span>
  <span class="c1">;;</span>
  <span class="ss">:advice</span> <span class="p">(</span><span class="ss">:override</span> <span class="nv">skk-setup-modeline</span> <span class="nv">my:skk-setup-modeline</span><span class="p">)</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">powerline-buffer-size-suffix</span>    <span class="no">nil</span>
        <span class="nv">powerline-display-hud</span>           <span class="no">nil</span>
        <span class="nv">powerline-display-buffer-size</span>   <span class="no">nil</span>
        <span class="nv">powerline-text-scale-factor</span>      <span class="mi">1</span>
        <span class="nv">powerline-default-separator</span>     <span class="ss">'utf-8</span>
        <span class="nv">powerline-utf-8-separator-left</span>  <span class="m">#xe0b0</span>
        <span class="nv">powerline-utf-8-separator-right</span> <span class="m">#xe0b2</span>
        <span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">my:powerline-theme</span><span class="p">)</span>
  <span class="ss">:config</span>
<span class="c1">;;;###autoload</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my:powerline-theme</span> <span class="p">()</span>
    <span class="s">"Setup the default mode-line."</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">my:skk-init-modeline-input-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">setq-default</span>
     <span class="nv">mode-line-format</span>
     <span class="o">'</span><span class="p">(</span><span class="s">"%e"</span>
       <span class="p">(</span><span class="ss">:eval</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">active</span> <span class="p">(</span><span class="nv">powerline-selected-window-active</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">mode-line-buffer-id</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'mode-line-buffer-id</span> <span class="ss">'mode-line-buffer-id-inactive</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">mode-line</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'mode-line</span> <span class="ss">'mode-line-inactive</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">face0</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'powerline-active0</span> <span class="ss">'powerline-inactive0</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">face1</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'powerline-active1</span> <span class="ss">'powerline-inactive1</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">face2</span> <span class="p">(</span><span class="k">if</span> <span class="nv">active</span> <span class="ss">'powerline-active2</span> <span class="ss">'powerline-inactive2</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">separator-left</span> <span class="p">(</span><span class="nb">intern</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"powerline-%s-%s"</span>
                                               <span class="p">(</span><span class="nv">powerline-current-separator</span><span class="p">)</span>
                                               <span class="p">(</span><span class="nb">car</span> <span class="nv">powerline-default-separator-dir</span><span class="p">))))</span>
               <span class="p">(</span><span class="nv">separator-right</span> <span class="p">(</span><span class="nb">intern</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"powerline-%s-%s"</span>
                                                <span class="p">(</span><span class="nv">powerline-current-separator</span><span class="p">)</span>
                                                <span class="p">(</span><span class="nb">cdr</span> <span class="nv">powerline-default-separator-dir</span><span class="p">))))</span>
               <span class="p">(</span><span class="nv">lhs</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">powerline-raw</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"%s"</span> <span class="p">(</span><span class="nv">my:skk-modeline-input-mode</span><span class="p">))</span> <span class="nv">mode-line</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">"%*"</span> <span class="nv">mode-line</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="nv">mode-line-mule-info</span> <span class="nv">mode-line</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="c1">;; (powerline-raw (my:major-mode-icon major-mode) mode-line 'l)</span>
                          <span class="p">(</span><span class="nv">powerline-buffer-id</span> <span class="nv">mode-line-buffer-id</span> <span class="ss">'l</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">" "</span><span class="p">)</span>
                          <span class="c1">;; (funcall separator-left face0 face1)</span>
                          <span class="p">))</span>
               <span class="p">(</span><span class="nv">rhs</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">powerline-raw</span> <span class="nv">global-mode-string</span> <span class="nv">face1</span> <span class="ss">'r</span><span class="p">)</span>
                          <span class="c1">;; (funcall separator-right face2 face1)</span>
                          <span class="p">(</span><span class="nv">powerline-vc</span> <span class="nv">face1</span> <span class="ss">'r</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="nv">mode-line-misc-info</span> <span class="ss">'r</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">" "</span><span class="p">)</span>
                          <span class="p">(</span><span class="nv">powerline-raw</span> <span class="s">"%6p"</span> <span class="nv">mode-line</span> <span class="ss">'r</span><span class="p">)</span>
                          <span class="p">)))</span>
          <span class="p">(</span><span class="nv">concat</span> <span class="p">(</span><span class="nv">powerline-render</span> <span class="nv">lhs</span><span class="p">)</span>
                  <span class="p">(</span><span class="nv">powerline-fill</span> <span class="nv">face2</span> <span class="p">(</span><span class="nv">powerline-width</span> <span class="nv">rhs</span><span class="p">))</span>
                  <span class="p">(</span><span class="nv">powerline-render</span> <span class="nv">rhs</span><span class="p">))))))</span>
    <span class="p">)</span>
  <span class="c1">;; (my:powerline-theme)</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
</div>
<div>
<h2 id="orgd89ceb4b">Debug&amp;Test</h2>
<div class="outline-text-2" id="text-orgd89ceb4b">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">perfect-margin</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">perfect-margin-visible-width</span> <span class="mi">128</span>
        <span class="nv">perfect-margin-only-set-left-margin</span> <span class="no">nil</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="c1">;; (emacs-startup-hook . perfect-margin-mode)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">dimmer</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">dimmer-fraction</span> <span class="mf">0.07</span> <span class="c1">;; 色の薄くなる比率</span>
        <span class="nv">dimmer-adjustment-mode</span> <span class="ss">:both</span>
        <span class="nv">dimmer-use-colorspace</span> <span class="ss">:rgb</span>
        <span class="nv">dimmer-watch-frame-focus-events</span> <span class="no">nil</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">dimmer-mode</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1">;; (leaf org-side-tree</span>
<span class="c1">;;   :ensure t</span>
<span class="c1">;;  )</span>

<span class="c1">;; (leaf copilot</span>
<span class="c1">;;   :vc (:url "https://github.com/copilot-emacs/copilot.el" :rev :newest :branch "main")</span>
<span class="c1">;;   :init</span>
<span class="c1">;;   (leaf editorconfig :ensure t)</span>
<span class="c1">;;   (leaf s :ensure t)</span>
<span class="c1">;;   (leaf dash :ensure t)</span>
<span class="c1">;;   )</span>
<span class="c1">;; (leaf copilot-chat :ensure t)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">apparmor-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>

<span class="p">(</span><span class="nv">leaf</span> <span class="nv">enh-ruby-mode</span>
  <span class="c1">;; :ensure t</span>
  <span class="ss">:disabled</span> <span class="no">t</span>
  <span class="ss">:advice</span>
  <span class="p">((</span><span class="ss">:override</span> <span class="nv">ruby-mode</span> <span class="nv">enh-ruby-mode</span><span class="p">))</span>
  <span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">my:debug-on-quit-if-scratch</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">_args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">debug-on-quit</span> <span class="p">(</span><span class="nb">string=</span> <span class="p">(</span><span class="nv">buffer-name</span><span class="p">)</span> <span class="s">"*scratch*"</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'window-selection-change-functions</span> <span class="ss">'my:debug-on-quit-if-scratch</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">which-key</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">which-key-show-early-on-C-h</span> <span class="no">t</span>
        <span class="nv">which-key-idle-delay</span> <span class="mi">10000</span>
        <span class="nv">which-key-idle-secondary-delay</span> <span class="mf">0.05</span>
        <span class="nv">which-key-popup-type</span> <span class="ss">'minibuffer</span>
        <span class="p">)</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">which-key-mode</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">rg</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">"rg"</span><span class="p">)</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="p">)</span>
<span class="c1">;;</span>
<span class="c1">;; (leaf mozc-temp</span>
<span class="c1">;;   :init</span>
<span class="c1">;;   (leaf mozc</span>
<span class="c1">;;     :config</span>
<span class="c1">;;     (setq default-input-method "japanese-mozc"))</span>
<span class="c1">;;   :bind* ("C-j" . mozc-temp-convert)</span>
<span class="c1">;;   :require t</span>
<span class="c1">;;   )</span>
<span class="c1">;; (global-set-key (kbd "C-j") #'mozc-temp-convert)</span>
<span class="c1">;;(leaf emacs</span>
<span class="c1">;;  :preface</span>
<span class="c1">;;  (defun my-advice/window-width (fn &amp;rest args)</span>
<span class="c1">;;    (- (apply fn args) 1))</span>
<span class="c1">;;  :advice (:around window-width my-advice/window-width))</span>
<span class="c1">;;</span>
<span class="c1">;; (leaf elfeed</span>
<span class="c1">;;   :if (file-directory-p my:d:password-store)</span>
<span class="c1">;;   :ensure t</span>
<span class="c1">;;   :custom</span>
<span class="c1">;;   `((elfeed-set-timeout  . 36000)</span>
<span class="c1">;;     (elfeed-db-directory . "~/.cache/elfeed"))</span>
<span class="c1">;;   :config</span>
<span class="c1">;;   (leaf elfeed-goodies</span>
<span class="c1">;;     :ensure t</span>
<span class="c1">;;     :config</span>
<span class="c1">;;     (elfeed-goodies/setup))</span>
<span class="c1">;;   ;;</span>
<span class="c1">;;   (leaf elfeed-protocol</span>
<span class="c1">;;     :ensure t</span>
<span class="c1">;;     :config</span>
<span class="c1">;;     (setq elfeed-feeds</span>
<span class="c1">;;           '(("owncloud+https://uwabami@uwabami.junkhub.org/nextcloud"</span>
<span class="c1">;;              :password (password-store-get "Web/uwabami.junkhub.org/nextcloud")</span>
<span class="c1">;;              )</span>
<span class="c1">;;             ))</span>
<span class="c1">;;     (elfeed-protocol-enable)</span>
<span class="c1">;;     )</span>
<span class="c1">;;   )</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">vterm</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">vterm-always-compile-module</span> <span class="no">t</span><span class="p">)</span>
  <span class="ss">:hook</span>
  <span class="p">(</span><span class="nv">vterm-mode-hook</span>
   <span class="o">.</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">setq-local</span> <span class="nv">global-hl-line-mode</span> <span class="no">nil</span><span class="p">)))</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">nginx-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">apache-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">keg</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">keg-mode</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">leaf</span> <span class="nv">atomic-chrome</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:hook</span> <span class="p">(</span><span class="nv">emacs-startup-hook</span> <span class="o">.</span> <span class="nv">atomic-chrome-start-server</span><span class="p">)</span>
  <span class="ss">:config</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">atomic-chrome-enable-auto-update</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">atomic-chrome-url-major-mode-alist</span>
        <span class="o">'</span><span class="p">((</span><span class="s">"overleaf\\.com"</span> <span class="o">.</span> <span class="nv">japanese-latex-mode</span><span class="p">)</span>
          <span class="p">(</span><span class="s">"ja.overleaf\\.com"</span> <span class="o">.</span> <span class="nv">japanese-latex-mode</span><span class="p">)))</span>
  <span class="p">)</span></code></pre></figure>
</div>
</div>
<div>
<h2 id="orgf87c4e84">最後に</h2>
<div class="outline-text-2" id="text-orgf87c4e84">
</div>
<div>
<h3 id="org0bd0c625">
<span class="todo TODO">TODO</span> <code>esup</code>: 起動時間を調べる <code>[/]</code>
</h3>
<div class="outline-text-3" id="text-org0bd0c625">
<p>
本気でやるなら profiler なんだろうけれど.
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">leaf</span> <span class="nv">esup</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">esup-insignificant-time</span> <span class="mf">0.0001</span>
        <span class="nv">esup-depth</span> <span class="mi">0</span> <span class="c1">;; 🤔</span>
        <span class="p">)</span>
  <span class="p">)</span></code></pre></figure>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> <code>early-init.el</code> を見ないので, 読み込まれない設定が多々.
<ul class="org-ul">
<li><a href="https://github.com/jschaf/esup/issues/93">early-init.el is not included in profiling · Issue #93 · jschaf/esup</a></li>
</ul>
</li>
<li>あと, leaf を利用していると,
殆どがマクロ展開で埋まるので,
速度計測の意味が無い…。</li>
</ul>
</div>
</div>
<div>
<h3 id="org8d339cf7">profiler report</h3>
<div class="outline-text-3" id="text-org8d339cf7">
<p>
必要に応じて
</p>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="k">setq</span> <span class="nv">debug-on-error</span> <span class="no">t</span><span class="p">)</span>
<span class="c1">;; (profiler-report)</span>
<span class="c1">;; (profiler-stop)</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="org4c97a1e0">provide の設定</h3>
<div class="outline-text-3" id="text-org4c97a1e0">
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">provide</span> <span class="ss">'init</span><span class="p">)</span></code></pre></figure>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; Local Variables:</span>
<span class="c1">;; byte-compile-warnings: (not cl-functions free-vars docstrings unresolved)</span>
<span class="c1">;; End:</span></code></pre></figure>
<figure class="highlight"><pre><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; Local Variables:</span>
<span class="c1">;; byte-compile-warnings: (not cl-functions free-vars docstrings unresolved)</span>
<span class="c1">;; End:</span></code></pre></figure>
</div>
</div>
<div>
<h3 id="orge8960401">LICENSE</h3>
<div class="outline-text-3" id="text-orge8960401">
<p>
幾つかの関数の元ネタとして Emacs 本体のコードを参照したので,
GPL-3 or later です．
</p>
<pre class="example">
Copyright (C) 2011--2026 Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;
.
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
.
This package is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.
You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.
</pre>
</div>
</div>
</div>

        </div>
      </main>
      <a href="#" class="back_to_top">Back to Top &#9650;</a>
      <hr/>
      <footer>
        <p>&copy; 2006-2026
  <a href="mailto:uwabami@gfd-dennou.org">Youhei SASAKI</a>,
  Lastupdate: 2026-02-10 13:17:35 +0000
  <br/>
  Powered by
  <a href="https://orgmode.org/" rel="noopener" title="Org mode">
    Org mode
  </a>
  +
  <a href="https://jekyllrb.com/" rel="noopener" title="Jekyll">
    Jekyll
  </a>
  +
  <a href="https://picocss.com/" rel="noopener" title="pico.css">
    Pico.css
  </a>
  &amp;
  <a href="https://amp.dev/">
    <span class="icon-amp">⚡</span>AMP
  </a>
</p>

      </footer>
    </div>
    <amp-analytics data-block-on-consent
               type="googleanalytics"
               config="https://uwabami.github.io/assets/ga4.json"
               data-credentials="include"
		       data-block-on-consent>
  <script type="application/json">
    {
        "vars": {
            "GA4_MEASUREMENT_ID": "G-CLB2VW9XEW",
            "GA4_ENDPOINT_HOSTNAME": "www.google-analytics.com",
            "DEFAULT_PAGEVIEW_ENABLED": true,
            "GOOGLE_CONSENT_ENABLED": true,
            "WEBVITALS_TRACKING": false,
            "PERFORMANCE_TIMING_TRACKING": false
        }
    }
  </script>
</amp-analytics>

  </body>
</html>
